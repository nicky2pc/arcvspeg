const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LeaderboardPopup-CYUC3rYi.js","assets/auth-BxfdJgsU.js","assets/vendor-Cs8wUaRe.js","assets/TransactionsTable-Dyu05HAh.js","assets/ethers-BBATp_Pg.js","assets/index-C3S8jdOc.js","assets/index-DIIAfn_-.css","assets/TransactionsTable-CPbYs6qR.css","assets/GameUI-B62Lv5Yi.js","assets/GameUI-BdaF4M79.css","assets/PowerupShop-DDg-hk7Y.js","assets/PowerupShop-PM4tFapF.css"])))=>i.map(i=>d[i]);
import{v as Mn,j as i,r as p,a as Xe,K as Ye,J as Nn,n as Pn,R as te,_ as Re}from"./auth-BxfdJgsU.js";import{B as pe,f as _e,C as be,p as Jt,s as Dn,J as jn}from"./ethers-BBATp_Pg.js";import{u as Fn}from"./index-C3S8jdOc.js";const b={CANVAS_WIDTH:1200,CANVAS_HEIGHT:900,MAX_ENEMIES_BEGINNING:3,MAX_ENEMIES:6,PLAYER_SPEED:2,BULLET_SPEED:5.5,FIRE_RATE:200,BULLET_LIFETIME:3e3,CELL_SIZE:30,MAX_BOUNCES:50,MAX_TRANSACTIONS:1337,MAP:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]};class We{constructor(e,n,r,o,t,a,f,u,l,h){this.x=e,this.y=n,this.speed=o,this.color=t,this.vx=Math.cos(r)*this.speed,this.vy=Math.sin(r)*this.speed,this.spawnTime=Date.now(),this.bounces=0,this.size=a,this.isPlayer=f,this.damage=u,this.type=l,this.lastUpdateTime=performance.now(),this.trail=[],this.image=h}draw(e){if(this.image){const n=Math.atan2(this.vy,this.vx),r=this.size*5.4,o=this.size*3.2;e.save(),e.translate(this.x,this.y),e.rotate(n),e.drawImage(this.image,-r/2,-o/2,r,o),e.restore();return}if(this.type==="ult"){e.save();for(let r=0;r<this.trail.length;r++){const o=this.trail[r];e.globalAlpha=o.alpha;const t=e.createRadialGradient(o.x,o.y,this.size*.2,o.x,o.y,this.size);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(.5,"rgba(255,120,0,0.8)"),t.addColorStop(1,"rgba(255,0,0,0.0)"),e.fillStyle=t,e.beginPath(),e.arc(o.x,o.y,this.size,0,Math.PI*2),e.fill()}e.globalAlpha=1,e.shadowBlur=25,e.shadowColor="rgba(255,120,0,0.9)";const n=e.createRadialGradient(this.x,this.y,this.size*.2,this.x,this.y,this.size*1.4);n.addColorStop(0,"#fff5e6"),n.addColorStop(.4,"#ffb347"),n.addColorStop(1,"rgba(255,0,0,0.35)"),e.fillStyle=n,e.beginPath(),e.arc(this.x,this.y,this.size,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.restore();return}else if(this.type==="fire"){e.shadowBlur=10+Math.sin(performance.now()/100)*5,e.shadowColor="rgba(0, 212, 255, 0.8)";const n=e.createRadialGradient(this.x,this.y,this.size*.2,this.x,this.y,this.size);n.addColorStop(0,"#ffffff"),n.addColorStop(.5,"#00D4FF"),n.addColorStop(1,"#0099CC"),e.fillStyle=n}else e.fillStyle=this.color||"#00D4FF";e.beginPath(),e.arc(this.x,this.y,this.size+(this.type==="fire"?Math.sin(performance.now()/100)*2:0),0,Math.PI*2),e.fill(),e.shadowBlur=0}update(){const e=performance.now();this.lastUpdateTime=e;const n=this.x,r=this.y;if(this.x+=this.vx,this.y+=this.vy,this.type==="ult"){this.trail.unshift({x:this.x,y:this.y,alpha:.5}),this.trail.length>8&&this.trail.pop();for(let o=0;o<this.trail.length;o++)this.trail[o].alpha*=.86}this.checkWallCollision(n,r)}checkWallCollision(e,n){if(this.bounces>=b.MAX_BOUNCES)return;const r=Math.floor(this.x/b.CELL_SIZE),o=Math.floor(this.y/b.CELL_SIZE),t=Math.floor(e/b.CELL_SIZE),a=Math.floor(n/b.CELL_SIZE);if(!(r<0||o<0||o>=b.MAP.length||r>=b.MAP[0].length)&&b.MAP[o][r]===1){const f=r!==t,u=o!==a;f&&(this.vx*=-1),u&&(this.vy*=-1),this.bounces++,this.x=e-this.vx,this.y=n-this.vy}}get isExpired(){return Date.now()-this.spawnTime>b.BULLET_LIFETIME||this.bounces>b.MAX_BOUNCES}}class Kt{constructor(e,n,r,o=b.BULLET_SPEED,t=b.FIRE_RATE,a,f,u,l,h=10){this.shakeOffsetX=0,this.shakeOffsetY=0,this.barrelSize=35,this.width=70,this.height=48,this.hitboxRadius=30,this.barrelThickness=6,this.shootingAnimation=!1,this.x=e,this.y=n,this.angle=0,this.speed=b.PLAYER_SPEED,this.bulletSpeed=o,this.fireRate=t,this.lastShot=0,this.isPlayer=r,this.bulletColor=a,this.health=r?100004:2,this.maxHealth=this.health,this.isBuffed=!1,this.type=f,this.characterImage=u,this.weaponImage=l,this.cornerRadius=h,this.weapon=null,(this.type==="fire"||this.type==="terraLuna")&&(this.width=Math.floor(this.width*1.5),this.height=Math.floor(this.height*1.5),this.hitboxRadius=Math.floor(this.hitboxRadius*1.3),this.health=4,this.maxHealth=4)}draw(e,n){if(e.save(),n)return;e.translate(this.x+this.shakeOffsetX,this.y+this.shakeOffsetY),e.rotate(this.angle);let r=this.width,o=this.height;this.isPlayer&&(r=70,o=35),this.isPlayer&&e.scale(-1,1);const t=this.isPlayer?50:r,a=this.isPlayer?50:o,f=this.weaponImage?this.isPlayer?75:Math.min(r*.6,48):0,u=this.weaponImage?this.isPlayer?30:Math.min(o*.6,24):0;if(this.drawRoundedImage(e,this.characterImage,-t/2+20,-a/2-10,t,a,this.cornerRadius,!0),this.weaponImage){const l=-t*.45,h=window.__ULT_WEAPON_SCALE__,d=h&&h>0?h:1,y=l-f*d*.15,w=-(u*d)*.05,T=window.__ULT_WEAPON_OVERRIDE__??this.weaponImage;this.drawRoundedImage(e,T,y,w,f*d,u*d,Math.max(4,Math.floor(this.cornerRadius/2)),!1)}this.drawHealthBar(e),e.restore()}drawRoundedImage(e,n,r,o,t,a,f,u=!1){const l=Math.min(f,t/2,a/2);e.save(),u&&(e.scale(-1,1),r=-r-t),e.beginPath(),e.moveTo(r+l,o),e.lineTo(r+t-l,o),e.quadraticCurveTo(r+t,o,r+t,o+l),e.lineTo(r+t,o+a-l),e.quadraticCurveTo(r+t,o+a,r+t-l,o+a),e.lineTo(r+l,o+a),e.quadraticCurveTo(r,o+a,r,o+a-l),e.lineTo(r,o+l),e.quadraticCurveTo(r,o,r+l,o),e.closePath(),e.clip(),e.drawImage(n,r,o,t,a),e.restore()}drawHealthBar(e){const o=this.health/this.maxHealth;e.save();const t=this.type==="fire"||this.type==="terraLuna"?45:22;e.translate(20,t),e.fillStyle="#333",e.fillRect(-30/2,0,30,4),e.fillStyle=o>.5?"#0f0":o>.3?"#ff0":"#f00",e.fillRect(-30/2,0,30*o,4),e.restore()}heal(){this.health<this.maxHealth&&this.health++}updatePosition(e,n){this.x=e,this.y=n}shoot(){const e=this.weapon?this.weapon.fireRate:this.fireRate;if(Date.now()-this.lastShot>e){this.lastShot=Date.now();const n=this.x+Math.cos(this.angle)*this.barrelSize,r=this.y+Math.sin(this.angle)*this.barrelSize,o=this.weapon?this.weapon.bulletSize:this.type==="fire"?18:6,t=this.weapon?this.weapon.damage:this.type==="fire"?4:1,a=this.weapon?this.weapon.color:this.bulletColor;return new We(n,r,this.angle,this.bulletSpeed,a,o,this.isPlayer,t,this.type)}return null}takeDamage(e){return this.health-=e,this.applyShake(),this.health<=0?this.isPlayer?!0:Math.floor(Math.random()*10)>5?Math.floor(Math.random()*10)>6?"drop_buff":"drop_heart":"explode":!1}applyShake(){let e=6,n=0;const r=o=>{(!n||o-n>30)&&(this.shakeOffsetX=(Math.random()-.5)*4,this.shakeOffsetY=(Math.random()-.5)*4,e--,n=o),e>0?requestAnimationFrame(r):(this.shakeOffsetX=0,this.shakeOffsetY=0)};requestAnimationFrame(r)}}class He extends Kt{constructor(e,n,r=b.BULLET_SPEED,o=b.FIRE_RATE,t=1.5,a,f,u,l){super(e,n,!1,r,o,a,u,l),this.targetX=e,this.targetY=n,this.moveCooldown=Date.now()+this.getRandomCooldown(),this.moveSpeed=t,this.spawnTime=f,this.type=u,this.lastUpdateTime=performance.now()}updateAI(e,n){const r=e-this.x,o=n-this.y;this.angle=Math.atan2(o,r),Date.now()>this.moveCooldown&&(this.targetX=this.x+(Math.random()-.5)*400,this.targetY=this.y+(Math.random()-.5)*400,this.moveCooldown=Date.now()+this.getRandomCooldown(),this.targetX=Math.max(45,Math.min(b.CANVAS_WIDTH-45,this.targetX)),this.targetY=Math.max(45,Math.min(b.CANVAS_HEIGHT-45,this.targetY)));const t=this.moveSpeed*.01;return this.x=this.lerp(this.x,this.targetX,t),this.y=this.lerp(this.y,this.targetY,t),this.x=Math.max(45,Math.min(b.CANVAS_WIDTH-45,this.x)),this.y=Math.max(45,Math.min(b.CANVAS_HEIGHT-45,this.y)),Date.now()-this.lastShot>this.fireRate&&Date.now()-700>this.spawnTime?this.shoot():null}lerp(e,n,r){const o=Math.min(1,Math.max(0,r));return e+(n-e)*o}getRandomCooldown(){return Math.floor(Math.random()*1e3+600)}static createDeathParticles(e,n){const o=[];for(let t=0;t<30;t++){const a=Math.PI*2*t/30+Math.random()*.5,f=2+Math.random()*4;o.push({x:e+(Math.random()-.5)*10,y:n+(Math.random()-.5)*10,vx:Math.cos(a)*f,vy:Math.sin(a)*f,created:Date.now(),size:2+Math.random()*3,alpha:1})}return o}}class Zt{constructor(e,n){this.lifetime=5e3,this.x=e,this.y=n,this.spawnTime=Date.now()}draw(e){e.font="22px 'Luckiest Guy', system-ui",e.textAlign="center",e.textBaseline="middle",e.fillText("üíµ",this.x,this.y)}isExpired(){return Date.now()-this.spawnTime>this.lifetime}}class Ln extends Zt{drawBuff(e){e.font="22px 'Luckiest Guy', system-ui",e.textAlign="center",e.textBaseline="middle",e.fillText("‚ö°",this.x,this.y)}}class On{constructor(e,n,r,o,t,a=10){this.fireRate=e,this.bulletSize=n,this.damage=r,this.color=o,this.image=t,this.barrelOffset=a}}const ze=new Map,ue=s=>{const e=ze.get(s);return e?Promise.resolve(e):new Promise((n,r)=>{const o=new Image;o.src=s,o.onload=()=>{ze.set(s,o),n(o)},o.onerror=t=>r(t)})},Bn=s=>ze.get(s),Un=async s=>{await Promise.all(s.map(e=>ue(e).catch(()=>{})))},G={IRON:"iron",BASIC_CASH:"basicCash",TERRA_LUNA:"terraLuna"},Gn={[G.IRON]:"#FFD700",[G.BASIC_CASH]:"#8A2BE2",[G.TERRA_LUNA]:"#DAA520"},Gt={[G.IRON]:"/chars/enemies/iron-enemy.png",[G.BASIC_CASH]:"/chars/enemies/basis-enemy.png",[G.TERRA_LUNA]:"/chars/enemies/luna-enemy.png"};function Wt(s,e,n,r,o,t){var $;if(s.length>=b.MAX_ENEMIES)return s;const a=100,f=a+Math.random()*(b.CANVAS_WIDTH-a*2),u=a+Math.random()*(b.CANVAS_HEIGHT-a*2);let l=Math.min(1+e*.1,2.5),h;r==="fire"||r===G.TERRA_LUNA?h=G.TERRA_LUNA:h=Math.random()<.5?G.IRON:G.BASIC_CASH;let d,y,w,v;switch(h){case G.TERRA_LUNA:d=2.5*o,y=600,w=4*o,v=8;break;case G.IRON:const P=(1+Math.random()*.8)*o;d=Math.min(P*l,3.5),y=Math.max(2200/l,900),w=(.4+Math.random()*.3)*o*l,v=2;break;case G.BASIC_CASH:default:const Q=(1.2+Math.random()*.6)*o;d=Math.min(Q*l,3),y=Math.max(2800/l,1e3),w=(.5+Math.random()*.5)*o*l,v=1;break}const T=Gt[h]||Gt[G.BASIC_CASH];let E=Bn(T);if(!E){const P=new Image;P.src=T,E=P}const F=Gn[h]||"#FF0000",L=($=t==null?void 0:t.weapons)==null?void 0:$[0],R=n?Date.now()+3e3:Date.now(),I=new He(f,u,d,y,w,F,R,h,E);I.health=v,I.maxHealth=v;const B=h===G.TERRA_LUNA?3:1,N=h===G.TERRA_LUNA?18:8;return I.weapon=new On(y,N,B,F,L),s.push(I),s}const Wn=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"address",name:"owner",type:"address"}],name:"ERC721IncorrectOwner",type:"error"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ERC721InsufficientApproval",type:"error"},{inputs:[{internalType:"address",name:"approver",type:"address"}],name:"ERC721InvalidApprover",type:"error"},{inputs:[{internalType:"address",name:"operator",type:"address"}],name:"ERC721InvalidOperator",type:"error"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"ERC721InvalidOwner",type:"error"},{inputs:[{internalType:"address",name:"receiver",type:"address"}],name:"ERC721InvalidReceiver",type:"error"},{inputs:[{internalType:"address",name:"sender",type:"address"}],name:"ERC721InvalidSender",type:"error"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ERC721NonexistentToken",type:"error"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"OwnableInvalidOwner",type:"error"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"OwnableUnauthorizedAccount",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_fromTokenId",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_toTokenId",type:"uint256"}],name:"BatchMetadataUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_tokenId",type:"uint256"}],name:"MetadataUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"MAX_PER_WALLET",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"MAX_SUPPLY",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"wallet",type:"address"}],name:"getWalletMints",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"string",name:"tokenURI",type:"string"},{internalType:"bytes32",name:"hehash",type:"bytes32"},{internalType:"uint256",name:"timestamp",type:"uint256"}],name:"mint",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_newTokenURI",type:"string"}],name:"setDefaultTokenURI",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"bytes32",name:"hehash",type:"bytes32"},{internalType:"uint256",name:"timestamp",type:"uint256"}],name:"simpleMint",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalMinted",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"}],Hn=[{inputs:[{internalType:"string",name:"_score",type:"string"}],name:"setScore",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"score",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}],Ht="0xF72e3EE1798eEE077d72912ED7245f3Dd2c72cF7",zt="0x7D6a748C89C902dDDD5F7B30B840136953Fb933b",Me="https://gameapi.monadassistant.xyz",he=new Map;let we=null,ie=null;const zn=30000n,$t=15n,$n=Jt("2","gwei");function Vt(s,e){return s*(100n+e)/100n}async function Vn(s,e){const n=BigInt(Date.now());if(we&&n-BigInt(we.ts)<zn)return e>0?Vt(we.gasPrice,$t):we.gasPrice;const o=(await s.getFeeData()).gasPrice??$n;return we={ts:Number(n),gasPrice:o},e>0?Vt(o,$t):o}async function Xn(s,e){return ie||(ie=await s.setScore.estimateGas(`${e}`)*120n/100n,ie)}let j=null,ae=!1,se=null,Ne=0;const Qt=()=>{Ne=0},Yn=()=>Ne,qn=()=>{let s=localStorage.getItem("playerId");return s||(s=Mn(),localStorage.setItem("playerId",s??"")),s},Xt={},Ie=(s,e,n,r=20)=>{if(!e)return n;r<0&&(r=0);let o=Xt[s],t;return o?t=o.cloneNode(!0):(t=new Audio(s),Xt[s]=t),t.volume=r/100*.15,n.push(t),t.play(),t.onended=()=>{n=n.filter(a=>a!==t)},n},oe=(s,e,n,r,o=20)=>{if(!n||!s||!s[e]||s[e].length===0)return r;const t=Math.floor(Math.random()*s[e].length),a=s[e][t].cloneNode(!0);return a.volume=o/100*.5,r.push(a),a.play(),a.onended=()=>{r=r.filter(f=>f!==a)},r},en=async()=>{const s={kill:[],death:[],hit:[],shoot:[],dash:[],ult:[]};for(let n=1;n<=2;n++){const r=new Audio(`/sound/kill/kill${n}.mp3`);r.volume=.05,s.kill.push(r)}for(let n=2;n<=5;n++){const r=new Audio(`/sound/ult/ult${n}.mp3`);r.volume=.05,s.ult.push(r)}for(let n=1;n<=1;n++){const r=new Audio(`/sound/dash/dash${n}.mp3`);r.volume=.05,s.dash.push(r)}for(let n=1;n<=1;n++){const r=new Audio(`/sound/death/death${n}.mp3`);r.volume=.02,s.death.push(r)}for(let n=1;n<=3;n++){const r=new Audio(`/sound/hit/hit${n}.mp3`);r.volume=.01,s.hit.push(r)}return[new Audio("/sound/shoot/shoot.MP3")].forEach(n=>{n.volume=.01,s.shoot.push(n)}),s},tn=async(s,e,n,r,o,t=!1,a,f,u=0)=>{try{if(s===1&&(j=null,ae=!1,se=null),!o)return{error:"User not authenticated"};if(!e||e.length===0)return{error:"No wallet found. Try to re-login to privy"};const l=e.find(N=>N.walletClientType==="privy");if(!l)return{error:"Privy wallet not found"};const h=await l.getEthereumProvider(),d=new pe(h),y=await d.getSigner(),w=await y.getAddress(),v=new be(Ht,Hn,y),T=await Vn(d,u),E=await Xn(v,s),F=Number(E);let L;he.has(w)?L=he.get(w)+1:L=await d.getTransactionCount(w,"latest"),he.set(w,L);const R={to:Ht,from:w,nonce:L,gasLimit:F,gasPrice:T,chainId:5042002,data:v.interface.encodeFunctionData("setScore",[`${s}`])},I=await y.sendTransaction(R).catch(async N=>{if(N.message.includes("json")||N.message.includes("JSON"))return console.error("JSON parsing error, retrying with delay..."),await new Promise($=>setTimeout($,2e3)),y.sendTransaction(R);throw N}),B=await I.wait().catch(async N=>{if(N.message.includes("json")||N.message.includes("JSON"))return console.error("JSON parsing error during receipt wait, retrying..."),await new Promise($=>setTimeout($,2e3)),I.wait();throw N});return!ie&&(B!=null&&B.gasUsed)&&(ie=B.gasUsed*120n/100n,console.log("gasLimitCache",ie)),Ne+=1,t&&I.hash&&!ae&&I.hash!==se&&(Ae(w,s,I.hash,a,n,r,f),ae=!0,se=I.hash),j={address:w,score:s,hash:I.hash},{tx_url:`https://testnet.arcscan.app/tx/${I.hash}`,error:""}}catch(l){console.error("Err:",l);let h="Unknown error";if(l instanceof Error){const d=l.message.toLowerCase(),y=l;if(d.includes("insufficient balance")||d.includes("signer had insufficient balance"))return h="No USDC left, you can <a href='#' class='interactive-link' data-action='logout'>play as a guest</a> or <a href='#' class='interactive-link' data-action='faucet'>use Faucet</a>",j&&j.address&&!ae&&j.hash!==se&&(await Ae(j.address,j.score,j.hash,j.user,n,r,f),ae=!0,se=j.hash),{error:l instanceof Error?h:"Unknown error"};if(u<2&&(d.includes("nonce")||d.includes("replacement transaction underpriced")||d.includes("transaction underpriced")||d.includes("already known")||d.includes("revert")||d.includes("missing revert data")||d.includes("json")||d.includes("unexpected end")||d.includes("failed to execute")||d.includes("HTTP request failed")||y.code&&(y.code==="NONCE_EXPIRED"||y.code==="REPLACEMENT_UNDERPRICED"||y.code==="TRANSACTION_REPLACED"||y.code==="UNPREDICTABLE_GAS_LIMIT"||y.code==="SERVER_ERROR"||y.code==="NETWORK_ERROR"||y.code==="TIMEOUT"||y.code==="UNKNOWN_ERROR")))return console.log(`Retrying sendTransaction... Attempt ${u+1}, Error: ${y.code||d}`),await new Promise(w=>setTimeout(w,2e3)),tn(s,e,n,r,o,t,a,f,u+1);if(y.code)switch(y.code){case"NONCE_EXPIRED":h="Transaction sequence error. Please reload the page and try again.";break;case"REPLACEMENT_UNDERPRICED":h="Gas price too low for replacement. Please try again.";break;case"TRANSACTION_REPLACED":h="Transaction was replaced by another transaction.";break;case"UNPREDICTABLE_GAS_LIMIT":h="Unable to estimate gas. The transaction may fail.";break;case"ACTION_REJECTED":h="You rejected the transaction. Please try again.";break;case"INSUFFICIENT_FUNDS":h="No USDC left, you can <a href='#' class='interactive-link' data-action='logout'>play as a guest</a> or <a href='#' class='interactive-link' data-action='faucet'>use Faucet</a>";break;case"SERVER_ERROR":h="Server connection error. Please check your internet and try again.";break;case"NETWORK_ERROR":h="Network connection error. Please check your internet and try again.";break;case"TIMEOUT":h="Request timed out. Please try again.";break;default:d.includes("json")||d.includes("unexpected end")?h="Network error. Please reload the page and try again.":d.includes("insufficient balance")||d.includes("signer had insufficient balance")?h="No USDC left, you can <a href='#' class='interactive-link' data-action='logout'>play as a guest</a> or <a href='#' class='interactive-link' data-action='faucet'>use Faucet</a>":d.includes("replacement transaction underpriced")?h="Transaction nonce error. Please reload the page and try again.":d.includes("gas")||d.includes("fee")?h="Gas fee error. Network might be congested.":d.includes("rejected")||d.includes("denied")?h="Transaction was rejected. Please try again.":d.includes("timeout")||d.includes("timed out")?h="Transaction timed out. Network might be slow.":d.includes("network")||d.includes("connection")?h="Network connection error. Please check your internet.":d.includes("revert")||d.includes("missing revert data")?h="Missing revert data.":h=l.message}else d.includes("json")||d.includes("unexpected end")?h="Network error. Please reload the page and try again.":d.includes("insufficient balance")||d.includes("signer had insufficient balance")?h="No USDC left, you can <a href='#' class='interactive-link' data-action='logout'>play as a guest</a> or <a href='#' class='interactive-link' data-action='faucet'>use Faucet</a>":d.includes("replacement transaction underpriced")?h="Transaction nonce error. Please reload the page and try again.":d.includes("gas")||d.includes("fee")?h="Gas fee error. Network might be congested.":d.includes("rejected")||d.includes("denied")?h="Transaction was rejected. Please try again.":d.includes("timeout")||d.includes("timed out")?h="Transaction timed out. Network might be slow.":d.includes("network")||d.includes("connection")?h="Network connection error. Please check your internet.":d.includes("revert")||d.includes("missing revert data")?h="Missing revert data.":h=l.message}return j&&j.address&&!ae&&j.hash!==se&&(await Ae(j.address,j.score,j.hash,j.user,n,r,f),ae=!0,se=j.hash),{error:l instanceof Error?h:"Unknown error"}}},Ae=async(s,e,n,r,o,t,a)=>{const f=btoa(n),u=await fetch(`${Me}/api/v1/game/dead`,{method:"POST",headers:{"Content-Type":"application/json","Privy-Id-Token":t?`Bearer ${t}`:"","Game-Session-Token":f,"x-transaction-count":String(Ne)},body:JSON.stringify(a)});if(!u.ok)throw new Error(`Err: ${u.statusText}`);await u.json()},Jn=async({score:s,isDead:e=!1,unitType:n})=>{try{const r={unit:n||"FLY"},o=localStorage.getItem("guestId");return o?await(await fetch(`${Me}/api/v1/game/guest_mode/killed`,{method:"POST",headers:{"Content-Type":"application/json","Guest-Id-Token":o},body:JSON.stringify(r)})).json():{error:"Guest ID not found"}}catch(r){return console.error("Err:",r),{error:"Server error"}}},nn=async(s,e,n=0,r=null)=>{try{if(!e)return{error:"User not authenticated"};if(!s||s.length===0)return{error:"No wallet found. Try to re-login to privy"};const o=s.find(E=>E.walletClientType==="privy");if(!o)return{error:"Privy wallet not found"};const t=await o.getEthereumProvider(),a=new pe(t),f=await a.getSigner(),u=await f.getAddress(),l=await a.getBalance(u),h=new be(zt,Wn,f),d=h.connect(f),w=(await a.getFeeData()).gasPrice??Jt("0.0002","ether"),v=Math.floor(Date.now()/1e3),T=Dn(["uint256"],[v]);try{const F=await h.getFunction("simpleMint").estimateGas(u,T,v),L=Math.floor(Number(F)*1.3),R=w*BigInt(L);if(l<R)return{error:"No USDC left, you can <a href='#' class='interactive-link' data-action='logout'>play as a guest</a> or <a href='#' class='interactive-link' data-action='faucet'>use Faucet</a>"};let I;he.has(u)?I=he.get(u)+1:I=await a.getTransactionCount(u,"latest"),he.set(u,I);const B={to:zt,from:u,nonce:I,gasLimit:L,gasPrice:w,chainId:5042002,data:h.interface.encodeFunctionData("simpleMint",[u,T,v])},N=await f.sendTransaction(B).catch(async P=>{if(console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:",P),P.message.includes("json")||P.message.includes("JSON"))return console.error("JSON parsing error, retrying with delay..."),await new Promise(Q=>setTimeout(Q,2e3)),f.sendTransaction(B);throw P}),$=await N.wait().catch(async P=>{if(console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–∂–∏–¥–∞–Ω–∏–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:",P),P.message.includes("json")||P.message.includes("JSON"))return console.error("JSON parsing error during receipt wait, retrying..."),await new Promise(Q=>setTimeout(Q,2e3)),N.wait();throw P});return{tx_url:`https://testnet.arcscan.app/tx/${N.hash}`,userAddress:u,error:""}}catch(E){throw console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ –≥–∞–∑–∞:",E),E}}catch(o){console.error("Err:",o);let t="Unknown error";if(o instanceof Error){const a=o.message.toLowerCase(),f=o;if(console.log("Detailed error info:",{message:o.message,code:f.code,data:f.data,reason:f.reason,errorArgs:f.errorArgs,transaction:f.transaction}),n<10&&(a.includes("nonce")||a.includes("replacement transaction underpriced")||a.includes("transaction underpriced")||a.includes("already known")||a.includes("revert")||a.includes("missing revert data")||a.includes("json")||a.includes("unexpected end")||a.includes("failed to execute")||f.code&&(f.code==="NONCE_EXPIRED"||f.code==="REPLACEMENT_UNDERPRICED"||f.code==="TRANSACTION_REPLACED"||f.code==="UNPREDICTABLE_GAS_LIMIT"||f.code==="SERVER_ERROR"||f.code==="NETWORK_ERROR"||f.code==="TIMEOUT"))){console.log(`Retrying mint... Attempt ${n+1}, Error: ${f.code||a}`),await new Promise(l=>setTimeout(l,2e3));const u=r!==null?r+BigInt(n+1):BigInt(n+1);return nn(s,e,n+1,u)}if(f.code)switch(f.code){case"NONCE_EXPIRED":t="Transaction sequence error. Please reload the page and try again.";break;case"REPLACEMENT_UNDERPRICED":t="Gas price too low for replacement. Please try again.";break;case"TRANSACTION_REPLACED":t="Transaction was replaced by another transaction.";break;case"UNPREDICTABLE_GAS_LIMIT":t="Unable to estimate gas. The transaction may fail.";break;case"ACTION_REJECTED":t="You rejected the transaction. Please try again.";break;case"INSUFFICIENT_FUNDS":t="No USDC left, you can <a href='#' class='interactive-link' data-action='logout'>play as a guest</a> or <a href='#' class='interactive-link' data-action='faucet'>use Faucet</a>";break;case"SERVER_ERROR":t="Server connection error. Please check your internet and try again.";case"NETWORK_ERROR":t="Network connection error. Please check your internet and try again.";break;case"TIMEOUT":t="Request timed out. Please try again.";break;default:a.includes("json")||a.includes("unexpected end")?t="Network error. Please reload the page and try again.":a.includes("insufficient balance")||a.includes("signer had insufficient balance")?t="No USDC left, you can <a href='#' class='interactive-link' data-action='logout'>play as a guest</a> or <a href='#' class='interactive-link' data-action='faucet'>use Faucet</a>":a.includes("replacement transaction underpriced")?t="Transaction nonce error. Please reload the page and try again.":a.includes("gas")||a.includes("fee")?t="Gas fee error. Network might be congested.":a.includes("rejected")||a.includes("denied")?t="Transaction was rejected. Please try again.":a.includes("timeout")||a.includes("timed out")?t="Transaction timed out. Network might be slow.":a.includes("network")||a.includes("connection")?t="Network connection error. Please check your internet.":a.includes("revert")||a.includes("missing revert data")?t="Missing revert data.":t=o.message}else a.includes("json")||a.includes("unexpected end")?t="Network error. Please reload the page and try again.":a.includes("insufficient balance")||a.includes("signer had insufficient balance")?t="No USDC left, you can <a href='#' class='interactive-link' data-action='logout'>play as a guest</a> or <a href='#' class='interactive-link' data-action='faucet'>use Faucet</a>":a.includes("replacement transaction underpriced")?t="Transaction nonce error. Please reload the page and try again.":a.includes("gas")||a.includes("fee")?t="Gas fee error. Network might be congested.":a.includes("rejected")||a.includes("denied")?t="Transaction was rejected. Please try again.":a.includes("timeout")||a.includes("timed out")?t="Transaction timed out. Network might be slow.":a.includes("network")||a.includes("connection")?t="Network connection error. Please check your internet.":a.includes("revert")||a.includes("missing revert data")?t="Missing revert data.":t=o.message}return{error:o instanceof Error?t:"Unknown error"}}},Kn=async()=>{const s=await fetch("https://gameapi.monadassistant.xyz/get_top_10_scores_not_auth",{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Error getting leaderboard: ${s.statusText}`);return await s.json()},Zn=async()=>{const s=await fetch("https://gameapi.monadassistant.xyz/get_top_10_scores_auth",{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Error getting leaderboard: ${s.statusText}`);return await s.json()},rn=async s=>{try{if(!s)return console.error("No wallet provided to getFormattedBalance"),"0.0000";const e=await s.getEthereumProvider(),r=await new pe(e).getBalance(s.address);return Number(_e(r)).toFixed(4)}catch(e){return console.error("Error getting balance:",e),"0.0000"}},Qn=async s=>await(await fetch(`${Me}/api/v1/users/me`,{method:"GET",headers:{"Content-Type":"application/json","Privy-Id-Token":s?`Bearer ${s}`:""}})).json(),er=async(s,e)=>{try{const n=await fetch(`${Me}/api/v1/game/crane?address=${s}`,{method:"POST",headers:{"Content-Type":"application/json","Privy-Id-Token":e?`Bearer ${e}`:""}});if(!n.ok){const o=await n.text();throw console.error("Faucet API error response:",o),new Error(`Error: ${n.statusText}. Details: ${o}`)}const r=await n.json();return r&&"mon"in r?{...r,error:""}:r.deadline_seconds?{...r,error:"Faucet is on cooldown."}:r}catch(n){return{error:n instanceof Error?n.message:"Unknown error"}}},Rr=Object.freeze(Object.defineProperty({__proto__:null,checkMyScore:Qn,faucet:er,getAuthLeaderBoard:Zn,getFormattedBalance:rn,getGameTransactionCount:Yn,getLeaderBoard:Kn,getOrCreatePlayerId:qn,loadSounds:en,mint:nn,playRandomSound:oe,playSound:Ie,resetGameTransactionCount:Qt,sendTransaction:tn,sendTransactionAsGuest:Jn,setScoreOnDeath:Ae},Symbol.toStringTag,{value:"Module"})),W={chainId:5042002,rpc:"https://rpc.testnet.arc.network",explorer:"https://testnet.arcscan.app",faucet:"https://faucet.circle.com"},tr=["function mintTrophy(string validationString, string tokenURI, uint256 score) external","function getScore(uint256 tokenId) view returns (uint256)","function ownerOf(uint256 tokenId) view returns (address)","function totalSupply() view returns (uint256)","function minScoreToMint() view returns (uint256)","event TrophyMinted(address indexed player, uint256 indexed tokenId, uint256 score)"],an=["function buyShield(uint256 quantity) external payable","function buySpeedBoost(uint256 quantity) external payable","function buyDoubleDamage(uint256 quantity) external payable","function donate(string message) external payable","function getPlayerPowerups(address player) view returns (uint256 shields, uint256 speedBoosts, uint256 doubles, uint256 spent)","function getPrices() view returns (uint256 shield, uint256 speed, uint256 double)","event PowerupPurchased(address indexed player, string powerupType, uint256 amount)","event DonationReceived(address indexed donor, uint256 amount, string message)"];let $e="0x2A4cAF0e6e2D256854cb159EAc574428f5a1509D",qe="0x37e80527E81Af0789c0551F8948dF812Fb45801E";const nr=()=>{const s=localStorage.getItem("arc_nft_contract"),e=localStorage.getItem("arc_game_actions");s&&($e=s),e&&(qe=e)};nr();const Yt="ipfs://bafkreicdqmt5zw6yhm3g4ugj3gqfs5jh562qydyzfeevycrjky5sah7ske";function rr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})}function ar(){const s=Math.floor(Date.now()/1e3),e=rr();return`${s}__${e}`}const sr=s=>`${W.explorer}/tx/${s}`;async function sn(s,e){const r=await new pe(s).getNetwork();if(Number(r.chainId)!==W.chainId){e==null||e("Switching to Arc Testnet...");try{await s.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${W.chainId.toString(16)}`}]})}catch(o){if(o.code===4902)await s.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${W.chainId.toString(16)}`,chainName:"Arc Testnet",rpcUrls:[W.rpc],nativeCurrency:{name:"USDC",symbol:"USDC",decimals:18},blockExplorerUrls:[W.explorer]}]});else throw o}}return new pe(s)}const or=async(s,e,n=0,r)=>{var o,t,a,f;try{if(!$e)throw new Error("NFT contract address not configured");r==null||r("Connecting to Arc Testnet...");const u=await s.getEthereumProvider(),h=await(await sn(u,r)).getSigner(),d=await h.getAddress();r==null||r("Preparing trophy mint...");const y=new be($e,tr,h),w=ar();let v=500000n;try{v=await y.mintTrophy.estimateGas(w,Yt,e)*130n/100n}catch{console.warn("Gas estimation failed, using default limit")}r==null||r("Minting trophy NFT...");const T=await y.mintTrophy(w,Yt,e,{gasLimit:v});r==null||r("Waiting for confirmation...");const E=await T.wait();return r==null||r("Trophy minted!"),E.hash||T.hash}catch(u){throw console.error("Mint error:",u),(o=u.message)!=null&&o.includes("Score too low")?new Error("Score too low to mint trophy (minimum 5 required)"):(t=u.message)!=null&&t.includes("Validation expired")?new Error("Transaction took too long, please try again"):(a=u.message)!=null&&a.includes("UUID already used")?new Error("Please try again"):(f=u.message)!=null&&f.includes("user rejected")?new Error("Transaction rejected by user"):new Error(u.message||"Failed to mint trophy")}},_r=async(s,e,n=1,r)=>{var o,t,a,f,u;try{const l=qe||"0x37e80527E81Af0789c0551F8948dF812Fb45801E";if(!l)throw new Error("Game Actions contract not configured");if(!s)throw new Error("Wallet not connected");r==null||r("Connecting to Arc Testnet...");const h=await s.getEthereumProvider(),y=await(await sn(h,r)).getSigner(),w=new be(l,an,y);r==null||r("Getting prices...");const[v,T,E]=await w.getPrices();let F,L,R;switch(e){case"shield":F=v,L="buyShield",R="Shield";break;case"speed":F=T,L="buySpeedBoost",R="Speed Boost";break;case"double":F=E,L="buyDoubleDamage",R="Double Damage";break}const I=F*BigInt(n);r==null||r(`Confirm ${R} for ${_e(I)} USDC...`);const B=await w[L](n,{value:I});return r==null||r("Waiting for confirmation..."),await B.wait(),r==null||r("Powerup purchased!"),B.hash}catch(l){throw console.error("Powerup purchase error:",l),(o=l.message)!=null&&o.includes("Insufficient payment")||(t=l.message)!=null&&t.includes("insufficient funds")?new Error("Insufficient USDC balance"):(a=l.message)!=null&&a.includes("user rejected")||(f=l.message)!=null&&f.includes("User rejected")?new Error("Transaction rejected"):(u=l.message)!=null&&u.includes("ACTION_REJECTED")?new Error("Transaction rejected"):new Error(l.message||"Failed to purchase powerup")}},ir=async s=>{const e=qe||"0x37e80527E81Af0789c0551F8948dF812Fb45801E";if(!e)return console.log("getPlayerPowerups: No contract address configured"),{shields:0,speedBoosts:0,doubles:0,spent:"0"};try{console.log("getPlayerPowerups: Fetching for",s,"from contract",e);const n=new jn(W.rpc),r=new be(e,an,n),[o,t,a,f]=await r.getPlayerPowerups(s);return console.log("getPlayerPowerups result:",{shields:o.toString(),speedBoosts:t.toString(),doubles:a.toString()}),{shields:Number(o),speedBoosts:Number(t),doubles:Number(a),spent:_e(f)}}catch(n){return console.error("Failed to get powerups:",n),{shields:0,speedBoosts:0,doubles:0,spent:"0"}}},cr=({onClose:s})=>{const e=()=>{window.open(W.faucet,"_blank")};return i.jsx("div",{onClick:s,style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:i.jsxs("div",{onClick:n=>n.stopPropagation(),style:{position:"relative",background:"linear-gradient(135deg, #0a1929 0%, #051420 100%)",padding:"40px 30px",borderRadius:"20px",width:"90%",maxWidth:"480px",textAlign:"center",border:"2px solid #00D4FF",boxShadow:"0 0 40px rgba(0, 212, 255, 0.4), inset 0 0 60px rgba(0, 212, 255, 0.03)"},children:[i.jsx("button",{onClick:s,style:{position:"absolute",top:"16px",right:"16px",background:"none",border:"none",color:"#00D4FF",fontSize:"24px",cursor:"pointer",opacity:.7,transition:"opacity 0.2s"},onMouseEnter:n=>n.currentTarget.style.opacity="1",onMouseLeave:n=>n.currentTarget.style.opacity="0.7",children:"‚úï"}),i.jsx("div",{style:{marginBottom:"20px"},children:i.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",style:{margin:"0 auto"},children:[i.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#00D4FF",strokeWidth:"2",fill:"none"}),i.jsx("path",{d:"M12 6v2m0 8v2m-6-6h2m8 0h2",stroke:"#00D4FF",strokeWidth:"2",strokeLinecap:"round"}),i.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"#00D4FF"})]})}),i.jsx("h2",{style:{color:"#00D4FF",fontSize:"28px",margin:"0 0 16px 0",fontWeight:"bold",fontFamily:"'Orbitron', sans-serif",textShadow:"0 0 20px rgba(0, 212, 255, 0.5)"},children:"Get Testnet USDC"}),i.jsxs("p",{style:{color:"#E0F7FF",fontSize:"16px",lineHeight:"1.6",marginBottom:"28px",opacity:.9},children:["You need USDC on ",i.jsx("strong",{children:"Arc Testnet"})," to mint your Trophy NFT and pay for gas."]}),i.jsx("button",{onClick:e,style:{display:"block",width:"100%",padding:"18px 32px",background:"linear-gradient(90deg, #00D4FF 0%, #0099CC 100%)",color:"#0a1929",fontWeight:"bold",fontSize:"18px",fontFamily:"'Orbitron', sans-serif",borderRadius:"32px",border:"none",cursor:"pointer",boxShadow:"0 4px 20px rgba(0, 212, 255, 0.5)",marginBottom:"20px",transition:"all 0.3s ease"},onMouseEnter:n=>{n.currentTarget.style.transform="translateY(-3px)",n.currentTarget.style.boxShadow="0 8px 30px rgba(0, 212, 255, 0.7)"},onMouseLeave:n=>{n.currentTarget.style.transform="translateY(0)",n.currentTarget.style.boxShadow="0 4px 20px rgba(0, 212, 255, 0.5)"},children:"Open Circle Faucet"}),i.jsx("div",{style:{background:"rgba(0, 212, 255, 0.1)",borderRadius:"12px",padding:"16px",marginTop:"8px"},children:i.jsxs("p",{style:{color:"#E0F7FF",fontSize:"14px",margin:0,opacity:.8},children:[i.jsx("strong",{children:"Steps:"}),i.jsx("br",{}),'1. Select "Arc Testnet" on the faucet',i.jsx("br",{}),"2. Paste your wallet address",i.jsx("br",{}),"3. Request USDC and return here"]})})]})})},lr=({onClose:s,onCheckAgain:e,isChecking:n})=>i.jsx("div",{onClick:s,style:{position:"absolute",top:0,left:0,width:"1200px",height:"900px",backgroundColor:"rgba(0, 0, 0, 0.85)",backdropFilter:"blur(4px)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:i.jsxs("div",{onClick:r=>r.stopPropagation(),style:{position:"relative",background:"linear-gradient(135deg, #0a1929 0%, #051420 100%)",padding:"40px 38px 20px 38px",borderRadius:"20px",width:"500px",minHeight:"300px",margin:"0 auto",border:"2px solid #00D4FF",boxShadow:"0 0 40px rgba(0, 212, 255, 0.4), inset 0 0 60px rgba(0, 212, 255, 0.03)"},children:[i.jsx("button",{onClick:s,style:{position:"absolute",top:"16px",right:"16px",background:"none",border:"none",color:"#00D4FF",fontSize:"24px",cursor:"pointer",opacity:.7,transition:"opacity 0.2s"},onMouseEnter:r=>r.currentTarget.style.opacity="1",onMouseLeave:r=>r.currentTarget.style.opacity="0.7",children:"‚úï"}),i.jsx("h2",{style:{color:"#00D4FF",marginBottom:"20px",marginTop:"12px",textAlign:"center",fontSize:"28px",fontWeight:"bold",fontFamily:"'Orbitron', sans-serif",textShadow:"0 0 20px rgba(0, 212, 255, 0.5)"},children:"Welcome to Arc"}),i.jsx("p",{style:{fontSize:"16px",display:"block",color:"#E0F7FF",lineHeight:"1.6",textAlign:"center",opacity:.9},children:"Connect your wallet to start playing on Arc Testnet."}),i.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"30px"},children:i.jsx("button",{onClick:s,style:{padding:"18px 32px",background:"linear-gradient(90deg, #00D4FF 0%, #0099CC 100%)",color:"#0a1929",fontWeight:"bold",fontSize:"18px",fontFamily:"'Orbitron', sans-serif",border:"none",borderRadius:"32px",cursor:"pointer",boxShadow:"0 4px 20px rgba(0, 212, 255, 0.5)",transition:"all 0.3s ease"},onMouseEnter:r=>{r.currentTarget.style.transform="translateY(-3px)",r.currentTarget.style.boxShadow="0 8px 30px rgba(0, 212, 255, 0.7)"},onMouseLeave:r=>{r.currentTarget.style.transform="translateY(0)",r.currentTarget.style.boxShadow="0 4px 20px rgba(0, 212, 255, 0.5)"},children:"Got it!"})})]})}),dr=({isOpen:s,onClose:e,characters:n,activeKey:r,onSelect:o,myTotalScore:t})=>s?i.jsx("div",{onClick:e,style:{position:"absolute",top:0,left:0,width:"1200px",height:"900px",backgroundColor:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:i.jsxs("div",{onClick:a=>a.stopPropagation(),style:{backgroundColor:"rgb(131 102 235)",padding:20,borderRadius:10,width:780,maxWidth:"92%",color:"#fff"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[i.jsxs("div",{children:[i.jsx("h2",{style:{margin:0},children:"Select Character"}),i.jsxs("span",{style:{fontSize:14,opacity:.9},children:["Your total penetrations: ",t]})]}),i.jsx("button",{onClick:e,style:{background:"none",border:"none",color:"#fff",fontSize:20,cursor:"pointer"},children:"‚úï"})]}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:n.map(a=>i.jsx("button",{disabled:t<a.points_to_unlock,className:"character-select-button-modal",onClick:()=>{t>=a.points_to_unlock?o(a.key):alert("You need to have at least "+a.points_to_unlock+" penetrations to unlock this character")},style:{textAlign:"left",background:r===a.key?"rgba(255,255,255,0.18)":"rgba(255,255,255,0.08)",border:r===a.key?"2px solid #fff":"1px solid rgba(255,255,255,0.3)",borderRadius:2,padding:12,color:"#fff",cursor:t<a.points_to_unlock?"not-allowed":"pointer"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[i.jsx("div",{style:{width:56,height:56,borderRadius:10,overflow:"hidden",background:"rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx("img",{src:a.src,style:{width:45,height:45,objectFit:"contain",borderRadius:8}})}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:800},children:a.name}),i.jsx("div",{style:{fontSize:12,opacity:.9},children:"Penetrations to unlock: "+a.points_to_unlock}),a.twitter&&i.jsxs("div",{style:{fontSize:12,opacity:.9},children:["X: "," ",i.jsx("a",{style:{color:"#fff"},href:a.twitter?`https://x.com/${a.twitter}`:"",target:"_blank",rel:"noopener noreferrer",children:a.twitter?a.twitter:"N/A"})]}),i.jsxs("div",{style:{fontSize:12,marginTop:6},children:["Move speed: ",a.moveSpeed.toFixed(2)," ‚Ä¢ Health: ",a.health]})]})]})},a.key))})]})}):null,ur=s=>{s.fillStyle="#0099CC";for(let e=0;e<b.MAP.length;e++)for(let n=0;n<b.MAP[e].length;n++)b.MAP[e][n]===1&&s.fillRect(n*b.CELL_SIZE,e*b.CELL_SIZE,b.CELL_SIZE-1,b.CELL_SIZE-1)},hr=s=>{},pr=async s=>({name:null}),fr=()=>{const s=p.useRef(!1),e=p.useRef(!1),[n,r]=p.useState(0),[o,t]=p.useState(0),a=p.useRef(null),f=p.useRef(null),u=p.useRef(null),l=p.useRef(null);return{ultActiveRef:s,ultCooldownRef:e,ultTimerValue:n,ultCooldownValue:o,setUltTimerValue:r,setUltCooldownValue:t,activateUlt:async y=>{if(!y||e.current||s.current)return;s.current=!0,e.current=!0,y.fireRate=400,a.current||(a.current=await ue("/chars/weapons/ult-weapon.png").catch(()=>null)),f.current||(f.current=await ue("/chars/weapons/bullet.png").catch(()=>null)),r(15);let w=15;const v=setInterval(()=>{w--,r(w),w<=0&&(clearInterval(v),u.current=null,r(0),y.fireRate=b.FIRE_RATE,s.current=!1,typeof window<"u"&&(window.__ULT_WEAPON_OVERRIDE__=null,window.__ULT_WEAPON_SCALE__=null))},1e3);u.current=v,t(60);let T=60;const E=setInterval(()=>{T--,t(T),T<=0&&(clearInterval(E),l.current=null,t(0),e.current=!1)},1e3);l.current=E},ultWeaponImageRef:a,ultBulletImageRef:f,resetUlt:()=>{u.current&&(clearInterval(u.current),u.current=null),l.current&&(clearInterval(l.current),l.current=null),s.current=!1,e.current=!1,r(0),t(0),typeof window<"u"&&(window.__ULT_WEAPON_OVERRIDE__=null,window.__ULT_WEAPON_SCALE__=null)}}},Ve="transactions-updated",mr=s=>{const e=new CustomEvent(Ve,{detail:s});window.dispatchEvent(e)};let q=(()=>{const s=localStorage.getItem("transactions");if(!s)return[];let e=JSON.parse(s);return e=e.map(n=>!n.link||n.link==="Pending..."?{...n,link:"Not processed"}:n),localStorage.setItem("transactions",JSON.stringify(e)),e})();const de=s=>{q=s,localStorage.setItem("transactions",JSON.stringify(q)),mr(q)},yr=()=>{const{wallets:s}=Xe();Ye(),Nn(),s.find(l=>l.walletClientType==="privy");const[e,n]=p.useState(q);p.useRef(null),p.useRef(null),p.useRef(!1),p.useRef(!1),p.useEffect(()=>{const l=h=>{h.detail?n([...h.detail]):n([...q])};return window.addEventListener(Ve,l),n([...q]),()=>{window.removeEventListener(Ve,l)}},[]);const r=l=>{o(l,l)},o=async(l,h=l)=>{const d=s[0];if(!d)throw new Error("No wallet connected");const y={id:Date.now(),type:`Trophy Mint: ${l} pts`,link:"Pending...",date:Date.now(),error:"",userAddress:d.address},w=[y,...q];w.length>b.MAX_TRANSACTIONS&&(w.length=b.MAX_TRANSACTIONS),de(w);try{const v=await or(d,l,h,E=>{console.log(`[Arc Mint] ${E}`)}),T=q.map(E=>E.id===y.id?{...E,link:sr(v),date:Date.now(),error:""}:E);return de(T),v}catch(v){const T=q.map(E=>E.id===y.id?{...E,link:"",date:Date.now(),error:v.message||"Mint failed"}:E);throw de(T),v}};return{transactions:e,handleMint:r,handleConfidentialMint:o,handleTotalScore:async(l,h=!1,d,y)=>{if(!h){console.log(`Score update: ${l}, enemy: ${d}`);return}console.log(`Game Over! Final score: ${l}`,y)},handleFaucet:async l=>{const h={id:Date.now(),type:"Faucet",link:"Pending...",date:Date.now(),error:""},d=[h,...q];d.length>b.MAX_TRANSACTIONS&&(d.length=b.MAX_TRANSACTIONS),de(d),window.open(W.faucet,"_blank");const y=q.map(w=>w.id===h.id?{...w,type:"Faucet (Circle)",link:W.faucet,date:Date.now(),error:""}:w);de(y)},clearTransactions:()=>{de([])}}},gr=()=>{const[s,e]=p.useState(""),[n,r]=p.useState(!1);return{balance:s,isLoading:n,updateBalance:async t=>{if(!t)return console.error("No wallet found for balance update"),null;r(!0);try{const a=await rn(t);return e(a),r(!1),a}catch(a){return console.error("Error updating balance:",a),e("Error"),r(!1),null}}}};function qt(){const{ready:s,authenticated:e,login:n,logout:r,isModalOpen:o}=Ye(),{wallets:t}=Xe(),a=t[0],f=(a==null?void 0:a.address)||"",u=f?`${f.slice(0,6)}...${f.slice(-4)}`:"",[l,h]=p.useState(u),[d,y]=p.useState("0.0000"),[w,v]=p.useState(!1),T=async()=>{if(a)try{const R=await a.getEthereumProvider(),I=new pe(R),B=await I.getNetwork();if(Number(B.chainId)!==W.chainId)try{await R.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${W.chainId.toString(16)}`}]})}catch(Q){Q.code===4902&&await R.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${W.chainId.toString(16)}`,chainName:"Arc Testnet",rpcUrls:[W.rpc],nativeCurrency:{name:"USDC",symbol:"USDC",decimals:18},blockExplorerUrls:[W.explorer]}]})}const N=await I.getBalance(a.address),$=_e(N),P=parseFloat($).toFixed(4);y(P),v(parseFloat(P)<.001)}catch(R){console.error("Failed to fetch balance:",R),y("0.0000"),v(!0)}},E=async()=>{f&&(await navigator.clipboard.writeText(f),h("Copied!"),setTimeout(()=>h(u),2e3))},F=()=>{e?r():n()},L=()=>{window.open(W.faucet,"_blank")};return p.useEffect(()=>{h(u)},[u]),p.useEffect(()=>{if(e&&a){T();const R=setInterval(T,15e3);return()=>clearInterval(R)}else y("0.0000"),v(!1)},[e,a]),p.useEffect(()=>{o?document.body.style.overflow="hidden":document.body.style.overflow="auto"},[o]),s?i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"login-btn",onClick:F,disabled:!s,children:i.jsx("span",{children:e?"Logout":"Login"})}),e&&f&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",justifyContent:"flex-end"},children:[i.jsx("div",{className:"username-container",onClick:E,style:{cursor:"pointer",userSelect:"none"},title:"Click to copy address",children:i.jsx("p",{style:{background:l==="Copied!"?"linear-gradient(90deg, #0099CC 0%, #00D4FF 100%)":"none",WebkitBackgroundClip:l==="Copied!"?"text":"initial",WebkitTextFillColor:l==="Copied!"?"transparent":"inherit",fontWeight:l==="Copied!"?"700":"normal",transition:"all 0.3s ease",margin:0},children:l})}),i.jsx("div",{className:"balance-container",onClick:w?L:void 0,style:{cursor:w?"pointer":"default",borderColor:w?"#FF6B6B":void 0,animation:w?"pulse-warning 2s infinite":void 0},title:w?"Click to get testnet USDC":void 0,children:i.jsxs("p",{style:{margin:0,display:"flex",alignItems:"center",gap:"6px"},children:[d," USDC",w&&i.jsx("span",{style:{color:"#FF6B6B",fontSize:"12px"},children:"(Get USDC)"})]})})]}),i.jsx("style",{children:`
        @keyframes pulse-warning {
          0%, 100% { box-shadow: 0 0 5px rgba(255, 107, 107, 0.3); }
          50% { box-shadow: 0 0 15px rgba(255, 107, 107, 0.6); }
        }
      `})]}):null}const wr=te.lazy(()=>Re(()=>import("./LeaderboardPopup-CYUC3rYi.js"),__vite__mapDeps([0,1,2]))),br=te.lazy(()=>Re(()=>import("./TransactionsTable-Dyu05HAh.js"),__vite__mapDeps([3,1,2,4,5,6,7]))),xr=te.lazy(()=>Re(()=>import("./GameUI-B62Lv5Yi.js"),__vite__mapDeps([8,1,2,9]))),Tr=te.lazy(()=>Re(()=>import("./PowerupShop-DDg-hk7Y.js"),__vite__mapDeps([10,1,2,4,5,6,11]))),Er=()=>{var St,Ct;const{authenticated:s,user:e}=Ye(),n=p.useRef(null),r=p.useRef([]),o=p.useRef([]),t=p.useRef(null),a=p.useRef([]),f=p.useRef(!1),u=p.useRef([]),l=p.useRef([]),h=p.useRef([]),d=p.useRef([]),y=p.useRef(0),w=p.useRef(0),v=p.useRef(!1),T=p.useRef(!0),E=p.useRef(null),[F,L]=p.useState(0),{ultActiveRef:R,ultCooldownRef:I,ultTimerValue:B,ultCooldownValue:N,activateUlt:$,ultWeaponImageRef:P,ultBulletImageRef:Q,resetUlt:Pe}=fr(),J=Fn(),{transactions:Je,handleConfidentialMint:on,clearTransactions:cn}=yr(),{wallets:fe}=Xe(),{updateBalance:Ke}=gr();Pn();const[Ze]=p.useState("/chars/weapons/m4a1-s.svg"),[ln,Qe]=p.useState(!1),[z,xe]=p.useState("menu"),[ee,dn]=p.useState(null),[un,et]=p.useState(!0),[tt,hn]=p.useState(100),V=p.useRef(100),[pn,nt]=p.useState(3),[fn,De]=p.useState(0),[Te,mn]=p.useState(!0),[U,rt]=p.useState({totalScore:0,killCount:0,bossesKilled:0,damageTaken:0,damageGiven:0,healsUsed:0,buffsTaken:0}),yn=p.useRef(U);p.useEffect(()=>{yn.current=U},[U]);const Ee=[{key:"default",points_to_unlock:0,name:"Arc",src:"/chars/arc.png",moveSpeed:2,health:5,twitter:null},{key:"arc_pro",points_to_unlock:25,name:"Arc Pro",src:"/chars/arc.png",moveSpeed:2.3,health:6,twitter:null},{key:"arc_elite",points_to_unlock:50,name:"Arc Elite",src:"/chars/arc.png",moveSpeed:2.5,health:7,twitter:null},{key:"arc_legend",points_to_unlock:100,name:"Arc Legend",src:"/chars/arc.png",moveSpeed:2.7,health:8,twitter:null}],[at,gn]=p.useState(Ee[0]),[st,je]=p.useState(!1),[wn,ot]=p.useState(!1),[bn,it]=p.useState(!1),[ct,lt]=p.useState(!1),[dt,Fe]=p.useState(!1),[xn,Le]=p.useState(!1),[ut,Tn]=p.useState([]),[En,ht]=p.useState(!1),[vr,Sr]=p.useState(!1),[Cr,Oe]=p.useState(null),[pt,ve]=p.useState(!1),me=p.useRef({shields:0,speedBoosts:0,doubles:0}),ce=p.useRef(0),ft=p.useRef([]),mt=p.useRef(0),yt=p.useRef({x:1,y:0}),ye=p.useRef([]),[vn,Se]=p.useState(0),X=(c,m)=>{rt(k=>({...k,[c]:typeof m=="function"?m(k[c]):m}))},Sn=()=>{const c=navigator.userAgent.toLowerCase();return c.includes("firefox")||c.includes("safari")&&!c.includes("chrome")||c.includes("edg/")&&!c.includes("chrome")||c.includes("tor")},Cn=()=>{xe("countdown"),v.current=!0,nt(3);let c=3;const m=setInterval(()=>{c--,nt(c),c<=0&&(clearInterval(m),v.current=!1,xe("playing"))},1e3)},gt=(c,m)=>{if(!m.current||z!=="playing")return;De(c),m.current.isBuffed=!0,E.current&&clearInterval(E.current);let k=c;const Y=setInterval(()=>{k--,De(k),k<=0&&(clearInterval(Y),E.current=null,m.current&&(m.current.isBuffed=!1))},1e3);E.current=Y},wt=async()=>{const c=["/chars/enemies/iron-enemy.png","/chars/enemies/basis-enemy.png"],m=["/chars/enemies/luna-enemy.png"],k=["/chars/arc.png"];await Un([...c,...m,...k,Ze]);const Y=await Promise.all(Array.from({length:136},(le,ne)=>16+ne).map(async le=>ue(`/explotion/frame(${le}).png`)));Tn(Y)},kn=()=>{et(!T.current),T.current=!T.current},bt=async()=>{Qt();const c=at;if(t.current=new Kt(n.current.width/2,n.current.width/2,!0,b.BULLET_SPEED,b.FIRE_RATE,"#00D4FF","main",await ue(c.src),await ue(Ze)),t.current){t.current.speed=c.moveSpeed,t.current.health=c.health,t.current.maxHealth=c.health;const m=me.current;if(m.shields>0&&(t.current.health+=m.shields,t.current.maxHealth+=m.shields,console.log(`Applied ${m.shields} shields: health now ${t.current.health}`)),m.speedBoosts>0){const k=1+m.speedBoosts*.15;t.current.speed*=k,console.log(`Applied ${m.speedBoosts} speed boosts: speed now ${t.current.speed}`)}m.doubles>0?(ce.current=m.doubles*20,console.log(`Stored ${m.doubles} double damage: ${ce.current}s to activate on play`)):ce.current=0}if(a.current=[],l.current=[],h.current=[],d.current=[],E.current=null,R.current=!1,ye.current=[],X("killCount",0),X("bossesKilled",0),X("damageTaken",0),X("damageGiven",0),X("totalScore",0),X("healsUsed",0),X("buffsTaken",0),De(0),Pe(),Se(0),y.current=0,w.current=0,f.current=!1,u.current.forEach(m=>{m.pause(),m.currentTime=0}),u.current=[],z==="countdown"&&(o.current=[],xt(0)),ft.current.length===0)for(let m=0;m<50;m++)ft.current.push(new We(0,0,0,0,"",0,!1,0,""))},xt=c=>{if(!c){Wt(o.current,1,!0,"default",J,{});return}const m=Math.min(b.MAX_ENEMIES_BEGINNING+Math.floor(c/10),b.MAX_ENEMIES);if(o.current.length<m){const k=m-o.current.length;for(let Y=0;Y<k;Y++){const le=150+Math.random()*280;setTimeout(()=>{if(o.current.length<m){const ne=Math.random()<.12?"terraLuna":"default",Ce=Math.min(Math.floor(c/10),10),Be=ne==="terraLuna"?Ce*10:Ce;o.current=Wt(o.current,Be,!1,ne,J,{})}},le)}}};p.useEffect(()=>{s&&vt()},[s]),p.useEffect(()=>{if(z==="playing"&&ce.current>0&&t.current){const c=ce.current;ce.current=0,console.log(`Activating double damage buff for ${c}s`),gt(c,t)}},[z]);const In=async()=>{if(w.current,xe("gameover"),Pe(),s&&fe.length>0){const c=fe.find(m=>m.walletClientType==="privy");c&&setTimeout(async()=>{await Ke(c)},1e3)}};p.useEffect(()=>{const c=window.matchMedia("(max-width: 1100px)"),m=k=>{ht(k.matches)};return ht(c.matches),c.addEventListener("change",m),()=>c.removeEventListener("change",m)},[]),p.useEffect(()=>{en().then(c=>{Object.values(c).forEach(m=>{m.forEach(k=>{k.volume=V.current/100*.1})}),dn(c)}),wt().then(()=>{Qe(!0)}),setTimeout(()=>{mn(!1)},1e3)},[]),p.useEffect(()=>{z==="playing"||z==="countdown"?(ln?bt():wt().then(()=>{Qe(!0),bt()}),ve(!1)):(t.current=null,o.current=[],a.current=[],d.current=[])},[z]),p.useEffect(()=>{if(!n.current)return;const c=n.current.getContext("2d");if(!c)return;n.current.width=b.CANVAS_WIDTH,n.current.height=b.CANVAS_HEIGHT;const m={w:!1,a:!1,s:!1,d:!1},k={x:0,y:0,shooting:!1},Y=(S,C)=>{switch(S.key.toLowerCase()){case"w":case"—Ü":m.w=C;break;case"a":case"—Ñ":m.a=C;break;case"s":case"—ã":case"—ñ":m.s=C;break;case"d":case"–≤":m.d=C;break;case"r":case"–∫":C&&Ce();break;case"q":case"–π":C&&Be();break}},le=()=>n.current.getBoundingClientRect().width/b.CANVAS_WIDTH,ne=S=>{const C=le(),g=n.current.getBoundingClientRect();k.x=(S.clientX-g.left)/C,k.y=(S.clientY-g.top)/C},Ce=async()=>{if(I.current)return;const S=oe(ee,"ult",T.current,u.current,V.current);u.current=S,await $(t.current),window.__ULT_WEAPON_OVERRIDE__=P.current??null,window.__ULT_WEAPON_SCALE__=1.5},Be=()=>{if(!t.current||!n.current)return;const S=Date.now(),C=1300;if(S-mt.current<C)return;mt.current=S,Se(Math.ceil(C/1e3)),setTimeout(()=>Se(1),500),setTimeout(()=>Se(0),C);const g=oe(ee,"dash",T.current,u.current,V.current);u.current=g;const _=180,A=yt.current,K=Math.abs(A.x)<.001&&Math.abs(A.y)<.001,x=K?Math.cos(t.current.angle):A.x,D=K?Math.sin(t.current.angle):A.y,M=t.current.x,O=t.current.y;let Z=M+x*_,H=O+D*_;Z=Math.max(45,Math.min(n.current.width-45,Z)),H=Math.max(45,Math.min(n.current.height-45,H));const re=-D,ge=x,Rn=28,Mt=[];for(let Nt=0;Nt<Rn;Nt++){const ke=Math.random()*.9,_n=.06+Math.random()*.25,Ge=Math.min(1,ke+_n),Pt=(Ge-ke)*_,Dt=M+x*((ke+Ge)*.5*_),jt=O+D*((ke+Ge)*.5*_),Ft=(Math.random()*2-1)*12,Lt=re*Ft,Ot=ge*Ft,Bt=x*(Pt/2),Ut=D*(Pt/2);Mt.push({x1:Dt-Bt+Lt,y1:jt-Ut+Ot,x2:Dt+Bt+Lt,y2:jt+Ut+Ot,width:2+Math.random()*3,alpha:.6+Math.random()*.3})}ye.current.push({created:Date.now(),duration:260,segments:Mt}),t.current.updatePosition(Z,H)},Ue=(S,C)=>{const g=He.createDeathParticles(S.x,S.y);d.current.push(...g),o.current.splice(C,1),rt(_=>{const A=_.killCount+1,K=S.type==="terraLuna",x=K?5:S.type==="iron"?2:1;return y.current=A,w.current=_.totalScore+x,xt(A),{..._,totalScore:_.totalScore+x,killCount:A,bossesKilled:K?_.bossesKilled+1:_.bossesKilled}}),setTimeout(()=>{const _=w.current,A=S.type==="terraLuna"?"TERRA_LUNA":S.type==="iron"?"IRON":"BASIC_CASH";console.log(`Killed ${A}, total score: ${_}`)},0),u.current=oe(ee,"kill",T.current,u.current,V.current)},An=()=>{if(!t.current||!n.current)return;let S=t.current.x,C=t.current.y;m.w&&(C-=t.current.speed*J),m.s&&(C+=t.current.speed*J),m.a&&(S-=t.current.speed*J),m.d&&(S+=t.current.speed*J),S=Math.max(45,Math.min(n.current.width-45,S)),C=Math.max(45,Math.min(n.current.height-45,C));const g=S-t.current.x,_=C-t.current.y;if(Math.abs(g)>.001||Math.abs(_)>.001){const x=Math.hypot(g,_)||1;yt.current={x:g/x,y:_/x}}t.current.updatePosition(S,C);const A=k.x-t.current.x,K=k.y-t.current.y;if(t.current.angle=Math.atan2(K,A),k.shooting&&Date.now()-t.current.lastShot>t.current.fireRate){const x=t.current.x+Math.cos(t.current.angle)*t.current.barrelSize,D=t.current.y+Math.sin(t.current.angle)*t.current.barrelSize,M=oe(ee,"shoot",T.current,u.current,V.current-4);u.current=M;const O=new We(x,D,t.current.angle,t.current.bulletSpeed*J,t.current.bulletColor,R.current?10:t.current.isBuffed?18:7,t.current.isPlayer,R.current?10:t.current.isBuffed?2:1,R.current?"ult":"player",R.current?Q.current??void 0:void 0);a.current.push(O),t.current.lastShot=Date.now()}a.current=a.current.filter(x=>!x.isExpired),a.current.forEach(x=>x.update()),a.current.forEach((x,D)=>{if(t.current&&!x.isExpired){const M=t.current.x-x.x,O=t.current.y-x.y;if(Math.sqrt(M*M+O*O)<35){const Z=t.current.takeDamage(x.damage);if(a.current.splice(D,1),X("damageTaken",H=>H+x.damage),Z&&!f.current)w.current,Pe(),f.current=!0,d.current=d.current.concat(He.createDeathParticles(t.current.x,t.current.y)),oe(ee,"death",T.current,u.current,V.current),setTimeout(()=>{xe("gameover")},1e3);else{const H=Ie("/sound/dmg.mp3",T.current,u.current,V.current-10);u.current=H}}}o.current.forEach((M,O)=>{if(x.isPlayer){const Z=M.x-x.x,H=M.y-x.y;if(Math.sqrt(Z*Z+H*H)<M.width/2){const re=M.takeDamage(x.damage);switch(x.type!=="ult"&&a.current.splice(D,1),X("damageGiven",ge=>ge+x.damage),re){case"drop_heart":l.current.push(new Zt(M.x,M.y)),Ue(M,O);return;case"drop_buff":h.current.push(new Ln(M.x,M.y)),Ue(M,O);return;case"explode":Ue(M,O);return;case!1:const ge=oe(ee,"hit",T.current,u.current,V.current);u.current=ge;return}}}})}),l.current.forEach((x,D)=>{if(t.current){const M=t.current.x-x.x,O=t.current.y-x.y;if(Math.sqrt(M*M+O*O)<t.current.width/2&&t.current.health<t.current.maxHealth){l.current.splice(D,1);const H=Ie("/sound/heal.mp3",T.current,u.current,V.current);u.current=H,t.current.heal(),X("healsUsed",re=>re+1)}x.isExpired()&&l.current.splice(D,1)}}),h.current.forEach((x,D)=>{if(t.current){const M=t.current.x-x.x,O=t.current.y-x.y;if(Math.sqrt(M*M+O*O)<t.current.width/2){h.current.splice(D,1);const H=Ie("/sound/heal.mp3",T.current,u.current,V.current);u.current=H,t.current.isBuffed=!0,gt(10,t),X("buffsTaken",re=>re+1)}x.isExpired()&&h.current.splice(D,1)}}),o.current.forEach(x=>{const D=x.updateAI(t.current.x,t.current.y);D&&a.current.push(D)}),y.current>10&&(t.current.maxHealth=8)},kt=()=>{if(!t.current)return;c.clearRect(0,0,b.CANVAS_WIDTH,b.CANVAS_HEIGHT),c.fillStyle="#E8F4F8",c.fillRect(0,0,b.CANVAS_WIDTH,b.CANVAS_HEIGHT),ur(c);const S=Date.now();ye.current=ye.current.filter(g=>S-g.created<g.duration),ye.current.forEach(g=>{const _=(S-g.created)/g.duration;g.segments.forEach(A=>{const K=Math.max(0,1-_),x=Math.max(.5,A.width*(1-_*.5));c.save(),c.globalAlpha=A.alpha*K*.9,c.strokeStyle="rgb(0, 212, 255)",c.lineWidth=x+1.4,c.lineCap="round",c.beginPath(),c.moveTo(A.x1,A.y1),c.lineTo(A.x2,A.y2),c.stroke(),c.globalAlpha=A.alpha*K*.65,c.strokeStyle="rgb(0, 153, 204)",c.lineWidth=x,c.beginPath(),c.moveTo(A.x1,A.y1),c.lineTo(A.x2,A.y2),c.stroke(),c.restore()})}),z==="playing"&&An(),t.current.draw(c,f.current),o.current.forEach(g=>g.draw(c)),a.current.forEach(g=>g.draw(c)),l.current.forEach(g=>g.draw(c)),h.current.forEach(g=>g.drawBuff(c)),r.current.forEach((g,_)=>{if(g.frame>=ut.length){r.current.splice(_,1);return}c.drawImage(ut[g.frame],g.x-g.width/2+10/2,g.y-g.height/2+20/2,g.height,g.height),g.frame+=Math.ceil(J)});const C=Date.now();d.current=d.current.filter(g=>C-g.created<2e3),d.current.forEach(g=>{const A=(C-g.created)/2e3;g.x+=g.vx*J,g.y+=g.vy*J,g.alpha=Math.max(0,1-A),c.save(),c.globalAlpha=g.alpha,c.fillStyle="#ff0000",c.beginPath(),c.arc(g.x,g.y,g.size,0,Math.PI*2),c.fill(),c.restore()}),requestAnimationFrame(kt)},It=S=>Y(S,!0),At=S=>Y(S,!1),Rt=()=>{k.shooting=!0},_t=()=>{k.shooting=!1};return window.addEventListener("keydown",It),window.addEventListener("keyup",At),n.current.addEventListener("mousemove",ne),n.current.addEventListener("mousedown",Rt),n.current.addEventListener("mouseup",_t),kt(),()=>{var S,C,g;window.removeEventListener("keydown",It),window.removeEventListener("keyup",At),(S=n.current)==null||S.removeEventListener("mousemove",ne),(C=n.current)==null||C.removeEventListener("mousedown",Rt),(g=n.current)==null||g.removeEventListener("mouseup",_t)}},[z]);const Tt=c=>{hn(c),V.current=c,et(c>0),u.current.forEach(m=>{m.volume=c/100*.1}),ee&&Object.values(ee).forEach(m=>{m.forEach(k=>{k.volume=c/100*.1})})},Et=async()=>{var c;if(ve(!1),s&&((c=fe[0])!=null&&c.address))try{const m=await ir(fe[0].address);me.current={shields:m.shields,speedBoosts:m.speedBoosts,doubles:m.doubles},console.log("Loaded powerups:",me.current)}catch(m){console.error("Failed to load powerups:",m),me.current={shields:0,speedBoosts:0,doubles:0}}else me.current={shields:0,speedBoosts:0,doubles:0};Cn()},vt=async()=>{if(!e)return!0;try{const c=hr(e);if(!c)return Oe(null),localStorage.removeItem("arcUsername"),localStorage.removeItem("arcUsernameWallet"),!0;Le(!0);const m=await pr(c);return Le(!1),m!=null&&m.name&&(Oe(m.name),localStorage.setItem("arcUsername",m.name),localStorage.setItem("arcUsernameWallet",c)),!0}catch(c){return console.error("Failed to check username:",c),Le(!1),Oe(null),localStorage.removeItem("arcUsername"),localStorage.removeItem("arcUsernameWallet"),!0}};return En?i.jsx("div",{className:"bg-mobile bg",children:i.jsxs("div",{className:"mobile-warning",children:[i.jsx("h2",{children:"Desktop version only"}),i.jsx("p",{children:"Web version is not available on mobile devices."})]})}):Sn()?i.jsx("div",{className:"bg-mobile bg",children:i.jsxs("div",{className:"mobile-warning",children:[i.jsx("h2",{children:"Unsupported browser"}),i.jsx("p",{children:"Please use browser from the list below."}),i.jsxs("ul",{style:{textAlign:"left",padding:0,margin:0},children:[i.jsx("li",{children:"Chrome"}),i.jsx("li",{children:"Edge (Chrome based)"}),i.jsx("li",{children:"Safari (Chrome based)"})]})]})}):i.jsxs("div",{className:"game-container",children:[i.jsxs("div",{children:[i.jsx("canvas",{ref:n,width:(St=n.current)==null?void 0:St.width,height:(Ct=n.current)==null?void 0:Ct.height}),z==="countdown"&&i.jsx(i.Fragment,{children:i.jsx("div",{className:"coundown bg",children:i.jsx("h1",{children:pn})})}),st&&i.jsx(te.Suspense,{fallback:null,children:i.jsx(wr,{isOpen:st,onClose:()=>je(!1)})}),wn&&i.jsx(cr,{onClose:()=>ot(!1)}),bn&&i.jsx(lr,{onClose:()=>it(!1),onCheckAgain:()=>{it(!1),vt()},isChecking:xn}),ct&&i.jsx(dr,{isOpen:ct,onClose:()=>lt(!1),myTotalScore:F,characters:Ee,activeKey:at.key,onSelect:c=>{gn(Ee.find(m=>m.key===c)||Ee[0]),lt(!1)}}),dt&&i.jsx(te.Suspense,{fallback:null,children:i.jsx(Tr,{isOpen:dt,onClose:()=>Fe(!1)})}),z==="playing"&&i.jsx(te.Suspense,{fallback:null,children:i.jsx(xr,{killCount:U.killCount,buffTimerValue:fn,ultTimerValue:B,ultCooldownValue:N,dashCooldownSeconds:vn,soundBtnLabelOn:un,onSoundToggle:kn,onStopGame:In,volume:tt,onVolumeChange:Tt})}),z==="menu"&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"bg",children:[i.jsxs("h1",{className:"total-score h1",children:["ARC: Kill the Peg ",i.jsx("br",{})," Destroy the Scams"]}),i.jsx("button",{disabled:Te,className:"leaderboard-button",onClick:()=>je(!0),children:"Leaderboard"}),i.jsx("button",{disabled:Te,className:"leaderboard-button shop-button",onClick:()=>Fe(!0),children:"Shop"}),i.jsx(qt,{}),i.jsx("a",{href:"https://x.com/solodanETH",target:"_blank",rel:"noopener noreferrer",style:{position:"absolute",bottom:"20px",right:"20px",width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"#000",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",textDecoration:"none",transition:"opacity 0.2s ease"},onMouseEnter:c=>c.currentTarget.style.opacity="0.8",onMouseLeave:c=>c.currentTarget.style.opacity="1",children:i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231 5.45-6.231Zm-1.161 17.52h1.833L7.084 4.126H5.117L17.083 19.77Z",fill:"white"})})}),i.jsxs("div",{className:"game-menu",style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:"10px",top:"45%"},children:[i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",flexDirection:"column"},className:"flex-wrapper",children:i.jsx("button",{className:s?"play-btn":"play-btn-guest",onClick:Et,disabled:Te,children:s?"Play":"Play as a guest"})}),i.jsxs("button",{disabled:Te,style:{marginRight:"10px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(255, 255, 255, 0.6)",border:"none",padding:"8px 12px",borderRadius:"32px"},children:[i.jsx("span",{className:"counter-label",style:{color:"#fff"},children:"üîä"}),i.jsx("input",{type:"range",min:"0",max:"100",value:tt,style:{width:"140px",accentColor:"#00D4FF"},onChange:c=>Tt(parseInt(c.target.value))})]})]})]})}),z==="gameover"&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"bg",children:[i.jsxs("h1",{className:"total-score h1",children:["Your total score: ",U.totalScore]}),i.jsx("button",{className:"leaderboard-button",onClick:()=>je(!0),children:"Leaderboard"}),i.jsx("button",{className:"leaderboard-button shop-button",onClick:()=>Fe(!0),children:"Shop"}),i.jsx(qt,{}),i.jsx("div",{className:"game-menu",style:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"20px",top:"45%"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"16px",flexDirection:"column"},className:"flex-wrapper",children:[i.jsx("button",{className:s?"play-btn":"play-btn-guest",onClick:Et,children:s?"Play again":"Play as a guest"}),s&&U.totalScore>=5&&!pt&&i.jsx("button",{className:"play-btn",style:{background:"#00D4FF",color:"#0a1929",border:"2px solid #00D4FF",fontWeight:"700",fontFamily:"'Orbitron', sans-serif",padding:"14px 28px",fontSize:"18px",boxShadow:"0 4px 15px rgba(0, 212, 255, 0.4)"},onMouseEnter:c=>{c.currentTarget.style.background="transparent",c.currentTarget.style.color="#00D4FF",c.currentTarget.style.boxShadow="0 0 20px rgba(0, 212, 255, 0.6)"},onMouseLeave:c=>{c.currentTarget.style.background="#00D4FF",c.currentTarget.style.color="#0a1929",c.currentTarget.style.boxShadow="0 4px 15px rgba(0, 212, 255, 0.4)"},onClick:async()=>{const c=fe[0];if(!c){alert("No wallet connected");return}const m=await Ke(c);if(parseFloat(m||"0")<.001){ot(!0);return}ve(!0);try{await on(U.totalScore)}catch{ve(!1)}},children:"üèÜ Mint Trophy NFT"}),s&&U.totalScore>=5&&pt&&i.jsxs("div",{style:{color:"#00D4FF",fontSize:"18px",textAlign:"center",fontFamily:"'Orbitron', sans-serif",fontWeight:"700",opacity:.9},children:["Trophy NFT mint in progress...",i.jsx("br",{}),i.jsx("small",{style:{fontSize:"14px",opacity:.8},children:"Check transaction in the list below"})]}),s&&U.totalScore>0&&U.totalScore<5&&i.jsx("div",{style:{color:"#00D4FF",fontSize:"16px",textAlign:"center",opacity:.9,fontFamily:"'Space Mono', monospace",marginTop:"10px"},children:"Need 5+ points to mint Trophy NFT"})]})}),i.jsx("div",{className:"game-stat",children:i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col",children:[i.jsxs("span",{children:["Total kills: ",U.killCount]}),i.jsxs("span",{children:["Bosses killed: ",U.bossesKilled]}),i.jsxs("span",{children:["Damage dealt: ",U.damageGiven]})]}),i.jsxs("div",{className:"col",children:[i.jsxs("span",{children:["Damage taken: ",U.damageTaken]}),i.jsxs("span",{children:["Heals used: ",U.healsUsed]}),i.jsxs("span",{children:["Buffs taken: ",U.buffsTaken]})]})]})})]})})]}),i.jsx(te.Suspense,{fallback:null,children:i.jsx(br,{transactions:Je,clearTransactions:cn},Je.length)})]})},Mr=Object.freeze(Object.defineProperty({__proto__:null,default:Er},Symbol.toStringTag,{value:"Module"}));export{Mr as G,Rr as a,_r as b,ir as g,yr as u};
