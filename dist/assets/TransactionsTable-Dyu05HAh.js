import{r as o,a as C,j as s,K as w}from"./auth-BxfdJgsU.js";import{u as E}from"./Game-Dr9zSDgt.js";import{J as I,C as R}from"./ethers-BBATp_Pg.js";import"./vendor-Cs8wUaRe.js";import"./index-C3S8jdOc.js";const S=["function getScore(uint256 tokenId) view returns (uint256)","function ownerOf(uint256 tokenId) view returns (address)","function tokenURI(uint256 tokenId) view returns (string)"],A="0x2A4cAF0e6e2D256854cb159EAc574428f5a1509D",D="https://rpc.testnet.arc.network",_=({isOpen:r,onClose:d,initialTokenId:i})=>{const[h,m]=o.useState(i?i.toString():""),[u,j]=o.useState(!1),[c,a]=o.useState(null),{wallets:b}=C(),x="https://ipfs.io/ipfs/bafkreicdqmt5zw6yhm3g4ugj3gqfs5jh562qydyzfeevycrjky5sah7ske";o.useEffect(()=>{i&&m(i.toString())},[i]),o.useEffect(()=>{r||(a(null),i||m(""))},[r,i]);const k=async()=>{var g,N;const n=parseInt(h);if(isNaN(n)||n<0){a({success:!1,message:"Enter valid NFT ID (number)"});return}j(!0),a(null);try{const l=new I(D),e=new R(A,S,l),t=await e.ownerOf(n),f=await e.getScore(n);a({success:!0,message:`Trophy NFT #${n}`,score:Number(f),owner:t})}catch(l){const e=((g=l.message)==null?void 0:g.toLowerCase())||"",t=l.code||"";e.includes("nonexistent token")||e.includes("invalid token")||e.includes("erc721")||e.includes("call_exception")||t==="CALL_EXCEPTION"||(N=l.data)!=null&&N.includes("0x7e273289")?a({success:!1,message:`NFT #${n} does not exist yet`}):e.includes("network")||e.includes("timeout")?a({success:!1,message:"Network error. Please try again."}):a({success:!1,message:"Unable to fetch NFT data. Token may not exist."})}finally{j(!1)}},y=()=>{m(""),a(null)},v=n=>{n.key==="Enter"&&h&&!u&&k(),n.key==="Escape"&&d()},p=n=>`${n.slice(0,6)}...${n.slice(-4)}`;return r?s.jsx("div",{className:"modal-overlay",onClick:d,children:s.jsxs("div",{className:"modal-content",onClick:n=>n.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{className:"modal-title",children:"NFT SCORE CHECKER"}),s.jsx("button",{className:"close-button",onClick:d,children:"âœ•"})]}),s.jsxs("div",{className:"modal-body",children:[s.jsx("p",{className:"modal-description",children:"Enter NFT ID to view its game score"}),s.jsx("div",{className:"input-section",children:s.jsx("input",{type:"number",value:h,onChange:n=>m(n.target.value),onKeyPress:v,placeholder:"Enter NFT ID (e.g., 1)",min:"0",disabled:u,className:"token-input",autoFocus:!0})}),s.jsxs("div",{className:"button-section",children:[s.jsx("button",{onClick:k,disabled:u||!h,className:"check-button",children:u?"CHECKING...":"CHECK SCORE"}),s.jsx("button",{onClick:y,disabled:u,className:"clear-button",children:"CLEAR"})]}),c&&s.jsxs("div",{className:`result-container ${c.success?"success":"error"}`,children:[s.jsx("div",{className:"result-message",children:c.message}),c.success&&c.score!==void 0&&s.jsxs("div",{className:"score-display",children:[s.jsx("div",{className:"nft-image-preview",children:s.jsx("img",{src:x,alt:`NFT #${h}`,onError:n=>{n.target.src="https://via.placeholder.com/200/1b1b1b/00D4FF?text=ARC+TROPHY"}})}),s.jsxs("div",{className:"score-value",children:[s.jsx("span",{className:"score-label",children:"Game Score:"}),s.jsx("span",{className:"score-number",children:c.score})]}),s.jsxs("div",{className:"nft-info",children:[s.jsxs("div",{className:"nft-id",children:["Token ID: #",h]}),c.owner&&s.jsxs("div",{className:"owner-info",children:["Owner: ",p(c.owner)]})]})]})]}),s.jsxs("div",{className:"info-section",children:[s.jsx("h4",{children:"HOW IT WORKS:"}),s.jsxs("ul",{children:[s.jsx("li",{children:"Enter any NFT ID to check its recorded score"}),s.jsx("li",{children:"Trophy NFTs are minted when you score 5+ points"}),s.jsx("li",{children:"Each NFT stores the game score onchain"}),s.jsx("li",{children:"View any player's achievement on Arc Testnet"})]})]})]}),s.jsx("div",{className:"modal-footer",children:s.jsx("button",{className:"close-modal-btn",onClick:d,children:"CLOSE"})})]})}):null},K=({transactions:r,clearTransactions:d})=>{const i=o.useRef([]),{logout:h}=w(),{handleFaucet:m}=E(),{wallets:u}=C(),[j,c]=o.useState(!1),[a,b]=o.useState(),x="https://sepolia.etherscan.io/address/0x7e6114bAB8ADf97d88e028697a9D0CF11A6af9e0",k="https://ipfs.io/ipfs/bafkreicdqmt5zw6yhm3g4ugj3gqfs5jh562qydyzfeevycrjky5sah7ske",y=e=>{const t=e.target;if(t.classList.contains("interactive-link")){e.preventDefault();const f=t.getAttribute("data-action");if(f==="logout")h();else if(f==="faucet"){const T=u.find(F=>F.walletClientType==="privy");T&&m(T.address)}}};o.useEffect(()=>{i.current=[...r]},[r]);const v=()=>{d&&window.confirm("Are you sure you want to clear all transactions?")&&d()},p=e=>e.startsWith("FHE Mint"),n=e=>e?e.includes("Not owner")?"Access denied - not NFT owner":e.includes("4001")||e.includes("user rejected")||e.includes("ACTION_REJECTED")?"Transaction rejected by user":e.includes("insufficient funds")?"Insufficient funds for gas":e.includes("nonce too low")?"Nonce error â€” try again":e.length>100?e.slice(0,97)+"...":e:"",g=e=>{const t=e.match(/FHE Mint \((\d+)\)/);return t?{tokenId:parseInt(t[1]),score:parseInt(t[1])}:null},N=e=>{b(e),c(!0)},l=r.filter(e=>p(e.type)&&e.link&&e.link!=="Pending..."&&e.link!=="Not processed").map(e=>{var f;const t=g(e.type);return t?{tokenId:t.tokenId,date:new Date(e.date),txHash:((f=e.link)==null?void 0:f.split("/").pop())||""}:null}).filter(Boolean).sort((e,t)=>t.tokenId-e.tokenId);return s.jsxs("div",{className:"transactions",children:[s.jsxs("div",{className:"header",children:[s.jsxs("h2",{children:["Transactions ",r.length?`(${r.length})`:null]}),l.length>=0&&s.jsx("button",{onClick:()=>N(),className:"nft-checker-btn",style:{marginRight:"10px",padding:"8px 16px",background:"#00D4FF",color:"#0a1929",border:"none",borderRadius:"32px",cursor:"pointer",fontWeight:"700",fontFamily:"'Orbitron', sans-serif",fontSize:"14px",boxShadow:"0 4px 15px rgba(0, 212, 255, 0.3)"},children:"ðŸ” Check NFT Scores"}),d&&r.length>0&&s.jsx("button",{onClick:v,className:"clear-btn",children:"Clear transactions"})]}),l.length>0&&s.jsxs("div",{className:"nft-display-section",children:[s.jsx("h3",{style:{color:"#00D4FF",marginBottom:"15px"},children:"ðŸ† Your Arc Trophy NFTs"}),s.jsx("div",{className:"nft-grid",children:l.map(e=>s.jsxs("div",{className:"nft-card",children:[s.jsx("div",{className:"nft-image",children:s.jsx("img",{src:k,alt:`NFT #${e.tokenId}`,onError:t=>{t.target.src="https://via.placeholder.com/150/1b1b1b/f6ffa4?text=NFT"}})}),s.jsxs("div",{className:"nft-info",children:[s.jsxs("div",{className:"nft-id",children:["Token ID: #",e.tokenId]}),s.jsx("div",{className:"nft-date",children:e.date.toLocaleDateString()}),s.jsx("button",{onClick:()=>N(e.tokenId),className:"check-score-btn",children:"Check Score"})]})]},e.tokenId))})]}),r.length?s.jsx("div",{className:"table-wrapper",children:s.jsxs("table",{className:"transactions-table",onClick:y,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Type"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Date"})]})}),s.jsx("tbody",{children:r.map((e,t)=>(p(e.type)&&e.link&&e.link!=="Pending..."&&e.link,s.jsxs("tr",{datatype:e.type.split(" ")[0].replace(":",""),children:[s.jsx("td",{children:e.type}),s.jsx("td",{children:e.error?s.jsx("span",{className:"error-text",children:n(e.error)}):!e.link||e.link==="Pending..."||e.link==="Not processed"?s.jsx("span",{className:"pending",children:e.link}):p(e.type)?s.jsxs("span",{children:["Congrats! You minted a"," ",s.jsx("a",{href:x,target:"_blank",rel:"noopener noreferrer",children:"Confidential Trophy NFT"})," ","ðŸ† | Tx:"," ",s.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",children:e.link.slice(-12)})]}):s.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",children:e.link.length>60?`${e.link.slice(0,30)}...${e.link.slice(-8)}`:e.link})}),s.jsx("td",{children:new Date(e.date).toLocaleString()})]},`${e.id}-${t}`)))})]})}):s.jsx("span",{className:"regular",children:"You have no transactions"}),s.jsx(_,{isOpen:j,onClose:()=>c(!1),initialTokenId:a})]})};export{K as default};
