const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-BdBRfmNu.js","assets/auth-BxfdJgsU.js","assets/vendor-Cs8wUaRe.js","assets/embedded-wallet-Be7BeICu.js","assets/if-defined-DGmVhyRS.js","assets/index-Dr4_p6CG.js","assets/index-BDLQ_3cj.js","assets/ref-CD41MNL9.js","assets/index-BWDVDgUe.js","assets/index-gYQeX_Si.js","assets/index-kSdHRgQ3.js","assets/index-BTxx52ui.js","assets/index-C9s6QKXN.js","assets/index-BzF-AT5A.js","assets/index-CqR9tDQ7.js","assets/email-f2-TTO6i.js","assets/index-B5Yulg4r.js","assets/socials-Bkyt1kXA.js","assets/index-ol_-2N4A.js","assets/ConstantsUtil-Dmg8YACJ.js","assets/index-D0nx5dFz.js","assets/index-D-4PSz6P.js","assets/index-CJKZ5lmR.js","assets/index-D_sE5vDe.js","assets/index-Co1MXdxN.js","assets/swaps-CtItMOLF.js","assets/index-Cw8Vcw59.js","assets/index-B1lF2DDx.js","assets/index-B-PYkf7z.js","assets/send-BJHVUFVq.js","assets/index-CR7qaT8J.js","assets/index-CJbzLXSd.js","assets/receive-DYPKYs-1.js","assets/index-0bzSMryu.js","assets/onramp-C5khZrCG.js","assets/index-ChsLRpbq.js","assets/index-DvPHCy1T.js","assets/index-C0-qorwb.js","assets/transactions-CQd-wA0I.js","assets/index-CNBaea6T.js","assets/index-BR8_a7pJ.js","assets/index-CZspJyNx.js","assets/index-V8I_cuBF.js","assets/index-BTz05um1.js","assets/w3m-modal-DTlqIVnD.js"])))=>i.map(i=>d[i]);
import{p as os,d as zn,s as yo,b as vc,c as hp,e as pp,k as fp,f as gp,g as mp,h as qc,I as Si,_ as Vt,i as wp,l as Yt,t as Pt,m as L,C as yp,o as Cr,q as vp,u as gt,w as Ji,x as Ua,y as du,z as kr,A as Ni,B as Ec,E as wt,D as Ep,F as qt,G as wr,H as On,L as bc,M as Zt,N as bp,P as _c,Q as Cc,S as Lo,T as Ac,U as Fc,V as _p,W as Cp,X as oi,Y as uu,Z as Os,$ as ms,a0 as qs,a1 as ds,a2 as Ap,a3 as Wc,a4 as Vn,a5 as Hc}from"./auth-BxfdJgsU.js";const Ip=Symbol(),zc=Object.getPrototypeOf,Da=new WeakMap,Sp=s=>s&&(Da.has(s)?Da.get(s):zc(s)===Object.prototype||zc(s)===Array.prototype),Np=s=>Sp(s)&&s[Ip]||null,Vc=(s,e=!0)=>{Da.set(s,e)},vo={},Jo=s=>typeof s=="object"&&s!==null,Vs=new WeakMap,Vi=new WeakSet,Tp=(s=Object.is,e=(l,d)=>new Proxy(l,d),t=l=>Jo(l)&&!Vi.has(l)&&(Array.isArray(l)||!(Symbol.iterator in l))&&!(l instanceof WeakMap)&&!(l instanceof WeakSet)&&!(l instanceof Error)&&!(l instanceof Number)&&!(l instanceof Date)&&!(l instanceof String)&&!(l instanceof RegExp)&&!(l instanceof ArrayBuffer),r=l=>{switch(l.status){case"fulfilled":return l.value;case"rejected":throw l.reason;default:throw l}},i=new WeakMap,n=(l,d,u=r)=>{const h=i.get(l);if((h==null?void 0:h[0])===d)return h[1];const f=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l));return Vc(f,!0),i.set(l,[d,f]),Reflect.ownKeys(l).forEach(g=>{if(Object.getOwnPropertyDescriptor(f,g))return;const m=Reflect.get(l,g),{enumerable:w}=Reflect.getOwnPropertyDescriptor(l,g),v={value:m,enumerable:w,configurable:!0};if(Vi.has(m))Vc(m,!1);else if(m instanceof Promise)delete v.value,v.get=()=>u(m);else if(Vs.has(m)){const[E,_]=Vs.get(m);v.value=n(E,_(),u)}Object.defineProperty(f,g,v)}),Object.preventExtensions(f)},o=new WeakMap,a=[1,1],c=l=>{if(!Jo(l))throw new Error("object required");const d=o.get(l);if(d)return d;let u=a[0];const h=new Set,f=(b,U=++a[0])=>{u!==U&&(u=U,h.forEach(A=>A(b,U)))};let g=a[1];const m=(b=++a[1])=>(g!==b&&!h.size&&(g=b,v.forEach(([U])=>{const A=U[1](b);A>u&&(u=A)})),u),w=b=>(U,A)=>{const j=[...U];j[1]=[b,...j[1]],f(j,A)},v=new Map,E=(b,U)=>{if((vo?"production":void 0)!=="production"&&v.has(b))throw new Error("prop listener already exists");if(h.size){const A=U[3](w(b));v.set(b,[U,A])}else v.set(b,[U])},_=b=>{var U;const A=v.get(b);A&&(v.delete(b),(U=A[1])==null||U.call(A))},C=b=>(h.add(b),h.size===1&&v.forEach(([A,j],J)=>{if((vo?"production":void 0)!=="production"&&j)throw new Error("remove already exists");const I=A[3](w(J));v.set(J,[A,I])}),()=>{h.delete(b),h.size===0&&v.forEach(([A,j],J)=>{j&&(j(),v.set(J,[A]))})}),k=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l)),P=e(k,{deleteProperty(b,U){const A=Reflect.get(b,U);_(U);const j=Reflect.deleteProperty(b,U);return j&&f(["delete",[U],A]),j},set(b,U,A,j){const J=Reflect.has(b,U),I=Reflect.get(b,U,j);if(J&&(s(I,A)||o.has(A)&&s(I,o.get(A))))return!0;_(U),Jo(A)&&(A=Np(A)||A);let R=A;if(A instanceof Promise)A.then(N=>{A.status="fulfilled",A.value=N,f(["resolve",[U],N])}).catch(N=>{A.status="rejected",A.reason=N,f(["reject",[U],N])});else{!Vs.has(A)&&t(A)&&(R=c(A));const N=!Vi.has(R)&&Vs.get(R);N&&E(U,N)}return Reflect.set(b,U,R,j),f(["set",[U],A,I]),!0}});o.set(l,P);const M=[k,m,n,C];return Vs.set(P,M),Reflect.ownKeys(l).forEach(b=>{const U=Object.getOwnPropertyDescriptor(l,b);"value"in U&&(P[b]=l[b],delete U.value,delete U.writable),Object.defineProperty(k,b,U)}),P})=>[c,Vs,Vi,s,e,t,r,i,n,o,a],[Pp]=Tp();function je(s={}){return Pp(s)}function Et(s,e,t){const r=Vs.get(s);(vo?"production":void 0)!=="production"&&!r&&console.warn("Please use proxy object");let i;const n=[],o=r[3];let a=!1;const l=o(d=>{n.push(d),i||(i=Promise.resolve().then(()=>{i=void 0,a&&e(n.splice(0))}))});return a=!0,()=>{a=!1,l()}}function cn(s,e){const t=Vs.get(s);(vo?"production":void 0)!=="production"&&!t&&console.warn("Please use proxy object");const[r,i,n]=t;return n(r,i(),e)}function Ar(s){return Vi.add(s),s}function Rt(s,e,t,r){let i=s[e];return Et(s,()=>{const n=s[e];Object.is(i,n)||t(i=n)})}function Rp(s){const e=je({data:Array.from([]),has(t){return this.data.some(r=>r[0]===t)},set(t,r){const i=this.data.find(n=>n[0]===t);return i?i[1]=r:this.data.push([t,r]),this},get(t){var r;return(r=this.data.find(i=>i[0]===t))==null?void 0:r[1]},delete(t){const r=this.data.findIndex(i=>i[0]===t);return r===-1?!1:(this.data.splice(r,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(t){this.data.forEach(r=>{t(r[1],r[0],this)})},keys(){return this.data.map(t=>t[0]).values()},values(){return this.data.map(t=>t[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}const hu={caipNetworkIdToNumber(s){return s?Number(s.split(":")[1]):void 0},parseEvmChainId(s){return typeof s=="string"?this.caipNetworkIdToNumber(s):s},getNetworksByNamespace(s,e){return(s==null?void 0:s.filter(t=>t.chainNamespace===e))||[]},getFirstNetworkByNamespace(s,e){return this.getNetworksByNamespace(s,e)[0]}};var Op=20,xp=1,Ti=1e6,kp=1e6,$p=-7,Up=21,Dp=!1,xn="[big.js] ",$r=xn+"Invalid ",Mo=$r+"decimal places",Lp=$r+"rounding mode",pu=xn+"Division by zero",Se={},vs=void 0,Mp=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function fu(){function s(e){var t=this;if(!(t instanceof s))return e===vs?fu():new s(e);if(e instanceof s)t.s=e.s,t.e=e.e,t.c=e.c.slice();else{if(typeof e!="string"){if(s.strict===!0&&typeof e!="bigint")throw TypeError($r+"value");e=e===0&&1/e<0?"-0":String(e)}jp(t,e)}t.constructor=s}return s.prototype=Se,s.DP=Op,s.RM=xp,s.NE=$p,s.PE=Up,s.strict=Dp,s.roundDown=0,s.roundHalfUp=1,s.roundHalfEven=2,s.roundUp=3,s}function jp(s,e){var t,r,i;if(!Mp.test(e))throw Error($r+"number");for(s.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(t=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(t<0&&(t=r),t+=+e.slice(r+1),e=e.substring(0,r)):t<0&&(t=e.length),i=e.length,r=0;r<i&&e.charAt(r)=="0";)++r;if(r==i)s.c=[s.e=0];else{for(;i>0&&e.charAt(--i)=="0";);for(s.e=t-r-1,s.c=[],t=0;r<=i;)s.c[t++]=+e.charAt(r++)}return s}function Ur(s,e,t,r){var i=s.c;if(t===vs&&(t=s.constructor.RM),t!==0&&t!==1&&t!==2&&t!==3)throw Error(Lp);if(e<1)r=t===3&&(r||!!i[0])||e===0&&(t===1&&i[0]>=5||t===2&&(i[0]>5||i[0]===5&&(r||i[1]!==vs))),i.length=1,r?(s.e=s.e-e+1,i[0]=1):i[0]=s.e=0;else if(e<i.length){if(r=t===1&&i[e]>=5||t===2&&(i[e]>5||i[e]===5&&(r||i[e+1]!==vs||i[e-1]&1))||t===3&&(r||!!i[0]),i.length=e,r){for(;++i[--e]>9;)if(i[e]=0,e===0){++s.e,i.unshift(1);break}}for(e=i.length;!i[--e];)i.pop()}return s}function Dr(s,e,t){var r=s.e,i=s.c.join(""),n=i.length;if(e)i=i.charAt(0)+(n>1?"."+i.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)i="0"+i;i="0."+i}else if(r>0)if(++r>n)for(r-=n;r--;)i+="0";else r<n&&(i=i.slice(0,r)+"."+i.slice(r));else n>1&&(i=i.charAt(0)+"."+i.slice(1));return s.s<0&&t?"-"+i:i}Se.abs=function(){var s=new this.constructor(this);return s.s=1,s};Se.cmp=function(s){var e,t=this,r=t.c,i=(s=new t.constructor(s)).c,n=t.s,o=s.s,a=t.e,c=s.e;if(!r[0]||!i[0])return r[0]?n:i[0]?-o:0;if(n!=o)return n;if(e=n<0,a!=c)return a>c^e?1:-1;for(o=(a=r.length)<(c=i.length)?a:c,n=-1;++n<o;)if(r[n]!=i[n])return r[n]>i[n]^e?1:-1;return a==c?0:a>c^e?1:-1};Se.div=function(s){var e=this,t=e.constructor,r=e.c,i=(s=new t(s)).c,n=e.s==s.s?1:-1,o=t.DP;if(o!==~~o||o<0||o>Ti)throw Error(Mo);if(!i[0])throw Error(pu);if(!r[0])return s.s=n,s.c=[s.e=0],s;var a,c,l,d,u,h=i.slice(),f=a=i.length,g=r.length,m=r.slice(0,a),w=m.length,v=s,E=v.c=[],_=0,C=o+(v.e=e.e-s.e)+1;for(v.s=n,n=C<0?0:C,h.unshift(0);w++<a;)m.push(0);do{for(l=0;l<10;l++){if(a!=(w=m.length))d=a>w?1:-1;else for(u=-1,d=0;++u<a;)if(i[u]!=m[u]){d=i[u]>m[u]?1:-1;break}if(d<0){for(c=w==a?i:h;w;){if(m[--w]<c[w]){for(u=w;u&&!m[--u];)m[u]=9;--m[u],m[w]+=10}m[w]-=c[w]}for(;!m[0];)m.shift()}else break}E[_++]=d?l:++l,m[0]&&d?m[w]=r[f]||0:m=[r[f]]}while((f++<g||m[0]!==vs)&&n--);return!E[0]&&_!=1&&(E.shift(),v.e--,C--),_>C&&Ur(v,C,t.RM,m[0]!==vs),v};Se.eq=function(s){return this.cmp(s)===0};Se.gt=function(s){return this.cmp(s)>0};Se.gte=function(s){return this.cmp(s)>-1};Se.lt=function(s){return this.cmp(s)<0};Se.lte=function(s){return this.cmp(s)<1};Se.minus=Se.sub=function(s){var e,t,r,i,n=this,o=n.constructor,a=n.s,c=(s=new o(s)).s;if(a!=c)return s.s=-c,n.plus(s);var l=n.c.slice(),d=n.e,u=s.c,h=s.e;if(!l[0]||!u[0])return u[0]?s.s=-c:l[0]?s=new o(n):s.s=1,s;if(a=d-h){for((i=a<0)?(a=-a,r=l):(h=d,r=u),r.reverse(),c=a;c--;)r.push(0);r.reverse()}else for(t=((i=l.length<u.length)?l:u).length,a=c=0;c<t;c++)if(l[c]!=u[c]){i=l[c]<u[c];break}if(i&&(r=l,l=u,u=r,s.s=-s.s),(c=(t=u.length)-(e=l.length))>0)for(;c--;)l[e++]=0;for(c=e;t>a;){if(l[--t]<u[t]){for(e=t;e&&!l[--e];)l[e]=9;--l[e],l[t]+=10}l[t]-=u[t]}for(;l[--c]===0;)l.pop();for(;l[0]===0;)l.shift(),--h;return l[0]||(s.s=1,l=[h=0]),s.c=l,s.e=h,s};Se.mod=function(s){var e,t=this,r=t.constructor,i=t.s,n=(s=new r(s)).s;if(!s.c[0])throw Error(pu);return t.s=s.s=1,e=s.cmp(t)==1,t.s=i,s.s=n,e?new r(t):(i=r.DP,n=r.RM,r.DP=r.RM=0,t=t.div(s),r.DP=i,r.RM=n,this.minus(t.times(s)))};Se.neg=function(){var s=new this.constructor(this);return s.s=-s.s,s};Se.plus=Se.add=function(s){var e,t,r,i=this,n=i.constructor;if(s=new n(s),i.s!=s.s)return s.s=-s.s,i.minus(s);var o=i.e,a=i.c,c=s.e,l=s.c;if(!a[0]||!l[0])return l[0]||(a[0]?s=new n(i):s.s=i.s),s;if(a=a.slice(),e=o-c){for(e>0?(c=o,r=l):(e=-e,r=a),r.reverse();e--;)r.push(0);r.reverse()}for(a.length-l.length<0&&(r=l,l=a,a=r),e=l.length,t=0;e;a[e]%=10)t=(a[--e]=a[e]+l[e]+t)/10|0;for(t&&(a.unshift(t),++c),e=a.length;a[--e]===0;)a.pop();return s.c=a,s.e=c,s};Se.pow=function(s){var e=this,t=new e.constructor("1"),r=t,i=s<0;if(s!==~~s||s<-1e6||s>kp)throw Error($r+"exponent");for(i&&(s=-s);s&1&&(r=r.times(e)),s>>=1,!!s;)e=e.times(e);return i?t.div(r):r};Se.prec=function(s,e){if(s!==~~s||s<1||s>Ti)throw Error($r+"precision");return Ur(new this.constructor(this),s,e)};Se.round=function(s,e){if(s===vs)s=0;else if(s!==~~s||s<-1e6||s>Ti)throw Error(Mo);return Ur(new this.constructor(this),s+this.e+1,e)};Se.sqrt=function(){var s,e,t,r=this,i=r.constructor,n=r.s,o=r.e,a=new i("0.5");if(!r.c[0])return new i(r);if(n<0)throw Error(xn+"No square root");n=Math.sqrt(+Dr(r,!0,!0)),n===0||n===1/0?(e=r.c.join(""),e.length+o&1||(e+="0"),n=Math.sqrt(e),o=((o+1)/2|0)-(o<0||o&1),s=new i((n==1/0?"5e":(n=n.toExponential()).slice(0,n.indexOf("e")+1))+o)):s=new i(n+""),o=s.e+(i.DP+=4);do t=s,s=a.times(t.plus(r.div(t)));while(t.c.slice(0,o).join("")!==s.c.slice(0,o).join(""));return Ur(s,(i.DP-=4)+s.e+1,i.RM)};Se.times=Se.mul=function(s){var e,t=this,r=t.constructor,i=t.c,n=(s=new r(s)).c,o=i.length,a=n.length,c=t.e,l=s.e;if(s.s=t.s==s.s?1:-1,!i[0]||!n[0])return s.c=[s.e=0],s;for(s.e=c+l,o<a&&(e=i,i=n,n=e,l=o,o=a,a=l),e=new Array(l=o+a);l--;)e[l]=0;for(c=a;c--;){for(a=0,l=o+c;l>c;)a=e[l]+n[c]*i[l-c-1]+a,e[l--]=a%10,a=a/10|0;e[l]=a}for(a?++s.e:e.shift(),c=e.length;!e[--c];)e.pop();return s.c=e,s};Se.toExponential=function(s,e){var t=this,r=t.c[0];if(s!==vs){if(s!==~~s||s<0||s>Ti)throw Error(Mo);for(t=Ur(new t.constructor(t),++s,e);t.c.length<s;)t.c.push(0)}return Dr(t,!0,!!r)};Se.toFixed=function(s,e){var t=this,r=t.c[0];if(s!==vs){if(s!==~~s||s<0||s>Ti)throw Error(Mo);for(t=Ur(new t.constructor(t),s+t.e+1,e),s=s+t.e+1;t.c.length<s;)t.c.push(0)}return Dr(t,!1,!!r)};Se[Symbol.for("nodejs.util.inspect.custom")]=Se.toJSON=Se.toString=function(){var s=this,e=s.constructor;return Dr(s,s.e<=e.NE||s.e>=e.PE,!!s.c[0])};Se.toNumber=function(){var s=+Dr(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(s.toString()))throw Error(xn+"Imprecise conversion");return s};Se.toPrecision=function(s,e){var t=this,r=t.constructor,i=t.c[0];if(s!==vs){if(s!==~~s||s<1||s>Ti)throw Error($r+"precision");for(t=Ur(new r(t),s,e);t.c.length<s;)t.c.push(0)}return Dr(t,s<=t.e||t.e<=r.NE||t.e>=r.PE,!!i)};Se.valueOf=function(){var s=this,e=s.constructor;if(e.strict===!0)throw Error(xn+"valueOf disallowed");return Dr(s,s.e<=e.NE||s.e>=e.PE,!0)};var $i=fu();const Bp={bigNumber(s){return s?new $i(s):new $i(0)},multiply(s,e){if(s===void 0||e===void 0)return new $i(0);const t=new $i(s),r=new $i(e);return t.times(r)},formatNumberToLocalString(s,e=2){return s===void 0?"0.00":typeof s=="number"?s.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e}):parseFloat(s).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e})},parseLocalStringToNumber(s){return s===void 0?0:parseFloat(s.replace(/,/gu,""))}},qp=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],Fp=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],Wp=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}];var Kc={};const G={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"ID_AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin",cosmos:"Cosmos"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],HTTP_STATUS_CODES:{SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network",SECURE_SITE_SDK_ORIGIN:(typeof os<"u"&&typeof Kc<"u"?Kc.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org"},Hp={getERC20Abi:s=>G.USDT_CONTRACT_ADDRESSES.includes(s)?Wp:qp,getSwapAbi:()=>Fp},Fs={validateCaipAddress(s){var e;if(((e=s.split(":"))==null?void 0:e.length)!==3)throw new Error("Invalid CAIP Address");return s},parseCaipAddress(s){const e=s.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${s}`);const[t,r,i]=e;if(!t||!r||!i)throw new Error(`Invalid CAIP-10 address: ${s}`);return{chainNamespace:t,chainId:r,address:i}},parseCaipNetworkId(s){const e=s.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${s}`);const[t,r]=e;if(!t||!r)throw new Error(`Invalid CAIP-2 network id: ${s}`);return{chainNamespace:t,chainId:r}}},he={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache",PREFERRED_ACCOUNT_TYPES:"@appkit/preferred_account_types"};function Xo(s){if(!s)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${s}:connected_connector_id`}const ae={setItem(s,e){Ki()&&e!==void 0&&localStorage.setItem(s,e)},getItem(s){if(Ki())return localStorage.getItem(s)||void 0},removeItem(s){Ki()&&localStorage.removeItem(s)},clear(){Ki()&&localStorage.clear()}};function Ki(){return typeof window<"u"&&typeof localStorage<"u"}function Ds(s,e){return e==="light"?{"--w3m-accent":(s==null?void 0:s["--w3m-accent"])||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":(s==null?void 0:s["--w3m-accent"])||"hsla(230, 100%, 67%, 1)","--w3m-background":"#121313"}}var Gc={};const Qo=(typeof os<"u"&&typeof Gc<"u"?Gc.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",QS=[{label:"Coinbase",name:"coinbase",feeRange:"1-2%",url:"",supportedChains:["eip155"]},{label:"Meld.io",name:"meld",feeRange:"1-2%",url:"https://meldcrypto.com",supportedChains:["eip155","solana"]}],eN="WXETMuFUQmqqybHuRkSgxv:25B8LJHSfpG6LVjR2ytU5Cwh7Z4Sch2ocoU",lt={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,FIVE_SEC_MS:5e3,THREE_SEC_MS:3e3,ONE_SEC_MS:1e3,SECURE_SITE:Qo,SECURE_SITE_DASHBOARD:`${Qo}/dashboard`,SECURE_SITE_FAVICON:`${Qo}/images/favicon.png`,RESTRICTED_TIMEZONES:["ASIA/SHANGHAI","ASIA/URUMQI","ASIA/CHONGQING","ASIA/HARBIN","ASIA/KASHGAR","ASIA/MACAU","ASIA/HONG_KONG","ASIA/MACAO","ASIA/BEIJING","ASIA/HARBIN"],WC_COINBASE_PAY_SDK_CHAINS:["ethereum","arbitrum","polygon","berachain","avalanche-c-chain","optimism","celo","base"],WC_COINBASE_PAY_SDK_FALLBACK_CHAIN:"ethereum",WC_COINBASE_PAY_SDK_CHAIN_NAME_MAP:{Ethereum:"ethereum","Arbitrum One":"arbitrum",Polygon:"polygon",Berachain:"berachain",Avalanche:"avalanche-c-chain","OP Mainnet":"optimism",Celo:"celo",Base:"base"},WC_COINBASE_ONRAMP_APP_ID:"bf18c88d-495a-463b-b249-0b9d3656cf5e",SWAP_SUGGESTED_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP"],SWAP_POPULAR_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP","METAL","DAI","CHAMP","WOLF","SALE","BAL","BUSD","MUST","BTCpx","ROUTE","HEX","WELT","amDAI","VSQ","VISION","AURUM","pSP","SNX","VC","LINK","CHP","amUSDT","SPHERE","FOX","GIDDY","GFC","OMEN","OX_OLD","DE","WNT"],BALANCE_SUPPORTED_CHAINS:["eip155","solana"],SWAP_SUPPORTED_NETWORKS:["eip155:1","eip155:42161","eip155:10","eip155:324","eip155:8453","eip155:56","eip155:137","eip155:100","eip155:43114","eip155:250","eip155:8217","eip155:1313161554"],NAMES_SUPPORTED_CHAIN_NAMESPACES:["eip155"],ONRAMP_SUPPORTED_CHAIN_NAMESPACES:["eip155","solana"],ACTIVITY_ENABLED_CHAIN_NAMESPACES:["eip155"],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x",cosmos:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in a new browser tab"},SEND_SUPPORTED_NAMESPACES:["eip155","solana"],DEFAULT_FEATURES:{swaps:!0,onramp:!0,receive:!0,send:!0,email:!0,emailShowWallets:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],history:!0,analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0,pay:!1},DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",BITCOIN:"bitcoin"}},K={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5},isCacheExpired(s,e){return Date.now()-s>e},getActiveNetworkProps(){const s=K.getActiveNamespace(),e=K.getActiveCaipNetworkId(),t=e?e.split(":")[1]:void 0,r=t?isNaN(Number(t))?t:Number(t):void 0;return{namespace:s,caipNetworkId:e,chainId:r}},setWalletConnectDeepLink({name:s,href:e}){try{ae.setItem(he.DEEPLINK_CHOICE,JSON.stringify({href:e,name:s}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const s=ae.getItem(he.DEEPLINK_CHOICE);if(s)return JSON.parse(s)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{ae.removeItem(he.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(s){try{ae.setItem(he.ACTIVE_NAMESPACE,s)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(s){try{ae.setItem(he.ACTIVE_CAIP_NETWORK_ID,s),K.setActiveNamespace(s.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return ae.getItem(he.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{ae.removeItem(he.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(s){try{const e=Xo(s);ae.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(s){try{const e=K.getRecentWallets();e.find(r=>r.id===s.id)||(e.unshift(s),e.length>2&&e.pop(),ae.setItem(he.RECENT_WALLETS,JSON.stringify(e)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const s=ae.getItem(he.RECENT_WALLETS);return s?JSON.parse(s):[]}catch{console.info("Unable to get AppKit recent")}return[]},setConnectedConnectorId(s,e){try{const t=Xo(s);ae.setItem(t,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return ae.getItem(he.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(s){if(s)try{const e=Xo(s);return ae.getItem(e)}catch{console.info("Unable to get connected connector id in namespace ",s)}},setConnectedSocialProvider(s){try{ae.setItem(he.CONNECTED_SOCIAL,s)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return ae.getItem(he.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{ae.removeItem(he.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return ae.getItem(he.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){var t;const s=ae.getItem(he.ACTIVE_CAIP_NETWORK_ID);return(t=s==null?void 0:s.split(":"))==null?void 0:t[1]},setConnectionStatus(s){try{ae.setItem(he.CONNECTION_STATUS,s)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return ae.getItem(he.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const s=ae.getItem(he.CONNECTED_NAMESPACES);return s!=null&&s.length?s.split(","):[]}catch{return[]}},setConnectedNamespaces(s){try{const e=Array.from(new Set(s));ae.setItem(he.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(s){try{const e=K.getConnectedNamespaces();e.includes(s)||(e.push(s),K.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(s){try{const e=K.getConnectedNamespaces(),t=e.indexOf(s);t>-1&&(e.splice(t,1),K.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return ae.getItem(he.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(s){try{ae.setItem(he.TELEGRAM_SOCIAL_PROVIDER,s)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{ae.removeItem(he.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let s={};try{const e=ae.getItem(he.PORTFOLIO_CACHE);s=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return s},removeAddressFromBalanceCache(s){try{const e=K.getBalanceCache();ae.setItem(he.PORTFOLIO_CACHE,JSON.stringify({...e,[s]:void 0}))}catch{console.info("Unable to remove address from balance cache",s)}},getBalanceCacheForCaipAddress(s){try{const t=K.getBalanceCache()[s];if(t&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.portfolio))return t.balance;K.removeAddressFromBalanceCache(s)}catch{console.info("Unable to get balance cache for address",s)}},updateBalanceCache(s){try{const e=K.getBalanceCache();e[s.caipAddress]=s,ae.setItem(he.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",s)}},getNativeBalanceCache(){let s={};try{const e=ae.getItem(he.NATIVE_BALANCE_CACHE);s=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return s},removeAddressFromNativeBalanceCache(s){try{const e=K.getBalanceCache();ae.setItem(he.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[s]:void 0}))}catch{console.info("Unable to remove address from balance cache",s)}},getNativeBalanceCacheForCaipAddress(s){try{const t=K.getNativeBalanceCache()[s];if(t&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.nativeBalance))return t;console.info("Discarding cache for address",s),K.removeAddressFromBalanceCache(s)}catch{console.info("Unable to get balance cache for address",s)}},updateNativeBalanceCache(s){try{const e=K.getNativeBalanceCache();e[s.caipAddress]=s,ae.setItem(he.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",s)}},getEnsCache(){let s={};try{const e=ae.getItem(he.ENS_CACHE);s=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return s},getEnsFromCacheForAddress(s){try{const t=K.getEnsCache()[s];if(t&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.ens))return t.ens;K.removeEnsFromCache(s)}catch{console.info("Unable to get ens name from cache",s)}},updateEnsCache(s){try{const e=K.getEnsCache();e[s.address]=s,ae.setItem(he.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",s)}},removeEnsFromCache(s){try{const e=K.getEnsCache();ae.setItem(he.ENS_CACHE,JSON.stringify({...e,[s]:void 0}))}catch{console.info("Unable to remove ens name from cache",s)}},getIdentityCache(){let s={};try{const e=ae.getItem(he.IDENTITY_CACHE);s=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return s},getIdentityFromCacheForAddress(s){try{const t=K.getIdentityCache()[s];if(t&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.identity))return t.identity;K.removeIdentityFromCache(s)}catch{console.info("Unable to get identity from cache",s)}},updateIdentityCache(s){try{const e=K.getIdentityCache();e[s.address]={identity:s.identity,timestamp:s.timestamp},ae.setItem(he.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",s)}},removeIdentityFromCache(s){try{const e=K.getIdentityCache();ae.setItem(he.IDENTITY_CACHE,JSON.stringify({...e,[s]:void 0}))}catch{console.info("Unable to remove identity from cache",s)}},clearAddressCache(){try{ae.removeItem(he.PORTFOLIO_CACHE),ae.removeItem(he.NATIVE_BALANCE_CACHE),ae.removeItem(he.ENS_CACHE),ae.removeItem(he.IDENTITY_CACHE)}catch{console.info("Unable to clear address cache")}},setPreferredAccountTypes(s){try{ae.setItem(he.PREFERRED_ACCOUNT_TYPES,JSON.stringify(s))}catch{console.info("Unable to set preferred account types",s)}},getPreferredAccountTypes(){try{const s=ae.getItem(he.PREFERRED_ACCOUNT_TYPES);return JSON.parse(s)}catch{console.info("Unable to get preferred account types")}}},ie={isMobile(){var s;return this.isClient()?!!((s=window==null?void 0:window.matchMedia("(pointer:coarse)"))!=null&&s.matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(s,e=""){return s==null?void 0:s.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const s=window==null?void 0:window.navigator.userAgent.toLowerCase();return ie.isMobile()&&s.includes("android")},isIos(){if(!this.isMobile())return!1;const s=window==null?void 0:window.navigator.userAgent.toLowerCase();return s.includes("iphone")||s.includes("ipad")},isSafari(){return this.isClient()?(window==null?void 0:window.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(s){return s?s-Date.now()<=lt.TEN_SEC_MS:!0},isAllowedRetry(s,e=lt.ONE_SEC_MS){return Date.now()-s>=e},copyToClopboard(s){navigator.clipboard.writeText(s)},isIframe(){try{return(window==null?void 0:window.self)!==(window==null?void 0:window.top)}catch{return!1}},getPairingExpiry(){return Date.now()+lt.FOUR_MINUTES_MS},getNetworkId(s){return s==null?void 0:s.split(":")[1]},getPlainAddress(s){return s==null?void 0:s.split(":")[2]},async wait(s){return new Promise(e=>{setTimeout(e,s)})},debounce(s,e=500){let t;return(...r)=>{function i(){s(...r)}t&&clearTimeout(t),t=setTimeout(i,e)}},isHttpUrl(s){return s.startsWith("http://")||s.startsWith("https://")},formatNativeUrl(s,e){if(ie.isHttpUrl(s))return this.formatUniversalUrl(s,e);let t=s;t.includes("://")||(t=s.replaceAll("/","").replaceAll(":",""),t=`${t}://`),t.endsWith("/")||(t=`${t}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const r=encodeURIComponent(e);return{redirect:`${t}wc?uri=${r}`,href:t}},formatUniversalUrl(s,e){if(!ie.isHttpUrl(s))return this.formatNativeUrl(s,e);let t=s;t.endsWith("/")||(t=`${t}/`);const r=encodeURIComponent(e);return{redirect:`${t}wc?uri=${r}`,href:t}},getOpenTargetForPlatform(s){return s==="popupWindow"?s:this.isTelegram()?K.getTelegramSocialProvider()?"_top":"_blank":s},openHref(s,e,t){window==null||window.open(s,this.getOpenTargetForPlatform(e),t||"noreferrer noopener")},returnOpenHref(s,e,t){return window==null?void 0:window.open(s,this.getOpenTargetForPlatform(e),t||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},isPWA(){var t,r,i;if(typeof window>"u")return!1;const s=(r=(t=window.matchMedia)==null?void 0:t.call(window,"(display-mode: standalone)"))==null?void 0:r.matches,e=(i=window==null?void 0:window.navigator)==null?void 0:i.standalone;return!!(s||e)},async preloadImage(s){const e=new Promise((t,r)=>{const i=new Image;i.onload=t,i.onerror=r,i.crossOrigin="anonymous",i.src=s});return Promise.race([e,ie.wait(2e3)])},formatBalance(s,e){let t="0.000";if(typeof s=="string"){const r=Number(s);if(r){const i=Math.floor(r*1e3)/1e3;i&&(t=i.toString())}}return`${t}${e?` ${e}`:""}`},formatBalance2(s,e){var r;let t;if(s==="0")t="0";else if(typeof s=="string"){const i=Number(s);i&&(t=(r=i.toString().match(/^-?\d+(?:\.\d{0,3})?/u))==null?void 0:r[0])}return{value:t??"0",rest:t==="0"?"000":"",symbol:e}},getApiUrl(){return G.W3M_API_URL},getBlockchainApiUrl(){return G.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return G.PULSE_API_URL},getUUID(){return crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})},parseError(s){var e,t;return typeof s=="string"?s:typeof((t=(e=s==null?void 0:s.issues)==null?void 0:e[0])==null?void 0:t.message)=="string"?s.issues[0].message:s instanceof Error?s.message:"Unknown error"},sortRequestedNetworks(s,e=[]){const t={};return e&&s&&(s.forEach((r,i)=>{t[r]=i}),e.sort((r,i)=>{const n=t[r.id],o=t[i.id];return n!==void 0&&o!==void 0?n-o:n!==void 0?-1:o!==void 0?1:0})),e},calculateBalance(s){let e=0;for(const t of s)e+=t.value??0;return e},formatTokenBalance(s){const e=s.toFixed(2),[t,r]=e.split(".");return{dollars:t,pennies:r}},isAddress(s,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(s)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(s)||/^(?:0x)?[0-9A-F]{40}$/iu.test(s))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(s);default:return!1}},uniqueBy(s,e){const t=new Set;return s.filter(r=>{const i=r[e];return t.has(i)?!1:(t.add(i),!0)})},generateSdkVersion(s,e,t){const i=s.length===0?lt.ADAPTER_TYPES.UNIVERSAL:s.map(n=>n.adapterType).join(",");return`${e}-${i}-${t}`},createAccount(s,e,t,r,i){return{namespace:s,address:e,type:t,publicKey:r,path:i}},isCaipAddress(s){if(typeof s!="string")return!1;const e=s.split(":"),t=e[0];return e.filter(Boolean).length===3&&t in G.CHAIN_NAME_MAP},isMac(){const s=window==null?void 0:window.navigator.userAgent.toLowerCase();return s.includes("macintosh")&&!s.includes("safari")},formatTelegramSocialLoginUrl(s){const e=`--${encodeURIComponent(window==null?void 0:window.location.href)}`,t="state=";if(new URL(s).host==="auth.magic.link"){const i="provider_authorization_url=",n=s.substring(s.indexOf(i)+i.length),o=this.injectIntoUrl(decodeURIComponent(n),t,e);return s.replace(n,encodeURIComponent(o))}return this.injectIntoUrl(s,t,e)},injectIntoUrl(s,e,t){const r=s.indexOf(e);if(r===-1)throw new Error(`${e} parameter not found in the URL: ${s}`);const i=s.indexOf("&",r),n=e.length,o=i!==-1?i:s.length,a=s.substring(0,r+n),c=s.substring(r+n,o),l=s.substring(i),d=c+t;return a+d+l}};async function Ui(...s){const e=await fetch(...s);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class jo{constructor({baseUrl:e,clientId:t}){this.baseUrl=e,this.clientId=t}async get({headers:e,signal:t,cache:r,...i}){const n=this.createUrl(i);return(await Ui(n,{method:"GET",headers:e,signal:t,cache:r})).json()}async getBlob({headers:e,signal:t,...r}){const i=this.createUrl(r);return(await Ui(i,{method:"GET",headers:e,signal:t})).blob()}async post({body:e,headers:t,signal:r,...i}){const n=this.createUrl(i);return(await Ui(n,{method:"POST",headers:t,body:e?JSON.stringify(e):void 0,signal:r})).json()}async put({body:e,headers:t,signal:r,...i}){const n=this.createUrl(i);return(await Ui(n,{method:"PUT",headers:t,body:e?JSON.stringify(e):void 0,signal:r})).json()}async delete({body:e,headers:t,signal:r,...i}){const n=this.createUrl(i);return(await Ui(n,{method:"DELETE",headers:t,body:e?JSON.stringify(e):void 0,signal:r})).json()}createUrl({path:e,params:t}){const r=new URL(e,this.baseUrl);return t&&Object.entries(t).forEach(([i,n])=>{n&&r.searchParams.append(i,n)}),this.clientId&&r.searchParams.append("clientId",this.clientId),r}}const zp={handleSolanaDeeplinkRedirect(s){if(y.state.activeChain===G.CHAIN.SOLANA){const e=window.location.href,t=encodeURIComponent(e);if(s==="Phantom"&&!("phantom"in window)){const r=e.startsWith("https")?"https":"http",i=e.split("/")[2],n=encodeURIComponent(`${r}://${i}`);window.location.href=`https://phantom.app/ul/browse/${t}?ref=${n}`}s==="Coinbase Wallet"&&!("coinbaseSolana"in window)&&(window.location.href=`https://go.cb-w.com/dapp?cb_url=${t}`)}}},Ot=je({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),ss={state:Ot,subscribeNetworkImages(s){return Et(Ot.networkImages,()=>s(Ot.networkImages))},subscribeKey(s,e){return Rt(Ot,s,e)},subscribe(s){return Et(Ot,()=>s(Ot))},setWalletImage(s,e){Ot.walletImages[s]=e},setNetworkImage(s,e){Ot.networkImages[s]=e},setChainImage(s,e){Ot.chainImages[s]=e},setConnectorImage(s,e){Ot.connectorImages={...Ot.connectorImages,[s]:e}},setTokenImage(s,e){Ot.tokenImages[s]=e},setCurrencyImage(s,e){Ot.currencyImages[s]=e}},Vp={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00",cosmos:""},ea=je({networkImagePromises:{}}),gu={async fetchWalletImage(s){if(s)return await te._fetchWalletImage(s),this.getWalletImageById(s)},async fetchNetworkImage(s){if(!s)return;const e=this.getNetworkImageById(s);return e||(ea.networkImagePromises[s]||(ea.networkImagePromises[s]=te._fetchNetworkImage(s)),await ea.networkImagePromises[s],this.getNetworkImageById(s))},getWalletImageById(s){if(s)return ss.state.walletImages[s]},getWalletImage(s){if(s!=null&&s.image_url)return s==null?void 0:s.image_url;if(s!=null&&s.image_id)return ss.state.walletImages[s.image_id]},getNetworkImage(s){var e,t,r;if((e=s==null?void 0:s.assets)!=null&&e.imageUrl)return(t=s==null?void 0:s.assets)==null?void 0:t.imageUrl;if((r=s==null?void 0:s.assets)!=null&&r.imageId)return ss.state.networkImages[s.assets.imageId]},getNetworkImageById(s){if(s)return ss.state.networkImages[s]},getConnectorImage(s){if(s!=null&&s.imageUrl)return s.imageUrl;if(s!=null&&s.imageId)return ss.state.connectorImages[s.imageId]},getChainImage(s){return ss.state.networkImages[Vp[s]]}},Kp={getFeatureValue(s,e){const t=e==null?void 0:e[s];return t===void 0?lt.DEFAULT_FEATURES[s]:t},filterSocialsByPlatform(s){if(!s||!s.length)return s;if(ie.isTelegram()){if(ie.isIos())return s.filter(e=>e!=="google");if(ie.isMac())return s.filter(e=>e!=="x");if(ie.isAndroid())return s.filter(e=>!["facebook","x"].includes(e))}return s}},ee=je({features:lt.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:{solana:"eoa",bip122:"payment",polkadot:"eoa",eip155:"smartAccount"},enableNetworkSwitch:!0}),x={state:ee,subscribeKey(s,e){return Rt(ee,s,e)},setOptions(s){Object.assign(ee,s)},setFeatures(s){if(!s)return;ee.features||(ee.features=lt.DEFAULT_FEATURES);const e={...ee.features,...s};ee.features=e,ee.features.socials&&(ee.features.socials=Kp.filterSocialsByPlatform(ee.features.socials))},setProjectId(s){ee.projectId=s},setCustomRpcUrls(s){ee.customRpcUrls=s},setAllWallets(s){ee.allWallets=s},setIncludeWalletIds(s){ee.includeWalletIds=s},setExcludeWalletIds(s){ee.excludeWalletIds=s},setFeaturedWalletIds(s){ee.featuredWalletIds=s},setTokens(s){ee.tokens=s},setTermsConditionsUrl(s){ee.termsConditionsUrl=s},setPrivacyPolicyUrl(s){ee.privacyPolicyUrl=s},setCustomWallets(s){ee.customWallets=s},setIsSiweEnabled(s){ee.isSiweEnabled=s},setIsUniversalProvider(s){ee.isUniversalProvider=s},setSdkVersion(s){ee.sdkVersion=s},setMetadata(s){ee.metadata=s},setDisableAppend(s){ee.disableAppend=s},setEIP6963Enabled(s){ee.enableEIP6963=s},setDebug(s){ee.debug=s},setEnableWalletConnect(s){ee.enableWalletConnect=s},setEnableWalletGuide(s){ee.enableWalletGuide=s},setEnableAuthLogger(s){ee.enableAuthLogger=s},setEnableWallets(s){ee.enableWallets=s},setHasMultipleAddresses(s){ee.hasMultipleAddresses=s},setSIWX(s){ee.siwx=s},setConnectMethodsOrder(s){ee.features={...ee.features,connectMethodsOrder:s}},setWalletFeaturesOrder(s){ee.features={...ee.features,walletFeaturesOrder:s}},setSocialsOrder(s){ee.features={...ee.features,socials:s}},setCollapseWallets(s){ee.features={...ee.features,collapseWallets:s}},setEnableEmbedded(s){ee.enableEmbedded=s},setAllowUnsupportedChain(s){ee.allowUnsupportedChain=s},setManualWCControl(s){ee.manualWCControl=s},setEnableNetworkSwitch(s){ee.enableNetworkSwitch=s},setDefaultAccountTypes(s={}){Object.entries(s).forEach(([e,t])=>{t&&(ee.defaultAccountTypes[e]=t)})},setUniversalProviderConfigOverride(s){ee.universalProviderConfigOverride=s},getUniversalProviderConfigOverride(){return ee.universalProviderConfigOverride},getSnapshot(){return cn(ee)}},Ws=je({message:"",variant:"info",open:!1}),$s={state:Ws,subscribeKey(s,e){return Rt(Ws,s,e)},open(s,e){const{debug:t}=x.state,{shortMessage:r,longMessage:i}=s;t&&(Ws.message=r,Ws.variant=e,Ws.open=!0),i&&console.error(typeof i=="function"?i():i)},close(){Ws.open=!1,Ws.message="",Ws.variant="info"}},Gp=ie.getAnalyticsUrl(),Yp=new jo({baseUrl:Gp,clientId:null}),Zp=["MODAL_CREATED"],Ns=je({timestamp:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"}}),Le={state:Ns,subscribe(s){return Et(Ns,()=>s(Ns))},getSdkProperties(){const{projectId:s,sdkType:e,sdkVersion:t}=x.state;return{projectId:s,st:e,sv:t||"html-wagmi-4.2.2"}},async _sendAnalyticsEvent(s){try{const e=Y.state.address;if(Zp.includes(s.data.event)||typeof window>"u")return;await Yp.post({path:"/e",params:Le.getSdkProperties(),body:{eventId:ie.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:s.timestamp,props:{...s.data,address:e}}}),Ns.reportedErrors.FORBIDDEN=!1}catch(e){e instanceof Error&&e.cause instanceof Response&&e.cause.status===G.HTTP_STATUS_CODES.FORBIDDEN&&!Ns.reportedErrors.FORBIDDEN&&($s.open({shortMessage:"Invalid App Configuration",longMessage:`Origin ${Ki()?window.origin:"uknown"} not found on Allowlist - update configuration on cloud.reown.com`},"error"),Ns.reportedErrors.FORBIDDEN=!0)}},sendEvent(s){var e;Ns.timestamp=Date.now(),Ns.data=s,(e=x.state.features)!=null&&e.analytics&&Le._sendAnalyticsEvent(Ns)}},Jp=["1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79","fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa","a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393"],Xp=ie.getApiUrl(),xt=new jo({baseUrl:Xp,clientId:null}),Qp=40,Yc=4,ef=20,le=je({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],filteredWallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1}),te={state:le,subscribeKey(s,e){return Rt(le,s,e)},_getSdkProperties(){const{projectId:s,sdkType:e,sdkVersion:t}=x.state;return{projectId:s,st:e||"appkit",sv:t||"html-wagmi-4.2.2"}},_filterOutExtensions(s){return x.state.isUniversalProvider?s.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):s},async _fetchWalletImage(s){const e=`${xt.baseUrl}/getWalletImage/${s}`,t=await xt.getBlob({path:e,params:te._getSdkProperties()});ss.setWalletImage(s,URL.createObjectURL(t))},async _fetchNetworkImage(s){const e=`${xt.baseUrl}/public/getAssetImage/${s}`,t=await xt.getBlob({path:e,params:te._getSdkProperties()});ss.setNetworkImage(s,URL.createObjectURL(t))},async _fetchConnectorImage(s){const e=`${xt.baseUrl}/public/getAssetImage/${s}`,t=await xt.getBlob({path:e,params:te._getSdkProperties()});ss.setConnectorImage(s,URL.createObjectURL(t))},async _fetchCurrencyImage(s){const e=`${xt.baseUrl}/public/getCurrencyImage/${s}`,t=await xt.getBlob({path:e,params:te._getSdkProperties()});ss.setCurrencyImage(s,URL.createObjectURL(t))},async _fetchTokenImage(s){const e=`${xt.baseUrl}/public/getTokenImage/${s}`,t=await xt.getBlob({path:e,params:te._getSdkProperties()});ss.setTokenImage(s,URL.createObjectURL(t))},async fetchAllowedOrigins(){try{const{allowedOrigins:s}=await xt.get({path:"/projects/v1/origins",params:te._getSdkProperties()});return s}catch{return[]}},async fetchNetworkImages(){const s=y.getAllRequestedCaipNetworks(),e=s==null?void 0:s.map(({assets:t})=>t==null?void 0:t.imageId).filter(Boolean).filter(t=>!gu.getNetworkImageById(t));e&&await Promise.allSettled(e.map(t=>te._fetchNetworkImage(t)))},async fetchConnectorImages(){const{connectors:s}=ne.state,e=s.map(({imageId:t})=>t).filter(Boolean);await Promise.allSettled(e.map(t=>te._fetchConnectorImage(t)))},async fetchCurrencyImages(s=[]){await Promise.allSettled(s.map(e=>te._fetchCurrencyImage(e)))},async fetchTokenImages(s=[]){await Promise.allSettled(s.map(e=>te._fetchTokenImage(e)))},async fetchWallets(s){var r,i;const e=s.exclude??[];return te._getSdkProperties().sv.startsWith("html-core-")&&e.push(...Jp),await xt.get({path:"/getWallets",params:{...te._getSdkProperties(),...s,page:String(s.page),entries:String(s.entries),include:(r=s.include)==null?void 0:r.join(","),exclude:(i=s.exclude)==null?void 0:i.join(",")}})},async fetchFeaturedWallets(){const{featuredWalletIds:s}=x.state;if(s!=null&&s.length){const e={...te._getSdkProperties(),page:1,entries:(s==null?void 0:s.length)??Yc,include:s},{data:t}=await te.fetchWallets(e);t.sort((i,n)=>s.indexOf(i.id)-s.indexOf(n.id));const r=t.map(i=>i.image_id).filter(Boolean);await Promise.allSettled(r.map(i=>te._fetchWalletImage(i))),le.featured=t,le.allFeatured=t}},async fetchRecommendedWallets(){try{le.isFetchingRecommendedWallets=!0;const{includeWalletIds:s,excludeWalletIds:e,featuredWalletIds:t}=x.state,r=[...e??[],...t??[]].filter(Boolean),i=y.getRequestedCaipNetworkIds().join(","),n={page:1,entries:Yc,include:s,exclude:r,chains:i},{data:o,count:a}=await te.fetchWallets(n),c=K.getRecentWallets(),l=o.map(u=>u.image_id).filter(Boolean),d=c.map(u=>u.image_id).filter(Boolean);await Promise.allSettled([...l,...d].map(u=>te._fetchWalletImage(u))),le.recommended=o,le.allRecommended=o,le.count=a??0}catch{}finally{le.isFetchingRecommendedWallets=!1}},async fetchWalletsByPage({page:s}){const{includeWalletIds:e,excludeWalletIds:t,featuredWalletIds:r}=x.state,i=y.getRequestedCaipNetworkIds().join(","),n=[...le.recommended.map(({id:d})=>d),...t??[],...r??[]].filter(Boolean),o={page:s,entries:Qp,include:e,exclude:n,chains:i},{data:a,count:c}=await te.fetchWallets(o),l=a.slice(0,ef).map(d=>d.image_id).filter(Boolean);await Promise.allSettled(l.map(d=>te._fetchWalletImage(d))),le.wallets=ie.uniqueBy([...le.wallets,...te._filterOutExtensions(a)],"id"),le.count=c>le.count?c:le.count,le.page=s},async initializeExcludedWallets({ids:s}){const e=y.getRequestedCaipNetworkIds().join(","),t={page:1,entries:s.length,include:s,chains:e},{data:r}=await te.fetchWallets(t);r&&r.forEach(i=>{le.excludedWallets.push({rdns:i.rdns,name:i.name})})},async searchWallet({search:s,badge:e}){const{includeWalletIds:t,excludeWalletIds:r}=x.state,i=y.getRequestedCaipNetworkIds().join(",");le.search=[];const n={page:1,entries:100,search:s==null?void 0:s.trim(),badge_type:e,include:t,exclude:r,chains:i},{data:o}=await te.fetchWallets(n);Le.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e??"",search:s??""}});const a=o.map(c=>c.image_id).filter(Boolean);await Promise.allSettled([...a.map(c=>te._fetchWalletImage(c)),ie.wait(300)]),le.search=te._filterOutExtensions(o)},initPromise(s,e){const t=le.promises[s];return t||(le.promises[s]=e())},prefetch({fetchConnectorImages:s=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:t=!0,fetchNetworkImages:r=!0}={}){const i=[s&&te.initPromise("connectorImages",te.fetchConnectorImages),e&&te.initPromise("featuredWallets",te.fetchFeaturedWallets),t&&te.initPromise("recommendedWallets",te.fetchRecommendedWallets),r&&te.initPromise("networkImages",te.fetchNetworkImages)].filter(Boolean);return Promise.allSettled(i)},prefetchAnalyticsConfig(){var s;(s=x.state.features)!=null&&s.analytics&&te.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:s}=await xt.get({path:"/getAnalyticsConfig",params:te._getSdkProperties()});x.setFeatures({analytics:s})}catch{x.setFeatures({analytics:!1})}},filterByNamespaces(s){if(!(s!=null&&s.length)){le.featured=le.allFeatured,le.recommended=le.allRecommended;return}const e=y.getRequestedCaipNetworkIds().join(",");le.featured=le.allFeatured.filter(t=>{var r;return(r=t.chains)==null?void 0:r.some(i=>e.includes(i))}),le.recommended=le.allRecommended.filter(t=>{var r;return(r=t.chains)==null?void 0:r.some(i=>e.includes(i))}),le.filteredWallets=le.wallets.filter(t=>{var r;return(r=t.chains)==null?void 0:r.some(i=>e.includes(i))})},clearFilterByNamespaces(){le.filteredWallets=[]},setFilterByNamespace(s){if(!s){le.featured=le.allFeatured,le.recommended=le.allRecommended;return}const e=y.getRequestedCaipNetworkIds().join(",");le.featured=le.allFeatured.filter(t=>{var r;return(r=t.chains)==null?void 0:r.some(i=>e.includes(i))}),le.recommended=le.allRecommended.filter(t=>{var r;return(r=t.chains)==null?void 0:r.some(i=>e.includes(i))}),le.filteredWallets=le.wallets.filter(t=>{var r;return(r=t.chains)==null?void 0:r.some(i=>e.includes(i))})}},_e=je({view:"Connect",history:["Connect"],transactionStack:[]}),Ae={state:_e,subscribeKey(s,e){return Rt(_e,s,e)},pushTransactionStack(s){_e.transactionStack.push(s)},popTransactionStack(s){var t,r;const e=_e.transactionStack.pop();if(e)if(s)this.goBack(),(t=e==null?void 0:e.onCancel)==null||t.call(e);else{if(e.goBack)this.goBack();else if(e.replace){const n=_e.history.indexOf("ConnectingSiwe");n>0?this.goBackToIndex(n-1):(Fe.close(!0),_e.history=[])}else e.view&&this.reset(e.view);(r=e==null?void 0:e.onSuccess)==null||r.call(e)}},push(s,e){s!==_e.view&&(_e.view=s,_e.history.push(s),_e.data=e)},reset(s,e){_e.view=s,_e.history=[s],_e.data=e},replace(s,e){_e.history.at(-1)===s||(_e.view=s,_e.history[_e.history.length-1]=s,_e.data=e)},goBack(){var e;const s=!y.state.activeCaipAddress&&this.state.view==="ConnectingFarcaster";if(_e.history.length>1&&!_e.history.includes("UnsupportedChain")){_e.history.pop();const[t]=_e.history.slice(-1);t&&(_e.view=t)}else Fe.close();(e=_e.data)!=null&&e.wallet&&(_e.data.wallet=void 0),setTimeout(()=>{var t,r,i;if(s){Y.setFarcasterUrl(void 0,y.state.activeChain);const n=ne.getAuthConnector();(t=n==null?void 0:n.provider)==null||t.reload();const o=cn(x.state);(i=(r=n==null?void 0:n.provider)==null?void 0:r.syncDappData)==null||i.call(r,{metadata:o.metadata,sdkVersion:o.sdkVersion,projectId:o.projectId,sdkType:o.sdkType})}},100)},goBackToIndex(s){if(_e.history.length>1){_e.history=_e.history.slice(0,s+1);const[e]=_e.history.slice(-1);e&&(_e.view=e)}}},Ts=je({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),ft={state:Ts,subscribe(s){return Et(Ts,()=>s(Ts))},setThemeMode(s){Ts.themeMode=s;try{const e=ne.getAuthConnector();if(e){const t=ft.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:s,themeVariables:t,w3mThemeVariables:Ds(t,s)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(s){Ts.themeVariables={...Ts.themeVariables,...s};try{const e=ne.getAuthConnector();if(e){const t=ft.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:t,w3mThemeVariables:Ds(Ts.themeVariables,Ts.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return cn(Ts)}},mu={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0},me=je({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:{...mu},filterByNamespaceMap:{eip155:!0,solana:!0,polkadot:!0,bip122:!0,cosmos:!0}}),ne={state:me,subscribe(s){return Et(me,()=>{s(me)})},subscribeKey(s,e){return Rt(me,s,e)},initialize(s){s.forEach(e=>{const t=K.getConnectedConnectorId(e);t&&this.setConnectorId(t,e)})},setActiveConnector(s){s&&(me.activeConnector=Ar(s))},setConnectors(s){s.filter(i=>!me.allConnectors.some(n=>n.id===i.id&&this.getConnectorName(n.name)===this.getConnectorName(i.name)&&n.chain===i.chain)).forEach(i=>{i.type!=="MULTI_CHAIN"&&me.allConnectors.push(Ar(i))});const t=this.getEnabledNamespaces(),r=this.getEnabledConnectors(t);me.connectors=this.mergeMultiChainConnectors(r)},filterByNamespaces(s){Object.keys(me.filterByNamespaceMap).forEach(e=>{me.filterByNamespaceMap[e]=!1}),s.forEach(e=>{me.filterByNamespaceMap[e]=!0}),this.updateConnectorsForEnabledNamespaces()},filterByNamespace(s,e){me.filterByNamespaceMap[s]=e,this.updateConnectorsForEnabledNamespaces()},updateConnectorsForEnabledNamespaces(){const s=this.getEnabledNamespaces(),e=this.getEnabledConnectors(s),t=this.areAllNamespacesEnabled();me.connectors=this.mergeMultiChainConnectors(e),t?te.clearFilterByNamespaces():te.filterByNamespaces(s)},getEnabledNamespaces(){return Object.entries(me.filterByNamespaceMap).filter(([s,e])=>e).map(([s])=>s)},getEnabledConnectors(s){return me.allConnectors.filter(e=>s.includes(e.chain))},areAllNamespacesEnabled(){return Object.values(me.filterByNamespaceMap).every(s=>s)},mergeMultiChainConnectors(s){const e=this.generateConnectorMapByName(s),t=[];return e.forEach(r=>{const i=r[0],n=(i==null?void 0:i.id)===G.CONNECTOR_ID.AUTH;r.length>1&&i?t.push({name:i.name,imageUrl:i.imageUrl,imageId:i.imageId,connectors:[...r],type:n?"AUTH":"MULTI_CHAIN",chain:"eip155",id:(i==null?void 0:i.id)||""}):i&&t.push(i)}),t},generateConnectorMapByName(s){const e=new Map;return s.forEach(t=>{const{name:r}=t,i=this.getConnectorName(r);if(!i)return;const n=e.get(i)||[];n.find(a=>a.chain===t.chain)||n.push(t),e.set(i,n)}),e},getConnectorName(s){return s&&({"Trust Wallet":"Trust"}[s]||s)},getUniqueConnectorsByName(s){const e=[];return s.forEach(t=>{e.find(r=>r.chain===t.chain)||e.push(t)}),e},addConnector(s){var e,t,r;if(s.id===G.CONNECTOR_ID.AUTH){const i=s,n=cn(x.state),o=ft.getSnapshot().themeMode,a=ft.getSnapshot().themeVariables;(t=(e=i==null?void 0:i.provider)==null?void 0:e.syncDappData)==null||t.call(e,{metadata:n.metadata,sdkVersion:n.sdkVersion,projectId:n.projectId,sdkType:n.sdkType}),(r=i==null?void 0:i.provider)==null||r.syncTheme({themeMode:o,themeVariables:a,w3mThemeVariables:Ds(a,o)}),this.setConnectors([s])}else this.setConnectors([s])},getAuthConnector(s){var r;const e=s||y.state.activeChain,t=me.connectors.find(i=>i.id===G.CONNECTOR_ID.AUTH);if(t)return(r=t==null?void 0:t.connectors)!=null&&r.length?t.connectors.find(n=>n.chain===e):t},getAnnouncedConnectorRdns(){return me.connectors.filter(s=>s.type==="ANNOUNCED").map(s=>{var e;return(e=s.info)==null?void 0:e.rdns})},getConnectorById(s){return me.allConnectors.find(e=>e.id===s)},getConnector(s,e){return me.allConnectors.filter(r=>r.chain===y.state.activeChain).find(r=>{var i;return r.explorerId===s||((i=r.info)==null?void 0:i.rdns)===e})},syncIfAuthConnector(s){var n,o;if(s.id!=="ID_AUTH")return;const e=s,t=cn(x.state),r=ft.getSnapshot().themeMode,i=ft.getSnapshot().themeVariables;(o=(n=e==null?void 0:e.provider)==null?void 0:n.syncDappData)==null||o.call(n,{metadata:t.metadata,sdkVersion:t.sdkVersion,sdkType:t.sdkType,projectId:t.projectId}),e.provider.syncTheme({themeMode:r,themeVariables:i,w3mThemeVariables:Ds(i,r)})},getConnectorsByNamespace(s){const e=me.allConnectors.filter(t=>t.chain===s);return this.mergeMultiChainConnectors(e)},selectWalletConnector(s){const e=ne.getConnector(s.id,s.rdns);y.state.activeChain===G.CHAIN.SOLANA&&zp.handleSolanaDeeplinkRedirect((e==null?void 0:e.name)||s.name||""),e?Ae.push("ConnectingExternal",{connector:e}):Ae.push("ConnectingWalletConnect",{wallet:s})},getConnectors(s){return s?this.getConnectorsByNamespace(s):this.mergeMultiChainConnectors(me.allConnectors)},setFilterByNamespace(s){me.filterByNamespace=s,me.connectors=this.getConnectors(s),te.setFilterByNamespace(s)},setConnectorId(s,e){s&&(me.activeConnectorIds={...me.activeConnectorIds,[e]:s},K.setConnectedConnectorId(e,s))},removeConnectorId(s){me.activeConnectorIds={...me.activeConnectorIds,[s]:void 0},K.deleteConnectedConnectorId(s)},getConnectorId(s){if(s)return me.activeConnectorIds[s]},isConnected(s){return s?!!me.activeConnectorIds[s]:Object.values(me.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){me.activeConnectorIds={...mu}}};function Kn(s,e){return ne.getConnectorId(s)===e}function tf(s){const e=Array.from(y.state.chains.keys());let t=[];return s?(t.push([s,y.state.chains.get(s)]),Kn(s,G.CONNECTOR_ID.WALLET_CONNECT)?e.forEach(r=>{r!==s&&Kn(r,G.CONNECTOR_ID.WALLET_CONNECT)&&t.push([r,y.state.chains.get(r)])}):Kn(s,G.CONNECTOR_ID.AUTH)&&e.forEach(r=>{r!==s&&Kn(r,G.CONNECTOR_ID.AUTH)&&t.push([r,y.state.chains.get(r)])})):t=Array.from(y.state.chains.entries()),t}function sf(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function Qe(s,...e){try{return sf(s(...e))}catch(t){return Promise.reject(t)}}function rf(s){const e=typeof s;return s===null||e!=="object"&&e!=="function"}function nf(s){const e=Object.getPrototypeOf(s);return!e||e.isPrototypeOf(Object)}function oo(s){if(rf(s))return String(s);if(nf(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return oo(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const La="base64:";function of(s){return typeof s=="string"?s:La+lf(s)}function af(s){return typeof s!="string"||!s.startsWith(La)?s:cf(s.slice(La.length))}function cf(s){return globalThis.Buffer?Buffer.from(s,"base64"):Uint8Array.from(globalThis.atob(s),e=>e.codePointAt(0))}function lf(s){return globalThis.Buffer?Buffer.from(s).toString("base64"):globalThis.btoa(String.fromCodePoint(...s))}function It(s){var e;return s&&((e=s.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function df(...s){return It(s.join(":"))}function Gn(s){return s=It(s),s?s+":":""}function uf(s,e){if(e===void 0)return!0;let t=0,r=s.indexOf(":");for(;r>-1;)t++,r=s.indexOf(":",r+1);return t<=e}function hf(s,e){return e?s.startsWith(e)&&s[s.length-1]!=="$":s[s.length-1]!=="$"}const pf="memory",ff=()=>{const s=new Map;return{name:pf,getInstance:()=>s,hasItem(e){return s.has(e)},getItem(e){return s.get(e)??null},getItemRaw(e){return s.get(e)??null},setItem(e,t){s.set(e,t)},setItemRaw(e,t){s.set(e,t)},removeItem(e){s.delete(e)},getKeys(){return[...s.keys()]},clear(){s.clear()},dispose(){s.clear()}}};function gf(s={}){const e={mounts:{"":s.driver||ff()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=l=>{for(const d of e.mountpoints)if(l.startsWith(d))return{base:d,relativeKey:l.slice(d.length),driver:e.mounts[d]};return{base:"",relativeKey:l,driver:e.mounts[""]}},r=(l,d)=>e.mountpoints.filter(u=>u.startsWith(l)||d&&l.startsWith(u)).map(u=>({relativeBase:l.length>u.length?l.slice(u.length):void 0,mountpoint:u,driver:e.mounts[u]})),i=(l,d)=>{if(e.watching){d=It(d);for(const u of e.watchListeners)u(l,d)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await Zc(e.mounts[l],i,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,d,u)=>{const h=new Map,f=g=>{let m=h.get(g.base);return m||(m={driver:g.driver,base:g.base,items:[]},h.set(g.base,m)),m};for(const g of l){const m=typeof g=="string",w=It(m?g:g.key),v=m?void 0:g.value,E=m||!g.options?d:{...d,...g.options},_=t(w);f(_).items.push({key:w,value:v,relativeKey:_.relativeKey,options:E})}return Promise.all([...h.values()].map(g=>u(g))).then(g=>g.flat())},c={hasItem(l,d={}){l=It(l);const{relativeKey:u,driver:h}=t(l);return Qe(h.hasItem,u,d)},getItem(l,d={}){l=It(l);const{relativeKey:u,driver:h}=t(l);return Qe(h.getItem,u,d).then(f=>zn(f))},getItems(l,d={}){return a(l,d,u=>u.driver.getItems?Qe(u.driver.getItems,u.items.map(h=>({key:h.relativeKey,options:h.options})),d).then(h=>h.map(f=>({key:df(u.base,f.key),value:zn(f.value)}))):Promise.all(u.items.map(h=>Qe(u.driver.getItem,h.relativeKey,h.options).then(f=>({key:h.key,value:zn(f)})))))},getItemRaw(l,d={}){l=It(l);const{relativeKey:u,driver:h}=t(l);return h.getItemRaw?Qe(h.getItemRaw,u,d):Qe(h.getItem,u,d).then(f=>af(f))},async setItem(l,d,u={}){if(d===void 0)return c.removeItem(l);l=It(l);const{relativeKey:h,driver:f}=t(l);f.setItem&&(await Qe(f.setItem,h,oo(d),u),f.watch||i("update",l))},async setItems(l,d){await a(l,d,async u=>{if(u.driver.setItems)return Qe(u.driver.setItems,u.items.map(h=>({key:h.relativeKey,value:oo(h.value),options:h.options})),d);u.driver.setItem&&await Promise.all(u.items.map(h=>Qe(u.driver.setItem,h.relativeKey,oo(h.value),h.options)))})},async setItemRaw(l,d,u={}){if(d===void 0)return c.removeItem(l,u);l=It(l);const{relativeKey:h,driver:f}=t(l);if(f.setItemRaw)await Qe(f.setItemRaw,h,d,u);else if(f.setItem)await Qe(f.setItem,h,of(d),u);else return;f.watch||i("update",l)},async removeItem(l,d={}){typeof d=="boolean"&&(d={removeMeta:d}),l=It(l);const{relativeKey:u,driver:h}=t(l);h.removeItem&&(await Qe(h.removeItem,u,d),(d.removeMeta||d.removeMata)&&await Qe(h.removeItem,u+"$",d),h.watch||i("remove",l))},async getMeta(l,d={}){typeof d=="boolean"&&(d={nativeOnly:d}),l=It(l);const{relativeKey:u,driver:h}=t(l),f=Object.create(null);if(h.getMeta&&Object.assign(f,await Qe(h.getMeta,u,d)),!d.nativeOnly){const g=await Qe(h.getItem,u+"$",d).then(m=>zn(m));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(f,g))}return f},setMeta(l,d,u={}){return this.setItem(l+"$",d,u)},removeMeta(l,d={}){return this.removeItem(l+"$",d)},async getKeys(l,d={}){var w;l=Gn(l);const u=r(l,!0);let h=[];const f=[];let g=!0;for(const v of u){(w=v.driver.flags)!=null&&w.maxDepth||(g=!1);const E=await Qe(v.driver.getKeys,v.relativeBase,d);for(const _ of E){const C=v.mountpoint+It(_);h.some(k=>C.startsWith(k))||f.push(C)}h=[v.mountpoint,...h.filter(_=>!_.startsWith(v.mountpoint))]}const m=d.maxDepth!==void 0&&!g;return f.filter(v=>(!m||uf(v,d.maxDepth))&&hf(v,l))},async clear(l,d={}){l=Gn(l),await Promise.all(r(l,!1).map(async u=>{if(u.driver.clear)return Qe(u.driver.clear,u.relativeBase,d);if(u.driver.removeItem){const h=await u.driver.getKeys(u.relativeBase||"",d);return Promise.all(h.map(f=>u.driver.removeItem(f,d)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Jc(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(d=>d!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,d){if(l=Gn(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((u,h)=>h.length-u.length)),e.mounts[l]=d,e.watching&&Promise.resolve(Zc(d,i,l)).then(u=>{e.unwatch[l]=u}).catch(console.error),c},async unmount(l,d=!0){var u,h;l=Gn(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((h=(u=e.unwatch)[l])==null||h.call(u),delete e.unwatch[l]),d&&await Jc(e.mounts[l]),e.mountpoints=e.mountpoints.filter(f=>f!==l),delete e.mounts[l])},getMount(l=""){l=It(l)+":";const d=t(l);return{driver:d.driver,base:d.base}},getMounts(l="",d={}){return l=It(l),r(l,d.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(l,d={})=>c.getKeys(l,d),get:(l,d={})=>c.getItem(l,d),set:(l,d,u={})=>c.setItem(l,d,u),has:(l,d={})=>c.hasItem(l,d),del:(l,d={})=>c.removeItem(l,d),remove:(l,d={})=>c.removeItem(l,d)};return c}function Zc(s,e,t){return s.watch?s.watch((r,i)=>e(r,t+i)):()=>{}}async function Jc(s){typeof s.dispose=="function"&&await Qe(s.dispose)}const mf="idb-keyval";var wf=(s={})=>{const e=s.base&&s.base.length>0?`${s.base}:`:"",t=i=>e+i;let r;return s.dbName&&s.storeName&&(r=hp(s.dbName,s.storeName)),{name:mf,options:s,async hasItem(i){return!(typeof await qc(t(i),r)>"u")},async getItem(i){return await qc(t(i),r)??null},setItem(i,n){return mp(t(i),n,r)},removeItem(i){return gp(t(i),r)},getKeys(){return fp(r)},clear(){return pp(r)}}};const yf="WALLET_CONNECT_V2_INDEXED_DB",vf="keyvaluestorage";let Ef=class{constructor(){this.indexedDb=gf({driver:wf({dbName:yf,storeName:vf})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,vc(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var ta=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},ao={exports:{}};(function(){let s;function e(){}s=e,s.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},s.prototype.setItem=function(t,r){this[t]=String(r)},s.prototype.removeItem=function(t){delete this[t]},s.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(r){t[r]=void 0,delete t[r]})},s.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ta<"u"&&ta.localStorage?ao.exports=ta.localStorage:typeof window<"u"&&window.localStorage?ao.exports=window.localStorage:ao.exports=new e})();function bf(s){var e;return[s[0],yo((e=s[1])!=null?e:"")]}let _f=class{constructor(){this.localStorage=ao.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(bf)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return yo(t)}async setItem(e,t){this.localStorage.setItem(e,vc(t))}async removeItem(e){this.localStorage.removeItem(e)}};const Cf="wc_storage_version",Xc=1,Af=async(s,e,t)=>{const r=Cf,i=await e.getItem(r);if(i&&i>=Xc){t(e);return}const n=await s.getKeys();if(!n.length){t(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await s.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(r,Xc),t(e),If(s,o)},If=async(s,e)=>{e.length&&e.forEach(async t=>{await s.removeItem(t)})};let Sf=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new _f;this.storage=e;try{const t=new Ef;Af(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var Nf=Object.defineProperty,Tf=(s,e,t)=>e in s?Nf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Qc=(s,e,t)=>Tf(s,typeof e!="symbol"?e+"":e,t);let Pf=class extends Si{constructor(e){super(),this.opts=e,Qc(this,"protocol","wc"),Qc(this,"version",2)}};var Rf=Object.defineProperty,Of=(s,e,t)=>e in s?Rf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,xf=(s,e,t)=>Of(s,e+"",t);let kf=class extends Si{constructor(e,t){super(),this.core=e,this.logger=t,xf(this,"records",new Map)}},$f=class{constructor(e,t){this.logger=e,this.core=t}},Uf=class extends Si{constructor(e,t){super(),this.relayer=e,this.logger=t}},Df=class extends Si{constructor(e){super()}},Lf=class{constructor(e,t,r,i){this.core=e,this.logger=t,this.name=r}},Mf=class extends Si{constructor(e,t){super(),this.relayer=e,this.logger=t}},jf=class extends Si{constructor(e,t){super(),this.core=e,this.logger=t}},Bf=class{constructor(e,t,r){this.core=e,this.logger=t,this.store=r}},qf=class{constructor(e,t){this.projectId=e,this.logger=t}},Ff=class{constructor(e,t,r){this.core=e,this.logger=t,this.telemetryEnabled=r}};var Wf=Object.defineProperty,Hf=(s,e,t)=>e in s?Wf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,el=(s,e,t)=>Hf(s,typeof e!="symbol"?e+"":e,t);let zf=class{constructor(e){this.opts=e,el(this,"protocol","wc"),el(this,"version",2)}},Vf=class{constructor(e){this.client=e}};function ln(s,{strict:e=!0}={}){return!s||typeof s!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(s):s.startsWith("0x")}function tl(s){return ln(s,{strict:!1})?Math.ceil((s.length-2)/2):s.length}const wu="2.23.2";let Di={getDocsUrl:({docsBaseUrl:s,docsPath:e="",docsSlug:t})=>e?`${s??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${wu}`};class Ir extends Error{constructor(e,t={}){var a;const r=(()=>{var c;return t.cause instanceof Ir?t.cause.details:(c=t.cause)!=null&&c.message?t.cause.message:t.details})(),i=t.cause instanceof Ir&&t.cause.docsPath||t.docsPath,n=(a=Di.getDocsUrl)==null?void 0:a.call(Di,{...t,docsPath:i}),o=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...r?[`Details: ${r}`]:[],...Di.version?[`Version: ${Di.version}`]:[]].join(`
`);super(o,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=i,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=wu}walk(e){return yu(this,e)}}function yu(s,e){return e!=null&&e(s)?s:s&&typeof s=="object"&&"cause"in s&&s.cause!==void 0?yu(s.cause,e):e?null:s}class vu extends Ir{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function Pi(s,{dir:e,size:t=32}={}){return typeof s=="string"?Kf(s,{dir:e,size:t}):Gf(s,{dir:e,size:t})}function Kf(s,{dir:e,size:t=32}={}){if(t===null)return s;const r=s.replace("0x","");if(r.length>t*2)throw new vu({size:Math.ceil(r.length/2),targetSize:t,type:"hex"});return`0x${r[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function Gf(s,{dir:e,size:t=32}={}){if(t===null)return s;if(s.length>t)throw new vu({size:s.length,targetSize:t,type:"bytes"});const r=new Uint8Array(t);for(let i=0;i<t;i++){const n=e==="right";r[n?i:t-i-1]=s[n?i:s.length-i-1]}return r}class Yf extends Ir{constructor({max:e,min:t,signed:r,size:i,value:n}){super(`Number "${n}" is not in safe ${i?`${i*8}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class Zf extends Ir{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Ri(s,{size:e}){if(tl(s)>e)throw new Zf({givenSize:tl(s),maxSize:e})}function Ma(s,e={}){const{signed:t}=e;e.size&&Ri(s,{size:e.size});const r=BigInt(s);if(!t)return r;const i=(s.length-2)/2,n=(1n<<BigInt(i)*8n-1n)-1n;return r<=n?r:r-BigInt(`0x${"f".padStart(i*2,"f")}`)-1n}function Jf(s,e={}){return Number(Ma(s,e))}const Xf=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function ja(s,e={}){return typeof s=="number"||typeof s=="bigint"?bu(s,e):typeof s=="string"?tg(s,e):typeof s=="boolean"?Qf(s,e):Eu(s,e)}function Qf(s,e={}){const t=`0x${Number(s)}`;return typeof e.size=="number"?(Ri(t,{size:e.size}),Pi(t,{size:e.size})):t}function Eu(s,e={}){let t="";for(let i=0;i<s.length;i++)t+=Xf[s[i]];const r=`0x${t}`;return typeof e.size=="number"?(Ri(r,{size:e.size}),Pi(r,{dir:"right",size:e.size})):r}function bu(s,e={}){const{signed:t,size:r}=e,i=BigInt(s);let n;r?t?n=(1n<<BigInt(r)*8n-1n)-1n:n=2n**(BigInt(r)*8n)-1n:typeof s=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&t?-n-1n:0;if(n&&i>n||i<o){const c=typeof s=="bigint"?"n":"";throw new Yf({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:t,size:r,value:`${s}${c}`})}const a=`0x${(t&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?Pi(a,{size:r}):a}const eg=new TextEncoder;function tg(s,e={}){const t=eg.encode(s);return Eu(t,e)}const sg=new TextEncoder;function rg(s,e={}){return typeof s=="number"||typeof s=="bigint"?ng(s,e):typeof s=="boolean"?ig(s,e):ln(s)?_u(s,e):Cu(s,e)}function ig(s,e={}){const t=new Uint8Array(1);return t[0]=Number(s),typeof e.size=="number"?(Ri(t,{size:e.size}),Pi(t,{size:e.size})):t}const Ps={zero:48,nine:57,A:65,F:70,a:97,f:102};function sl(s){if(s>=Ps.zero&&s<=Ps.nine)return s-Ps.zero;if(s>=Ps.A&&s<=Ps.F)return s-(Ps.A-10);if(s>=Ps.a&&s<=Ps.f)return s-(Ps.a-10)}function _u(s,e={}){let t=s;e.size&&(Ri(t,{size:e.size}),t=Pi(t,{dir:"right",size:e.size}));let r=t.slice(2);r.length%2&&(r=`0${r}`);const i=r.length/2,n=new Uint8Array(i);for(let o=0,a=0;o<i;o++){const c=sl(r.charCodeAt(a++)),l=sl(r.charCodeAt(a++));if(c===void 0||l===void 0)throw new Ir(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);n[o]=c*16+l}return n}function ng(s,e){const t=bu(s,e);return _u(t)}function Cu(s,e={}){const t=sg.encode(s);return typeof e.size=="number"?(Ri(t,{size:e.size}),Pi(t,{dir:"right",size:e.size})):t}function Eo(s){if(!Number.isSafeInteger(s)||s<0)throw new Error("positive integer expected, got "+s)}function og(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Bo(s,...e){if(!og(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function wN(s){if(typeof s!="function"||typeof s.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Eo(s.outputLen),Eo(s.blockLen)}function rl(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function ag(s,e){Bo(s);const t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Yn=BigInt(2**32-1),il=BigInt(32);function cg(s,e=!1){return e?{h:Number(s&Yn),l:Number(s>>il&Yn)}:{h:Number(s>>il&Yn)|0,l:Number(s&Yn)|0}}function lg(s,e=!1){let t=new Uint32Array(s.length),r=new Uint32Array(s.length);for(let i=0;i<s.length;i++){const{h:n,l:o}=cg(s[i],e);[t[i],r[i]]=[n,o]}return[t,r]}const dg=(s,e,t)=>s<<t|e>>>32-t,ug=(s,e,t)=>e<<t|s>>>32-t,hg=(s,e,t)=>e<<t-32|s>>>64-t,pg=(s,e,t)=>s<<t-32|e>>>64-t,jr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function fg(s){return new Uint32Array(s.buffer,s.byteOffset,Math.floor(s.byteLength/4))}function yN(s){return new DataView(s.buffer,s.byteOffset,s.byteLength)}function vN(s,e){return s<<32-e|s>>>e}const nl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function gg(s){return s<<24&4278190080|s<<8&16711680|s>>>8&65280|s>>>24&255}function ol(s){for(let e=0;e<s.length;e++)s[e]=gg(s[e])}function mg(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function Au(s){return typeof s=="string"&&(s=mg(s)),Bo(s),s}function EN(...s){let e=0;for(let r=0;r<s.length;r++){const i=s[r];Bo(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<s.length;r++){const n=s[r];t.set(n,i),i+=n.length}return t}class wg{clone(){return this._cloneInto()}}function yg(s){const e=r=>s().update(Au(r)).digest(),t=s();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>s(),e}function bN(s=32){if(jr&&typeof jr.getRandomValues=="function")return jr.getRandomValues(new Uint8Array(s));if(jr&&typeof jr.randomBytes=="function")return jr.randomBytes(s);throw new Error("crypto.getRandomValues must be defined")}const Iu=[],Su=[],Nu=[],vg=BigInt(0),Li=BigInt(1),Eg=BigInt(2),bg=BigInt(7),_g=BigInt(256),Cg=BigInt(113);for(let s=0,e=Li,t=1,r=0;s<24;s++){[t,r]=[r,(2*t+3*r)%5],Iu.push(2*(5*r+t)),Su.push((s+1)*(s+2)/2%64);let i=vg;for(let n=0;n<7;n++)e=(e<<Li^(e>>bg)*Cg)%_g,e&Eg&&(i^=Li<<(Li<<BigInt(n))-Li);Nu.push(i)}const[Ag,Ig]=lg(Nu,!0),al=(s,e,t)=>t>32?hg(s,e,t):dg(s,e,t),cl=(s,e,t)=>t>32?pg(s,e,t):ug(s,e,t);function Sg(s,e=24){const t=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)t[o]=s[o]^s[o+10]^s[o+20]^s[o+30]^s[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],d=t[c+1],u=al(l,d,1)^t[a],h=cl(l,d,1)^t[a+1];for(let f=0;f<50;f+=10)s[o+f]^=u,s[o+f+1]^=h}let i=s[2],n=s[3];for(let o=0;o<24;o++){const a=Su[o],c=al(i,n,a),l=cl(i,n,a),d=Iu[o];i=s[d],n=s[d+1],s[d]=c,s[d+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=s[o+a];for(let a=0;a<10;a++)s[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}s[0]^=Ag[r],s[1]^=Ig[r]}t.fill(0)}class Ic extends wg{constructor(e,t,r,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Eo(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=fg(this.state)}keccak(){nl||ol(this.state32),Sg(this.state32,this.rounds),nl||ol(this.state32),this.posOut=0,this.pos=0}update(e){rl(this);const{blockLen:t,state:r}=this;e=Au(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(t-this.pos,i-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(t&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){rl(this,!1),Bo(e),this.finish();const t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Eo(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ag(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new Ic(t,r,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Ng=(s,e,t)=>yg(()=>new Ic(e,s,t)),Tg=Ng(1,136,256/8);function Tu(s,e){const t=e||"hex",r=Tg(ln(s,{strict:!1})?rg(s):s);return t==="bytes"?r:ja(r)}class Pg extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const sa=new Pg(8192);function Rg(s,e){if(sa.has(`${s}.${e}`))return sa.get(`${s}.${e}`);const t=s.substring(2).toLowerCase(),r=Tu(Cu(t),"bytes"),i=t.split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&i[o]&&(i[o]=i[o].toUpperCase()),(r[o>>1]&15)>=8&&i[o+1]&&(i[o+1]=i[o+1].toUpperCase());const n=`0x${i.join("")}`;return sa.set(`${s}.${e}`,n),n}function Og(s){const e=Tu(`0x${s.substring(4)}`).substring(26);return Rg(`0x${e}`)}async function xg({hash:s,signature:e}){const t=ln(s)?s:ja(s),{secp256k1:r}=await Vt(async()=>{const{secp256k1:o}=await import("./secp256k1-BdBRfmNu.js");return{secp256k1:o}},__vite__mapDeps([0,1,2]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:d,v:u,yParity:h}=e,f=Number(h??u),g=ll(f);return new r.Signature(Ma(l),Ma(d)).addRecoveryBit(g)}const o=ln(e)?e:ja(e),a=Jf(`0x${o.slice(130)}`),c=ll(a);return r.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function ll(s){if(s===0||s===1)return s;if(s===27)return 0;if(s===28)return 1;throw new Error("Invalid yParityOrV value")}async function kg({hash:s,signature:e}){return Og(await xg({hash:s,signature:e}))}var $g={};const Ug=":";function di(s){const[e,t]=s.split(Ug);return{namespace:e,reference:t}}function Pu(s,e){return s.includes(":")?[s]:e.chains||[]}var Dg=Object.defineProperty,Lg=Object.defineProperties,Mg=Object.getOwnPropertyDescriptors,dl=Object.getOwnPropertySymbols,jg=Object.prototype.hasOwnProperty,Bg=Object.prototype.propertyIsEnumerable,ul=(s,e,t)=>e in s?Dg(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,hl=(s,e)=>{for(var t in e||(e={}))jg.call(e,t)&&ul(s,t,e[t]);if(dl)for(var t of dl(e))Bg.call(e,t)&&ul(s,t,e[t]);return s},qg=(s,e)=>Lg(s,Mg(e));const Fg="ReactNative",jt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Wg="js";function bo(){return typeof os<"u"&&typeof os.versions<"u"&&typeof os.versions.node<"u"}function or(){return!Cr.getDocument()&&!!Cr.getNavigator()&&navigator.product===Fg}function Hg(){return or()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="android"}function zg(){return or()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="ios"}function kn(){return!bo()&&!!Cr.getNavigator()&&!!Cr.getDocument()}function $n(){return or()?jt.reactNative:bo()?jt.node:kn()?jt.browser:jt.unknown}function pl(){var s;try{return or()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Application)<"u"?(s=globalThis.Application)==null?void 0:s.applicationId:void 0}catch{return}}function Vg(s,e){const t=new URLSearchParams(s);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const i=e[r];i!==void 0&&t.set(r,i)}return t.toString()}function Kg(s){var e,t;const r=Ru();try{return s!=null&&s.url&&r.url&&s.url!==r.url&&(console.warn(`The configured WalletConnect 'metadata.url':${s.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),s.url=r.url),(e=s==null?void 0:s.icons)!=null&&e.length&&s.icons.length>0&&(s.icons=s.icons.filter(i=>i!=="")),qg(hl(hl({},r),s),{url:(s==null?void 0:s.url)||r.url,name:(s==null?void 0:s.name)||r.name,description:(s==null?void 0:s.description)||r.description,icons:(t=s==null?void 0:s.icons)!=null&&t.length&&s.icons.length>0?s.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),s||r}}function Ru(){return wp.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Gg(){if($n()===jt.reactNative&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"){const{OS:t,Version:r}=globalThis.Platform;return[t,r].join("-")}const s=vp();if(s===null)return"unknown";const e=s.os?s.os.replace(" ","").toLowerCase():"unknown";return s.type==="browser"?[e,s.name,s.version].join("-"):[e,s.version].join("-")}function Yg(){var s;const e=$n();return e===jt.browser?[e,((s=Cr.getLocation())==null?void 0:s.host)||"unknown"].join(":"):e}function Ou(s,e,t){const r=Gg(),i=Yg();return[[s,e].join("-"),[Wg,t].join("-"),r,i].join("/")}function Zg({protocol:s,version:e,relayUrl:t,sdkVersion:r,auth:i,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=t.split("?"),d=Ou(s,e,r),u={auth:i,ua:d,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},h=Vg(l[1]||"",u);return l[0]+"?"+h}function yr(s,e){return s.filter(t=>e.includes(t)).length===s.length}function Ba(s){return Object.fromEntries(s.entries())}function qa(s){return new Map(Object.entries(s))}function hr(s=L.FIVE_MINUTES,e){const t=L.toMiliseconds(s||L.FIVE_MINUTES);let r,i,n,o;return{resolve:a=>{n&&r&&(clearTimeout(n),r(a),o=Promise.resolve(a))},reject:a=>{n&&i&&(clearTimeout(n),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},t),r=a,i=c})}}function Js(s,e,t){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(new Error(t)),e);try{const o=await s;r(o)}catch(o){i(o)}clearTimeout(n)})}function xu(s,e){if(typeof e=="string"&&e.startsWith(`${s}:`))return e;if(s.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(s.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${s}`)}function Jg(s){return xu("topic",s)}function Xg(s){return xu("id",s)}function ku(s){const[e,t]=s.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")r.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return r}function Ye(s,e){return L.fromMiliseconds(Date.now()+L.toMiliseconds(s))}function Ks(s){return Date.now()>=L.toMiliseconds(s)}function Ce(s,e){return`${s}${e?`:${e}`:""}`}function co(s=[],e=[]){return[...new Set([...s,...e])]}async function Qg({id:s,topic:e,wcDeepLink:t}){var r;try{if(!t)return;const i=typeof t=="string"?JSON.parse(t):t,n=i==null?void 0:i.href;if(typeof n!="string")return;const o=em(n,s,e),a=$n();if(a===jt.browser){if(!((r=Cr.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}tm(o)}else a===jt.reactNative&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"&&await globalThis.Linking.openURL(o)}catch(i){console.error(i)}}function em(s,e,t){const r=`requestId=${e}&sessionTopic=${t}`;s.endsWith("/")&&(s=s.slice(0,-1));let i=`${s}`;if(s.startsWith("https://t.me")){const n=s.includes("?")?"&startapp=":"?startapp=";i=`${i}${n}${nm(r,!0)}`}else i=`${i}/wc?${r}`;return i}function tm(s){let e="_self";im()?e="_top":(rm()||s.startsWith("https://")||s.startsWith("http://"))&&(e="_blank"),window.open(s,e,"noreferrer noopener")}async function sm(s,e){let t="";try{if(kn()&&(t=localStorage.getItem(e),t))return t;t=await s.getItem(e)}catch(r){console.error(r)}return t}function fl(s,e){if(!s.includes(e))return null;const t=s.split(/([&,?,=])/),r=t.indexOf(e);return t[r+2]}function gl(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})}function Sc(){return typeof os<"u"&&$g.IS_VITEST==="true"}function rm(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function im(){try{return window.self!==window.top}catch{return!1}}function nm(s,e=!1){const t=gt.Buffer.from(s).toString("base64");return e?t.replace(/[=]/g,""):t}function $u(s){return gt.Buffer.from(s,"base64").toString("utf-8")}function om(s){return new Promise(e=>setTimeout(e,s))}function dn(s){if(!Number.isSafeInteger(s)||s<0)throw new Error("positive integer expected, got "+s)}function am(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Un(s,...e){if(!am(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function Nc(s){if(typeof s!="function"||typeof s.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");dn(s.outputLen),dn(s.blockLen)}function fi(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function Uu(s,e){Un(s);const t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Zn=BigInt(2**32-1),ml=BigInt(32);function cm(s,e=!1){return e?{h:Number(s&Zn),l:Number(s>>ml&Zn)}:{h:Number(s>>ml&Zn)|0,l:Number(s&Zn)|0}}function lm(s,e=!1){let t=new Uint32Array(s.length),r=new Uint32Array(s.length);for(let i=0;i<s.length;i++){const{h:n,l:o}=cm(s[i],e);[t[i],r[i]]=[n,o]}return[t,r]}const dm=(s,e,t)=>s<<t|e>>>32-t,um=(s,e,t)=>e<<t|s>>>32-t,hm=(s,e,t)=>e<<t-32|s>>>64-t,pm=(s,e,t)=>s<<t-32|e>>>64-t,Br=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function fm(s){return new Uint32Array(s.buffer,s.byteOffset,Math.floor(s.byteLength/4))}function ra(s){return new DataView(s.buffer,s.byteOffset,s.byteLength)}function hs(s,e){return s<<32-e|s>>>e}const wl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function gm(s){return s<<24&4278190080|s<<8&16711680|s>>>8&65280|s>>>24&255}function yl(s){for(let e=0;e<s.length;e++)s[e]=gm(s[e])}function mm(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function gi(s){return typeof s=="string"&&(s=mm(s)),Un(s),s}function wm(...s){let e=0;for(let r=0;r<s.length;r++){const i=s[r];Un(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<s.length;r++){const n=s[r];t.set(n,i),i+=n.length}return t}let Tc=class{clone(){return this._cloneInto()}};function Du(s){const e=r=>s().update(gi(r)).digest(),t=s();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>s(),e}function Oi(s=32){if(Br&&typeof Br.getRandomValues=="function")return Br.getRandomValues(new Uint8Array(s));if(Br&&typeof Br.randomBytes=="function")return Br.randomBytes(s);throw new Error("crypto.getRandomValues must be defined")}const Lu=[],Mu=[],ju=[],ym=BigInt(0),Mi=BigInt(1),vm=BigInt(2),Em=BigInt(7),bm=BigInt(256),_m=BigInt(113);for(let s=0,e=Mi,t=1,r=0;s<24;s++){[t,r]=[r,(2*t+3*r)%5],Lu.push(2*(5*r+t)),Mu.push((s+1)*(s+2)/2%64);let i=ym;for(let n=0;n<7;n++)e=(e<<Mi^(e>>Em)*_m)%bm,e&vm&&(i^=Mi<<(Mi<<BigInt(n))-Mi);ju.push(i)}const[Cm,Am]=lm(ju,!0),vl=(s,e,t)=>t>32?hm(s,e,t):dm(s,e,t),El=(s,e,t)=>t>32?pm(s,e,t):um(s,e,t);function Im(s,e=24){const t=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)t[o]=s[o]^s[o+10]^s[o+20]^s[o+30]^s[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],d=t[c+1],u=vl(l,d,1)^t[a],h=El(l,d,1)^t[a+1];for(let f=0;f<50;f+=10)s[o+f]^=u,s[o+f+1]^=h}let i=s[2],n=s[3];for(let o=0;o<24;o++){const a=Mu[o],c=vl(i,n,a),l=El(i,n,a),d=Lu[o];i=s[d],n=s[d+1],s[d]=c,s[d+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=s[o+a];for(let a=0;a<10;a++)s[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}s[0]^=Cm[r],s[1]^=Am[r]}t.fill(0)}let Sm=class Bu extends Tc{constructor(e,t,r,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,dn(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=fm(this.state)}keccak(){wl||yl(this.state32),Im(this.state32,this.rounds),wl||yl(this.state32),this.posOut=0,this.pos=0}update(e){fi(this);const{blockLen:t,state:r}=this;e=gi(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(t-this.pos,i-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(t&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){fi(this,!1),Un(e),this.finish();const t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return dn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Uu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new Bu(t,r,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Nm=(s,e,t)=>Du(()=>new Sm(e,s,t)),Tm=Nm(1,136,256/8),Pm="https://rpc.walletconnect.org/v1";function qu(s){const e=`Ethereum Signed Message:
${s.length}`,t=new TextEncoder().encode(e+s);return"0x"+gt.Buffer.from(Tm(t)).toString("hex")}async function Rm(s,e,t,r,i,n){switch(t.t){case"eip191":return await Om(s,e,t.s);case"eip1271":return await xm(s,e,t.s,r,i,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function Om(s,e,t){return(await kg({hash:qu(e),signature:t})).toLowerCase()===s.toLowerCase()}async function xm(s,e,t,r,i,n){const o=di(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l="0000000000000000000000000000000000000000000000000000000000000041",d=t.substring(2),u=qu(e).substring(2),h=a+u+c+l+d,f=await fetch(`${n||Pm}/?chainId=${r}&projectId=${i}`,{method:"POST",body:JSON.stringify({id:km(),jsonrpc:"2.0",method:"eth_call",params:[{to:s,data:h},"latest"]})}),{result:g}=await f.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function km(){return Date.now()+Math.floor(Math.random()*1e3)}function $m(s){const e=atob(s),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const r=t[0];if(r===0)throw new Error("No signatures found");const i=1+r*64;if(t.length<i)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const n=gt.Buffer.from(s,"base64").slice(1,65);return du.encode(n)}var Um=Object.defineProperty,Dm=Object.defineProperties,Lm=Object.getOwnPropertyDescriptors,bl=Object.getOwnPropertySymbols,Mm=Object.prototype.hasOwnProperty,jm=Object.prototype.propertyIsEnumerable,_l=(s,e,t)=>e in s?Um(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Bm=(s,e)=>{for(var t in e||(e={}))Mm.call(e,t)&&_l(s,t,e[t]);if(bl)for(var t of bl(e))jm.call(e,t)&&_l(s,t,e[t]);return s},qm=(s,e)=>Dm(s,Lm(e));const Fm="did:pkh:",Pc=s=>s==null?void 0:s.split(":"),Wm=s=>{const e=s&&Pc(s);if(e)return s.includes(Fm)?e[3]:e[1]},Fa=s=>{const e=s&&Pc(s);if(e)return e[2]+":"+e[3]},_o=s=>{const e=s&&Pc(s);if(e)return e.pop()};async function Cl(s){const{cacao:e,projectId:t}=s,{s:r,p:i}=e,n=Fu(i,i.iss),o=_o(i.iss);return await Rm(o,n,r,Fa(i.iss),t)}const Fu=(s,e)=>{const t=`${s.domain} wants you to sign in with your Ethereum account:`,r=_o(e);if(!s.aud&&!s.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=s.statement||void 0;const n=`URI: ${s.aud||s.uri}`,o=`Version: ${s.version}`,a=`Chain ID: ${Wm(e)}`,c=`Nonce: ${s.nonce}`,l=`Issued At: ${s.iat}`,d=s.exp?`Expiration Time: ${s.exp}`:void 0,u=s.nbf?`Not Before: ${s.nbf}`:void 0,h=s.requestId?`Request ID: ${s.requestId}`:void 0,f=s.resources?`Resources:${s.resources.map(m=>`
- ${m}`).join("")}`:void 0,g=lo(s.resources);if(g){const m=un(g);i=Xm(i,m)}return[t,r,"",i,"",n,o,a,c,l,d,u,h,f].filter(m=>m!=null).join(`
`)};function Hm(s){return gt.Buffer.from(JSON.stringify(s)).toString("base64")}function zm(s){return JSON.parse(gt.Buffer.from(s,"base64").toString("utf-8"))}function Sr(s){if(!s)throw new Error("No recap provided, value is undefined");if(!s.att)throw new Error("No `att` property found");const e=Object.keys(s.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const r=s.att[t];if(Array.isArray(r))throw new Error(`Resource must be an object: ${t}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(r).forEach(i=>{const n=r[i];if(!Array.isArray(n))throw new Error(`Ability limits ${i} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function Vm(s,e,t,r={}){return t==null||t.sort((i,n)=>i.localeCompare(n)),{att:{[s]:Km(e,t,r)}}}function Km(s,e,t={}){e=e==null?void 0:e.sort((i,n)=>i.localeCompare(n));const r=e.map(i=>({[`${s}/${i}`]:[t]}));return Object.assign({},...r)}function Wu(s){return Sr(s),`urn:recap:${Hm(s).replace(/=/g,"")}`}function un(s){const e=zm(s.replace("urn:recap:",""));return Sr(e),e}function Gm(s,e,t){const r=Vm(s,e,t);return Wu(r)}function Ym(s){return s&&s.includes("urn:recap:")}function Zm(s,e){const t=un(s),r=un(e),i=Jm(t,r);return Wu(i)}function Jm(s,e){Sr(s),Sr(e);const t=Object.keys(s.att).concat(Object.keys(e.att)).sort((i,n)=>i.localeCompare(n)),r={att:{}};return t.forEach(i=>{var n,o;Object.keys(((n=s.att)==null?void 0:n[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;r.att[i]=qm(Bm({},r.att[i]),{[a]:((c=s.att[i])==null?void 0:c[a])||((l=e.att[i])==null?void 0:l[a])})})}),r}function Xm(s="",e){Sr(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(s.includes(t))return s;const r=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));c.sort((u,h)=>u.action.localeCompare(h.action));const l={};c.forEach(u=>{l[u.ability]||(l[u.ability]=[]),l[u.ability].push(u.action)});const d=Object.keys(l).map(u=>(i++,`(${i}) '${u}': '${l[u].join("', '")}' for '${a}'.`));r.push(d.join(", ").replace(".,","."))});const n=r.join(" "),o=`${t}${n}`;return`${s?s+" ":""}${o}`}function Al(s){var e;const t=un(s);Sr(t);const r=(e=t.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function Il(s){const e=un(s);Sr(e);const t=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var n;(n=i==null?void 0:i[0])!=null&&n.chains&&t.push(i[0].chains)})}),[...new Set(t.flat())]}function lo(s){if(!s)return;const e=s==null?void 0:s[s.length-1];return Ym(e)?e:void 0}function ia(s){if(!Number.isSafeInteger(s)||s<0)throw new Error("positive integer expected, got "+s)}function Hu(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Lt(s,...e){if(!Hu(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function Sl(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function Qm(s,e){Lt(s);const t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Nl(s){if(typeof s!="boolean")throw new Error(`boolean expected, not ${s}`)}const Xs=s=>new Uint32Array(s.buffer,s.byteOffset,Math.floor(s.byteLength/4)),ew=s=>new DataView(s.buffer,s.byteOffset,s.byteLength),tw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!tw)throw new Error("Non little-endian hardware is not supported");function sw(s){if(typeof s!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(s))}function Wa(s){if(typeof s=="string")s=sw(s);else if(Hu(s))s=Ha(s);else throw new Error("Uint8Array expected, got "+typeof s);return s}function rw(s,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(s,e)}function iw(s,e){if(s.length!==e.length)return!1;let t=0;for(let r=0;r<s.length;r++)t|=s[r]^e[r];return t===0}const nw=(s,e)=>{function t(r,...i){if(Lt(r),s.nonceLength!==void 0){const l=i[0];if(!l)throw new Error("nonce / iv required");s.varSizeNonce?Lt(l):Lt(l,s.nonceLength)}const n=s.tagLength;n&&i[1]!==void 0&&Lt(i[1]);const o=e(r,...i),a=(l,d)=>{if(d!==void 0){if(l!==2)throw new Error("cipher output not supported");Lt(d)}};let c=!1;return{encrypt(l,d){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Lt(l),a(o.encrypt.length,d),o.encrypt(l,d)},decrypt(l,d){if(Lt(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,d),o.decrypt(l,d)}}}return Object.assign(t,s),t};function Tl(s,e,t=!0){if(e===void 0)return new Uint8Array(s);if(e.length!==s)throw new Error("invalid output length, expected "+s+", got: "+e.length);if(t&&!ow(e))throw new Error("invalid output, must be aligned");return e}function Pl(s,e,t,r){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,t,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(t>>i&n),a=Number(t&n);s.setUint32(e+4,o,r),s.setUint32(e+0,a,r)}function ow(s){return s.byteOffset%4===0}function Ha(s){return Uint8Array.from(s)}function mi(...s){for(let e=0;e<s.length;e++)s[e].fill(0)}const zu=s=>Uint8Array.from(s.split("").map(e=>e.charCodeAt(0))),aw=zu("expand 16-byte k"),cw=zu("expand 32-byte k"),lw=Xs(aw),dw=Xs(cw);function we(s,e){return s<<e|s>>>32-e}function za(s){return s.byteOffset%4===0}const Jn=64,uw=16,Vu=2**32-1,Rl=new Uint32Array;function hw(s,e,t,r,i,n,o,a){const c=i.length,l=new Uint8Array(Jn),d=Xs(l),u=za(i)&&za(n),h=u?Xs(i):Rl,f=u?Xs(n):Rl;for(let g=0;g<c;o++){if(s(e,t,r,d,o,a),o>=Vu)throw new Error("arx: counter overflow");const m=Math.min(Jn,c-g);if(u&&m===Jn){const w=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let v=0,E;v<uw;v++)E=w+v,f[E]=h[E]^d[v];g+=Jn;continue}for(let w=0,v;w<m;w++)v=g+w,n[v]=i[v]^l[w];g+=m}}function pw(s,e){const{allowShortKeys:t,extendNonceFn:r,counterLength:i,counterRight:n,rounds:o}=rw({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof s!="function")throw new Error("core must be a function");return ia(i),ia(o),Nl(n),Nl(t),(a,c,l,d,u=0)=>{Lt(a),Lt(c),Lt(l);const h=l.length;if(d===void 0&&(d=new Uint8Array(h)),Lt(d),ia(u),u<0||u>=Vu)throw new Error("arx: counter overflow");if(d.length<h)throw new Error(`arx: output (${d.length}) is shorter than data (${h})`);const f=[];let g=a.length,m,w;if(g===32)f.push(m=Ha(a)),w=dw;else if(g===16&&t)m=new Uint8Array(32),m.set(a),m.set(a,16),w=lw,f.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);za(c)||f.push(c=Ha(c));const v=Xs(m);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(w,v,Xs(c.subarray(0,16)),v),c=c.subarray(16)}const E=16-i;if(E!==c.length)throw new Error(`arx: nonce must be ${E} or 16 bytes`);if(E!==12){const C=new Uint8Array(12);C.set(c,n?0:12-c.length),c=C,f.push(c)}const _=Xs(c);return hw(s,w,v,_,l,d,u,o),mi(...f),d}}const it=(s,e)=>s[e++]&255|(s[e++]&255)<<8;class fw{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Wa(e),Lt(e,32);const t=it(e,0),r=it(e,2),i=it(e,4),n=it(e,6),o=it(e,8),a=it(e,10),c=it(e,12),l=it(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let d=0;d<8;d++)this.pad[d]=it(e,16+2*d)}process(e,t,r=!1){const i=r?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],d=o[3],u=o[4],h=o[5],f=o[6],g=o[7],m=o[8],w=o[9],v=it(e,t+0),E=it(e,t+2),_=it(e,t+4),C=it(e,t+6),k=it(e,t+8),T=it(e,t+10),P=it(e,t+12),M=it(e,t+14);let b=n[0]+(v&8191),U=n[1]+((v>>>13|E<<3)&8191),A=n[2]+((E>>>10|_<<6)&8191),j=n[3]+((_>>>7|C<<9)&8191),J=n[4]+((C>>>4|k<<12)&8191),I=n[5]+(k>>>1&8191),R=n[6]+((k>>>14|T<<2)&8191),N=n[7]+((T>>>11|P<<5)&8191),q=n[8]+((P>>>8|M<<8)&8191),Z=n[9]+(M>>>5|i),O=0,Q=O+b*a+U*(5*w)+A*(5*m)+j*(5*g)+J*(5*f);O=Q>>>13,Q&=8191,Q+=I*(5*h)+R*(5*u)+N*(5*d)+q*(5*l)+Z*(5*c),O+=Q>>>13,Q&=8191;let ce=O+b*c+U*a+A*(5*w)+j*(5*m)+J*(5*g);O=ce>>>13,ce&=8191,ce+=I*(5*f)+R*(5*h)+N*(5*u)+q*(5*d)+Z*(5*l),O+=ce>>>13,ce&=8191;let ue=O+b*l+U*c+A*a+j*(5*w)+J*(5*m);O=ue>>>13,ue&=8191,ue+=I*(5*g)+R*(5*f)+N*(5*h)+q*(5*u)+Z*(5*d),O+=ue>>>13,ue&=8191;let Oe=O+b*d+U*l+A*c+j*a+J*(5*w);O=Oe>>>13,Oe&=8191,Oe+=I*(5*m)+R*(5*g)+N*(5*f)+q*(5*h)+Z*(5*u),O+=Oe>>>13,Oe&=8191;let be=O+b*u+U*d+A*l+j*c+J*a;O=be>>>13,be&=8191,be+=I*(5*w)+R*(5*m)+N*(5*g)+q*(5*f)+Z*(5*h),O+=be>>>13,be&=8191;let We=O+b*h+U*u+A*d+j*l+J*c;O=We>>>13,We&=8191,We+=I*a+R*(5*w)+N*(5*m)+q*(5*g)+Z*(5*f),O+=We>>>13,We&=8191;let Ze=O+b*f+U*h+A*u+j*d+J*l;O=Ze>>>13,Ze&=8191,Ze+=I*c+R*a+N*(5*w)+q*(5*m)+Z*(5*g),O+=Ze>>>13,Ze&=8191;let ht=O+b*g+U*f+A*h+j*u+J*d;O=ht>>>13,ht&=8191,ht+=I*l+R*c+N*a+q*(5*w)+Z*(5*m),O+=ht>>>13,ht&=8191;let Ve=O+b*m+U*g+A*f+j*h+J*u;O=Ve>>>13,Ve&=8191,Ve+=I*d+R*l+N*c+q*a+Z*(5*w),O+=Ve>>>13,Ve&=8191;let Ke=O+b*w+U*m+A*g+j*f+J*h;O=Ke>>>13,Ke&=8191,Ke+=I*u+R*d+N*l+q*c+Z*a,O+=Ke>>>13,Ke&=8191,O=(O<<2)+O|0,O=O+Q|0,Q=O&8191,O=O>>>13,ce+=O,n[0]=Q,n[1]=ce,n[2]=ue,n[3]=Oe,n[4]=be,n[5]=We,n[6]=Ze,n[7]=ht,n[8]=Ve,n[9]=Ke}finalize(){const{h:e,pad:t}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let n=(i^1)-1;for(let a=0;a<10;a++)r[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;mi(r)}update(e){Sl(this);const{buffer:t,blockLen:r}=this;e=Wa(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(r-this.pos,i-n);if(o===r){for(;r<=i-n;n+=r)this.process(e,n);continue}t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){mi(this.h,this.r,this.buffer,this.pad)}digestInto(e){Sl(this),Qm(e,this),this.finished=!0;const{buffer:t,h:r}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=r[o]>>>0,e[n++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}}function gw(s){const e=(r,i)=>s(i).update(Wa(r)).digest(),t=s(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=r=>s(r),e}const mw=gw(s=>new fw(s));function ww(s,e,t,r,i,n=20){let o=s[0],a=s[1],c=s[2],l=s[3],d=e[0],u=e[1],h=e[2],f=e[3],g=e[4],m=e[5],w=e[6],v=e[7],E=i,_=t[0],C=t[1],k=t[2],T=o,P=a,M=c,b=l,U=d,A=u,j=h,J=f,I=g,R=m,N=w,q=v,Z=E,O=_,Q=C,ce=k;for(let Oe=0;Oe<n;Oe+=2)T=T+U|0,Z=we(Z^T,16),I=I+Z|0,U=we(U^I,12),T=T+U|0,Z=we(Z^T,8),I=I+Z|0,U=we(U^I,7),P=P+A|0,O=we(O^P,16),R=R+O|0,A=we(A^R,12),P=P+A|0,O=we(O^P,8),R=R+O|0,A=we(A^R,7),M=M+j|0,Q=we(Q^M,16),N=N+Q|0,j=we(j^N,12),M=M+j|0,Q=we(Q^M,8),N=N+Q|0,j=we(j^N,7),b=b+J|0,ce=we(ce^b,16),q=q+ce|0,J=we(J^q,12),b=b+J|0,ce=we(ce^b,8),q=q+ce|0,J=we(J^q,7),T=T+A|0,ce=we(ce^T,16),N=N+ce|0,A=we(A^N,12),T=T+A|0,ce=we(ce^T,8),N=N+ce|0,A=we(A^N,7),P=P+j|0,Z=we(Z^P,16),q=q+Z|0,j=we(j^q,12),P=P+j|0,Z=we(Z^P,8),q=q+Z|0,j=we(j^q,7),M=M+J|0,O=we(O^M,16),I=I+O|0,J=we(J^I,12),M=M+J|0,O=we(O^M,8),I=I+O|0,J=we(J^I,7),b=b+U|0,Q=we(Q^b,16),R=R+Q|0,U=we(U^R,12),b=b+U|0,Q=we(Q^b,8),R=R+Q|0,U=we(U^R,7);let ue=0;r[ue++]=o+T|0,r[ue++]=a+P|0,r[ue++]=c+M|0,r[ue++]=l+b|0,r[ue++]=d+U|0,r[ue++]=u+A|0,r[ue++]=h+j|0,r[ue++]=f+J|0,r[ue++]=g+I|0,r[ue++]=m+R|0,r[ue++]=w+N|0,r[ue++]=v+q|0,r[ue++]=E+Z|0,r[ue++]=_+O|0,r[ue++]=C+Q|0,r[ue++]=k+ce|0}const yw=pw(ww,{counterRight:!1,counterLength:4,allowShortKeys:!1}),vw=new Uint8Array(16),Ol=(s,e)=>{s.update(e);const t=e.length%16;t&&s.update(vw.subarray(t))},Ew=new Uint8Array(32);function xl(s,e,t,r,i){const n=s(e,t,Ew),o=mw.create(n);i&&Ol(o,i),Ol(o,r);const a=new Uint8Array(16),c=ew(a);Pl(c,0,BigInt(i?i.length:0),!0),Pl(c,8,BigInt(r.length),!0),o.update(a);const l=o.digest();return mi(n,a),l}const bw=s=>(e,t,r)=>({encrypt(i,n){const o=i.length;n=Tl(o+16,n,!1),n.set(i);const a=n.subarray(0,-16);s(e,t,a,a,1);const c=xl(s,e,t,a,r);return n.set(c,o),mi(c),n},decrypt(i,n){n=Tl(i.length-16,n,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=xl(s,e,t,o,r);if(!iw(a,c))throw new Error("invalid tag");return n.set(i.subarray(0,-16)),s(e,t,n,n,1),mi(c),n}}),Ku=nw({blockSize:64,nonceLength:12,tagLength:16},bw(yw));let Gu=class extends Tc{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Nc(e);const r=gi(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return fi(this),this.iHash.update(e),this}digestInto(e){fi(this),Un(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:i,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const qo=(s,e,t)=>new Gu(s,e).update(t).digest();qo.create=(s,e)=>new Gu(s,e);function _w(s,e,t){return Nc(s),t===void 0&&(t=new Uint8Array(s.outputLen)),qo(s,gi(t),gi(e))}const na=new Uint8Array([0]),kl=new Uint8Array;function Cw(s,e,t,r=32){if(Nc(s),dn(r),r>255*s.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/s.outputLen);t===void 0&&(t=kl);const n=new Uint8Array(i*s.outputLen),o=qo.create(s,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<i;l++)na[0]=l+1,a.update(l===0?kl:c).update(t).update(na).digestInto(c),n.set(c,s.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),na.fill(0),n.slice(0,r)}const Aw=(s,e,t,r,i)=>Cw(s,_w(s,e,t),r,i);function Iw(s,e,t,r){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,t,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(t>>i&n),a=Number(t&n),c=r?4:0,l=r?0:4;s.setUint32(e+c,o,r),s.setUint32(e+l,a,r)}function Sw(s,e,t){return s&e^~s&t}function Nw(s,e,t){return s&e^s&t^e&t}let Tw=class extends Tc{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ra(this.buffer)}update(e){fi(this);const{view:t,buffer:r,blockLen:i}=this;e=gi(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(i-this.pos,n-o);if(a===i){const c=ra(e);for(;i<=n-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fi(this),Uu(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let u=o;u<i;u++)t[u]=0;Iw(r,i-8,BigInt(this.length*8),n),this.process(r,0);const a=ra(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,d[u],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:i,finished:n,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=n,e.destroyed=o,i%t&&e.buffer.set(r),e}};const Pw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Hs=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),zs=new Uint32Array(64);class Rw extends Tw{constructor(){super(64,32,8,!1),this.A=Hs[0]|0,this.B=Hs[1]|0,this.C=Hs[2]|0,this.D=Hs[3]|0,this.E=Hs[4]|0,this.F=Hs[5]|0,this.G=Hs[6]|0,this.H=Hs[7]|0}get(){const{A:e,B:t,C:r,D:i,E:n,F:o,G:a,H:c}=this;return[e,t,r,i,n,o,a,c]}set(e,t,r,i,n,o,a,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=i|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let u=0;u<16;u++,t+=4)zs[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){const h=zs[u-15],f=zs[u-2],g=hs(h,7)^hs(h,18)^h>>>3,m=hs(f,17)^hs(f,19)^f>>>10;zs[u]=m+zs[u-7]+g+zs[u-16]|0}let{A:r,B:i,C:n,D:o,E:a,F:c,G:l,H:d}=this;for(let u=0;u<64;u++){const h=hs(a,6)^hs(a,11)^hs(a,25),f=d+h+Sw(a,c,l)+Pw[u]+zs[u]|0,g=(hs(r,2)^hs(r,13)^hs(r,22))+Nw(r,i,n)|0;d=l,l=c,c=a,a=o+f|0,o=n,n=i,i=r,r=f+g|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(r,i,n,o,a,c,l,d)}roundClean(){zs.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Dn=Du(()=>new Rw);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fo=BigInt(0),Wo=BigInt(1),Ow=BigInt(2);function Nr(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Ln(s){if(!Nr(s))throw new Error("Uint8Array expected")}function wi(s,e){if(typeof e!="boolean")throw new Error(s+" boolean expected, got "+e)}const xw=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function yi(s){Ln(s);let e="";for(let t=0;t<s.length;t++)e+=xw[s[t]];return e}function ai(s){const e=s.toString(16);return e.length&1?"0"+e:e}function Rc(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return s===""?Fo:BigInt("0x"+s)}const Rs={_0:48,_9:57,A:65,F:70,a:97,f:102};function $l(s){if(s>=Rs._0&&s<=Rs._9)return s-Rs._0;if(s>=Rs.A&&s<=Rs.F)return s-(Rs.A-10);if(s>=Rs.a&&s<=Rs.f)return s-(Rs.a-10)}function vi(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);const e=s.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let i=0,n=0;i<t;i++,n+=2){const o=$l(s.charCodeAt(n)),a=$l(s.charCodeAt(n+1));if(o===void 0||a===void 0){const c=s[n]+s[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[i]=o*16+a}return r}function Er(s){return Rc(yi(s))}function hn(s){return Ln(s),Rc(yi(Uint8Array.from(s).reverse()))}function Ei(s,e){return vi(s.toString(16).padStart(e*2,"0"))}function Ho(s,e){return Ei(s,e).reverse()}function kw(s){return vi(ai(s))}function Dt(s,e,t){let r;if(typeof e=="string")try{r=vi(e)}catch(n){throw new Error(s+" must be hex string or Uint8Array, cause: "+n)}else if(Nr(e))r=Uint8Array.from(e);else throw new Error(s+" must be hex string or Uint8Array");const i=r.length;if(typeof t=="number"&&i!==t)throw new Error(s+" of length "+t+" expected, got "+i);return r}function pn(...s){let e=0;for(let r=0;r<s.length;r++){const i=s[r];Ln(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<s.length;r++){const n=s[r];t.set(n,i),i+=n.length}return t}function $w(s,e){if(s.length!==e.length)return!1;let t=0;for(let r=0;r<s.length;r++)t|=s[r]^e[r];return t===0}function Uw(s){if(typeof s!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(s))}const oa=s=>typeof s=="bigint"&&Fo<=s;function zo(s,e,t){return oa(s)&&oa(e)&&oa(t)&&e<=s&&s<t}function Ls(s,e,t,r){if(!zo(e,t,r))throw new Error("expected valid "+s+": "+t+" <= n < "+r+", got "+e)}function Yu(s){let e;for(e=0;s>Fo;s>>=Wo,e+=1);return e}function Dw(s,e){return s>>BigInt(e)&Wo}function Lw(s,e,t){return s|(t?Wo:Fo)<<BigInt(e)}const Oc=s=>(Ow<<BigInt(s-1))-Wo,aa=s=>new Uint8Array(s),Ul=s=>Uint8Array.from(s);function Zu(s,e,t){if(typeof s!="number"||s<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=aa(s),i=aa(s),n=0;const o=()=>{r.fill(1),i.fill(0),n=0},a=(...d)=>t(i,r,...d),c=(d=aa())=>{i=a(Ul([0]),d),r=a(),d.length!==0&&(i=a(Ul([1]),d),r=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const u=[];for(;d<e;){r=a();const h=r.slice();u.push(h),d+=r.length}return pn(...u)};return(d,u)=>{o(),c(d);let h;for(;!(h=u(l()));)c();return o(),h}}const Mw={bigint:s=>typeof s=="bigint",function:s=>typeof s=="function",boolean:s=>typeof s=="boolean",string:s=>typeof s=="string",stringOrUint8Array:s=>typeof s=="string"||Nr(s),isSafeInteger:s=>Number.isSafeInteger(s),array:s=>Array.isArray(s),field:(s,e)=>e.Fp.isValid(s),hash:s=>typeof s=="function"&&Number.isSafeInteger(s.outputLen)};function xi(s,e,t={}){const r=(i,n,o)=>{const a=Mw[n];if(typeof a!="function")throw new Error("invalid validator function");const c=s[i];if(!(o&&c===void 0)&&!a(c,s))throw new Error("param "+String(i)+" is invalid. Expected "+n+", got "+c)};for(const[i,n]of Object.entries(e))r(i,n,!1);for(const[i,n]of Object.entries(t))r(i,n,!0);return s}const jw=()=>{throw new Error("not implemented")};function Va(s){const e=new WeakMap;return(t,...r)=>{const i=e.get(t);if(i!==void 0)return i;const n=s(t,...r);return e.set(t,n),n}}var Bw=Object.freeze({__proto__:null,isBytes:Nr,abytes:Ln,abool:wi,bytesToHex:yi,numberToHexUnpadded:ai,hexToNumber:Rc,hexToBytes:vi,bytesToNumberBE:Er,bytesToNumberLE:hn,numberToBytesBE:Ei,numberToBytesLE:Ho,numberToVarBytesBE:kw,ensureBytes:Dt,concatBytes:pn,equalBytes:$w,utf8ToBytes:Uw,inRange:zo,aInRange:Ls,bitLen:Yu,bitGet:Dw,bitSet:Lw,bitMask:Oc,createHmacDrbg:Zu,validateObject:xi,notImplemented:jw,memoized:Va});const rt=BigInt(0),qe=BigInt(1),fr=BigInt(2),qw=BigInt(3),Ka=BigInt(4),Dl=BigInt(5),Ll=BigInt(8);function Nt(s,e){const t=s%e;return t>=rt?t:e+t}function Ju(s,e,t){if(e<rt)throw new Error("invalid exponent, negatives unsupported");if(t<=rt)throw new Error("invalid modulus");if(t===qe)return rt;let r=qe;for(;e>rt;)e&qe&&(r=r*s%t),s=s*s%t,e>>=qe;return r}function ts(s,e,t){let r=s;for(;e-- >rt;)r*=r,r%=t;return r}function Ga(s,e){if(s===rt)throw new Error("invert: expected non-zero number");if(e<=rt)throw new Error("invert: expected positive modulus, got "+e);let t=Nt(s,e),r=e,i=rt,n=qe;for(;t!==rt;){const o=r/t,a=r%t,c=i-n*o;r=t,t=a,i=n,n=c}if(r!==qe)throw new Error("invert: does not exist");return Nt(i,e)}function Fw(s){const e=(s-qe)/fr;let t,r,i;for(t=s-qe,r=0;t%fr===rt;t/=fr,r++);for(i=fr;i<s&&Ju(i,e,s)!==s-qe;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(s+qe)/Ka;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(t+qe)/fr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,l=o.pow(o.mul(o.ONE,i),t),d=o.pow(a,n),u=o.pow(a,t);for(;!o.eql(u,o.ONE);){if(o.eql(u,o.ZERO))return o.ZERO;let h=1;for(let g=o.sqr(u);h<c&&!o.eql(g,o.ONE);h++)g=o.sqr(g);const f=o.pow(l,qe<<BigInt(c-h-1));l=o.sqr(f),d=o.mul(d,f),u=o.mul(u,l),c=h}return d}}function Ww(s){if(s%Ka===qw){const e=(s+qe)/Ka;return function(t,r){const i=t.pow(r,e);if(!t.eql(t.sqr(i),r))throw new Error("Cannot find square root");return i}}if(s%Ll===Dl){const e=(s-Dl)/Ll;return function(t,r){const i=t.mul(r,fr),n=t.pow(i,e),o=t.mul(r,n),a=t.mul(t.mul(o,fr),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),r))throw new Error("Cannot find square root");return c}}return Fw(s)}const Hw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function zw(s){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Hw.reduce((r,i)=>(r[i]="function",r),e);return xi(s,t)}function Vw(s,e,t){if(t<rt)throw new Error("invalid exponent, negatives unsupported");if(t===rt)return s.ONE;if(t===qe)return e;let r=s.ONE,i=e;for(;t>rt;)t&qe&&(r=s.mul(r,i)),i=s.sqr(i),t>>=qe;return r}function Kw(s,e){const t=new Array(e.length),r=e.reduce((n,o,a)=>s.is0(o)?n:(t[a]=n,s.mul(n,o)),s.ONE),i=s.inv(r);return e.reduceRight((n,o,a)=>s.is0(o)?n:(t[a]=s.mul(n,t[a]),s.mul(n,o)),i),t}function Xu(s,e){const t=e!==void 0?e:s.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Qu(s,e,t=!1,r={}){if(s<=rt)throw new Error("invalid field: expected ORDER > 0, got "+s);const{nBitLength:i,nByteLength:n}=Xu(s,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:s,isLE:t,BITS:i,BYTES:n,MASK:Oc(i),ZERO:rt,ONE:qe,create:c=>Nt(c,s),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return rt<=c&&c<s},is0:c=>c===rt,isOdd:c=>(c&qe)===qe,neg:c=>Nt(-c,s),eql:(c,l)=>c===l,sqr:c=>Nt(c*c,s),add:(c,l)=>Nt(c+l,s),sub:(c,l)=>Nt(c-l,s),mul:(c,l)=>Nt(c*l,s),pow:(c,l)=>Vw(a,c,l),div:(c,l)=>Nt(c*Ga(l,s),s),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Ga(c,s),sqrt:r.sqrt||(c=>(o||(o=Ww(s)),o(a,c))),invertBatch:c=>Kw(a,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>t?Ho(c,n):Ei(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?hn(c):Er(c)}});return Object.freeze(a)}function eh(s){if(typeof s!="bigint")throw new Error("field order must be bigint");const e=s.toString(2).length;return Math.ceil(e/8)}function th(s){const e=eh(s);return e+Math.ceil(e/2)}function Gw(s,e,t=!1){const r=s.length,i=eh(e),n=th(e);if(r<16||r<n||r>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+r);const o=t?hn(s):Er(s),a=Nt(o,e-qe)+qe;return t?Ho(a,i):Ei(a,i)}const Ml=BigInt(0),Xn=BigInt(1);function ca(s,e){const t=e.negate();return s?t:e}function sh(s,e){if(!Number.isSafeInteger(s)||s<=0||s>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+s)}function la(s,e){sh(s,e);const t=Math.ceil(e/s)+1,r=2**(s-1);return{windows:t,windowSize:r}}function Yw(s,e){if(!Array.isArray(s))throw new Error("array expected");s.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function Zw(s,e){if(!Array.isArray(s))throw new Error("array of scalars expected");s.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const da=new WeakMap,rh=new WeakMap;function ua(s){return rh.get(s)||1}function Jw(s,e){return{constTimeNegate:ca,hasPrecomputes(t){return ua(t)!==1},unsafeLadder(t,r,i=s.ZERO){let n=t;for(;r>Ml;)r&Xn&&(i=i.add(n)),n=n.double(),r>>=Xn;return i},precomputeWindow(t,r){const{windows:i,windowSize:n}=la(r,e),o=[];let a=t,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let d=1;d<n;d++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,r,i){const{windows:n,windowSize:o}=la(t,e);let a=s.ZERO,c=s.BASE;const l=BigInt(2**t-1),d=2**t,u=BigInt(t);for(let h=0;h<n;h++){const f=h*o;let g=Number(i&l);i>>=u,g>o&&(g-=d,i+=Xn);const m=f,w=f+Math.abs(g)-1,v=h%2!==0,E=g<0;g===0?c=c.add(ca(v,r[m])):a=a.add(ca(E,r[w]))}return{p:a,f:c}},wNAFUnsafe(t,r,i,n=s.ZERO){const{windows:o,windowSize:a}=la(t,e),c=BigInt(2**t-1),l=2**t,d=BigInt(t);for(let u=0;u<o;u++){const h=u*a;if(i===Ml)break;let f=Number(i&c);if(i>>=d,f>a&&(f-=l,i+=Xn),f===0)continue;let g=r[h+Math.abs(f)-1];f<0&&(g=g.negate()),n=n.add(g)}return n},getPrecomputes(t,r,i){let n=da.get(r);return n||(n=this.precomputeWindow(r,t),t!==1&&da.set(r,i(n))),n},wNAFCached(t,r,i){const n=ua(t);return this.wNAF(n,this.getPrecomputes(n,t,i),r)},wNAFCachedUnsafe(t,r,i,n){const o=ua(t);return o===1?this.unsafeLadder(t,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),r,n)},setWindowSize(t,r){sh(r,e),rh.set(t,r),da.delete(t)}}}function Xw(s,e,t,r){if(Yw(t,s),Zw(r,e),t.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=s.ZERO,n=Yu(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let d=i;for(let u=l;u>=0;u-=o){c.fill(i);for(let f=0;f<r.length;f++){const g=r[f],m=Number(g>>BigInt(u)&BigInt(a));c[m]=c[m].add(t[f])}let h=i;for(let f=c.length-1,g=i;f>0;f--)g=g.add(c[f]),h=h.add(g);if(d=d.add(h),u!==0)for(let f=0;f<o;f++)d=d.double()}return d}function ih(s){return zw(s.Fp),xi(s,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Xu(s.n,s.nBitLength),...s,p:s.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const qr=BigInt(0),ha=BigInt(1);function Qw(s){return xi(s,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...s})}function ey(s){const e=Qw(s),{P:t}=e,r=E=>Nt(E,t),i=e.montgomeryBits,n=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(E=>E),c=e.powPminus2||(E=>Ju(E,t-BigInt(2),t));function l(E,_,C){const k=r(E*(_-C));return _=r(_-k),C=r(C+k),[_,C]}const d=(e.a-BigInt(2))/BigInt(4);function u(E,_){Ls("u",E,qr,t),Ls("scalar",_,qr,t);const C=_,k=E;let T=ha,P=qr,M=E,b=ha,U=qr,A;for(let J=BigInt(i-1);J>=qr;J--){const I=C>>J&ha;U^=I,A=l(U,T,M),T=A[0],M=A[1],A=l(U,P,b),P=A[0],b=A[1],U=I;const R=T+P,N=r(R*R),q=T-P,Z=r(q*q),O=N-Z,Q=M+b,ce=M-b,ue=r(ce*R),Oe=r(Q*q),be=ue+Oe,We=ue-Oe;M=r(be*be),b=r(k*r(We*We)),T=r(N*Z),P=r(O*(N+r(d*O)))}A=l(U,T,M),T=A[0],M=A[1],A=l(U,P,b),P=A[0],b=A[1];const j=c(P);return r(T*j)}function h(E){return Ho(r(E),n)}function f(E){const _=Dt("u coordinate",E,n);return o===32&&(_[31]&=127),hn(_)}function g(E){const _=Dt("scalar",E),C=_.length;if(C!==n&&C!==o){let k=""+n+" or "+o;throw new Error("invalid scalar, expected "+k+" bytes, got "+C)}return hn(a(_))}function m(E,_){const C=f(_),k=g(E),T=u(C,k);if(T===qr)throw new Error("invalid private or public key received");return h(T)}const w=h(e.Gu);function v(E){return m(E,w)}return{scalarMult:m,scalarMultBase:v,getSharedSecret:(E,_)=>m(E,_),getPublicKey:E=>v(E),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:w}}const Ya=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const ty=BigInt(1),jl=BigInt(2),sy=BigInt(3),ry=BigInt(5);BigInt(8);function iy(s){const e=BigInt(10),t=BigInt(20),r=BigInt(40),i=BigInt(80),n=Ya,o=s*s%n*s%n,a=ts(o,jl,n)*o%n,c=ts(a,ty,n)*s%n,l=ts(c,ry,n)*c%n,d=ts(l,e,n)*l%n,u=ts(d,t,n)*d%n,h=ts(u,r,n)*u%n,f=ts(h,i,n)*h%n,g=ts(f,i,n)*h%n,m=ts(g,e,n)*l%n;return{pow_p_5_8:ts(m,jl,n)*s%n,b2:o}}function ny(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}const Za=ey({P:Ya,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:s=>{const e=Ya,{pow_p_5_8:t,b2:r}=iy(s);return Nt(ts(t,sy,e)*r,e)},adjustScalarBytes:ny,randomBytes:Oi});function Bl(s){s.lowS!==void 0&&wi("lowS",s.lowS),s.prehash!==void 0&&wi("prehash",s.prehash)}function oy(s){const e=ih(s);xi(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:i}=e;if(t){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:ay,hexToBytes:cy}=Bw;class ly extends Error{constructor(e=""){super(e)}}const ks={Err:ly,_tlv:{encode:(s,e)=>{const{Err:t}=ks;if(s<0||s>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,i=ai(r);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const n=r>127?ai(i.length/2|128):"";return ai(s)+n+i+e},decode(s,e){const{Err:t}=ks;let r=0;if(s<0||s>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==s)throw new t("tlv.decode: wrong tlv");const i=e[r++],n=!!(i&128);let o=0;if(!n)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const d of l)o=o<<8|d;if(r+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(s){const{Err:e}=ks;if(s<Us)throw new e("integer: negative integers are not allowed");let t=ai(s);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(s){const{Err:e}=ks;if(s[0]&128)throw new e("invalid signature integer: negative");if(s[0]===0&&!(s[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ay(s)}},toSig(s){const{Err:e,_int:t,_tlv:r}=ks,i=typeof s=="string"?cy(s):s;Ln(i);const{v:n,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,n),{v:l,l:d}=r.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(s){const{_tlv:e,_int:t}=ks,r=e.encode(2,t.encode(s.r)),i=e.encode(2,t.encode(s.s)),n=r+i;return e.encode(48,n)}},Us=BigInt(0),et=BigInt(1);BigInt(2);const ql=BigInt(3);BigInt(4);function dy(s){const e=oy(s),{Fp:t}=e,r=Qu(e.n,e.nBitLength),i=e.toBytes||((m,w,v)=>{const E=w.toAffine();return pn(Uint8Array.from([4]),t.toBytes(E.x),t.toBytes(E.y))}),n=e.fromBytes||(m=>{const w=m.subarray(1),v=t.fromBytes(w.subarray(0,t.BYTES)),E=t.fromBytes(w.subarray(t.BYTES,2*t.BYTES));return{x:v,y:E}});function o(m){const{a:w,b:v}=e,E=t.sqr(m),_=t.mul(E,m);return t.add(t.add(_,t.mul(m,w)),v)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(m){return zo(m,et,e.n)}function c(m){const{allowedPrivateKeyLengths:w,nByteLength:v,wrapPrivateKey:E,n:_}=e;if(w&&typeof m!="bigint"){if(Nr(m)&&(m=yi(m)),typeof m!="string"||!w.includes(m.length))throw new Error("invalid private key");m=m.padStart(v*2,"0")}let C;try{C=typeof m=="bigint"?m:Er(Dt("private key",m,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof m)}return E&&(C=Nt(C,_)),Ls("private key",C,et,_),C}function l(m){if(!(m instanceof h))throw new Error("ProjectivePoint expected")}const d=Va((m,w)=>{const{px:v,py:E,pz:_}=m;if(t.eql(_,t.ONE))return{x:v,y:E};const C=m.is0();w==null&&(w=C?t.ONE:t.inv(_));const k=t.mul(v,w),T=t.mul(E,w),P=t.mul(_,w);if(C)return{x:t.ZERO,y:t.ZERO};if(!t.eql(P,t.ONE))throw new Error("invZ was invalid");return{x:k,y:T}}),u=Va(m=>{if(m.is0()){if(e.allowInfinityPoint&&!t.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:w,y:v}=m.toAffine();if(!t.isValid(w)||!t.isValid(v))throw new Error("bad point: x or y not FE");const E=t.sqr(v),_=o(w);if(!t.eql(E,_))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class h{constructor(w,v,E){if(this.px=w,this.py=v,this.pz=E,w==null||!t.isValid(w))throw new Error("x required");if(v==null||!t.isValid(v))throw new Error("y required");if(E==null||!t.isValid(E))throw new Error("z required");Object.freeze(this)}static fromAffine(w){const{x:v,y:E}=w||{};if(!w||!t.isValid(v)||!t.isValid(E))throw new Error("invalid affine point");if(w instanceof h)throw new Error("projective point not allowed");const _=C=>t.eql(C,t.ZERO);return _(v)&&_(E)?h.ZERO:new h(v,E,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(w){const v=t.invertBatch(w.map(E=>E.pz));return w.map((E,_)=>E.toAffine(v[_])).map(h.fromAffine)}static fromHex(w){const v=h.fromAffine(n(Dt("pointHex",w)));return v.assertValidity(),v}static fromPrivateKey(w){return h.BASE.multiply(c(w))}static msm(w,v){return Xw(h,r,w,v)}_setWindowSize(w){g.setWindowSize(this,w)}assertValidity(){u(this)}hasEvenY(){const{y:w}=this.toAffine();if(t.isOdd)return!t.isOdd(w);throw new Error("Field doesn't support isOdd")}equals(w){l(w);const{px:v,py:E,pz:_}=this,{px:C,py:k,pz:T}=w,P=t.eql(t.mul(v,T),t.mul(C,_)),M=t.eql(t.mul(E,T),t.mul(k,_));return P&&M}negate(){return new h(this.px,t.neg(this.py),this.pz)}double(){const{a:w,b:v}=e,E=t.mul(v,ql),{px:_,py:C,pz:k}=this;let T=t.ZERO,P=t.ZERO,M=t.ZERO,b=t.mul(_,_),U=t.mul(C,C),A=t.mul(k,k),j=t.mul(_,C);return j=t.add(j,j),M=t.mul(_,k),M=t.add(M,M),T=t.mul(w,M),P=t.mul(E,A),P=t.add(T,P),T=t.sub(U,P),P=t.add(U,P),P=t.mul(T,P),T=t.mul(j,T),M=t.mul(E,M),A=t.mul(w,A),j=t.sub(b,A),j=t.mul(w,j),j=t.add(j,M),M=t.add(b,b),b=t.add(M,b),b=t.add(b,A),b=t.mul(b,j),P=t.add(P,b),A=t.mul(C,k),A=t.add(A,A),b=t.mul(A,j),T=t.sub(T,b),M=t.mul(A,U),M=t.add(M,M),M=t.add(M,M),new h(T,P,M)}add(w){l(w);const{px:v,py:E,pz:_}=this,{px:C,py:k,pz:T}=w;let P=t.ZERO,M=t.ZERO,b=t.ZERO;const U=e.a,A=t.mul(e.b,ql);let j=t.mul(v,C),J=t.mul(E,k),I=t.mul(_,T),R=t.add(v,E),N=t.add(C,k);R=t.mul(R,N),N=t.add(j,J),R=t.sub(R,N),N=t.add(v,_);let q=t.add(C,T);return N=t.mul(N,q),q=t.add(j,I),N=t.sub(N,q),q=t.add(E,_),P=t.add(k,T),q=t.mul(q,P),P=t.add(J,I),q=t.sub(q,P),b=t.mul(U,N),P=t.mul(A,I),b=t.add(P,b),P=t.sub(J,b),b=t.add(J,b),M=t.mul(P,b),J=t.add(j,j),J=t.add(J,j),I=t.mul(U,I),N=t.mul(A,N),J=t.add(J,I),I=t.sub(j,I),I=t.mul(U,I),N=t.add(N,I),j=t.mul(J,N),M=t.add(M,j),j=t.mul(q,N),P=t.mul(R,P),P=t.sub(P,j),j=t.mul(R,J),b=t.mul(q,b),b=t.add(b,j),new h(P,M,b)}subtract(w){return this.add(w.negate())}is0(){return this.equals(h.ZERO)}wNAF(w){return g.wNAFCached(this,w,h.normalizeZ)}multiplyUnsafe(w){const{endo:v,n:E}=e;Ls("scalar",w,Us,E);const _=h.ZERO;if(w===Us)return _;if(this.is0()||w===et)return this;if(!v||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,w,h.normalizeZ);let{k1neg:C,k1:k,k2neg:T,k2:P}=v.splitScalar(w),M=_,b=_,U=this;for(;k>Us||P>Us;)k&et&&(M=M.add(U)),P&et&&(b=b.add(U)),U=U.double(),k>>=et,P>>=et;return C&&(M=M.negate()),T&&(b=b.negate()),b=new h(t.mul(b.px,v.beta),b.py,b.pz),M.add(b)}multiply(w){const{endo:v,n:E}=e;Ls("scalar",w,et,E);let _,C;if(v){const{k1neg:k,k1:T,k2neg:P,k2:M}=v.splitScalar(w);let{p:b,f:U}=this.wNAF(T),{p:A,f:j}=this.wNAF(M);b=g.constTimeNegate(k,b),A=g.constTimeNegate(P,A),A=new h(t.mul(A.px,v.beta),A.py,A.pz),_=b.add(A),C=U.add(j)}else{const{p:k,f:T}=this.wNAF(w);_=k,C=T}return h.normalizeZ([_,C])[0]}multiplyAndAddUnsafe(w,v,E){const _=h.BASE,C=(T,P)=>P===Us||P===et||!T.equals(_)?T.multiplyUnsafe(P):T.multiply(P),k=C(this,v).add(C(w,E));return k.is0()?void 0:k}toAffine(w){return d(this,w)}isTorsionFree(){const{h:w,isTorsionFree:v}=e;if(w===et)return!0;if(v)return v(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:w,clearCofactor:v}=e;return w===et?this:v?v(h,this):this.multiplyUnsafe(e.h)}toRawBytes(w=!0){return wi("isCompressed",w),this.assertValidity(),i(h,this,w)}toHex(w=!0){return wi("isCompressed",w),yi(this.toRawBytes(w))}}h.BASE=new h(e.Gx,e.Gy,t.ONE),h.ZERO=new h(t.ZERO,t.ONE,t.ZERO);const f=e.nBitLength,g=Jw(h,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function uy(s){const e=ih(s);return xi(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function hy(s){const e=uy(s),{Fp:t,n:r}=e,i=t.BYTES+1,n=2*t.BYTES+1;function o(I){return Nt(I,r)}function a(I){return Ga(I,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:d,isWithinCurveOrder:u}=dy({...e,toBytes(I,R,N){const q=R.toAffine(),Z=t.toBytes(q.x),O=pn;return wi("isCompressed",N),N?O(Uint8Array.from([R.hasEvenY()?2:3]),Z):O(Uint8Array.from([4]),Z,t.toBytes(q.y))},fromBytes(I){const R=I.length,N=I[0],q=I.subarray(1);if(R===i&&(N===2||N===3)){const Z=Er(q);if(!zo(Z,et,t.ORDER))throw new Error("Point is not on curve");const O=d(Z);let Q;try{Q=t.sqrt(O)}catch(ue){const Oe=ue instanceof Error?": "+ue.message:"";throw new Error("Point is not on curve"+Oe)}const ce=(Q&et)===et;return(N&1)===1!==ce&&(Q=t.neg(Q)),{x:Z,y:Q}}else if(R===n&&N===4){const Z=t.fromBytes(q.subarray(0,t.BYTES)),O=t.fromBytes(q.subarray(t.BYTES,2*t.BYTES));return{x:Z,y:O}}else{const Z=i,O=n;throw new Error("invalid Point, expected length of "+Z+", or uncompressed "+O+", got "+R)}}}),h=I=>yi(Ei(I,e.nByteLength));function f(I){const R=r>>et;return I>R}function g(I){return f(I)?o(-I):I}const m=(I,R,N)=>Er(I.slice(R,N));class w{constructor(R,N,q){this.r=R,this.s=N,this.recovery=q,this.assertValidity()}static fromCompact(R){const N=e.nByteLength;return R=Dt("compactSignature",R,N*2),new w(m(R,0,N),m(R,N,2*N))}static fromDER(R){const{r:N,s:q}=ks.toSig(Dt("DER",R));return new w(N,q)}assertValidity(){Ls("r",this.r,et,r),Ls("s",this.s,et,r)}addRecoveryBit(R){return new w(this.r,this.s,R)}recoverPublicKey(R){const{r:N,s:q,recovery:Z}=this,O=T(Dt("msgHash",R));if(Z==null||![0,1,2,3].includes(Z))throw new Error("recovery id invalid");const Q=Z===2||Z===3?N+e.n:N;if(Q>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const ce=(Z&1)===0?"02":"03",ue=c.fromHex(ce+h(Q)),Oe=a(Q),be=o(-O*Oe),We=o(q*Oe),Ze=c.BASE.multiplyAndAddUnsafe(ue,be,We);if(!Ze)throw new Error("point at infinify");return Ze.assertValidity(),Ze}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return vi(this.toDERHex())}toDERHex(){return ks.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return vi(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const v={isValidPrivateKey(I){try{return l(I),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const I=th(e.n);return Gw(e.randomBytes(I),e.n)},precompute(I=8,R=c.BASE){return R._setWindowSize(I),R.multiply(BigInt(3)),R}};function E(I,R=!0){return c.fromPrivateKey(I).toRawBytes(R)}function _(I){const R=Nr(I),N=typeof I=="string",q=(R||N)&&I.length;return R?q===i||q===n:N?q===2*i||q===2*n:I instanceof c}function C(I,R,N=!0){if(_(I))throw new Error("first arg must be private key");if(!_(R))throw new Error("second arg must be public key");return c.fromHex(R).multiply(l(I)).toRawBytes(N)}const k=e.bits2int||function(I){if(I.length>8192)throw new Error("input is too large");const R=Er(I),N=I.length*8-e.nBitLength;return N>0?R>>BigInt(N):R},T=e.bits2int_modN||function(I){return o(k(I))},P=Oc(e.nBitLength);function M(I){return Ls("num < 2^"+e.nBitLength,I,Us,P),Ei(I,e.nByteLength)}function b(I,R,N=U){if(["recovered","canonical"].some(Ve=>Ve in N))throw new Error("sign() legacy options not supported");const{hash:q,randomBytes:Z}=e;let{lowS:O,prehash:Q,extraEntropy:ce}=N;O==null&&(O=!0),I=Dt("msgHash",I),Bl(N),Q&&(I=Dt("prehashed msgHash",q(I)));const ue=T(I),Oe=l(R),be=[M(Oe),M(ue)];if(ce!=null&&ce!==!1){const Ve=ce===!0?Z(t.BYTES):ce;be.push(Dt("extraEntropy",Ve))}const We=pn(...be),Ze=ue;function ht(Ve){const Ke=k(Ve);if(!u(Ke))return;const ar=a(Ke),As=c.BASE.multiply(Ke).toAffine(),us=o(As.x);if(us===Us)return;const Is=o(ar*o(Ze+us*Oe));if(Is===Us)return;let Ss=(As.x===us?0:2)|Number(As.y&et),Hn=Is;return O&&f(Is)&&(Hn=g(Is),Ss^=1),new w(us,Hn,Ss)}return{seed:We,k2sig:ht}}const U={lowS:e.lowS,prehash:!1},A={lowS:e.lowS,prehash:!1};function j(I,R,N=U){const{seed:q,k2sig:Z}=b(I,R,N),O=e;return Zu(O.hash.outputLen,O.nByteLength,O.hmac)(q,Z)}c.BASE._setWindowSize(8);function J(I,R,N,q=A){var Is;const Z=I;R=Dt("msgHash",R),N=Dt("publicKey",N);const{lowS:O,prehash:Q,format:ce}=q;if(Bl(q),"strict"in q)throw new Error("options.strict was renamed to lowS");if(ce!==void 0&&ce!=="compact"&&ce!=="der")throw new Error("format must be compact or der");const ue=typeof Z=="string"||Nr(Z),Oe=!ue&&!ce&&typeof Z=="object"&&Z!==null&&typeof Z.r=="bigint"&&typeof Z.s=="bigint";if(!ue&&!Oe)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let be,We;try{if(Oe&&(be=new w(Z.r,Z.s)),ue){try{ce!=="compact"&&(be=w.fromDER(Z))}catch(Ss){if(!(Ss instanceof ks.Err))throw Ss}!be&&ce!=="der"&&(be=w.fromCompact(Z))}We=c.fromHex(N)}catch{return!1}if(!be||O&&be.hasHighS())return!1;Q&&(R=e.hash(R));const{r:Ze,s:ht}=be,Ve=T(R),Ke=a(ht),ar=o(Ve*Ke),As=o(Ze*Ke),us=(Is=c.BASE.multiplyAndAddUnsafe(We,ar,As))==null?void 0:Is.toAffine();return us?o(us.x)===Ze:!1}return{CURVE:e,getPublicKey:E,getSharedSecret:C,sign:j,verify:J,ProjectivePoint:c,Signature:w,utils:v}}function py(s){return{hash:s,hmac:(e,...t)=>qo(s,e,wm(...t)),randomBytes:Oi}}function fy(s,e){const t=r=>hy({...s,...py(r)});return{...t(e),create:t}}const nh=Qu(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),gy=nh.create(BigInt("-3")),my=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),wy=fy({a:gy,b:my,Fp:nh,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Dn),oh="base10",vt="base16",is="base64pad",Gs="base64url",Mn="utf8",ah=0,Ms=1,jn=2,yy=0,Fl=1,Xi=12,xc=32;function vy(){const s=Za.utils.randomPrivateKey(),e=Za.getPublicKey(s);return{privateKey:Pt(s,vt),publicKey:Pt(e,vt)}}function Ja(){const s=Oi(xc);return Pt(s,vt)}function Ey(s,e){const t=Za.getSharedSecret(Yt(s,vt),Yt(e,vt)),r=Aw(Dn,t,void 0,void 0,xc);return Pt(r,vt)}function uo(s){const e=Dn(Yt(s,vt));return Pt(e,vt)}function ws(s){const e=Dn(Yt(s,Mn));return Pt(e,vt)}function ch(s){return Yt(`${s}`,oh)}function Tr(s){return Number(Pt(s,oh))}function lh(s){return s.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function dh(s){const e=s.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function by(s){const e=ch(typeof s.type<"u"?s.type:ah);if(Tr(e)===Ms&&typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof s.senderPublicKey<"u"?Yt(s.senderPublicKey,vt):void 0,r=typeof s.iv<"u"?Yt(s.iv,vt):Oi(Xi),i=Yt(s.symKey,vt),n=Ku(i,r).encrypt(Yt(s.message,Mn)),o=uh({type:e,sealed:n,iv:r,senderPublicKey:t});return s.encoding===Gs?lh(o):o}function _y(s){const e=Yt(s.symKey,vt),{sealed:t,iv:r}=fn({encoded:s.encoded,encoding:s.encoding}),i=Ku(e,r).decrypt(t);if(i===null)throw new Error("Failed to decrypt");return Pt(i,Mn)}function Cy(s,e){const t=ch(jn),r=Oi(Xi),i=Yt(s,Mn),n=uh({type:t,sealed:i,iv:r});return e===Gs?lh(n):n}function Ay(s,e){const{sealed:t}=fn({encoded:s,encoding:e});return Pt(t,Mn)}function uh(s){if(Tr(s.type)===jn)return Pt(Ji([s.type,s.sealed]),is);if(Tr(s.type)===Ms){if(typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Pt(Ji([s.type,s.senderPublicKey,s.iv,s.sealed]),is)}return Pt(Ji([s.type,s.iv,s.sealed]),is)}function fn(s){const e=(s.encoding||is)===Gs?dh(s.encoded):s.encoded,t=Yt(e,is),r=t.slice(yy,Fl),i=Fl;if(Tr(r)===Ms){const c=i+xc,l=c+Xi,d=t.slice(i,c),u=t.slice(c,l),h=t.slice(l);return{type:r,sealed:h,iv:u,senderPublicKey:d}}if(Tr(r)===jn){const c=t.slice(i),l=Oi(Xi);return{type:r,sealed:c,iv:l}}const n=i+Xi,o=t.slice(i,n),a=t.slice(n);return{type:r,sealed:a,iv:o}}function Iy(s,e){const t=fn({encoded:s,encoding:e==null?void 0:e.encoding});return hh({type:Tr(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Pt(t.senderPublicKey,vt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function hh(s){const e=(s==null?void 0:s.type)||ah;if(e===Ms){if(typeof(s==null?void 0:s.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(s==null?void 0:s.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:s==null?void 0:s.senderPublicKey,receiverPublicKey:s==null?void 0:s.receiverPublicKey}}function Wl(s){return s.type===Ms&&typeof s.senderPublicKey=="string"&&typeof s.receiverPublicKey=="string"}function Hl(s){return s.type===jn}function Sy(s){const e=gt.Buffer.from(s.x,"base64"),t=gt.Buffer.from(s.y,"base64");return Ji([new Uint8Array([4]),e,t])}function Ny(s,e){const[t,r,i]=s.split("."),n=gt.Buffer.from(dh(i),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${t}.${r}`,l=Dn(c),d=Sy(e);if(!wy.verify(Ji([o,a]),l,d))throw new Error("Invalid signature");return Ua(s).payload}const Ty="irn";function Co(s){return(s==null?void 0:s.relay)||{protocol:Ty}}function Gi(s){const e=yp[s];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${s}`);return e}function Py(s,e="-"){const t={},r="relay"+e;return Object.keys(s).forEach(i=>{if(i.startsWith(r)){const n=i.replace(r,""),o=s[i];t[n]=o}}),t}function zl(s){if(!s.includes("wc:")){const l=$u(s);l!=null&&l.includes("wc:")&&(s=l)}s=s.includes("wc://")?s.replace("wc://",""):s,s=s.includes("wc:")?s.replace("wc:",""):s;const e=s.indexOf(":"),t=s.indexOf("?")!==-1?s.indexOf("?"):void 0,r=s.substring(0,e),i=s.substring(e+1,t).split("@"),n=typeof t<"u"?s.substring(t):"",o=new URLSearchParams(n),a={};o.forEach((l,d)=>{a[d]=l});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:Ry(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:Py(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function Ry(s){return s.startsWith("//")?s.substring(2):s}function Oy(s,e="-"){const t="relay",r={};return Object.keys(s).forEach(i=>{const n=i,o=t+e+n;s[n]&&(r[o]=s[n])}),r}function Vl(s){const e=new URLSearchParams,t=Oy(s.relay);Object.keys(t).sort().forEach(i=>{e.set(i,t[i])}),e.set("symKey",s.symKey),s.expiryTimestamp&&e.set("expiryTimestamp",s.expiryTimestamp.toString()),s.methods&&e.set("methods",s.methods.join(","));const r=e.toString();return`${s.protocol}:${s.topic}@${s.version}?${r}`}function Qn(s,e,t){return`${s}?wc_ev=${t}&topic=${e}`}function ki(s){const e=[];return s.forEach(t=>{const[r,i]=t.split(":");e.push(`${r}:${i}`)}),e}function xy(s){const e=[];return Object.values(s).forEach(t=>{e.push(...ki(t.accounts))}),e}function ky(s,e){const t=[];return Object.values(s).forEach(r=>{ki(r.accounts).includes(e)&&t.push(...r.methods)}),t}function $y(s,e){const t=[];return Object.values(s).forEach(r=>{ki(r.accounts).includes(e)&&t.push(...r.events)}),t}function kc(s){return s.includes(":")}function Yi(s){return kc(s)?s.split(":")[0]:s}function Uy(s){const e={};return s==null||s.forEach(t=>{var r;const[i,n]=t.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(t),(r=e[i].chains)==null||r.push(`${i}:${n}`)}),e}function Kl(s,e){e=e.map(r=>r.replace("did:pkh:",""));const t=Uy(e);for(const[r,i]of Object.entries(t))i.methods?i.methods=co(i.methods,s):i.methods=s,i.events=["chainChanged","accountsChanged"];return t}const Dy={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Ly={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function D(s,e){const{message:t,code:r}=Ly[s];return{message:e?`${t} ${e}`:t,code:r}}function Te(s,e){const{message:t,code:r}=Dy[s];return{message:e?`${t} ${e}`:t,code:r}}function Qs(s,e){return!!Array.isArray(s)}function gn(s){return Object.getPrototypeOf(s)===Object.prototype&&Object.keys(s).length}function ct(s){return typeof s>"u"}function ze(s,e){return e&&ct(s)?!0:typeof s=="string"&&!!s.trim().length}function $c(s,e){return e&&ct(s)?!0:typeof s=="number"&&!isNaN(s)}function My(s,e){const{requiredNamespaces:t}=e,r=Object.keys(s.namespaces),i=Object.keys(t);let n=!0;return yr(i,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:l}=s.namespaces[o],d=ki(a),u=t[o];(!yr(Pu(o,u),d)||!yr(u.methods,c)||!yr(u.events,l))&&(n=!1)}),n):!1}function Ao(s){return ze(s,!1)&&s.includes(":")?s.split(":").length===2:!1}function jy(s){if(ze(s,!1)&&s.includes(":")){const e=s.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Ao(t)}}return!1}function By(s){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(ze(s,!1)){if(e(s))return!0;const t=$u(s);return e(t)}}catch{}return!1}function qy(s){var e;return(e=s==null?void 0:s.proposer)==null?void 0:e.publicKey}function Fy(s){return s==null?void 0:s.topic}function Wy(s,e){let t=null;return ze(s==null?void 0:s.publicKey,!1)||(t=D("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Gl(s){let e=!0;return Qs(s)?s.length&&(e=s.every(t=>ze(t,!1))):e=!1,e}function Hy(s,e,t){let r=null;return Qs(e)&&e.length?e.forEach(i=>{r||Ao(i)||(r=Te("UNSUPPORTED_CHAINS",`${t}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):Ao(s)||(r=Te("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function zy(s,e,t){let r=null;return Object.entries(s).forEach(([i,n])=>{if(r)return;const o=Hy(i,Pu(i,n),`${e} ${t}`);o&&(r=o)}),r}function Vy(s,e){let t=null;return Qs(s)?s.forEach(r=>{t||jy(r)||(t=Te("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=Te("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Ky(s,e){let t=null;return Object.values(s).forEach(r=>{if(t)return;const i=Vy(r==null?void 0:r.accounts,`${e} namespace`);i&&(t=i)}),t}function Gy(s,e){let t=null;return Gl(s==null?void 0:s.methods)?Gl(s==null?void 0:s.events)||(t=Te("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Te("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function ph(s,e){let t=null;return Object.values(s).forEach(r=>{if(t)return;const i=Gy(r,`${e}, namespace`);i&&(t=i)}),t}function Yy(s,e,t){let r=null;if(s&&gn(s)){const i=ph(s,e);i&&(r=i);const n=zy(s,e,t);n&&(r=n)}else r=D("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return r}function pa(s,e){let t=null;if(s&&gn(s)){const r=ph(s,e);r&&(t=r);const i=Ky(s,e);i&&(t=i)}else t=D("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function fh(s){return ze(s.protocol,!0)}function Zy(s,e){let t=!1;return s?s&&Qs(s)&&s.length&&s.forEach(r=>{t=fh(r)}):t=!0,t}function Jy(s){return typeof s=="number"}function St(s){return typeof s<"u"&&typeof s!==null}function Xy(s){return!(!s||typeof s!="object"||!s.code||!$c(s.code,!1)||!s.message||!ze(s.message,!1))}function Qy(s){return!(ct(s)||!ze(s.method,!1))}function ev(s){return!(ct(s)||ct(s.result)&&ct(s.error)||!$c(s.id,!1)||!ze(s.jsonrpc,!1))}function tv(s){return!(ct(s)||!ze(s.name,!1))}function Yl(s,e){return!(!Ao(e)||!xy(s).includes(e))}function sv(s,e,t){return ze(t,!1)?ky(s,e).includes(t):!1}function rv(s,e,t){return ze(t,!1)?$y(s,e).includes(t):!1}function Zl(s,e,t){let r=null;const i=iv(s),n=nv(e),o=Object.keys(i),a=Object.keys(n),c=Jl(Object.keys(s)),l=Jl(Object.keys(e)),d=c.filter(u=>!l.includes(u));return d.length&&(r=D("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${d.toString()}
      Received: ${Object.keys(e).toString()}`)),yr(o,a)||(r=D("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(u=>{if(!u.includes(":")||r)return;const h=ki(e[u].accounts);h.includes(u)||(r=D("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${h.toString()}`))}),o.forEach(u=>{r||(yr(i[u].methods,n[u].methods)?yr(i[u].events,n[u].events)||(r=D("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${u}`)):r=D("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${u}`))}),r}function iv(s){const e={};return Object.keys(s).forEach(t=>{var r;t.includes(":")?e[t]=s[t]:(r=s[t].chains)==null||r.forEach(i=>{e[i]={methods:s[t].methods,events:s[t].events}})}),e}function Jl(s){return[...new Set(s.map(e=>e.includes(":")?e.split(":")[0]:e))]}function nv(s){const e={};return Object.keys(s).forEach(t=>{if(t.includes(":"))e[t]=s[t];else{const r=ki(s[t].accounts);r==null||r.forEach(i=>{e[i]={accounts:s[t].accounts.filter(n=>n.includes(`${i}:`)),methods:s[t].methods,events:s[t].events}})}}),e}function ov(s,e){return $c(s,!1)&&s<=e.max&&s>=e.min}function Xl(){const s=$n();return new Promise(e=>{switch(s){case jt.browser:e(av());break;case jt.reactNative:e(cv());break;case jt.node:e(lv());break;default:e(!0)}})}function av(){return kn()&&(navigator==null?void 0:navigator.onLine)}async function cv(){if(or()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo){const s=await(globalThis==null?void 0:globalThis.NetInfo.fetch());return s==null?void 0:s.isConnected}return!0}function lv(){return!0}function dv(s){switch($n()){case jt.browser:uv(s);break;case jt.reactNative:hv(s);break}}function uv(s){!or()&&kn()&&(window.addEventListener("online",()=>s(!0)),window.addEventListener("offline",()=>s(!1)))}function hv(s){or()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo&&(globalThis==null||globalThis.NetInfo.addEventListener(e=>s(e==null?void 0:e.isConnected)))}const fa={};class ji{static get(e){return fa[e]}static set(e,t){fa[e]=t}static delete(e){delete fa[e]}}var pv={};const gh="wc",mh=2,Xa="core",bs=`${gh}@2:${Xa}:`,fv={logger:"error"},gv={database:":memory:"},mv="crypto",Ql="client_ed25519_seed",wv=L.ONE_DAY,yv="keychain",vv="0.3",Ev="messages",bv="0.3",ed=L.SIX_HOURS,_v="publisher",wh="irn",Cv="error",yh="wss://relay.walletconnect.org",Av="relayer",tt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Iv="_subscription",Ft={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Sv=.1,Qa="2.19.2",De={link_mode:"link_mode",relay:"relay"},ho={inbound:"inbound",outbound:"outbound"},Nv="0.3",Tv="WALLETCONNECT_CLIENT_ID",td="WALLETCONNECT_LINK_MODE_APPS",Ut={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Pv="subscription",Rv="0.3",Ov="pairing",xv="0.3",Bi={wc_pairingDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:L.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L.ONE_DAY,prompt:!1,tag:0},res:{ttl:L.ONE_DAY,prompt:!1,tag:0}}},gr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Xt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},kv="history",$v="0.3",Uv="expirer",Gt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Dv="0.3",Lv="verify-api",Mv="https://verify.walletconnect.com",vh="https://verify.walletconnect.org",Qi=vh,jv=`${Qi}/v3`,Bv=[Mv,vh],qv="echo",Fv="https://echo.walletconnect.com",gs={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},xs={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Qt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},cr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},lr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},qi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Wv=.1,Hv="event-client",zv=86400,Vv="https://pulse.walletconnect.org/batch";function Kv(s,e){if(s.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<s.length;i++){var n=s.charAt(i),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=i}var a=s.length,c=s.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function u(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var m=0,w=0,v=0,E=g.length;v!==E&&g[v]===0;)v++,m++;for(var _=(E-v)*d+1>>>0,C=new Uint8Array(_);v!==E;){for(var k=g[v],T=0,P=_-1;(k!==0||T<w)&&P!==-1;P--,T++)k+=256*C[P]>>>0,C[P]=k%a>>>0,k=k/a>>>0;if(k!==0)throw new Error("Non-zero carry");w=T,v++}for(var M=_-w;M!==_&&C[M]===0;)M++;for(var b=c.repeat(m);M<_;++M)b+=s.charAt(C[M]);return b}function h(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var m=0;if(g[m]!==" "){for(var w=0,v=0;g[m]===c;)w++,m++;for(var E=(g.length-m)*l+1>>>0,_=new Uint8Array(E);g[m];){var C=t[g.charCodeAt(m)];if(C===255)return;for(var k=0,T=E-1;(C!==0||k<v)&&T!==-1;T--,k++)C+=a*_[T]>>>0,_[T]=C%256>>>0,C=C/256>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,m++}if(g[m]!==" "){for(var P=E-v;P!==E&&_[P]===0;)P++;for(var M=new Uint8Array(w+(E-P)),b=w;P!==E;)M[b++]=_[P++];return M}}}function f(g){var m=h(g);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:h,decode:f}}var Gv=Kv,Yv=Gv;const Eh=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},Zv=s=>new TextEncoder().encode(s),Jv=s=>new TextDecoder().decode(s);class Xv{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Qv{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bh(this,e)}}class eE{constructor(e){this.decoders=e}or(e){return bh(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const bh=(s,e)=>new eE({...s.decoders||{[s.prefix]:s},...e.decoders||{[e.prefix]:e}});class tE{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new Xv(e,t,r),this.decoder=new Qv(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Vo=({name:s,prefix:e,encode:t,decode:r})=>new tE(s,e,t,r),Bn=({prefix:s,name:e,alphabet:t})=>{const{encode:r,decode:i}=Yv(t,e);return Vo({prefix:s,name:e,encode:r,decode:n=>Eh(i(n))})},sE=(s,e,t,r)=>{const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let n=s.length;for(;s[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,l=0;for(let d=0;d<n;++d){const u=i[s[d]];if(u===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<t|u,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},rE=(s,e,t)=>{const r=e[e.length-1]==="=",i=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<s.length;++c)for(a=a<<8|s[c],o+=8;o>t;)o-=t,n+=e[i&a>>o];if(o&&(n+=e[i&a<<t-o]),r)for(;n.length*t&7;)n+="=";return n},ut=({name:s,prefix:e,bitsPerChar:t,alphabet:r})=>Vo({prefix:e,name:s,encode(i){return rE(i,r,t)},decode(i){return sE(i,r,t,s)}}),iE=Vo({prefix:"\0",name:"identity",encode:s=>Jv(s),decode:s=>Zv(s)});var nE=Object.freeze({__proto__:null,identity:iE});const oE=ut({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var aE=Object.freeze({__proto__:null,base2:oE});const cE=ut({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lE=Object.freeze({__proto__:null,base8:cE});const dE=Bn({prefix:"9",name:"base10",alphabet:"0123456789"});var uE=Object.freeze({__proto__:null,base10:dE});const hE=ut({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),pE=ut({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var fE=Object.freeze({__proto__:null,base16:hE,base16upper:pE});const gE=ut({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mE=ut({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wE=ut({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),yE=ut({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),vE=ut({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),EE=ut({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bE=ut({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),_E=ut({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),CE=ut({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var AE=Object.freeze({__proto__:null,base32:gE,base32upper:mE,base32pad:wE,base32padupper:yE,base32hex:vE,base32hexupper:EE,base32hexpad:bE,base32hexpadupper:_E,base32z:CE});const IE=Bn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),SE=Bn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var NE=Object.freeze({__proto__:null,base36:IE,base36upper:SE});const TE=Bn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),PE=Bn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var RE=Object.freeze({__proto__:null,base58btc:TE,base58flickr:PE});const OE=ut({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xE=ut({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),kE=ut({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$E=ut({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var UE=Object.freeze({__proto__:null,base64:OE,base64pad:xE,base64url:kE,base64urlpad:$E});const _h=Array.from(""),DE=_h.reduce((s,e,t)=>(s[t]=e,s),[]),LE=_h.reduce((s,e,t)=>(s[e.codePointAt(0)]=t,s),[]);function ME(s){return s.reduce((e,t)=>(e+=DE[t],e),"")}function jE(s){const e=[];for(const t of s){const r=LE[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const BE=Vo({prefix:"",name:"base256emoji",encode:ME,decode:jE});var qE=Object.freeze({__proto__:null,base256emoji:BE}),FE=Ch,sd=128,WE=-128,HE=Math.pow(2,31);function Ch(s,e,t){e=e||[],t=t||0;for(var r=t;s>=HE;)e[t++]=s&255|sd,s/=128;for(;s&WE;)e[t++]=s&255|sd,s>>>=7;return e[t]=s|0,Ch.bytes=t-r+1,e}var zE=ec,VE=128,rd=127;function ec(s,r){var t=0,r=r||0,i=0,n=r,o,a=s.length;do{if(n>=a)throw ec.bytes=0,new RangeError("Could not decode varint");o=s[n++],t+=i<28?(o&rd)<<i:(o&rd)*Math.pow(2,i),i+=7}while(o>=VE);return ec.bytes=n-r,t}var KE=Math.pow(2,7),GE=Math.pow(2,14),YE=Math.pow(2,21),ZE=Math.pow(2,28),JE=Math.pow(2,35),XE=Math.pow(2,42),QE=Math.pow(2,49),eb=Math.pow(2,56),tb=Math.pow(2,63),sb=function(s){return s<KE?1:s<GE?2:s<YE?3:s<ZE?4:s<JE?5:s<XE?6:s<QE?7:s<eb?8:s<tb?9:10},rb={encode:FE,decode:zE,encodingLength:sb},Ah=rb;const id=(s,e,t=0)=>(Ah.encode(s,e,t),e),nd=s=>Ah.encodingLength(s),tc=(s,e)=>{const t=e.byteLength,r=nd(s),i=r+nd(t),n=new Uint8Array(i+t);return id(s,n,0),id(t,n,r),n.set(e,i),new ib(s,t,e,n)};class ib{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}const Ih=({name:s,code:e,encode:t})=>new nb(s,e,t);class nb{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?tc(this.code,t):t.then(r=>tc(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Sh=s=>async e=>new Uint8Array(await crypto.subtle.digest(s,e)),ob=Ih({name:"sha2-256",code:18,encode:Sh("SHA-256")}),ab=Ih({name:"sha2-512",code:19,encode:Sh("SHA-512")});var cb=Object.freeze({__proto__:null,sha256:ob,sha512:ab});const Nh=0,lb="identity",Th=Eh,db=s=>tc(Nh,Th(s)),ub={code:Nh,name:lb,encode:Th,digest:db};var hb=Object.freeze({__proto__:null,identity:ub});new TextEncoder,new TextDecoder;const od={...nE,...aE,...lE,...uE,...fE,...AE,...NE,...RE,...UE,...qE};({...cb,...hb});function pb(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(s):new Uint8Array(s)}function Ph(s,e,t,r){return{name:s,prefix:e,encoder:{name:s,prefix:e,encode:t},decoder:{decode:r}}}const ad=Ph("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),ga=Ph("ascii","a",s=>{let e="a";for(let t=0;t<s.length;t++)e+=String.fromCharCode(s[t]);return e},s=>{s=s.substring(1);const e=pb(s.length);for(let t=0;t<s.length;t++)e[t]=s.charCodeAt(t);return e}),fb={utf8:ad,"utf-8":ad,hex:od.base16,latin1:ga,ascii:ga,binary:ga,...od};function gb(s,e="utf8"){const t=fb[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s,"utf8"):t.decoder.decode(`${t.prefix}${s}`)}var mb=Object.defineProperty,wb=(s,e,t)=>e in s?mb(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ps=(s,e,t)=>wb(s,typeof e!="symbol"?e+"":e,t);class yb{constructor(e,t){this.core=e,this.logger=t,ps(this,"keychain",new Map),ps(this,"name",yv),ps(this,"version",vv),ps(this,"initialized",!1),ps(this,"storagePrefix",bs),ps(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),ps(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),ps(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),ps(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:n}=D("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}),ps(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=wt(t,this.name)}get context(){return qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ba(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?qa(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vb=Object.defineProperty,Eb=(s,e,t)=>e in s?vb(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,nt=(s,e,t)=>Eb(s,typeof e!="symbol"?e+"":e,t);class bb{constructor(e,t,r){this.core=e,this.logger=t,nt(this,"name",mv),nt(this,"keychain"),nt(this,"randomSessionIdentifier",Ja()),nt(this,"initialized",!1),nt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),nt(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),nt(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),n=Fc(i);return _p(n.publicKey)}),nt(this,"generateKeyPair",()=>{this.isInitialized();const i=vy();return this.setPrivateKey(i.publicKey,i.privateKey)}),nt(this,"signJWT",async i=>{this.isInitialized();const n=await this.getClientSeed(),o=Fc(n),a=this.randomSessionIdentifier;return await Cp(a,i,wv,o)}),nt(this,"generateSharedKey",(i,n,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=Ey(a,n);return this.setSymKey(c,o)}),nt(this,"setSymKey",async(i,n)=>{this.isInitialized();const o=n||uo(i);return await this.keychain.set(o,i),o}),nt(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),nt(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),nt(this,"encode",async(i,n,o)=>{this.isInitialized();const a=hh(o),c=vc(n);if(Hl(a))return Cy(c,o==null?void 0:o.encoding);if(Wl(a)){const h=a.senderPublicKey,f=a.receiverPublicKey;i=await this.generateSharedKey(h,f)}const l=this.getSymKey(i),{type:d,senderPublicKey:u}=a;return by({type:d,symKey:l,message:c,senderPublicKey:u,encoding:o==null?void 0:o.encoding})}),nt(this,"decode",async(i,n,o)=>{this.isInitialized();const a=Iy(n,o);if(Hl(a)){const c=Ay(n,o==null?void 0:o.encoding);return yo(c)}if(Wl(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;i=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(i),l=_y({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return yo(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),nt(this,"getPayloadType",(i,n=is)=>{const o=fn({encoded:i,encoding:n});return Tr(o.type)}),nt(this,"getPayloadSenderPublicKey",(i,n=is)=>{const o=fn({encoded:i,encoding:n});return o.senderPublicKey?Pt(o.senderPublicKey,vt):void 0}),this.core=e,this.logger=wt(t,this.name),this.keychain=r||new yb(this.core,this.logger)}get context(){return qt(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ql)}catch{e=Ja(),await this.keychain.set(Ql,e)}return gb(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}}var _b=Object.defineProperty,Cb=Object.defineProperties,Ab=Object.getOwnPropertyDescriptors,cd=Object.getOwnPropertySymbols,Ib=Object.prototype.hasOwnProperty,Sb=Object.prototype.propertyIsEnumerable,sc=(s,e,t)=>e in s?_b(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Nb=(s,e)=>{for(var t in e||(e={}))Ib.call(e,t)&&sc(s,t,e[t]);if(cd)for(var t of cd(e))Sb.call(e,t)&&sc(s,t,e[t]);return s},Tb=(s,e)=>Cb(s,Ab(e)),kt=(s,e,t)=>sc(s,typeof e!="symbol"?e+"":e,t);class Pb extends $f{constructor(e,t){super(e,t),this.logger=e,this.core=t,kt(this,"messages",new Map),kt(this,"messagesWithoutClientAck",new Map),kt(this,"name",Ev),kt(this,"version",bv),kt(this,"initialized",!1),kt(this,"storagePrefix",bs),kt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),kt(this,"set",async(r,i,n)=>{this.isInitialized();const o=ws(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),n===ho.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,Tb(Nb({},c),{[o]:i}))}return await this.persist(),o}),kt(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),kt(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const n of r){const o=this.messagesWithoutClientAck.get(n)||{};i[n]=Object.values(o)}return i}),kt(this,"has",(r,i)=>{this.isInitialized();const n=this.get(r),o=ws(i);return typeof n[o]<"u"}),kt(this,"ack",async(r,i)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(r);if(typeof n>"u")return;const o=ws(i);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,n),await this.persist()}),kt(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=wt(e,this.name),this.core=t}get context(){return qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ba(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Ba(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?qa(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?qa(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Rb=Object.defineProperty,Ob=Object.defineProperties,xb=Object.getOwnPropertyDescriptors,ld=Object.getOwnPropertySymbols,kb=Object.prototype.hasOwnProperty,$b=Object.prototype.propertyIsEnumerable,rc=(s,e,t)=>e in s?Rb(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,eo=(s,e)=>{for(var t in e||(e={}))kb.call(e,t)&&rc(s,t,e[t]);if(ld)for(var t of ld(e))$b.call(e,t)&&rc(s,t,e[t]);return s},ma=(s,e)=>Ob(s,xb(e)),es=(s,e,t)=>rc(s,typeof e!="symbol"?e+"":e,t);class Ub extends Uf{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,es(this,"events",new kr.EventEmitter),es(this,"name",_v),es(this,"queue",new Map),es(this,"publishTimeout",L.toMiliseconds(L.ONE_MINUTE)),es(this,"initialPublishTimeout",L.toMiliseconds(L.ONE_SECOND*15)),es(this,"needsTransportRestart",!1),es(this,"publish",async(r,i,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:n}});const a=(n==null?void 0:n.ttl)||ed,c=Co(n),l=(n==null?void 0:n.prompt)||!1,d=(n==null?void 0:n.tag)||0,u=(n==null?void 0:n.id)||oi().toString(),h={topic:r,message:i,opts:{ttl:a,relay:c,prompt:l,tag:d,id:u,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},f=`Failed to publish payload, please try again. id:${u} tag:${d}`;try{const g=new Promise(async m=>{const w=({id:E})=>{h.opts.id===E&&(this.removeRequestFromQueue(E),this.relayer.events.removeListener(tt.publish,w),m(h))};this.relayer.events.on(tt.publish,w);const v=Js(new Promise((E,_)=>{this.rpcPublish({topic:r,message:i,ttl:a,prompt:l,tag:d,id:u,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(E).catch(C=>{this.logger.warn(C,C==null?void 0:C.message),_(C)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${u} tag:${d}`);try{await v,this.events.removeListener(tt.publish,w)}catch(E){this.queue.set(u,ma(eo({},h),{attempt:1})),this.logger.warn(E,E==null?void 0:E.message)}});this.logger.trace({type:"method",method:"publish",params:{id:u,topic:r,message:i,opts:n}}),await Js(g,this.publishTimeout,f)}catch(g){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(g),(o=n==null?void 0:n.internal)!=null&&o.throwOnFailedPublish)throw g}finally{this.queue.delete(u)}}),es(this,"on",(r,i)=>{this.events.on(r,i)}),es(this,"once",(r,i)=>{this.events.once(r,i)}),es(this,"off",(r,i)=>{this.events.off(r,i)}),es(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=wt(t,this.name),this.registerEventListeners()}get context(){return qt(this.logger)}async rpcPublish(e){var t,r,i,n;const{topic:o,message:a,ttl:c=ed,prompt:l,tag:d,id:u,attestation:h,tvf:f}=e,g={method:Gi(Co().protocol).publish,params:eo({topic:o,message:a,ttl:c,prompt:l,tag:d,attestation:h},f),id:u};ct((t=g.params)==null?void 0:t.prompt)&&((r=g.params)==null||delete r.prompt),ct((i=g.params)==null?void 0:i.tag)&&((n=g.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:g});const m=await this.relayer.request(g);return this.relayer.events.emit(tt.publish,e),this.logger.debug("Successfully Published Payload"),m}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const r=e.attempt+1;this.queue.set(t,ma(eo({},e),{attempt:r}));const{topic:i,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${r}`),await this.rpcPublish(ma(eo({},e),{topic:i,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(On.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(tt.connection_stalled);return}this.checkQueue()}),this.relayer.on(tt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var Db=Object.defineProperty,Lb=(s,e,t)=>e in s?Db(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Fr=(s,e,t)=>Lb(s,typeof e!="symbol"?e+"":e,t);class Mb{constructor(){Fr(this,"map",new Map),Fr(this,"set",(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])}),Fr(this,"get",e=>this.map.get(e)||[]),Fr(this,"exists",(e,t)=>this.get(e).includes(t)),Fr(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const i=r.filter(n=>n!==t);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Fr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var jb=Object.defineProperty,Bb=Object.defineProperties,qb=Object.getOwnPropertyDescriptors,dd=Object.getOwnPropertySymbols,Fb=Object.prototype.hasOwnProperty,Wb=Object.prototype.propertyIsEnumerable,ic=(s,e,t)=>e in s?jb(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Fi=(s,e)=>{for(var t in e||(e={}))Fb.call(e,t)&&ic(s,t,e[t]);if(dd)for(var t of dd(e))Wb.call(e,t)&&ic(s,t,e[t]);return s},wa=(s,e)=>Bb(s,qb(e)),Pe=(s,e,t)=>ic(s,typeof e!="symbol"?e+"":e,t);class Hb extends Mf{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Pe(this,"subscriptions",new Map),Pe(this,"topicMap",new Mb),Pe(this,"events",new kr.EventEmitter),Pe(this,"name",Pv),Pe(this,"version",Rv),Pe(this,"pending",new Map),Pe(this,"cached",[]),Pe(this,"initialized",!1),Pe(this,"storagePrefix",bs),Pe(this,"subscribeTimeout",L.toMiliseconds(L.ONE_MINUTE)),Pe(this,"initialSubscribeTimeout",L.toMiliseconds(L.ONE_SECOND*15)),Pe(this,"clientId"),Pe(this,"batchSubscribeTopicsLimit",500),Pe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Pe(this,"subscribe",async(r,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const n=Co(i),o={topic:r,relay:n,transportType:i==null?void 0:i.transportType};this.pending.set(r,o);const a=await this.rpcSubscribe(r,n,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),Pe(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),Pe(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),Pe(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(n=>n.topic===r))})),Pe(this,"on",(r,i)=>{this.events.on(r,i)}),Pe(this,"once",(r,i)=>{this.events.once(r,i)}),Pe(this,"off",(r,i)=>{this.events.off(r,i)}),Pe(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),Pe(this,"start",async()=>{await this.onConnect()}),Pe(this,"stop",async()=>{await this.onDisconnect()}),Pe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Pe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),Pe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(On.pulse,async()=>{await this.checkPending()}),this.events.on(Ut.created,async r=>{const i=Ut.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Ut.deleted,async r=>{const i=Ut.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=wt(t,this.name),this.clientId=""}get context(){return qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const i=Co(r);await this.restartToComplete({topic:e,id:t,relay:i}),await this.rpcUnsubscribe(e,t,i);const n=Te("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,t,r){var i;(!r||(r==null?void 0:r.transportType)===De.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:Gi(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((r==null?void 0:r.transportType)===De.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(d=>this.logger.warn(d))},L.toMiliseconds(L.ONE_SECOND)),a;const c=new Promise(async d=>{const u=h=>{h.topic===e&&(this.events.removeListener(Ut.created,u),d(h.id))};this.events.on(Ut.created,u);try{const h=await Js(new Promise((f,g)=>{this.relayer.request(n).catch(m=>{this.logger.warn(m,m==null?void 0:m.message),g(m)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ut.created,u),d(h)}catch{}}),l=await Js(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return l?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(tt.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,r={method:Gi(t.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Js(new Promise(i=>{this.relayer.request(r).catch(n=>this.logger.warn(n)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(tt.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,r={method:Gi(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await Js(new Promise((n,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(tt.connection_stalled)}return i}rpcUnsubscribe(e,t,r){const i={method:Gi(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,t){this.setSubscription(e,wa(Fi({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Fi({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Fi({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ut.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:r}=D("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Ut.deleted,wa(Fi({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ut.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Ut.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=D("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>wa(Fi({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await om(L.toMiliseconds(L.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return ws(e+await this.getClientId())}}var zb=Object.defineProperty,ud=Object.getOwnPropertySymbols,Vb=Object.prototype.hasOwnProperty,Kb=Object.prototype.propertyIsEnumerable,nc=(s,e,t)=>e in s?zb(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,hd=(s,e)=>{for(var t in e||(e={}))Vb.call(e,t)&&nc(s,t,e[t]);if(ud)for(var t of ud(e))Kb.call(e,t)&&nc(s,t,e[t]);return s},ye=(s,e,t)=>nc(s,typeof e!="symbol"?e+"":e,t);class Gb extends Df{constructor(e){super(e),ye(this,"protocol","wc"),ye(this,"version",2),ye(this,"core"),ye(this,"logger"),ye(this,"events",new kr.EventEmitter),ye(this,"provider"),ye(this,"messages"),ye(this,"subscriber"),ye(this,"publisher"),ye(this,"name",Av),ye(this,"transportExplicitlyClosed",!1),ye(this,"initialized",!1),ye(this,"connectionAttemptInProgress",!1),ye(this,"relayUrl"),ye(this,"projectId"),ye(this,"packageName"),ye(this,"bundleId"),ye(this,"hasExperiencedNetworkDisruption",!1),ye(this,"pingTimeout"),ye(this,"heartBeatTimeout",L.toMiliseconds(L.THIRTY_SECONDS+L.FIVE_SECONDS)),ye(this,"reconnectTimeout"),ye(this,"connectPromise"),ye(this,"reconnectInProgress",!1),ye(this,"requestsInFlight",[]),ye(this,"connectTimeout",L.toMiliseconds(L.ONE_SECOND*15)),ye(this,"request",async t=>{var r,i;this.logger.debug("Publishing Request Payload");const n=t.id||oi().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(r=t.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${n}:${((i=t.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),ye(this,"resetPingTimeout",()=>{bo()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,r,i,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(i=(r=(t=this.provider)==null?void 0:t.connection)==null?void 0:r.socket)==null?void 0:i.terminate)==null||n.call(i)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),ye(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),ye(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(tt.connect)}),ye(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),ye(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(tt.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ye(this,"registerProviderListeners",()=>{this.provider.on(Ft.payload,this.onPayloadHandler),this.provider.on(Ft.connect,this.onConnectHandler),this.provider.on(Ft.disconnect,this.onDisconnectHandler),this.provider.on(Ft.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?wt(e.logger,this.name):bc(Ni({level:e.logger||Cv})),this.messages=new Pb(this.logger,e.core),this.subscriber=new Hb(this,this.logger),this.publisher=new Ub(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||yh,this.projectId=e.projectId,Hg()?this.packageName=pl():zg()&&(this.bundleId=pl()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return qt(this.logger)}get connected(){var e,t,r;return((r=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,t,r;return((r=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:De.relay},ho.outbound)}async subscribe(e,t){var r,i,n;this.isInitialized(),(!(t!=null&&t.transportType)||(t==null?void 0:t.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((r=t==null?void 0:t.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=t==null?void 0:t.internal)==null?void 0:i.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=d=>{d.topic===e&&(this.subscriber.off(Ut.created,l),c())};return await Promise.all([new Promise(d=>{c=d,this.subscriber.on(Ut.created,l)}),new Promise(async(d,u)=>{a=await this.subscriber.subscribe(e,hd({internal:{throwOnFailedPublish:o}},t)).catch(h=>{o&&u(h)})||a,d()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Js(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,r)=>{await this.connect(e).then(t).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Xl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const r of t)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:r}=e;if(!t.sessionExists){const i=Ye(L.FIVE_MINUTES),n={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,n)}this.events.emit(tt.message,e),await this.recordMessageEvent(e,ho.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(r,i)=>{const n=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ft.disconnect,n),await Js(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(Ft.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ft.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Ft.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(r=>setTimeout(r,L.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,r,i,n;if(bo())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Zt(new bp(Zg({sdkVersion:Qa,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:r,message:i}=e;await this.messages.set(r,i,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const i=this.messages.has(t,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),_c(e)){if(!e.method.endsWith(Iv))return;const t=e.params,{topic:r,message:i,publishedAt:n,attestation:o}=t.data,a={topic:r,message:i,publishedAt:n,transportType:De.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(hd({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Cc(e)&&this.events.emit(tt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,ho.inbound),this.events.emit(tt.message,e))}async acknowledgePayload(e){const t=Lo(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Ft.payload,this.onPayloadHandler),this.provider.off(Ft.connect,this.onConnectHandler),this.provider.off(Ft.disconnect,this.onDisconnectHandler),this.provider.off(Ft.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Xl();dv(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(r=>this.logger.error(r,r==null?void 0:r.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(tt.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},L.toMiliseconds(Sv)))))}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function Yb(){}function pd(s){if(!s||typeof s!="object")return!1;const e=Object.getPrototypeOf(s);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(s)==="[object Object]":!1}function fd(s){return Object.getOwnPropertySymbols(s).filter(e=>Object.prototype.propertyIsEnumerable.call(s,e))}function gd(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}const Zb="[object RegExp]",Jb="[object String]",Xb="[object Number]",Qb="[object Boolean]",md="[object Arguments]",e_="[object Symbol]",t_="[object Date]",s_="[object Map]",r_="[object Set]",i_="[object Array]",n_="[object Function]",o_="[object ArrayBuffer]",ya="[object Object]",a_="[object Error]",c_="[object DataView]",l_="[object Uint8Array]",d_="[object Uint8ClampedArray]",u_="[object Uint16Array]",h_="[object Uint32Array]",p_="[object BigUint64Array]",f_="[object Int8Array]",g_="[object Int16Array]",m_="[object Int32Array]",w_="[object BigInt64Array]",y_="[object Float32Array]",v_="[object Float64Array]";function E_(s,e){return s===e||Number.isNaN(s)&&Number.isNaN(e)}function b_(s,e,t){return Zi(s,e,void 0,void 0,void 0,void 0,t)}function Zi(s,e,t,r,i,n,o){const a=o(s,e,t,r,i,n);if(a!==void 0)return a;if(typeof s==typeof e)switch(typeof s){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return s===e;case"number":return s===e||Object.is(s,e);case"function":return s===e;case"object":return en(s,e,n,o)}return en(s,e,n,o)}function en(s,e,t,r){if(Object.is(s,e))return!0;let i=gd(s),n=gd(e);if(i===md&&(i=ya),n===md&&(n=ya),i!==n)return!1;switch(i){case Jb:return s.toString()===e.toString();case Xb:{const c=s.valueOf(),l=e.valueOf();return E_(c,l)}case Qb:case t_:case e_:return Object.is(s.valueOf(),e.valueOf());case Zb:return s.source===e.source&&s.flags===e.flags;case n_:return s===e}t=t??new Map;const o=t.get(s),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(s,e),t.set(e,s);try{switch(i){case s_:{if(s.size!==e.size)return!1;for(const[c,l]of s.entries())if(!e.has(c)||!Zi(l,e.get(c),c,s,e,t,r))return!1;return!0}case r_:{if(s.size!==e.size)return!1;const c=Array.from(s.values()),l=Array.from(e.values());for(let d=0;d<c.length;d++){const u=c[d],h=l.findIndex(f=>Zi(u,f,void 0,s,e,t,r));if(h===-1)return!1;l.splice(h,1)}return!0}case i_:case l_:case d_:case u_:case h_:case p_:case f_:case g_:case m_:case w_:case y_:case v_:{if(typeof gt.Buffer<"u"&&gt.Buffer.isBuffer(s)!==gt.Buffer.isBuffer(e)||s.length!==e.length)return!1;for(let c=0;c<s.length;c++)if(!Zi(s[c],e[c],c,s,e,t,r))return!1;return!0}case o_:return s.byteLength!==e.byteLength?!1:en(new Uint8Array(s),new Uint8Array(e),t,r);case c_:return s.byteLength!==e.byteLength||s.byteOffset!==e.byteOffset?!1:en(new Uint8Array(s),new Uint8Array(e),t,r);case a_:return s.name===e.name&&s.message===e.message;case ya:{if(!(en(s.constructor,e.constructor,t,r)||pd(s)&&pd(e)))return!1;const c=[...Object.keys(s),...fd(s)],l=[...Object.keys(e),...fd(e)];if(c.length!==l.length)return!1;for(let d=0;d<c.length;d++){const u=c[d],h=s[u];if(!Object.hasOwn(e,u))return!1;const f=e[u];if(!Zi(h,f,u,s,e,t,r))return!1}return!0}default:return!1}}finally{t.delete(s),t.delete(e)}}function __(s,e){return b_(s,e,Yb)}var C_=Object.defineProperty,wd=Object.getOwnPropertySymbols,A_=Object.prototype.hasOwnProperty,I_=Object.prototype.propertyIsEnumerable,oc=(s,e,t)=>e in s?C_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,yd=(s,e)=>{for(var t in e||(e={}))A_.call(e,t)&&oc(s,t,e[t]);if(wd)for(var t of wd(e))I_.call(e,t)&&oc(s,t,e[t]);return s},_t=(s,e,t)=>oc(s,typeof e!="symbol"?e+"":e,t);class Lr extends Lf{constructor(e,t,r,i=bs,n=void 0){super(e,t,r,i),this.core=e,this.logger=t,this.name=r,_t(this,"map",new Map),_t(this,"version",Nv),_t(this,"cached",[]),_t(this,"initialized",!1),_t(this,"getKey"),_t(this,"storagePrefix",bs),_t(this,"recentlyDeleted",[]),_t(this,"recentlyDeletedLimit",200),_t(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!ct(o)?this.map.set(this.getKey(o),o):qy(o)?this.map.set(o.id,o):Fy(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),_t(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),_t(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),_t(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>__(a[c],o[c]))):this.values)),_t(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=yd(yd({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),_t(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=wt(t,this.name),this.storagePrefix=i,this.getKey=n}get context(){return qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:i}=D("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:r}=D("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=D("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}}var S_=Object.defineProperty,N_=(s,e,t)=>e in s?S_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,fe=(s,e,t)=>N_(s,typeof e!="symbol"?e+"":e,t);class T_{constructor(e,t){this.core=e,this.logger=t,fe(this,"name",Ov),fe(this,"version",xv),fe(this,"events",new Ac),fe(this,"pairings"),fe(this,"initialized",!1),fe(this,"storagePrefix",bs),fe(this,"ignoredPayloadTypes",[Ms]),fe(this,"registeredMethods",[]),fe(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),fe(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),fe(this,"create",async r=>{this.isInitialized();const i=Ja(),n=await this.core.crypto.setSymKey(i),o=Ye(L.FIVE_MINUTES),a={protocol:wh},c={topic:n,expiry:o,relay:a,active:!1,methods:r==null?void 0:r.methods},l=Vl({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:a,expiryTimestamp:o,methods:r==null?void 0:r.methods});return this.events.emit(gr.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:r==null?void 0:r.transportType}),{topic:n,uri:l}}),fe(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r==null?void 0:r.uri,trace:[gs.pairing_started]}});this.isValidPair(r,i);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=zl(r.uri);i.props.properties.topic=n,i.addTrace(gs.pairing_uri_validation_success),i.addTrace(gs.pairing_uri_not_expired);let d;if(this.pairings.keys.includes(n)){if(d=this.pairings.get(n),i.addTrace(gs.existing_pairing),d.active)throw i.setError(xs.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);i.addTrace(gs.pairing_not_expired)}const u=c||Ye(L.FIVE_MINUTES),h={topic:n,relay:a,expiry:u,active:!1,methods:l};this.core.expirer.set(n,u),await this.pairings.set(n,h),i.addTrace(gs.store_new_pairing),r.activatePairing&&await this.activate({topic:n}),this.events.emit(gr.create,h),i.addTrace(gs.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),i.addTrace(gs.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(xs.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw i.setError(xs.subscribe_pairing_topic_failure),f}return i.addTrace(gs.subscribe_pairing_topic_success),h}),fe(this,"activate",async({topic:r})=>{this.isInitialized();const i=Ye(L.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),fe(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const n=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=hr();this.events.once(Ce("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),fe(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),fe(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),fe(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),fe(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Te("USER_DISCONNECTED")),await this.deletePairing(i))}),fe(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:n,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return Vl({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),fe(this,"sendRequest",async(r,i,n)=>{const o=wr(i,n),a=await this.core.crypto.encode(r,o),c=Bi[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),fe(this,"sendResult",async(r,i,n)=>{const o=Lo(r,n),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=Bi[c].res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),fe(this,"sendError",async(r,i,n)=>{const o=uu(r,n),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=Bi[c]?Bi[c].res:Bi.unregistered_method.res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),fe(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Te("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),fe(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>Ks(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),fe(this,"onRelayEventRequest",async r=>{const{topic:i,payload:n}=r;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,n);default:return await this.onUnknownRpcMethodRequest(i,n)}}),fe(this,"onRelayEventResponse",async r=>{const{topic:i,payload:n}=r,o=(await this.core.history.get(i,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,n);default:return this.onUnknownRpcMethodResponse(o)}}),fe(this,"onPairingPingRequest",async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.events.emit(gr.ping,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),fe(this,"onPairingPingResponse",(r,i)=>{const{id:n}=i;setTimeout(()=>{Os(i)?this.events.emit(Ce("pairing_ping",n),{}):ms(i)&&this.events.emit(Ce("pairing_ping",n),{error:i.error})},500)}),fe(this,"onPairingDeleteRequest",async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(gr.delete,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),fe(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:n,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Te("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,r,a),this.logger.error(a)}catch(a){await this.sendError(n,r,a),this.logger.error(a)}}),fe(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(Te("WC_METHOD_UNSUPPORTED",r))}),fe(this,"isValidPair",(r,i)=>{var n;if(!St(r)){const{message:a}=D("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(xs.malformed_pairing_uri),new Error(a)}if(!By(r.uri)){const{message:a}=D("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(xs.malformed_pairing_uri),new Error(a)}const o=zl(r==null?void 0:r.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=D("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(xs.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=D("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(xs.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&L.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError(xs.pairing_expired);const{message:a}=D("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),fe(this,"isValidPing",async r=>{if(!St(r)){const{message:n}=D("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidPairingTopic(i)}),fe(this,"isValidDisconnect",async r=>{if(!St(r)){const{message:n}=D("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidPairingTopic(i)}),fe(this,"isValidPairingTopic",async r=>{if(!ze(r,!1)){const{message:i}=D("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=D("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Ks(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=D("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=wt(t,this.name),this.pairings=new Lr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return qt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(tt.message,async e=>{const{topic:t,message:r,transportType:i}=e;if(this.pairings.keys.includes(t)&&i!==De.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const n=await this.core.crypto.decode(t,r);_c(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):Cc(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,r)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(Gt.expired,async e=>{const{topic:t}=ku(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(gr.expire,{topic:t}))})}}var P_=Object.defineProperty,R_=(s,e,t)=>e in s?P_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ot=(s,e,t)=>R_(s,typeof e!="symbol"?e+"":e,t);class O_ extends kf{constructor(e,t){super(e,t),this.core=e,this.logger=t,ot(this,"records",new Map),ot(this,"events",new kr.EventEmitter),ot(this,"name",kv),ot(this,"version",$v),ot(this,"cached",[]),ot(this,"initialized",!1),ot(this,"storagePrefix",bs),ot(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),ot(this,"set",(r,i,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:n}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:n,expiry:Ye(L.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Xt.created,o)}),ot(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=ms(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(Xt.updated,i))}),ot(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),ot(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(n=>{if(n.topic===r){if(typeof i<"u"&&n.id!==i)return;this.records.delete(n.id),this.events.emit(Xt.deleted,n)}}),this.persist()}),ot(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),ot(this,"on",(r,i)=>{this.events.on(r,i)}),ot(this,"once",(r,i)=>{this.events.once(r,i)}),ot(this,"off",(r,i)=>{this.events.off(r,i)}),ot(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=wt(t,this.name)}get context(){return qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:wr(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:r}=D("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Xt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=D("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Xt.created,e=>{const t=Xt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Xt.updated,e=>{const t=Xt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Xt.deleted,e=>{const t=Xt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(On.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{L.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(Xt.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}}var x_=Object.defineProperty,k_=(s,e,t)=>e in s?x_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,pt=(s,e,t)=>k_(s,typeof e!="symbol"?e+"":e,t);class $_ extends jf{constructor(e,t){super(e,t),this.core=e,this.logger=t,pt(this,"expirations",new Map),pt(this,"events",new kr.EventEmitter),pt(this,"name",Uv),pt(this,"version",Dv),pt(this,"cached",[]),pt(this,"initialized",!1),pt(this,"storagePrefix",bs),pt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),pt(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),pt(this,"set",(r,i)=>{this.isInitialized();const n=this.formatTarget(r),o={target:n,expiry:i};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(Gt.created,{target:n,expiration:o})}),pt(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),pt(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),n=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Gt.deleted,{target:i,expiration:n})}}),pt(this,"on",(r,i)=>{this.events.on(r,i)}),pt(this,"once",(r,i)=>{this.events.once(r,i)}),pt(this,"off",(r,i)=>{this.events.off(r,i)}),pt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=wt(t,this.name)}get context(){return qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Jg(e);if(typeof e=="number")return Xg(e);const{message:t}=D("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Gt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=D("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:r}=D("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return t}checkExpiry(e,t){const{expiry:r}=t;L.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Gt.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(On.pulse,()=>this.checkExpirations()),this.events.on(Gt.created,e=>{const t=Gt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Gt.expired,e=>{const t=Gt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Gt.deleted,e=>{const t=Gt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}}var U_=Object.defineProperty,D_=(s,e,t)=>e in s?U_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,He=(s,e,t)=>D_(s,typeof e!="symbol"?e+"":e,t);class L_ extends Bf{constructor(e,t,r){super(e,t,r),this.core=e,this.logger=t,this.store=r,He(this,"name",Lv),He(this,"abortController"),He(this,"isDevEnv"),He(this,"verifyUrlV3",jv),He(this,"storagePrefix",bs),He(this,"version",mh),He(this,"publicKey"),He(this,"fetchPromise"),He(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&L.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),He(this,"register",async i=>{if(!kn()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=Cr.getDocument(),d=this.startAbortTimer(L.ONE_SECOND*5),u=await new Promise((h,f)=>{const g=()=>{window.removeEventListener("message",w),l.body.removeChild(m),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const m=l.createElement("iframe");m.src=c,m.style.display="none",m.addEventListener("error",g,{signal:this.abortController.signal});const w=v=>{if(v.data&&typeof v.data=="string")try{const E=JSON.parse(v.data);if(E.type==="verify_attestation"){if(Ua(E.attestation).payload.id!==o)return;clearInterval(d),l.body.removeChild(m),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",w),h(E.attestation===null?"":E.attestation)}}catch(E){this.logger.warn(E)}};l.body.appendChild(m),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",u),u}catch(l){this.logger.warn(l)}return""}),He(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=i;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Ua(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),He(this,"fetchAttestation",async(i,n)=>{this.logger.debug(`resolving attestation: ${i} from url: ${n}`);const o=this.startAbortTimer(L.ONE_SECOND*5),a=await fetch(`${n}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),He(this,"getVerifyUrl",i=>{let n=i||Qi;return Bv.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Qi}`),n=Qi),n}),He(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(L.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await n.json()}catch(i){this.logger.warn(i)}}),He(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),He(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),He(this,"isValidJwtAttestation",async i=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(i,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),He(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),He(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),He(this,"validateAttestation",(i,n)=>{const o=Ny(i,n.publicKey),a={hasExpired:L.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=wt(t,this.name),this.abortController=new AbortController,this.isDevEnv=Sc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return qt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),L.toMiliseconds(e))}}var M_=Object.defineProperty,j_=(s,e,t)=>e in s?M_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,vd=(s,e,t)=>j_(s,typeof e!="symbol"?e+"":e,t);class B_ extends qf{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,vd(this,"context",qv),vd(this,"registerDeviceToken",async r=>{const{clientId:i,token:n,notificationType:o,enableEncrypted:a=!1}=r,c=`${Fv}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:n,always_raw:a})})}),this.logger=wt(t,this.context)}}var q_=Object.defineProperty,Ed=Object.getOwnPropertySymbols,F_=Object.prototype.hasOwnProperty,W_=Object.prototype.propertyIsEnumerable,ac=(s,e,t)=>e in s?q_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Wi=(s,e)=>{for(var t in e||(e={}))F_.call(e,t)&&ac(s,t,e[t]);if(Ed)for(var t of Ed(e))W_.call(e,t)&&ac(s,t,e[t]);return s},Je=(s,e,t)=>ac(s,typeof e!="symbol"?e+"":e,t);class H_ extends Ff{constructor(e,t,r=!0){super(e,t,r),this.core=e,this.logger=t,Je(this,"context",Hv),Je(this,"storagePrefix",bs),Je(this,"storageVersion",Wv),Je(this,"events",new Map),Je(this,"shouldPersist",!1),Je(this,"init",async()=>{if(!Sc())try{const i={eventId:gl(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Ou(this.core.relayer.protocol,this.core.relayer.version,Qa)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Je(this,"createEvent",i=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=i,l=gl(),d=this.core.projectId||"",u=Date.now(),h=Wi({eventId:l,timestamp:u,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:d,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,h),this.shouldPersist=!0),h}),Je(this,"getEvent",i=>{const{eventId:n,topic:o}=i;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Wi(Wi({},a),this.setMethods(a.eventId))}),Je(this,"deleteEvent",i=>{const{eventId:n}=i;this.events.delete(n),this.shouldPersist=!0}),Je(this,"setEventListeners",()=>{this.core.heartbeat.on(On.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{L.fromMiliseconds(Date.now())-L.fromMiliseconds(i.timestamp)>zv&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Je(this,"setMethods",i=>({addTrace:n=>this.addTrace(i,n),setError:n=>this.setError(i,n)})),Je(this,"addTrace",(i,n)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(n),this.events.set(i,o),this.shouldPersist=!0)}),Je(this,"setError",(i,n)=>{const o=this.events.get(i);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Je(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Je(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(n=>{this.events.set(n.eventId,Wi(Wi({},n),this.setMethods(n.eventId)))})}catch(i){this.logger.warn(i)}}),Je(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[n,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const n of i)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),Je(this,"sendEvent",async i=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Vv}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Qa}${n}`,{method:"POST",body:JSON.stringify(i)})}),Je(this,"getAppDomain",()=>Ru().url),this.logger=wt(t,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var z_=Object.defineProperty,bd=Object.getOwnPropertySymbols,V_=Object.prototype.hasOwnProperty,K_=Object.prototype.propertyIsEnumerable,cc=(s,e,t)=>e in s?z_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_d=(s,e)=>{for(var t in e||(e={}))V_.call(e,t)&&cc(s,t,e[t]);if(bd)for(var t of bd(e))K_.call(e,t)&&cc(s,t,e[t]);return s},xe=(s,e,t)=>cc(s,typeof e!="symbol"?e+"":e,t);let G_=class Rh extends Pf{constructor(e){var t;super(e),xe(this,"protocol",gh),xe(this,"version",mh),xe(this,"name",Xa),xe(this,"relayUrl"),xe(this,"projectId"),xe(this,"customStoragePrefix"),xe(this,"events",new kr.EventEmitter),xe(this,"logger"),xe(this,"heartbeat"),xe(this,"relayer"),xe(this,"crypto"),xe(this,"storage"),xe(this,"history"),xe(this,"expirer"),xe(this,"pairing"),xe(this,"verify"),xe(this,"echoClient"),xe(this,"linkModeSupportedApps"),xe(this,"eventClient"),xe(this,"initialized",!1),xe(this,"logChunkController"),xe(this,"on",(a,c)=>this.events.on(a,c)),xe(this,"once",(a,c)=>this.events.once(a,c)),xe(this,"off",(a,c)=>this.events.off(a,c)),xe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),xe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const d={topic:a,message:c,publishedAt:Date.now(),transportType:De.link_mode};this.relayer.onLinkMessageEvent(d,{sessionExists:l})});const r=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||yh,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Ni({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:fv.logger,name:Xa}),{logger:n,chunkLoggerController:o}=Ec({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=wt(n,this.name),this.heartbeat=new Ep,this.crypto=new bb(this,this.logger,e==null?void 0:e.keychain),this.history=new O_(this,this.logger),this.expirer=new $_(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Sf(_d(_d({},gv),e==null?void 0:e.storageOptions)),this.relayer=new Gb({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new T_(this,this.logger),this.verify=new L_(this,this.logger,this.storage),this.echoClient=new B_(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new H_(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new Rh(e);await t.initialize();const r=await t.crypto.getClientId();return await t.storage.setItem(Tv,r),t}get context(){return qt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(td,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(td)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,r=`${t}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof os<"u"&&pv.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const Y_=G_,Oh="wc",xh=2,kh="client",Uc=`${Oh}@${xh}:${kh}:`,va={name:kh,logger:"error"},Cd="WALLETCONNECT_DEEPLINK_CHOICE",Z_="proposal",Ad="Proposal expired",J_="session",Wr=L.SEVEN_DAYS,X_="engine",Xe={wc_sessionPropose:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1104},res:{ttl:L.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1106},res:{ttl:L.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1112},res:{ttl:L.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1114},res:{ttl:L.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:L.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:L.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1119}}},Ea={min:L.FIVE_MINUTES,max:L.SEVEN_DAYS},fs={idle:"IDLE",active:"ACTIVE"},Id={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},Q_="request",eC=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],tC="wc",sC="auth",rC="authKeys",iC="pairingTopics",nC="requests",Ko=`${tC}@${1.5}:${sC}:`,po=`${Ko}:PUB_KEY`;var oC=Object.defineProperty,aC=Object.defineProperties,cC=Object.getOwnPropertyDescriptors,Sd=Object.getOwnPropertySymbols,lC=Object.prototype.hasOwnProperty,dC=Object.prototype.propertyIsEnumerable,lc=(s,e,t)=>e in s?oC(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Re=(s,e)=>{for(var t in e||(e={}))lC.call(e,t)&&lc(s,t,e[t]);if(Sd)for(var t of Sd(e))dC.call(e,t)&&lc(s,t,e[t]);return s},yt=(s,e)=>aC(s,cC(e)),S=(s,e,t)=>lc(s,typeof e!="symbol"?e+"":e,t);class uC extends Vf{constructor(e){super(e),S(this,"name",X_),S(this,"events",new Ac),S(this,"initialized",!1),S(this,"requestQueue",{state:fs.idle,queue:[]}),S(this,"sessionRequestQueue",{state:fs.idle,queue:[]}),S(this,"requestQueueDelay",L.ONE_SECOND),S(this,"expectedPairingMethodMap",new Map),S(this,"recentlyDeletedMap",new Map),S(this,"recentlyDeletedLimit",200),S(this,"relayMessageCache",[]),S(this,"pendingSessions",new Map),S(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Xe)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay)))}),S(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=yt(Re({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=r;let d=i,u,h=!1;try{if(d){const T=this.client.core.pairing.pairings.get(d);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),h=T.active}}catch(T){throw this.client.logger.error(`connect() -> pairing.get(${d}) failed`),T}if(!d||!h){const{topic:T,uri:P}=await this.client.core.pairing.create();d=T,u=P}if(!d){const{message:T}=D("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(T)}const f=await this.client.core.crypto.generateKeyPair(),g=Xe.wc_sessionPropose.req.ttl||L.FIVE_MINUTES,m=Ye(g),w=yt(Re(Re({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:wh}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:d},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:qs()}),v=Ce("session_connect",w.id),{reject:E,resolve:_,done:C}=hr(g,Ad),k=({id:T})=>{T===w.id&&(this.client.events.off("proposal_expire",k),this.pendingSessions.delete(w.id),this.events.emit(v,{error:{message:Ad,code:0}}))};return this.client.events.on("proposal_expire",k),this.events.once(v,({error:T,session:P})=>{this.client.events.off("proposal_expire",k),T?E(T):P&&_(P)}),await this.sendRequest({topic:d,method:"wc_sessionPropose",params:w,throwOnFailedPublish:!0,clientRpcId:w.id}),await this.setProposal(w.id,w),{uri:u,approval:C}}),S(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(r){throw this.client.logger.error("pair() failed"),r}}),S(this,"approve",async t=>{var r,i,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=t==null?void 0:t.id)==null?void 0:r.toString(),trace:[Qt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(b){throw o.setError(cr.no_internet_connection),b}try{await this.isValidProposalId(t==null?void 0:t.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${t==null?void 0:t.id}) failed`),o.setError(cr.proposal_not_found),b}try{await this.isValidApprove(t)}catch(b){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(cr.session_approve_namespace_validation_failure),b}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:d,scopedProperties:u,sessionConfig:h}=t,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:m,requiredNamespaces:w,optionalNamespaces:v}=f;let E=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:g});E||(E=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Qt.session_approve_started,properties:{topic:g,trace:[Qt.session_approve_started,Qt.session_namespaces_validation_success]}}));const _=await this.client.core.crypto.generateKeyPair(),C=m.publicKey,k=await this.client.core.crypto.generateSharedKey(_,C),T=Re(Re(Re({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:_,metadata:this.client.metadata},expiry:Ye(Wr)},d&&{sessionProperties:d}),u&&{scopedProperties:u}),h&&{sessionConfig:h}),P=De.relay;E.addTrace(Qt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(k,{transportType:P})}catch(b){throw E.setError(cr.subscribe_session_topic_failure),b}E.addTrace(Qt.subscribe_session_topic_success);const M=yt(Re({},T),{topic:k,requiredNamespaces:w,optionalNamespaces:v,pairingTopic:g,acknowledged:!1,self:T.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:_,transportType:De.relay});await this.client.session.set(k,M),E.addTrace(Qt.store_session);try{E.addTrace(Qt.publishing_session_settle),await this.sendRequest({topic:k,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0}).catch(b=>{throw E==null||E.setError(cr.session_settle_publish_failure),b}),E.addTrace(Qt.session_settle_publish_success),E.addTrace(Qt.publishing_session_approve),await this.sendResult({id:a,topic:g,result:{relay:{protocol:c??"irn"},responderPublicKey:_},throwOnFailedPublish:!0}).catch(b=>{throw E==null||E.setError(cr.session_approve_publish_failure),b}),E.addTrace(Qt.session_approve_publish_success)}catch(b){throw this.client.logger.error(b),this.client.session.delete(k,Te("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(k),b}return this.client.core.eventClient.deleteEvent({eventId:E.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:m.metadata}),await this.client.proposal.delete(a,Te("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(k,Ye(Wr)),{topic:k,acknowledged:()=>Promise.resolve(this.client.session.get(k))}}),S(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:i}=t;let n;try{n=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}n&&(await this.sendError({id:r,topic:n,error:i,rpcOpts:Xe.wc_sessionPropose.reject}),await this.client.proposal.delete(r,Te("USER_DISCONNECTED")))}),S(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(u){throw this.client.logger.error("update() -> isValidUpdate() failed"),u}const{topic:r,namespaces:i}=t,{done:n,resolve:o,reject:a}=hr(),c=qs(),l=oi().toString(),d=this.client.session.get(r).namespaces;return this.events.once(Ce("session_update",c),({error:u})=>{u?a(u):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(u=>{this.client.logger.error(u),this.client.session.update(r,{namespaces:d}),a(u)}),{acknowledged:n}}),S(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=t,i=qs(),{done:n,resolve:o,reject:a}=hr();return this.events.once(Ce("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,Ye(Wr)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),S(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(v){throw this.client.logger.error("request() -> isValidRequest() failed"),v}const{chainId:r,request:i,topic:n,expiry:o=Xe.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(n);(a==null?void 0:a.transportType)===De.relay&&await this.confirmOnlineStateOrThrow();const c=qs(),l=oi().toString(),{done:d,resolve:u,reject:h}=hr(o,"Request expired. Please try again.");this.events.once(Ce("session_request",c),({error:v,result:E})=>{v?h(v):u(E)});const f="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:{request:yt(Re({},i),{expiryTimestamp:Ye(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(v=>h(v)),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:r,id:c}),await d();const m={request:yt(Re({},i),{expiryTimestamp:Ye(o)}),chainId:r},w=this.shouldSetTVF(f,m);return await Promise.all([new Promise(async v=>{await this.sendRequest(Re({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:m,expiry:o,throwOnFailedPublish:!0},w&&{tvf:this.getTVFParams(c,m)})).catch(E=>h(E)),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:r,id:c}),v()}),new Promise(async v=>{var E;if(!((E=a.sessionConfig)!=null&&E.disableDeepLink)){const _=await sm(this.client.core.storage,Cd);await Qg({id:c,topic:n,wcDeepLink:_})}v()}),d()]).then(v=>v[2])}),S(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:r,response:i}=t,{id:n}=i,o=this.client.session.get(r);o.transportType===De.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Os(i)?await this.sendResult({id:n,topic:r,result:i.result,throwOnFailedPublish:!0,appLink:a}):ms(i)&&await this.sendError({id:n,topic:r,error:i.error,appLink:a}),this.cleanupAfterResponse(t)}),S(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:r}=t;if(this.client.session.keys.includes(r)){const i=qs(),n=oi().toString(),{done:o,resolve:a,reject:c}=hr();this.events.once(Ce("session_ping",i),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),S(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:r,event:i,chainId:n}=t,o=oi().toString(),a=qs();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),S(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:r}=t;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:Te("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:i}=D("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),S(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(r=>My(r,t)))),S(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),S(this,"authenticate",async(t,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(t);const n=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=n?De.link_mode:De.relay;o===De.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:d,nonce:u,type:h,exp:f,nbf:g,methods:m=[],expiry:w}=t,v=[...t.resources||[]],{topic:E,uri:_}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:E,uri:_}});const C=await this.client.core.crypto.generateKeyPair(),k=uo(C);if(await Promise.all([this.client.auth.authKeys.set(po,{responseTopic:k,publicKey:C}),this.client.auth.pairingTopics.set(k,{topic:k,pairingTopic:E})]),await this.client.core.relayer.subscribe(k,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${E}`),m.length>0){const{namespace:O}=di(a[0]);let Q=Gm(O,"request",m);lo(v)&&(Q=Zm(Q,v.pop())),v.push(Q)}const T=w&&w>Xe.wc_sessionAuthenticate.req.ttl?w:Xe.wc_sessionAuthenticate.req.ttl,P={authPayload:{type:h??"caip122",chains:a,statement:c,aud:l,domain:d,version:"1",nonce:u,iat:new Date().toISOString(),exp:f,nbf:g,resources:v},requester:{publicKey:C,metadata:this.client.metadata},expiryTimestamp:Ye(T)},M={eip155:{chains:a,methods:[...new Set(["personal_sign",...m])],events:["chainChanged","accountsChanged"]}},b={requiredNamespaces:{},optionalNamespaces:M,relays:[{protocol:"irn"}],pairingTopic:E,proposer:{publicKey:C,metadata:this.client.metadata},expiryTimestamp:Ye(Xe.wc_sessionPropose.req.ttl),id:qs()},{done:U,resolve:A,reject:j}=hr(T,"Request expired"),J=qs(),I=Ce("session_connect",b.id),R=Ce("session_request",J),N=async({error:O,session:Q})=>{this.events.off(R,q),O?j(O):Q&&A({session:Q})},q=async O=>{var Q,ce,ue;if(await this.deletePendingAuthRequest(J,{message:"fulfilled",code:0}),O.error){const Ke=Te("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return O.error.code===Ke.code?void 0:(this.events.off(I,N),j(O.error.message))}await this.deleteProposal(b.id),this.events.off(I,N);const{cacaos:Oe,responder:be}=O.result,We=[],Ze=[];for(const Ke of Oe){await Cl({cacao:Ke,projectId:this.client.core.projectId})||(this.client.logger.error(Ke,"Signature verification failed"),j(Te("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:ar}=Ke,As=lo(ar.resources),us=[Fa(ar.iss)],Is=_o(ar.iss);if(As){const Ss=Al(As),Hn=Il(As);We.push(...Ss),us.push(...Hn)}for(const Ss of us)Ze.push(`${Ss}:${Is}`)}const ht=await this.client.core.crypto.generateSharedKey(C,be.publicKey);let Ve;We.length>0&&(Ve={topic:ht,acknowledged:!0,self:{publicKey:C,metadata:this.client.metadata},peer:be,controller:be.publicKey,expiry:Ye(Wr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:E,namespaces:Kl([...new Set(We)],[...new Set(Ze)]),transportType:o},await this.client.core.relayer.subscribe(ht,{transportType:o}),await this.client.session.set(ht,Ve),E&&await this.client.core.pairing.updateMetadata({topic:E,metadata:be.metadata}),Ve=this.client.session.get(ht)),(Q=this.client.metadata.redirect)!=null&&Q.linkMode&&(ce=be.metadata.redirect)!=null&&ce.linkMode&&(ue=be.metadata.redirect)!=null&&ue.universal&&r&&(this.client.core.addLinkModeSupportedApp(be.metadata.redirect.universal),this.client.session.update(ht,{transportType:De.link_mode})),A({auths:Oe,session:Ve})};this.events.once(I,N),this.events.once(R,q);let Z;try{if(n){const O=wr("wc_sessionAuthenticate",P,J);this.client.core.history.set(E,O);const Q=await this.client.core.crypto.encode("",O,{type:jn,encoding:Gs});Z=Qn(r,E,Q)}else await Promise.all([this.sendRequest({topic:E,method:"wc_sessionAuthenticate",params:P,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:J}),this.sendRequest({topic:E,method:"wc_sessionPropose",params:b,expiry:Xe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:b.id})])}catch(O){throw this.events.off(I,N),this.events.off(R,q),O}return await this.setProposal(b.id,b),await this.setAuthRequest(J,{request:yt(Re({},P),{verifyContext:{}}),pairingTopic:E,transportType:o}),{uri:Z??_,response:U}}),S(this,"approveSessionAuthenticate",async t=>{const{id:r,auths:i}=t,n=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[lr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw n.setError(qi.no_internet_connection),w}const o=this.getPendingAuthRequest(r);if(!o)throw n.setError(qi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||De.relay;a===De.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),d=uo(c),u={type:Ms,receiverPublicKey:c,senderPublicKey:l},h=[],f=[];for(const w of i){if(!await Cl({cacao:w,projectId:this.client.core.projectId})){n.setError(qi.invalid_cacao);const k=Te("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:d,error:k,encodeOpts:u}),new Error(k.message)}n.addTrace(lr.cacaos_verified);const{p:v}=w,E=lo(v.resources),_=[Fa(v.iss)],C=_o(v.iss);if(E){const k=Al(E),T=Il(E);h.push(...k),_.push(...T)}for(const k of _)f.push(`${k}:${C}`)}const g=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(lr.create_authenticated_session_topic);let m;if((h==null?void 0:h.length)>0){m={topic:g,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ye(Wr),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Kl([...new Set(h)],[...new Set(f)]),transportType:a},n.addTrace(lr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(w){throw n.setError(qi.subscribe_authenticated_session_topic_failure),w}n.addTrace(lr.subscribe_authenticated_session_topic_success),await this.client.session.set(g,m),n.addTrace(lr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(lr.publishing_authenticated_session_approve);try{await this.sendResult({topic:d,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:u,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw n.setError(qi.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:m}}),S(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:r,reason:i}=t,n=this.getPendingAuthRequest(r);if(!n)throw new Error(`Could not find pending auth request with id ${r}`);n.transportType===De.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=uo(o),l={type:Ms,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:l,rpcOpts:Xe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.client.proposal.delete(r,Te("USER_DISCONNECTED"))}),S(this,"formatAuthMessage",t=>{this.isInitialized();const{request:r,iss:i}=t;return Fu(r,i)}),S(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),S(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const r=this.client.core.pairing.pairings.get(t.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&n.topic&&n.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),S(this,"deleteSession",async t=>{var r;const{topic:i,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,Te("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Cd).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===i&&this.deletePendingSessionRequest(l.id,Te("USER_DISCONNECTED"))}),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=fs.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),S(this,"deleteProposal",async(t,r)=>{if(r)try{const i=this.client.proposal.get(t),n=this.client.core.eventClient.getEvent({topic:i.pairingTopic});n==null||n.setError(cr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,Te("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),S(this,"deletePendingSessionRequest",async(t,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,r),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),i&&(this.sessionRequestQueue.state=fs.idle,this.client.events.emit("session_request_expire",{id:t}))}),S(this,"deletePendingAuthRequest",async(t,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(t,r),i?Promise.resolve():this.client.core.expirer.del(t)])}),S(this,"setExpiry",async(t,r)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,r),await this.client.session.update(t,{expiry:r}))}),S(this,"setProposal",async(t,r)=>{this.client.core.expirer.set(t,Ye(Xe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,r)}),S(this,"setAuthRequest",async(t,r)=>{const{request:i,pairingTopic:n,transportType:o=De.relay}=r;this.client.core.expirer.set(t,i.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:t,pairingTopic:n,verifyContext:i.verifyContext,transportType:o})}),S(this,"setPendingSessionRequest",async t=>{const{id:r,topic:i,params:n,verifyContext:o}=t,a=n.request.expiryTimestamp||Ye(Xe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:n,verifyContext:o})}),S(this,"sendRequest",async t=>{const{topic:r,method:i,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:d,tvf:u}=t,h=wr(i,n,c);let f;const g=!!d;try{const v=g?Gs:is;f=await this.client.core.crypto.encode(r,h,{encoding:v})}catch(v){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),v}let m;if(eC.includes(i)){const v=ws(JSON.stringify(h)),E=ws(f);m=await this.client.core.verify.register({id:E,decryptedId:v})}const w=Xe[i].req;if(w.attestation=m,o&&(w.ttl=o),a&&(w.id=a),this.client.core.history.set(r,h),g){const v=Qn(d,r,f);await globalThis.Linking.openURL(v,this.client.name)}else{const v=Xe[i].req;o&&(v.ttl=o),a&&(v.id=a),v.tvf=yt(Re({},u),{correlationId:h.id}),l?(v.internal=yt(Re({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,f,v)):this.client.core.relayer.publish(r,f,v).catch(E=>this.client.logger.error(E))}return h.id}),S(this,"sendResult",async t=>{const{id:r,topic:i,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,l=Lo(r,n);let d;const u=c&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const g=u?Gs:is;d=await this.client.core.crypto.encode(i,l,yt(Re({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),g}let h,f;try{h=await this.client.core.history.get(i,r);const g=h.request;try{this.shouldSetTVF(g.method,g.params)&&(f=this.getTVFParams(r,g.params,n))}catch(m){this.client.logger.warn("sendResult() -> getTVFParams() failed",m)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),g}if(u){const g=Qn(c,i,d);await globalThis.Linking.openURL(g,this.client.name)}else{const g=h.request.method,m=Xe[g].res;m.tvf=yt(Re({},f),{correlationId:r}),o?(m.internal=yt(Re({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,m)):this.client.core.relayer.publish(i,d,m).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(l)}),S(this,"sendError",async t=>{const{id:r,topic:i,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=t,l=uu(r,n);let d;const u=c&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const f=u?Gs:is;d=await this.client.core.crypto.encode(i,l,yt(Re({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),f}let h;try{h=await this.client.core.history.get(i,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),f}if(u){const f=Qn(c,i,d);await globalThis.Linking.openURL(f,this.client.name)}else{const f=h.request.method,g=a||Xe[f].res;this.client.core.relayer.publish(i,d,g)}await this.client.core.history.resolve(l)}),S(this,"cleanup",async()=>{const t=[],r=[];this.client.session.getAll().forEach(i=>{let n=!1;Ks(i.expiry)&&(n=!0),this.client.core.crypto.keychain.has(i.topic)||(n=!0),n&&t.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{Ks(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...t.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),S(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),S(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),S(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===fs.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=fs.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=fs.idle}),S(this,"processRequest",async t=>{const{topic:r,payload:i,attestation:n,transportType:o,encryptedId:a}=t,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),S(this,"onRelayEventResponse",async t=>{const{topic:r,payload:i,transportType:n}=t,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),S(this,"onRelayEventUnknownPayload",t=>{const{topic:r}=t,{message:i}=D("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),S(this,"shouldIgnorePairingRequest",t=>{const{topic:r,requestMethod:i}=t,n=this.expectedPairingMethodMap.get(r);return!n||n.includes(i)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),S(this,"onSessionProposeRequest",async t=>{const{topic:r,payload:i,attestation:n,encryptedId:o}=t,{params:a,id:c}=i;try{const l=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(xs.proposal_listener_not_found)),this.isValidConnect(Re({},i.params));const d=a.expiryTimestamp||Ye(Xe.wc_sessionPropose.req.ttl),u=Re({id:c,pairingTopic:r,expiryTimestamp:d},a);await this.setProposal(c,u);const h=await this.getVerifyContext({attestationId:n,hash:ws(JSON.stringify(i)),encryptedId:o,metadata:u.proposer.metadata});l==null||l.addTrace(gs.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:u,verifyContext:h})}catch(l){await this.sendError({id:c,topic:r,error:l,rpcOpts:Xe.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),S(this,"onSessionProposeResponse",async(t,r,i)=>{const{id:n}=r;if(Os(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const d=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:d,pairingTopic:t,proposalId:n,publicKey:c});const u=await this.client.core.relayer.subscribe(d,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:u}),await this.client.core.pairing.activate({topic:t})}else if(ms(r)){await this.client.proposal.delete(n,Te("USER_DISCONNECTED"));const o=Ce("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),S(this,"onSessionSettleRequest",async(t,r)=>{const{id:i,params:n}=r;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:d,scopedProperties:u,sessionConfig:h}=r.params,f=[...this.pendingSessions.values()].find(w=>w.sessionTopic===t);if(!f)return this.client.logger.error(`Pending session not found for topic ${t}`);const g=this.client.proposal.get(f.proposalId),m=yt(Re(Re(Re({topic:t,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},d&&{sessionProperties:d}),u&&{scopedProperties:u}),h&&{sessionConfig:h}),{transportType:De.relay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(Ce("session_connect",f.proposalId),{session:m}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:r.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:i,topic:t,error:o}),this.client.logger.error(o)}}),S(this,"onSessionSettleResponse",async(t,r)=>{const{id:i}=r;Os(r)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Ce("session_approve",i),{})):ms(r)&&(await this.client.session.delete(t,Te("USER_DISCONNECTED")),this.events.emit(Ce("session_approve",i),{error:r.error}))}),S(this,"onSessionUpdateRequest",async(t,r)=>{const{params:i,id:n}=r;try{const o=`${t}_session_update`,a=ji.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:Te("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Re({topic:t},i));try{ji.set(o,n),await this.client.session.update(t,{namespaces:i.namespaces}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(c){throw ji.delete(o),c}this.client.events.emit("session_update",{id:n,topic:t,params:i})}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),S(this,"isRequestOutOfSync",(t,r)=>r.toString().slice(0,-3)<t.toString().slice(0,-3)),S(this,"onSessionUpdateResponse",(t,r)=>{const{id:i}=r,n=Ce("session_update",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Os(r)?this.events.emit(Ce("session_update",i),{}):ms(r)&&this.events.emit(Ce("session_update",i),{error:r.error})}),S(this,"onSessionExtendRequest",async(t,r)=>{const{id:i}=r;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Ye(Wr)),await this.sendResult({id:i,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:i,topic:t})}catch(n){await this.sendError({id:i,topic:t,error:n}),this.client.logger.error(n)}}),S(this,"onSessionExtendResponse",(t,r)=>{const{id:i}=r,n=Ce("session_extend",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Os(r)?this.events.emit(Ce("session_extend",i),{}):ms(r)&&this.events.emit(Ce("session_extend",i),{error:r.error})}),S(this,"onSessionPingRequest",async(t,r)=>{const{id:i}=r;try{this.isValidPing({topic:t}),await this.sendResult({id:i,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:t})}catch(n){await this.sendError({id:i,topic:t,error:n}),this.client.logger.error(n)}}),S(this,"onSessionPingResponse",(t,r)=>{const{id:i}=r,n=Ce("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);Os(r)?this.events.emit(Ce("session_ping",i),{}):ms(r)&&this.events.emit(Ce("session_ping",i),{error:r.error})},500)}),S(this,"onSessionDeleteRequest",async(t,r)=>{const{id:i}=r;try{this.isValidDisconnect({topic:t,reason:r.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(tt.publish,async()=>{n(await this.deleteSession({topic:t,id:i}))})}),this.sendResult({id:i,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:Te("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),S(this,"onSessionRequest",async t=>{var r,i,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:d}=t,{id:u,params:h}=a;try{await this.isValidRequest(Re({topic:o},h));const f=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:ws(JSON.stringify(wr("wc_sessionRequest",h,u))),encryptedId:l,metadata:f.peer.metadata,transportType:d}),m={id:u,topic:o,params:h,verifyContext:g};await this.setPendingSessionRequest(m),d===De.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=f.peer.metadata.redirect)==null?void 0:i.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(f){await this.sendError({id:u,topic:o,error:f}),this.client.logger.error(f)}}),S(this,"onSessionRequestResponse",(t,r)=>{const{id:i}=r,n=Ce("session_request",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Os(r)?this.events.emit(Ce("session_request",i),{result:r.result}):ms(r)&&this.events.emit(Ce("session_request",i),{error:r.error})}),S(this,"onSessionEventRequest",async(t,r)=>{const{id:i,params:n}=r;try{const o=`${t}_session_event_${n.event.name}`,a=ji.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(Re({topic:t},n)),this.client.events.emit("session_event",{id:i,topic:t,params:n}),ji.set(o,i)}catch(o){await this.sendError({id:i,topic:t,error:o}),this.client.logger.error(o)}}),S(this,"onSessionAuthenticateResponse",(t,r)=>{const{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:r}),Os(r)?this.events.emit(Ce("session_request",i),{result:r.result}):ms(r)&&this.events.emit(Ce("session_request",i),{error:r.error})}),S(this,"onSessionAuthenticateRequest",async t=>{var r;const{topic:i,payload:n,attestation:o,encryptedId:a,transportType:c}=t;try{const{requester:l,authPayload:d,expiryTimestamp:u}=n.params,h=await this.getVerifyContext({attestationId:o,hash:ws(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:i,id:n.id,authPayload:d,verifyContext:h,expiryTimestamp:u};await this.setAuthRequest(n.id,{request:f,pairingTopic:i,transportType:c}),c===De.link_mode&&(r=l.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:n.params,id:n.id,verifyContext:h})}catch(l){this.client.logger.error(l);const d=n.params.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),h=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:Ms,receiverPublicKey:d,senderPublicKey:u};await this.sendError({id:n.id,topic:i,error:l,encodeOpts:f,rpcOpts:Xe.wc_sessionAuthenticate.autoReject,appLink:h})}}),S(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),S(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=fs.idle,this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay))}),S(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:r})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=Ce("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(Ce("session_request",n.request.id),{error:r})})}),S(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===fs.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=fs.active,this.emitSessionRequest(t)}catch(r){this.client.logger.error(r)}}),S(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),S(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const r=this.client.proposal.getAll().find(i=>i.pairingTopic===t.topic);r&&this.onSessionProposeRequest({topic:t.topic,payload:wr("wc_sessionPropose",yt(Re({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id)})}),S(this,"isValidConnect",async t=>{if(!St(t)){const{message:l}=D("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=t;if(ct(r)||await this.isValidPairingTopic(r),!Zy(c)){const{message:l}=D("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!ct(i)&&gn(i)!==0&&this.validateNamespaces(i,"requiredNamespaces"),!ct(n)&&gn(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),ct(o)||this.validateSessionProps(o,"sessionProperties"),!ct(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(i||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(d=>l.includes(d)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),S(this,"validateNamespaces",(t,r)=>{const i=Yy(t,"connect()",r);if(i)throw new Error(i.message)}),S(this,"isValidApprove",async t=>{if(!St(t))throw new Error(D("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:r,namespaces:i,relayProtocol:n,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),l=pa(i,"approve()");if(l)throw new Error(l.message);const d=Zl(c.requiredNamespaces,i,"approve()");if(d)throw new Error(d.message);if(!ze(n,!0)){const{message:u}=D("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(u)}if(ct(o)||this.validateSessionProps(o,"sessionProperties"),!ct(a)){this.validateSessionProps(a,"scopedProperties");const u=new Set(Object.keys(i));if(!Object.keys(a).every(h=>u.has(h)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(u).join(", ")}`)}}),S(this,"isValidReject",async t=>{if(!St(t)){const{message:n}=D("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:r,reason:i}=t;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!Xy(i)){const{message:n}=D("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(n)}}),S(this,"isValidSessionSettleRequest",t=>{if(!St(t)){const{message:l}=D("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(l)}const{relay:r,controller:i,namespaces:n,expiry:o}=t;if(!fh(r)){const{message:l}=D("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=Wy(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=pa(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Ks(o)){const{message:l}=D("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),S(this,"isValidUpdate",async t=>{if(!St(t)){const{message:c}=D("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:r,namespaces:i}=t;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const n=this.client.session.get(r),o=pa(i,"update()");if(o)throw new Error(o.message);const a=Zl(n.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),S(this,"isValidExtend",async t=>{if(!St(t)){const{message:i}=D("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(i)}const{topic:r}=t;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),S(this,"isValidRequest",async t=>{if(!St(t)){const{message:c}=D("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:r,request:i,chainId:n,expiry:o}=t;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!Yl(a,n)){const{message:c}=D("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!Qy(i)){const{message:c}=D("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!sv(a,n,i.method)){const{message:c}=D("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!ov(o,Ea)){const{message:c}=D("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Ea.min} and ${Ea.max}`);throw new Error(c)}}),S(this,"isValidRespond",async t=>{var r;if(!St(t)){const{message:o}=D("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:i,response:n}=t;try{await this.isValidSessionTopic(i)}catch(o){throw(r=t==null?void 0:t.response)!=null&&r.id&&this.cleanupAfterResponse(t),o}if(!ev(n)){const{message:o}=D("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),S(this,"isValidPing",async t=>{if(!St(t)){const{message:i}=D("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(i)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)}),S(this,"isValidEmit",async t=>{if(!St(t)){const{message:a}=D("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}const{topic:r,event:i,chainId:n}=t;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!Yl(o,n)){const{message:a}=D("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!tv(i)){const{message:a}=D("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!rv(o,n,i.name)){const{message:a}=D("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),S(this,"isValidDisconnect",async t=>{if(!St(t)){const{message:i}=D("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(i)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)}),S(this,"isValidAuthenticate",t=>{const{chains:r,uri:i,domain:n,nonce:o}=t;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!ze(i,!1))throw new Error("uri is required parameter");if(!ze(n,!1))throw new Error("domain is required parameter");if(!ze(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>di(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=di(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),S(this,"getVerifyContext",async t=>{const{attestationId:r,hash:i,encryptedId:n,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||Qi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===De.link_mode){const d=this.getAppLinkIfEnabled(o,a);return c.verified.validation=d&&new URL(d).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),S(this,"validateSessionProps",(t,r)=>{Object.values(t).forEach((i,n)=>{if(i==null){const{message:o}=D("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(t)[n]}`);throw new Error(o)}})}),S(this,"getPendingAuthRequest",t=>{const r=this.client.auth.requests.get(t);return typeof r=="object"?r:void 0}),S(this,"addToRecentlyDeleted",(t,r)=>{if(this.recentlyDeletedMap.set(t,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=n)break;this.recentlyDeletedMap.delete(o)}}}),S(this,"checkRecentlyDeleted",t=>{const r=this.recentlyDeletedMap.get(t);if(r){const{message:i}=D("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${t}`);throw new Error(i)}}),S(this,"isLinkModeEnabled",(t,r)=>{var i,n,o,a,c,l,d,u,h;return!t||r!==De.link_mode?!1:((n=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((d=t==null?void 0:t.redirect)==null?void 0:d.universal)!==void 0&&((u=t==null?void 0:t.redirect)==null?void 0:u.universal)!==""&&((h=t==null?void 0:t.redirect)==null?void 0:h.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"}),S(this,"getAppLinkIfEnabled",(t,r)=>{var i;return this.isLinkModeEnabled(t,r)?(i=t==null?void 0:t.redirect)==null?void 0:i.universal:void 0}),S(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const r=fl(t,"topic")||"",i=decodeURIComponent(fl(t,"wc_ev")||""),n=this.client.session.keys.includes(r);n&&this.client.session.update(r,{transportType:De.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:n})}),S(this,"registerLinkModeListeners",async()=>{var t;if(Sc()||or()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const r=globalThis==null?void 0:globalThis.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),S(this,"shouldSetTVF",(t,r)=>{if(!r||t!=="wc_sessionRequest")return!1;const{request:i}=r;return Object.keys(Id).includes(i.method)}),S(this,"getTVFParams",(t,r,i)=>{var n,o;try{const a=r.request.method,c=this.extractTxHashesFromResult(a,i);return yt(Re({correlationId:t,rpcMethods:[a],chainId:r.chainId},this.isValidContractData(r.request.params)&&{contractAddresses:[(o=(n=r.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),S(this,"isValidContractData",t=>{var r;if(!t)return!1;try{const i=(t==null?void 0:t.data)||((r=t==null?void 0:t[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;const n=i.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),S(this,"extractTxHashesFromResult",(t,r)=>{try{const i=Id[t];if(typeof r=="string")return[r];const n=r[i.key];if(Qs(n))return t==="solana_signAllTransactions"?n.map(o=>$m(o)):n;if(typeof n=="string")return[n]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,i]of Object.entries(t))for(const n of i)try{await this.onProviderMessageEvent({topic:r,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=D("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(tt.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:r,attestation:i,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(po)?this.client.auth.authKeys.get(po):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(t,r,{receiverPublicKey:o,encoding:n===De.link_mode?Gs:is});_c(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:i,transportType:n,encryptedId:ws(r)})):Cc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:n}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(t,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Gt.expired,async e=>{const{topic:t,id:r}=ku(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,D("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,D("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(gr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(gr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ze(e,!1)){const{message:t}=D("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=D("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Ks(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=D("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!ze(e,!1)){const{message:t}=D("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=D("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Ks(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=D("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=D("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ze(e,!1)){const{message:t}=D("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=D("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Jy(e)){const{message:t}=D("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=D("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Ks(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=D("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class hC extends Lr{constructor(e,t){super(e,t,Z_,Uc),this.core=e,this.logger=t}}let pC=class extends Lr{constructor(e,t){super(e,t,J_,Uc),this.core=e,this.logger=t}};class fC extends Lr{constructor(e,t){super(e,t,Q_,Uc,r=>r.id),this.core=e,this.logger=t}}class gC extends Lr{constructor(e,t){super(e,t,rC,Ko,()=>po),this.core=e,this.logger=t}}class mC extends Lr{constructor(e,t){super(e,t,iC,Ko),this.core=e,this.logger=t}}class wC extends Lr{constructor(e,t){super(e,t,nC,Ko,r=>r.id),this.core=e,this.logger=t}}var yC=Object.defineProperty,vC=(s,e,t)=>e in s?yC(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ba=(s,e,t)=>vC(s,typeof e!="symbol"?e+"":e,t);class EC{constructor(e,t){this.core=e,this.logger=t,ba(this,"authKeys"),ba(this,"pairingTopics"),ba(this,"requests"),this.authKeys=new gC(this.core,this.logger),this.pairingTopics=new mC(this.core,this.logger),this.requests=new wC(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var bC=Object.defineProperty,_C=(s,e,t)=>e in s?bC(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ge=(s,e,t)=>_C(s,typeof e!="symbol"?e+"":e,t);let CC=class $h extends zf{constructor(e){super(e),ge(this,"protocol",Oh),ge(this,"version",xh),ge(this,"name",va.name),ge(this,"metadata"),ge(this,"core"),ge(this,"logger"),ge(this,"events",new kr.EventEmitter),ge(this,"engine"),ge(this,"session"),ge(this,"proposal"),ge(this,"pendingRequest"),ge(this,"auth"),ge(this,"signConfig"),ge(this,"on",(r,i)=>this.events.on(r,i)),ge(this,"once",(r,i)=>this.events.once(r,i)),ge(this,"off",(r,i)=>this.events.off(r,i)),ge(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),ge(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),ge(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),ge(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(n){throw this.logger.error(n.message),n}}),ge(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),ge(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||va.name,this.metadata=Kg(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:bc(Ni({level:(e==null?void 0:e.logger)||va.logger}));this.core=(e==null?void 0:e.core)||new Y_(e),this.logger=wt(t,this.name),this.session=new pC(this.core,this.logger),this.proposal=new hC(this.core,this.logger),this.pendingRequest=new fC(this.core,this.logger),this.engine=new uC(this),this.auth=new EC(this.core,this.logger)}static async init(e){const t=new $h(e);return await t.initialize(),t}get context(){return qt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},L.toMiliseconds(L.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Nd="error",AC="wss://relay.walletconnect.org",IC="wc",SC="universal_provider",to=`${IC}@2:${SC}:`,Uh="https://rpc.walletconnect.org/v1/",si="generic",NC=`${Uh}bundler`,Jt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function TC(){}function Dc(s){return s==null||typeof s!="object"&&typeof s!="function"}function Lc(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function PC(s){if(Dc(s))return s;if(Array.isArray(s)||Lc(s)||s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);const e=Object.getPrototypeOf(s),t=e.constructor;if(s instanceof Date||s instanceof Map||s instanceof Set)return new t(s);if(s instanceof RegExp){const r=new t(s);return r.lastIndex=s.lastIndex,r}if(s instanceof DataView)return new t(s.buffer.slice(0));if(s instanceof Error){const r=new t(s.message);return r.stack=s.stack,r.name=s.name,r.cause=s.cause,r}if(typeof File<"u"&&s instanceof File)return new t([s],s.name,{type:s.type,lastModified:s.lastModified});if(typeof s=="object"){const r=Object.create(e);return Object.assign(r,s)}return s}function Td(s){return typeof s=="object"&&s!==null}function Dh(s){return Object.getOwnPropertySymbols(s).filter(e=>Object.prototype.propertyIsEnumerable.call(s,e))}function Lh(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}const RC="[object RegExp]",Mh="[object String]",jh="[object Number]",Bh="[object Boolean]",qh="[object Arguments]",OC="[object Symbol]",xC="[object Date]",kC="[object Map]",$C="[object Set]",UC="[object Array]",DC="[object ArrayBuffer]",LC="[object Object]",MC="[object DataView]",jC="[object Uint8Array]",BC="[object Uint8ClampedArray]",qC="[object Uint16Array]",FC="[object Uint32Array]",WC="[object Int8Array]",HC="[object Int16Array]",zC="[object Int32Array]",VC="[object Float32Array]",KC="[object Float64Array]";function GC(s,e){return ci(s,void 0,s,new Map,e)}function ci(s,e,t,r=new Map,i=void 0){const n=i==null?void 0:i(s,e,t,r);if(n!=null)return n;if(Dc(s))return s;if(r.has(s))return r.get(s);if(Array.isArray(s)){const o=new Array(s.length);r.set(s,o);for(let a=0;a<s.length;a++)o[a]=ci(s[a],a,t,r,i);return Object.hasOwn(s,"index")&&(o.index=s.index),Object.hasOwn(s,"input")&&(o.input=s.input),o}if(s instanceof Date)return new Date(s.getTime());if(s instanceof RegExp){const o=new RegExp(s.source,s.flags);return o.lastIndex=s.lastIndex,o}if(s instanceof Map){const o=new Map;r.set(s,o);for(const[a,c]of s)o.set(a,ci(c,a,t,r,i));return o}if(s instanceof Set){const o=new Set;r.set(s,o);for(const a of s)o.add(ci(a,void 0,t,r,i));return o}if(typeof gt.Buffer<"u"&&gt.Buffer.isBuffer(s))return s.subarray();if(Lc(s)){const o=new(Object.getPrototypeOf(s)).constructor(s.length);r.set(s,o);for(let a=0;a<s.length;a++)o[a]=ci(s[a],a,t,r,i);return o}if(s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);if(s instanceof DataView){const o=new DataView(s.buffer.slice(0),s.byteOffset,s.byteLength);return r.set(s,o),mr(o,s,t,r,i),o}if(typeof File<"u"&&s instanceof File){const o=new File([s],s.name,{type:s.type});return r.set(s,o),mr(o,s,t,r,i),o}if(s instanceof Blob){const o=new Blob([s],{type:s.type});return r.set(s,o),mr(o,s,t,r,i),o}if(s instanceof Error){const o=new s.constructor;return r.set(s,o),o.message=s.message,o.name=s.name,o.stack=s.stack,o.cause=s.cause,mr(o,s,t,r,i),o}if(typeof s=="object"&&YC(s)){const o=Object.create(Object.getPrototypeOf(s));return r.set(s,o),mr(o,s,t,r,i),o}return s}function mr(s,e,t=s,r,i){const n=[...Object.keys(e),...Dh(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(s,a);(c==null||c.writable)&&(s[a]=ci(e[a],a,t,r,i))}}function YC(s){switch(Lh(s)){case qh:case UC:case DC:case MC:case Bh:case xC:case VC:case KC:case WC:case HC:case zC:case kC:case jh:case LC:case RC:case $C:case Mh:case OC:case jC:case BC:case qC:case FC:return!0;default:return!1}}function ZC(s,e){return GC(s,(t,r,i,n)=>{if(typeof s=="object")switch(Object.prototype.toString.call(s)){case jh:case Mh:case Bh:{const o=new s.constructor(s==null?void 0:s.valueOf());return mr(o,s),o}case qh:{const o={};return mr(o,s),o.length=s.length,o[Symbol.iterator]=s[Symbol.iterator],o}default:return}})}function Pd(s){return ZC(s)}function Rd(s){return s!==null&&typeof s=="object"&&Lh(s)==="[object Arguments]"}function JC(s){return Lc(s)}function XC(s){var t;if(typeof s!="object"||s==null)return!1;if(Object.getPrototypeOf(s)===null)return!0;if(Object.prototype.toString.call(s)!=="[object Object]"){const r=s[Symbol.toStringTag];return r==null||!((t=Object.getOwnPropertyDescriptor(s,Symbol.toStringTag))!=null&&t.writable)?!1:s.toString()===`[object ${r}]`}let e=s;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(s)===e}function QC(s,...e){const t=e.slice(0,-1),r=e[e.length-1];let i=s;for(let n=0;n<t.length;n++){const o=t[n];i=dc(i,o,r,new Map)}return i}function dc(s,e,t,r){if(Dc(s)&&(s=Object(s)),e==null||typeof e!="object")return s;if(r.has(e))return PC(r.get(e));if(r.set(e,s),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const i=[...Object.keys(e),...Dh(e)];for(let n=0;n<i.length;n++){const o=i[n];let a=e[o],c=s[o];if(Rd(a)&&(a={...a}),Rd(c)&&(c={...c}),typeof gt.Buffer<"u"&&gt.Buffer.isBuffer(a)&&(a=Pd(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const d=[],u=Reflect.ownKeys(c);for(let h=0;h<u.length;h++){const f=u[h];d[f]=c[f]}c=d}else c=[];const l=t(c,a,o,s,e,r);l!=null?s[o]=l:Array.isArray(a)||Td(c)&&Td(a)?s[o]=dc(c,a,t,r):c==null&&XC(a)?s[o]=dc({},a,t,r):c==null&&JC(a)?s[o]=Pd(a):(c===void 0||a!==void 0)&&(s[o]=a)}return s}function e0(s,...e){return QC(s,...e,TC)}var t0=Object.defineProperty,s0=Object.defineProperties,r0=Object.getOwnPropertyDescriptors,Od=Object.getOwnPropertySymbols,i0=Object.prototype.hasOwnProperty,n0=Object.prototype.propertyIsEnumerable,xd=(s,e,t)=>e in s?t0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,so=(s,e)=>{for(var t in e||(e={}))i0.call(e,t)&&xd(s,t,e[t]);if(Od)for(var t of Od(e))n0.call(e,t)&&xd(s,t,e[t]);return s},o0=(s,e)=>s0(s,r0(e));function Bt(s,e,t){var r;const i=di(s);return((r=e.rpcMap)==null?void 0:r[i.reference])||`${Uh}?chainId=${i.namespace}:${i.reference}&projectId=${t}`}function Mr(s){return s.includes(":")?s.split(":")[1]:s}function Fh(s){return s.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function a0(s,e){const t=Object.keys(e.namespaces).filter(i=>i.includes(s));if(!t.length)return[];const r=[];return t.forEach(i=>{const n=e.namespaces[i].accounts;r.push(...n)}),r}function _a(s={},e={}){const t=kd(s),r=kd(e);return e0(t,r)}function kd(s){var e,t,r,i;const n={};if(!gn(s))return n;for(const[o,a]of Object.entries(s)){const c=kc(o)?[o]:a.chains,l=a.methods||[],d=a.events||[],u=a.rpcMap||{},h=Yi(o);n[h]=o0(so(so({},n[h]),a),{chains:co(c,(e=n[h])==null?void 0:e.chains),methods:co(l,(t=n[h])==null?void 0:t.methods),events:co(d,(r=n[h])==null?void 0:r.events),rpcMap:so(so({},u),(i=n[h])==null?void 0:i.rpcMap)})}return n}function $d(s){return s.includes(":")?s.split(":")[2]:s}function Ud(s){const e={};for(const[t,r]of Object.entries(s)){const i=r.methods||[],n=r.events||[],o=r.accounts||[],a=kc(t)?[t]:r.chains?r.chains:Fh(r.accounts);e[t]={chains:a,methods:i,events:n,accounts:o}}return e}function Ca(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):(s=s.includes(":")?s.split(":")[1]:s,isNaN(Number(s))?s:Number(s))}const Wh={},Ee=s=>Wh[s],Aa=(s,e)=>{Wh[s]=e};var c0=Object.defineProperty,l0=(s,e,t)=>e in s?c0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Hr=(s,e,t)=>l0(s,typeof e!="symbol"?e+"":e,t);class d0{constructor(e){Hr(this,"name","polkadot"),Hr(this,"client"),Hr(this,"httpProviders"),Hr(this,"events"),Hr(this,"namespace"),Hr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const i=Mr(t);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zt(new ds(r,Ee("disableProviderPing")))}}var u0=Object.defineProperty,h0=Object.defineProperties,p0=Object.getOwnPropertyDescriptors,Dd=Object.getOwnPropertySymbols,f0=Object.prototype.hasOwnProperty,g0=Object.prototype.propertyIsEnumerable,uc=(s,e,t)=>e in s?u0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ld=(s,e)=>{for(var t in e||(e={}))f0.call(e,t)&&uc(s,t,e[t]);if(Dd)for(var t of Dd(e))g0.call(e,t)&&uc(s,t,e[t]);return s},Md=(s,e)=>h0(s,p0(e)),zr=(s,e,t)=>uc(s,typeof e!="symbol"?e+"":e,t);class m0{constructor(e){zr(this,"name","eip155"),zr(this,"client"),zr(this,"chainId"),zr(this,"namespace"),zr(this,"httpProviders"),zr(this,"events"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const r=t||Bt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zt(new ds(r,Ee("disableProviderPing")))}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const i=parseInt(Mr(t));e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,r;let i=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;const n=parseInt(i,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(r=this.namespace.chains)==null?void 0:r[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,r,i;const n=(r=(t=e.request)==null?void 0:t.params)==null?void 0:r[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const o=this.client.session.get(e.topic),a=((i=o==null?void 0:o.sessionProperties)==null?void 0:i.capabilities)||{};if(a!=null&&a[n])return a==null?void 0:a[n];const c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Md(Ld({},o.sessionProperties||{}),{capabilities:Md(Ld({},a||{}),{[n]:c})})})}catch(l){console.warn("Failed to update session with capabilities",l)}return c}async getCallStatus(e){var t,r;const i=this.client.session.get(e.topic),n=(t=i.sessionProperties)==null?void 0:t.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(r=i.sessionProperties)==null?void 0:r.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var r;const i=new URL(e),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(wr("eth_getUserOperationReceipt",[(r=t.request.params)==null?void 0:r[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${NC}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var w0=Object.defineProperty,y0=(s,e,t)=>e in s?w0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Vr=(s,e,t)=>y0(s,typeof e!="symbol"?e+"":e,t);class v0{constructor(e){Vr(this,"name","solana"),Vr(this,"client"),Vr(this,"httpProviders"),Vr(this,"events"),Vr(this,"namespace"),Vr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const i=Mr(t);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zt(new ds(r,Ee("disableProviderPing")))}}var E0=Object.defineProperty,b0=(s,e,t)=>e in s?E0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Kr=(s,e,t)=>b0(s,typeof e!="symbol"?e+"":e,t);class _0{constructor(e){Kr(this,"name","cosmos"),Kr(this,"client"),Kr(this,"httpProviders"),Kr(this,"events"),Kr(this,"namespace"),Kr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const i=Mr(t);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zt(new ds(r,Ee("disableProviderPing")))}}var C0=Object.defineProperty,A0=(s,e,t)=>e in s?C0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Gr=(s,e,t)=>A0(s,typeof e!="symbol"?e+"":e,t);class I0{constructor(e){Gr(this,"name","algorand"),Gr(this,"client"),Gr(this,"httpProviders"),Gr(this,"events"),Gr(this,"namespace"),Gr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const r=t||Bt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;e[t]=this.createHttpProvider(t,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new Zt(new ds(r,Ee("disableProviderPing")))}}var S0=Object.defineProperty,N0=(s,e,t)=>e in s?S0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Yr=(s,e,t)=>N0(s,typeof e!="symbol"?e+"":e,t);class T0{constructor(e){Yr(this,"name","cip34"),Yr(this,"client"),Yr(this,"httpProviders"),Yr(this,"events"),Yr(this,"namespace"),Yr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const r=this.getCardanoRPCUrl(t),i=Mr(t);e[i]=this.createHttpProvider(i,r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||this.getCardanoRPCUrl(e);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zt(new ds(r,Ee("disableProviderPing")))}}var P0=Object.defineProperty,R0=(s,e,t)=>e in s?P0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Zr=(s,e,t)=>R0(s,typeof e!="symbol"?e+"":e,t);class O0{constructor(e){Zr(this,"name","elrond"),Zr(this,"client"),Zr(this,"httpProviders"),Zr(this,"events"),Zr(this,"namespace"),Zr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const i=Mr(t);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zt(new ds(r,Ee("disableProviderPing")))}}var x0=Object.defineProperty,k0=(s,e,t)=>e in s?x0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Jr=(s,e,t)=>k0(s,typeof e!="symbol"?e+"":e,t);class $0{constructor(e){Jr(this,"name","multiversx"),Jr(this,"client"),Jr(this,"httpProviders"),Jr(this,"events"),Jr(this,"namespace"),Jr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;const i=Mr(t);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zt(new ds(r,Ee("disableProviderPing")))}}var U0=Object.defineProperty,D0=(s,e,t)=>e in s?U0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Xr=(s,e,t)=>D0(s,typeof e!="symbol"?e+"":e,t);class L0{constructor(e){Xr(this,"name","near"),Xr(this,"client"),Xr(this,"httpProviders"),Xr(this,"events"),Xr(this,"namespace"),Xr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Bt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var r;e[t]=this.createHttpProvider(t,(r=this.namespace.rpcMap)==null?void 0:r[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace);return typeof r>"u"?void 0:new Zt(new ds(r,Ee("disableProviderPing")))}}var M0=Object.defineProperty,j0=(s,e,t)=>e in s?M0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Qr=(s,e,t)=>j0(s,typeof e!="symbol"?e+"":e,t);class B0{constructor(e){Qr(this,"name","tezos"),Qr(this,"client"),Qr(this,"httpProviders"),Qr(this,"events"),Qr(this,"namespace"),Qr(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Bt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace);return typeof r>"u"?void 0:new Zt(new ds(r))}}var q0=Object.defineProperty,F0=(s,e,t)=>e in s?q0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ei=(s,e,t)=>F0(s,typeof e!="symbol"?e+"":e,t);class W0{constructor(e){ei(this,"name",si),ei(this,"client"),ei(this,"httpProviders"),ei(this,"events"),ei(this,"namespace"),ei(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Jt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const r={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(i=>{const n=di(i);r[`${n.namespace}:${n.reference}`]=this.createHttpProvider(i)}),r}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Bt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zt(new ds(r,Ee("disableProviderPing")))}}var H0=Object.defineProperty,z0=Object.defineProperties,V0=Object.getOwnPropertyDescriptors,jd=Object.getOwnPropertySymbols,K0=Object.prototype.hasOwnProperty,G0=Object.prototype.propertyIsEnumerable,hc=(s,e,t)=>e in s?H0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ro=(s,e)=>{for(var t in e||(e={}))K0.call(e,t)&&hc(s,t,e[t]);if(jd)for(var t of jd(e))G0.call(e,t)&&hc(s,t,e[t]);return s},Ia=(s,e)=>z0(s,V0(e)),Wt=(s,e,t)=>hc(s,typeof e!="symbol"?e+"":e,t);let Y0=class Hh{constructor(e){Wt(this,"client"),Wt(this,"namespaces"),Wt(this,"optionalNamespaces"),Wt(this,"sessionProperties"),Wt(this,"scopedProperties"),Wt(this,"events",new Ac),Wt(this,"rpcProviders",{}),Wt(this,"session"),Wt(this,"providerOpts"),Wt(this,"logger"),Wt(this,"uri"),Wt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:bc(Ni({level:(e==null?void 0:e.logger)||Nd})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new Hh(e);return await t.initialize(),t}async request(e,t,r){const[i,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:ro({},e),chainId:`${i}:${n}`,topic:this.session.topic,expiry:r})}sendAsync(e,t,r,i){const n=new Date().getTime();this.request(e,r,i).then(o=>t(null,Lo(n,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Te("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:r,response:i}=await this.client.authenticate(e,t);r&&(this.uri=r,this.events.emit("display_uri",r));const n=await i();if(this.session=n.session,this.session){const o=Ud(this.session.namespaces);this.namespaces=_a(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const i=await r();this.session=i;const n=Ud(i.namespaces);return this.namespaces=_a(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[r,i]=this.validateChain(e),n=this.getProvider(r);n.name===si?n.setDefaultChain(`${r}:${i}`,t):n.setDefaultChain(i,t)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Qs(t)){for(const r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await CC.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Nd,relayUrl:this.providerOpts.relayUrl||AC,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error("Failed to get session",r),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const r=this.client.session.getAll();this.session=r[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>Yi(t)))];Aa("client",this.client),Aa("events",this.events),Aa("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const r=a0(t,this.session),i=Fh(r),n=_a(this.namespaces,this.optionalNamespaces),o=Ia(ro({},n[t]),{accounts:r,chains:i});switch(t){case"eip155":this.rpcProviders[t]=new m0({namespace:o});break;case"algorand":this.rpcProviders[t]=new I0({namespace:o});break;case"solana":this.rpcProviders[t]=new v0({namespace:o});break;case"cosmos":this.rpcProviders[t]=new _0({namespace:o});break;case"polkadot":this.rpcProviders[t]=new d0({namespace:o});break;case"cip34":this.rpcProviders[t]=new T0({namespace:o});break;case"elrond":this.rpcProviders[t]=new O0({namespace:o});break;case"multiversx":this.rpcProviders[t]=new $0({namespace:o});break;case"near":this.rpcProviders[t]=new L0({namespace:o});break;case"tezos":this.rpcProviders[t]=new B0({namespace:o});break;default:this.rpcProviders[si]?this.rpcProviders[si].updateNamespace(o):this.rpcProviders[si]=new W0({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:r}=e;r===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:r,topic:i}=e;if(i!==((t=this.session)==null?void 0:t.topic))return;const{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&Qs(o)&&this.events.emit("accountsChanged",o.map($d))}else if(n.name==="chainChanged"){const o=r.chainId,a=r.event.data,c=Yi(o),l=Ca(o)!==Ca(a)?`${c}:${Ca(a)}`:o;this.onChainChanged(l)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r,i;if(e!==((r=this.session)==null?void 0:r.topic))return;const{namespaces:n}=t,o=(i=this.client)==null?void 0:i.session.get(e);this.session=Ia(ro({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ia(ro({},Te("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Jt.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[si]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:r,sessionProperties:i,scopedProperties:n}=e;t&&Object.keys(t).length&&(this.namespaces=t),r&&Object.keys(r).length&&(this.optionalNamespaces=r),this.sessionProperties=i,this.scopedProperties=n}validateChain(e){const[t,r]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,r];if(t&&!Object.keys(this.namespaces||{}).map(o=>Yi(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];const i=Yi(Object.keys(this.namespaces)[0]),n=this.rpcProviders[i].getDefaultChain();return[i,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[r,i]=this.validateChain(e);if(!i)return;this.updateNamespaceChain(r,i),this.events.emit("chainChanged",i);const n=this.getProvider(r).getDefaultChain();t||this.getProvider(r).setDefaultChain(i),this.emitAccountsChangedOnChainChange({namespace:r,previousChainId:n,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:r}){var i,n;try{if(t===r)return;const o=(n=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map($d);if(!Qs(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const r=this.namespaces[e]?e:`${e}:${t}`,i={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=t):this.namespaces[r]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.setItem(`${to}/${e}${i}`,t)}async getFromStore(e){var t;const r=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${to}/${e}${r}`)}async deleteFromStore(e){var t;const r=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${to}/${e}${r}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const r of t)r.startsWith(to)&&await this.client.core.storage.removeItem(r)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}};var bi={};const Z0="https://secure.walletconnect.org/sdk",J0=(typeof os<"u"&&typeof bi<"u"?bi.NEXT_PUBLIC_SECURE_SITE_SDK_URL:void 0)||Z0,X0=(typeof os<"u"&&typeof bi<"u"?bi.NEXT_PUBLIC_DEFAULT_LOG_LEVEL:void 0)||"error",Q0=(typeof os<"u"&&typeof bi<"u"?bi.NEXT_PUBLIC_SECURE_SITE_SDK_VERSION:void 0)||"4",V={APP_EVENT_KEY:"@w3m-app/",FRAME_EVENT_KEY:"@w3m-frame/",RPC_METHOD_KEY:"RPC_",STORAGE_KEY:"@appkit-wallet/",SESSION_TOKEN_KEY:"SESSION_TOKEN_KEY",EMAIL_LOGIN_USED_KEY:"EMAIL_LOGIN_USED_KEY",LAST_USED_CHAIN_KEY:"LAST_USED_CHAIN_KEY",LAST_EMAIL_LOGIN_TIME:"LAST_EMAIL_LOGIN_TIME",EMAIL:"EMAIL",PREFERRED_ACCOUNT_TYPE:"PREFERRED_ACCOUNT_TYPE",SMART_ACCOUNT_ENABLED:"SMART_ACCOUNT_ENABLED",SMART_ACCOUNT_ENABLED_NETWORKS:"SMART_ACCOUNT_ENABLED_NETWORKS",SOCIAL_USERNAME:"SOCIAL_USERNAME",APP_SWITCH_NETWORK:"@w3m-app/SWITCH_NETWORK",APP_CONNECT_EMAIL:"@w3m-app/CONNECT_EMAIL",APP_CONNECT_DEVICE:"@w3m-app/CONNECT_DEVICE",APP_CONNECT_OTP:"@w3m-app/CONNECT_OTP",APP_CONNECT_SOCIAL:"@w3m-app/CONNECT_SOCIAL",APP_GET_SOCIAL_REDIRECT_URI:"@w3m-app/GET_SOCIAL_REDIRECT_URI",APP_GET_USER:"@w3m-app/GET_USER",APP_SIGN_OUT:"@w3m-app/SIGN_OUT",APP_IS_CONNECTED:"@w3m-app/IS_CONNECTED",APP_GET_CHAIN_ID:"@w3m-app/GET_CHAIN_ID",APP_RPC_REQUEST:"@w3m-app/RPC_REQUEST",APP_UPDATE_EMAIL:"@w3m-app/UPDATE_EMAIL",APP_UPDATE_EMAIL_PRIMARY_OTP:"@w3m-app/UPDATE_EMAIL_PRIMARY_OTP",APP_UPDATE_EMAIL_SECONDARY_OTP:"@w3m-app/UPDATE_EMAIL_SECONDARY_OTP",APP_AWAIT_UPDATE_EMAIL:"@w3m-app/AWAIT_UPDATE_EMAIL",APP_SYNC_THEME:"@w3m-app/SYNC_THEME",APP_SYNC_DAPP_DATA:"@w3m-app/SYNC_DAPP_DATA",APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS:"@w3m-app/GET_SMART_ACCOUNT_ENABLED_NETWORKS",APP_INIT_SMART_ACCOUNT:"@w3m-app/INIT_SMART_ACCOUNT",APP_SET_PREFERRED_ACCOUNT:"@w3m-app/SET_PREFERRED_ACCOUNT",APP_CONNECT_FARCASTER:"@w3m-app/CONNECT_FARCASTER",APP_GET_FARCASTER_URI:"@w3m-app/GET_FARCASTER_URI",APP_RELOAD:"@w3m-app/RELOAD",FRAME_SWITCH_NETWORK_ERROR:"@w3m-frame/SWITCH_NETWORK_ERROR",FRAME_SWITCH_NETWORK_SUCCESS:"@w3m-frame/SWITCH_NETWORK_SUCCESS",FRAME_CONNECT_EMAIL_ERROR:"@w3m-frame/CONNECT_EMAIL_ERROR",FRAME_CONNECT_EMAIL_SUCCESS:"@w3m-frame/CONNECT_EMAIL_SUCCESS",FRAME_CONNECT_DEVICE_ERROR:"@w3m-frame/CONNECT_DEVICE_ERROR",FRAME_CONNECT_DEVICE_SUCCESS:"@w3m-frame/CONNECT_DEVICE_SUCCESS",FRAME_CONNECT_OTP_SUCCESS:"@w3m-frame/CONNECT_OTP_SUCCESS",FRAME_CONNECT_OTP_ERROR:"@w3m-frame/CONNECT_OTP_ERROR",FRAME_CONNECT_SOCIAL_SUCCESS:"@w3m-frame/CONNECT_SOCIAL_SUCCESS",FRAME_CONNECT_SOCIAL_ERROR:"@w3m-frame/CONNECT_SOCIAL_ERROR",FRAME_CONNECT_FARCASTER_SUCCESS:"@w3m-frame/CONNECT_FARCASTER_SUCCESS",FRAME_CONNECT_FARCASTER_ERROR:"@w3m-frame/CONNECT_FARCASTER_ERROR",FRAME_GET_FARCASTER_URI_SUCCESS:"@w3m-frame/GET_FARCASTER_URI_SUCCESS",FRAME_GET_FARCASTER_URI_ERROR:"@w3m-frame/GET_FARCASTER_URI_ERROR",FRAME_GET_SOCIAL_REDIRECT_URI_SUCCESS:"@w3m-frame/GET_SOCIAL_REDIRECT_URI_SUCCESS",FRAME_GET_SOCIAL_REDIRECT_URI_ERROR:"@w3m-frame/GET_SOCIAL_REDIRECT_URI_ERROR",FRAME_GET_USER_SUCCESS:"@w3m-frame/GET_USER_SUCCESS",FRAME_GET_USER_ERROR:"@w3m-frame/GET_USER_ERROR",FRAME_SIGN_OUT_SUCCESS:"@w3m-frame/SIGN_OUT_SUCCESS",FRAME_SIGN_OUT_ERROR:"@w3m-frame/SIGN_OUT_ERROR",FRAME_IS_CONNECTED_SUCCESS:"@w3m-frame/IS_CONNECTED_SUCCESS",FRAME_IS_CONNECTED_ERROR:"@w3m-frame/IS_CONNECTED_ERROR",FRAME_GET_CHAIN_ID_SUCCESS:"@w3m-frame/GET_CHAIN_ID_SUCCESS",FRAME_GET_CHAIN_ID_ERROR:"@w3m-frame/GET_CHAIN_ID_ERROR",FRAME_RPC_REQUEST_SUCCESS:"@w3m-frame/RPC_REQUEST_SUCCESS",FRAME_RPC_REQUEST_ERROR:"@w3m-frame/RPC_REQUEST_ERROR",FRAME_SESSION_UPDATE:"@w3m-frame/SESSION_UPDATE",FRAME_UPDATE_EMAIL_SUCCESS:"@w3m-frame/UPDATE_EMAIL_SUCCESS",FRAME_UPDATE_EMAIL_ERROR:"@w3m-frame/UPDATE_EMAIL_ERROR",FRAME_UPDATE_EMAIL_PRIMARY_OTP_SUCCESS:"@w3m-frame/UPDATE_EMAIL_PRIMARY_OTP_SUCCESS",FRAME_UPDATE_EMAIL_PRIMARY_OTP_ERROR:"@w3m-frame/UPDATE_EMAIL_PRIMARY_OTP_ERROR",FRAME_UPDATE_EMAIL_SECONDARY_OTP_SUCCESS:"@w3m-frame/UPDATE_EMAIL_SECONDARY_OTP_SUCCESS",FRAME_UPDATE_EMAIL_SECONDARY_OTP_ERROR:"@w3m-frame/UPDATE_EMAIL_SECONDARY_OTP_ERROR",FRAME_SYNC_THEME_SUCCESS:"@w3m-frame/SYNC_THEME_SUCCESS",FRAME_SYNC_THEME_ERROR:"@w3m-frame/SYNC_THEME_ERROR",FRAME_SYNC_DAPP_DATA_SUCCESS:"@w3m-frame/SYNC_DAPP_DATA_SUCCESS",FRAME_SYNC_DAPP_DATA_ERROR:"@w3m-frame/SYNC_DAPP_DATA_ERROR",FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS:"@w3m-frame/GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS",FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_ERROR:"@w3m-frame/GET_SMART_ACCOUNT_ENABLED_NETWORKS_ERROR",FRAME_INIT_SMART_ACCOUNT_SUCCESS:"@w3m-frame/INIT_SMART_ACCOUNT_SUCCESS",FRAME_INIT_SMART_ACCOUNT_ERROR:"@w3m-frame/INIT_SMART_ACCOUNT_ERROR",FRAME_SET_PREFERRED_ACCOUNT_SUCCESS:"@w3m-frame/SET_PREFERRED_ACCOUNT_SUCCESS",FRAME_SET_PREFERRED_ACCOUNT_ERROR:"@w3m-frame/SET_PREFERRED_ACCOUNT_ERROR",FRAME_READY:"@w3m-frame/READY",FRAME_RELOAD_SUCCESS:"@w3m-frame/RELOAD_SUCCESS",FRAME_RELOAD_ERROR:"@w3m-frame/RELOAD_ERROR",RPC_RESPONSE_TYPE_ERROR:"RPC_RESPONSE_ERROR",RPC_RESPONSE_TYPE_TX:"RPC_RESPONSE_TRANSACTION_HASH",RPC_RESPONSE_TYPE_OBJECT:"RPC_RESPONSE_OBJECT"},dt={SAFE_RPC_METHODS:["eth_accounts","eth_blockNumber","eth_call","eth_chainId","eth_estimateGas","eth_feeHistory","eth_gasPrice","eth_getAccount","eth_getBalance","eth_getBlockByHash","eth_getBlockByNumber","eth_getBlockReceipts","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getCode","eth_getFilterChanges","eth_getFilterLogs","eth_getLogs","eth_getProof","eth_getStorageAt","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionByHash","eth_getTransactionCount","eth_getTransactionReceipt","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_maxPriorityFeePerGas","eth_newBlockFilter","eth_newFilter","eth_newPendingTransactionFilter","eth_sendRawTransaction","eth_syncing","eth_uninstallFilter","wallet_getCapabilities","wallet_getCallsStatus","eth_getUserOperationReceipt","eth_estimateUserOperationGas","eth_getUserOperationByHash","eth_supportedEntryPoints","wallet_getAssets"],NOT_SAFE_RPC_METHODS:["personal_sign","eth_signTypedData_v4","eth_sendTransaction","solana_signMessage","solana_signTransaction","solana_signAllTransactions","solana_signAndSendTransaction","wallet_sendCalls","wallet_grantPermissions","wallet_revokePermissions","eth_sendUserOperation"],GET_CHAIN_ID:"eth_chainId",RPC_METHOD_NOT_ALLOWED_MESSAGE:"Requested RPC call is not allowed",RPC_METHOD_NOT_ALLOWED_UI_MESSAGE:"Action not allowed",ACCOUNT_TYPES:{EOA:"eoa",SMART_ACCOUNT:"smartAccount"}},pr=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),Ge=je({...pr}),rs={state:Ge,subscribeKey(s,e){return Rt(Ge,s,e)},showLoading(s,e={}){this._showMessage({message:s,variant:"loading",...e})},showSuccess(s){this._showMessage({message:s,variant:"success"})},showSvg(s,e){this._showMessage({message:s,svg:e})},showError(s){const e=ie.parseError(s);this._showMessage({message:e,variant:"error"})},hide(){Ge.message=pr.message,Ge.variant=pr.variant,Ge.svg=pr.svg,Ge.open=pr.open,Ge.autoClose=pr.autoClose},_showMessage({message:s,svg:e,variant:t="success",autoClose:r=pr.autoClose}){Ge.open?(Ge.open=!1,setTimeout(()=>{Ge.message=s,Ge.variant=t,Ge.svg=e,Ge.open=!0,Ge.autoClose=r},150)):(Ge.message=s,Ge.variant=t,Ge.svg=e,Ge.open=!0,Ge.autoClose=r)}},tn={getSIWX(){return x.state.siwx},async initializeIfEnabled(){var n;const s=x.state.siwx,e=y.getActiveCaipAddress();if(!(s&&e))return;const[t,r,i]=e.split(":");if(y.checkIfSupportedNetwork(t))try{if((await s.getSessions(`${t}:${r}`,i)).length)return;await Fe.open({view:"SIWXSignMessage"})}catch(o){console.error("SIWXUtil:initializeIfEnabled",o),Le.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties()}),await((n=Ue._getClient())==null?void 0:n.disconnect().catch(console.error)),Ae.reset("Connect"),rs.showError("A problem occurred while trying initialize authentication")}},async requestSignMessage(){const s=x.state.siwx,e=ie.getPlainAddress(y.getActiveCaipAddress()),t=y.getActiveCaipNetwork(),r=Ue._getClient();if(!s)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!t)throw new Error("No ActiveCaipNetwork or client found");if(!r)throw new Error("No ConnectionController client found");try{const i=await s.createMessage({chainId:t.caipNetworkId,accountAddress:e}),n=i.toString();ne.getConnectorId(t.chainNamespace)===G.CONNECTOR_ID.AUTH&&Ae.pushTransactionStack({view:null,goBack:!1,replace:!0});const a=await r.signMessage(n);await s.addSession({data:i,message:n,signature:a}),Fe.close(),Le.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(i){const n=this.getSIWXEventProperties();(!Fe.state.open||Ae.state.view==="ApproveTransaction")&&await Fe.open({view:"SIWXSignMessage"}),n.isSmartAccount?rs.showError("This application might not support Smart Accounts"):rs.showError("Signature declined"),Le.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:n}),console.error("SWIXUtil:requestSignMessage",i)}},async cancelSignMessage(){var s;try{const e=this.getSIWX();((s=e==null?void 0:e.getRequired)==null?void 0:s.call(e))?await Ue.disconnect():Fe.close(),Ae.reset("Connect"),Le.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(e){console.error("SIWXUtil:cancelSignMessage",e)}},async getSessions(){const s=x.state.siwx,e=ie.getPlainAddress(y.getActiveCaipAddress()),t=y.getActiveCaipNetwork();return s&&e&&t?s.getSessions(t.caipNetworkId,e):[]},async isSIWXCloseDisabled(){var e;const s=this.getSIWX();if(s){const t=Ae.state.view==="ApproveTransaction",r=Ae.state.view==="SIWXSignMessage";if(t||r)return((e=s.getRequired)==null?void 0:e.call(s))&&(await this.getSessions()).length===0}return!1},async universalProviderAuthenticate({universalProvider:s,chains:e,methods:t}){var a,c,l;const r=tn.getSIWX(),i=new Set(e.map(d=>d.split(":")[0]));if(!r||i.size!==1||!i.has("eip155"))return!1;const n=await r.createMessage({chainId:((a=y.getActiveCaipNetwork())==null?void 0:a.caipNetworkId)||"",accountAddress:""}),o=await s.authenticate({nonce:n.nonce,domain:n.domain,uri:n.uri,exp:n.expirationTime,iat:n.issuedAt,nbf:n.notBefore,requestId:n.requestId,version:n.version,resources:n.resources,statement:n.statement,chainId:n.chainId,methods:t,chains:[n.chainId,...e.filter(d=>d!==n.chainId)]});if(rs.showLoading("Authenticating...",{autoClose:!1}),Y.setConnectedWalletInfo({...o.session.peer.metadata,name:o.session.peer.metadata.name,icon:(c=o.session.peer.metadata.icons)==null?void 0:c[0],type:"WALLET_CONNECT"},Array.from(i)[0]),(l=o==null?void 0:o.auths)!=null&&l.length){const d=o.auths.map(u=>{const h=s.client.formatAuthMessage({request:u.p,iss:u.p.iss});return{data:{...u.p,accountAddress:u.p.iss.split(":").slice(-1).join(""),chainId:u.p.iss.split(":").slice(2,4).join(":"),uri:u.p.aud,version:u.p.version||n.version,expirationTime:u.p.exp,issuedAt:u.p.iat,notBefore:u.p.nbf},message:h,signature:u.s.s,cacao:u}});try{await r.setSessions(d),Le.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:tn.getSIWXEventProperties()})}catch(u){throw console.error("SIWX:universalProviderAuth - failed to set sessions",u),Le.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:tn.getSIWXEventProperties()}),await s.disconnect().catch(console.error),u}finally{rs.hide()}}return!0},getSIWXEventProperties(){var e,t;const s=y.state.activeChain;return{network:((e=y.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)||"",isSmartAccount:((t=Y.state.preferredAccountTypes)==null?void 0:t[s])===dt.ACCOUNT_TYPES.SMART_ACCOUNT}},async clearSessions(){const s=this.getSIWX();s&&await s.setSessions([])}},ke=je({transactions:[],coinbaseTransactions:{},transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),eA={state:ke,subscribe(s){return Et(ke,()=>s(ke))},setLastNetworkInView(s){ke.lastNetworkInView=s},async fetchTransactions(s,e){var t,r;if(!s)throw new Error("Transactions can't be fetched without an accountAddress");ke.loading=!0;try{const i=await re.fetchTransactions({account:s,cursor:ke.next,onramp:e,cache:e==="coinbase"?"no-cache":void 0,chainId:(t=y.state.activeCaipNetwork)==null?void 0:t.caipNetworkId}),n=this.filterSpamTransactions(i.data),o=this.filterByConnectedChain(n),a=[...ke.transactions,...o];ke.loading=!1,e==="coinbase"?ke.coinbaseTransactions=this.groupTransactionsByYearAndMonth(ke.coinbaseTransactions,i.data):(ke.transactions=a,ke.transactionsByYear=this.groupTransactionsByYearAndMonth(ke.transactionsByYear,o)),ke.empty=a.length===0,ke.next=i.next?i.next:void 0}catch{const n=y.state.activeChain;Le.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:s,projectId:x.state.projectId,cursor:ke.next,isSmartAccount:((r=Y.state.preferredAccountTypes)==null?void 0:r[n])===dt.ACCOUNT_TYPES.SMART_ACCOUNT}}),rs.showError("Failed to fetch transactions"),ke.loading=!1,ke.empty=!0,ke.next=void 0}},groupTransactionsByYearAndMonth(s={},e=[]){const t=s;return e.forEach(r=>{const i=new Date(r.metadata.minedAt).getFullYear(),n=new Date(r.metadata.minedAt).getMonth(),o=t[i]??{},c=(o[n]??[]).filter(l=>l.id!==r.id);t[i]={...o,[n]:[...c,r].sort((l,d)=>new Date(d.metadata.minedAt).getTime()-new Date(l.metadata.minedAt).getTime())}}),t},filterSpamTransactions(s){return s.filter(e=>!e.transfers.every(r=>{var i;return((i=r.nft_info)==null?void 0:i.flags.is_spam)===!0}))},filterByConnectedChain(s){var r;const e=(r=y.state.activeCaipNetwork)==null?void 0:r.caipNetworkId;return s.filter(i=>i.metadata.chain===e)},clearCursor(){ke.next=void 0},resetTransactions(){ke.transactions=[],ke.transactionsByYear={},ke.lastNetworkInView=void 0,ke.loading=!1,ke.empty=!1,ke.next=void 0}},$e=je({wcError:!1,buffering:!1,status:"disconnected"});let dr;const Ue={state:$e,subscribeKey(s,e){return Rt($e,s,e)},_getClient(){return $e._client},setClient(s){$e._client=Ar(s)},async connectWalletConnect(){var s,e,t,r;if(ie.isTelegram()||ie.isSafari()&&ie.isIos()){if(dr){await dr,dr=void 0;return}if(!ie.isPairingExpired($e==null?void 0:$e.wcPairingExpiry)){const i=$e.wcUri;$e.wcUri=i;return}dr=(e=(s=this._getClient())==null?void 0:s.connectWalletConnect)==null?void 0:e.call(s).catch(()=>{}),this.state.status="connecting",await dr,dr=void 0,$e.wcPairingExpiry=void 0,this.state.status="connected"}else await((r=(t=this._getClient())==null?void 0:t.connectWalletConnect)==null?void 0:r.call(t))},async connectExternal(s,e,t=!0){var r,i;await((i=(r=this._getClient())==null?void 0:r.connectExternal)==null?void 0:i.call(r,s)),t&&y.setActiveNamespace(e)},async reconnectExternal(s){var t,r;await((r=(t=this._getClient())==null?void 0:t.reconnectExternal)==null?void 0:r.call(t,s));const e=s.chain||y.state.activeChain;e&&ne.setConnectorId(s.id,e)},async setPreferredAccountType(s,e){var r;Fe.setLoading(!0,y.state.activeChain);const t=ne.getAuthConnector();t&&(Y.setPreferredAccountType(s,e),await t.provider.setPreferredAccount(s),K.setPreferredAccountTypes(Y.state.preferredAccountTypes??{[e]:s}),await this.reconnectExternal(t),Fe.setLoading(!1,y.state.activeChain),Le.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:s,network:((r=y.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)||""}}))},async signMessage(s){var e;return(e=this._getClient())==null?void 0:e.signMessage(s)},parseUnits(s,e){var t;return(t=this._getClient())==null?void 0:t.parseUnits(s,e)},formatUnits(s,e){var t;return(t=this._getClient())==null?void 0:t.formatUnits(s,e)},async sendTransaction(s){var e;return(e=this._getClient())==null?void 0:e.sendTransaction(s)},async getCapabilities(s){var e;return(e=this._getClient())==null?void 0:e.getCapabilities(s)},async grantPermissions(s){var e;return(e=this._getClient())==null?void 0:e.grantPermissions(s)},async walletGetAssets(s){var e;return((e=this._getClient())==null?void 0:e.walletGetAssets(s))??{}},async estimateGas(s){var e;return(e=this._getClient())==null?void 0:e.estimateGas(s)},async writeContract(s){var e;return(e=this._getClient())==null?void 0:e.writeContract(s)},async getEnsAddress(s){var e;return(e=this._getClient())==null?void 0:e.getEnsAddress(s)},async getEnsAvatar(s){var e;return(e=this._getClient())==null?void 0:e.getEnsAvatar(s)},checkInstalled(s){var e,t;return((t=(e=this._getClient())==null?void 0:e.checkInstalled)==null?void 0:t.call(e,s))||!1},resetWcConnection(){$e.wcUri=void 0,$e.wcPairingExpiry=void 0,$e.wcLinking=void 0,$e.recentWallet=void 0,$e.status="disconnected",eA.resetTransactions(),K.deleteWalletConnectDeepLink()},resetUri(){$e.wcUri=void 0,$e.wcPairingExpiry=void 0,dr=void 0},finalizeWcConnection(){var t,r;const{wcLinking:s,recentWallet:e}=Ue.state;s&&K.setWalletConnectDeepLink(s),e&&K.setAppKitRecent(e),Le.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:s?"mobile":"qrcode",name:((r=(t=Ae.state.data)==null?void 0:t.wallet)==null?void 0:r.name)||"Unknown"}})},setWcBasic(s){$e.wcBasic=s},setUri(s){$e.wcUri=s,$e.wcPairingExpiry=ie.getPairingExpiry()},setWcLinking(s){$e.wcLinking=s},setWcError(s){$e.wcError=s,$e.buffering=!1},setRecentWallet(s){$e.recentWallet=s},setBuffering(s){$e.buffering=s},setStatus(s){$e.status=s},async disconnect(s){try{Fe.setLoading(!0,s),await tn.clearSessions(),await y.disconnect(s),Fe.setLoading(!1,s),ne.setFilterByNamespace(void 0)}catch{throw new Error("Failed to disconnect")}}},ti=je({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1}),Es={state:ti,subscribe(s){return Et(ti,()=>s(ti))},subscribeOpen(s){return Rt(ti,"open",s)},set(s){Object.assign(ti,{...ti,...s})}},Sa={createBalance(s,e){const t={name:s.metadata.name||"",symbol:s.metadata.symbol||"",decimals:s.metadata.decimals||0,value:s.metadata.value||0,price:s.metadata.price||0,iconUrl:s.metadata.iconUrl||""};return{name:t.name,symbol:t.symbol,chainId:e,address:s.address==="native"?void 0:this.convertAddressToCAIP10Address(s.address,e),value:t.value,price:t.price,quantity:{decimals:t.decimals.toString(),numeric:this.convertHexToBalance({hex:s.balance,decimals:t.decimals})},iconUrl:t.iconUrl}},convertHexToBalance({hex:s,decimals:e}){return Ap(BigInt(s),e)},convertAddressToCAIP10Address(s,e){return`${e}:${s}`},createCAIP2ChainId(s,e){return`${e}:${parseInt(s,16)}`},getChainIdHexFromCAIP2ChainId(s){const e=s.split(":");if(e.length<2||!e[1])return"0x0";const t=e[1],r=parseInt(t,10);return isNaN(r)?"0x0":`0x${r.toString(16)}`},isWalletGetAssetsResponse(s){return typeof s!="object"||s===null?!1:Object.values(s).every(e=>Array.isArray(e)&&e.every(t=>this.isValidAsset(t)))},isValidAsset(s){return typeof s=="object"&&s!==null&&typeof s.address=="string"&&typeof s.balance=="string"&&(s.type==="ERC20"||s.type==="NATIVE")&&typeof s.metadata=="object"&&s.metadata!==null&&typeof s.metadata.name=="string"&&typeof s.metadata.symbol=="string"&&typeof s.metadata.decimals=="number"&&typeof s.metadata.price=="number"&&typeof s.metadata.iconUrl=="string"}},Bd={async getMyTokensWithBalance(s){const e=Y.state.address,t=y.state.activeCaipNetwork;if(!e||!t)return[];if(t.chainNamespace==="eip155"){const i=await this.getEIP155Balances(e,t);if(i)return this.filterLowQualityTokens(i)}const r=await re.getBalance(e,t.caipNetworkId,s);return this.filterLowQualityTokens(r.balances)},async getEIP155Balances(s,e){var t,r;try{const i=Sa.getChainIdHexFromCAIP2ChainId(e.caipNetworkId),n=await Ue.getCapabilities(s);if(!((r=(t=n==null?void 0:n[i])==null?void 0:t.assetDiscovery)!=null&&r.supported))return null;const o=await Ue.walletGetAssets({account:s,chainFilter:[i]});return Sa.isWalletGetAssetsResponse(o)?(o[i]||[]).map(c=>Sa.createBalance(c,e.caipNetworkId)):null}catch{return null}},filterLowQualityTokens(s){return s.filter(e=>e.quantity.decimals!=="0")},mapBalancesToSwapTokens(s){return(s==null?void 0:s.map(e=>({...e,address:e!=null&&e.address?e.address:y.getActiveNetworkTokenAddress(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1})))||[]}},Ie=je({tokenBalances:[],loading:!1}),qd={state:Ie,subscribe(s){return Et(Ie,()=>s(Ie))},subscribeKey(s,e){return Rt(Ie,s,e)},setToken(s){s&&(Ie.token=Ar(s))},setTokenAmount(s){Ie.sendTokenAmount=s},setReceiverAddress(s){Ie.receiverAddress=s},setReceiverProfileImageUrl(s){Ie.receiverProfileImageUrl=s},setReceiverProfileName(s){Ie.receiverProfileName=s},setNetworkBalanceInUsd(s){Ie.networkBalanceInUSD=s},setLoading(s){Ie.loading=s},async sendToken(){var s;try{switch(this.setLoading(!0),(s=y.state.activeCaipNetwork)==null?void 0:s.chainNamespace){case"eip155":await this.sendEvmToken();return;case"solana":await this.sendSolanaToken();return;default:throw new Error("Unsupported chain")}}finally{this.setLoading(!1)}},async sendEvmToken(){var t,r,i,n;const s=y.state.activeChain,e=(t=Y.state.preferredAccountTypes)==null?void 0:t[s];if(!this.state.sendTokenAmount||!this.state.receiverAddress)throw new Error("An amount and receiver address are required");if(!this.state.token)throw new Error("A token is required");(r=this.state.token)!=null&&r.address?(Le.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===dt.ACCOUNT_TYPES.SMART_ACCOUNT,token:this.state.token.address,amount:this.state.sendTokenAmount,network:((i=y.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||""}}),await this.sendERC20Token({receiverAddress:this.state.receiverAddress,tokenAddress:this.state.token.address,sendTokenAmount:this.state.sendTokenAmount,decimals:this.state.token.quantity.decimals})):(Le.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===dt.ACCOUNT_TYPES.SMART_ACCOUNT,token:this.state.token.symbol||"",amount:this.state.sendTokenAmount,network:((n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}}),await this.sendNativeToken({receiverAddress:this.state.receiverAddress,sendTokenAmount:this.state.sendTokenAmount,decimals:this.state.token.quantity.decimals}))},async fetchTokenBalance(s){var n,o;Ie.loading=!0;const e=(n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId,t=(o=y.state.activeCaipNetwork)==null?void 0:o.chainNamespace,r=y.state.activeCaipAddress,i=r?ie.getPlainAddress(r):void 0;if(Ie.lastRetry&&!ie.isAllowedRetry(Ie.lastRetry,30*lt.ONE_SEC_MS))return Ie.loading=!1,[];try{if(i&&e&&t){const a=await Bd.getMyTokensWithBalance();return Ie.tokenBalances=a,Ie.lastRetry=void 0,a}}catch(a){Ie.lastRetry=Date.now(),s==null||s(a),rs.showError("Token Balance Unavailable")}finally{Ie.loading=!1}return[]},fetchNetworkBalance(){if(Ie.tokenBalances.length===0)return;const s=Bd.mapBalancesToSwapTokens(Ie.tokenBalances);if(!s)return;const e=s.find(t=>t.address===y.getActiveNetworkTokenAddress());e&&(Ie.networkBalanceInUSD=e?Bp.multiply(e.quantity.numeric,e.price).toString():"0")},async sendNativeToken(s){var o,a,c;const e=y.state.activeChain;Ae.pushTransactionStack({view:null,goBack:!1});const t=s.receiverAddress,r=Y.state.address,i=Ue.parseUnits(s.sendTokenAmount.toString(),Number(s.decimals));await Ue.sendTransaction({chainNamespace:"eip155",to:t,address:r,data:"0x",value:i??BigInt(0)}),Le.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:((o=Y.state.preferredAccountTypes)==null?void 0:o[e])===dt.ACCOUNT_TYPES.SMART_ACCOUNT,token:((a=this.state.token)==null?void 0:a.symbol)||"",amount:s.sendTokenAmount,network:((c=y.state.activeCaipNetwork)==null?void 0:c.caipNetworkId)||""}}),this.resetSend()},async sendERC20Token(s){Ae.pushTransactionStack({view:"Account",goBack:!1});const e=Ue.parseUnits(s.sendTokenAmount.toString(),Number(s.decimals));if(Y.state.address&&s.sendTokenAmount&&s.receiverAddress&&s.tokenAddress){const t=ie.getPlainAddress(s.tokenAddress);await Ue.writeContract({fromAddress:Y.state.address,tokenAddress:t,args:[s.receiverAddress,e??BigInt(0)],method:"transfer",abi:Hp.getERC20Abi(t),chainNamespace:"eip155"}),this.resetSend()}},async sendSolanaToken(){if(!this.state.sendTokenAmount||!this.state.receiverAddress)throw new Error("An amount and receiver address are required");Ae.pushTransactionStack({view:"Account",goBack:!1}),await Ue.sendTransaction({chainNamespace:"solana",to:this.state.receiverAddress,value:this.state.sendTokenAmount}),this.resetSend(),Y.fetchTokenBalance()},resetSend(){Ie.token=void 0,Ie.sendTokenAmount=void 0,Ie.receiverAddress=void 0,Ie.receiverProfileImageUrl=void 0,Ie.receiverProfileName=void 0,Ie.loading=!1,Ie.tokenBalances=[]}},Na={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[],user:void 0},io={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},B=je({chains:Rp(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{networkControllerClient:void 0,connectionControllerClient:void 0},isSwitchingNamespace:!1}),y={state:B,subscribe(s){return Et(B,()=>{s(B)})},subscribeKey(s,e){return Rt(B,s,e)},subscribeChainProp(s,e,t){let r;return Et(B.chains,()=>{var n;const i=t||B.activeChain;if(i){const o=(n=B.chains.get(i))==null?void 0:n[s];r!==o&&(r=o,e(o))}})},initialize(s,e,t){const{chainId:r,namespace:i}=K.getActiveNetworkProps(),n=e==null?void 0:e.find(d=>d.id.toString()===(r==null?void 0:r.toString())),a=s.find(d=>(d==null?void 0:d.namespace)===i)||(s==null?void 0:s[0]),c=s.map(d=>d.namespace).filter(d=>d!==void 0),l=x.state.enableEmbedded?new Set([...c]):new Set([...(e==null?void 0:e.map(d=>d.chainNamespace))??[]]);((s==null?void 0:s.length)===0||!a)&&(B.noAdapters=!0),B.noAdapters||(B.activeChain=a==null?void 0:a.namespace,B.activeCaipNetwork=n,this.setChainNetworkData(a==null?void 0:a.namespace,{caipNetwork:n}),B.activeChain&&Es.set({activeChain:a==null?void 0:a.namespace})),l.forEach(d=>{const u=e==null?void 0:e.filter(h=>h.chainNamespace===d);y.state.chains.set(d,{namespace:d,networkState:je({...io,caipNetwork:u==null?void 0:u[0]}),accountState:je(Na),caipNetworks:u??[],...t}),this.setRequestedCaipNetworks(u??[],d)})},removeAdapter(s){var e,t;if(B.activeChain===s){const r=Array.from(B.chains.entries()).find(([i])=>i!==s);if(r){const i=(t=(e=r[1])==null?void 0:e.caipNetworks)==null?void 0:t[0];i&&this.setActiveCaipNetwork(i)}}B.chains.delete(s)},addAdapter(s,{networkControllerClient:e,connectionControllerClient:t},r){B.chains.set(s.namespace,{namespace:s.namespace,networkState:{...io,caipNetwork:r[0]},accountState:Na,caipNetworks:r,connectionControllerClient:t,networkControllerClient:e}),this.setRequestedCaipNetworks((r==null?void 0:r.filter(i=>i.chainNamespace===s.namespace))??[],s.namespace)},addNetwork(s){var t;const e=B.chains.get(s.chainNamespace);if(e){const r=[...e.caipNetworks||[]];(t=e.caipNetworks)!=null&&t.find(i=>i.id===s.id)||r.push(s),B.chains.set(s.chainNamespace,{...e,caipNetworks:r}),this.setRequestedCaipNetworks(r,s.chainNamespace),ne.filterByNamespace(s.chainNamespace,!0)}},removeNetwork(s,e){var r,i,n;const t=B.chains.get(s);if(t){const o=((r=B.activeCaipNetwork)==null?void 0:r.id)===e,a=[...((i=t.caipNetworks)==null?void 0:i.filter(c=>c.id!==e))||[]];o&&((n=t==null?void 0:t.caipNetworks)!=null&&n[0])&&this.setActiveCaipNetwork(t.caipNetworks[0]),B.chains.set(s,{...t,caipNetworks:a}),this.setRequestedCaipNetworks(a||[],s),a.length===0&&ne.filterByNamespace(s,!1)}},setAdapterNetworkState(s,e){const t=B.chains.get(s);t&&(t.networkState={...t.networkState||io,...e},B.chains.set(s,t))},setChainAccountData(s,e,t=!0){if(!s)throw new Error("Chain is required to update chain account data");const r=B.chains.get(s);if(r){const i={...r.accountState||Na,...e};B.chains.set(s,{...r,accountState:i}),(B.chains.size===1||B.activeChain===s)&&(e.caipAddress&&(B.activeCaipAddress=e.caipAddress),Y.replaceState(i))}},setChainNetworkData(s,e){if(!s)return;const t=B.chains.get(s);if(t){const r={...t.networkState||io,...e};B.chains.set(s,{...t,networkState:r})}},setAccountProp(s,e,t,r=!0){this.setChainAccountData(t,{[s]:e},r),s==="status"&&e==="disconnected"&&t&&ne.removeConnectorId(t)},setActiveNamespace(s){var r,i;B.activeChain=s;const e=s?B.chains.get(s):void 0,t=(r=e==null?void 0:e.networkState)==null?void 0:r.caipNetwork;t!=null&&t.id&&s&&(B.activeCaipAddress=(i=e==null?void 0:e.accountState)==null?void 0:i.caipAddress,B.activeCaipNetwork=t,this.setChainNetworkData(s,{caipNetwork:t}),K.setActiveCaipNetworkId(t==null?void 0:t.caipNetworkId),Es.set({activeChain:s,selectedNetworkId:t==null?void 0:t.caipNetworkId}))},setActiveCaipNetwork(s){var r,i,n;if(!s)return;B.activeChain!==s.chainNamespace&&this.setIsSwitchingNamespace(!0);const e=B.chains.get(s.chainNamespace);B.activeChain=s.chainNamespace,B.activeCaipNetwork=s,this.setChainNetworkData(s.chainNamespace,{caipNetwork:s}),(r=e==null?void 0:e.accountState)!=null&&r.address?B.activeCaipAddress=`${s.chainNamespace}:${s.id}:${(i=e==null?void 0:e.accountState)==null?void 0:i.address}`:B.activeCaipAddress=void 0,this.setAccountProp("caipAddress",B.activeCaipAddress,s.chainNamespace),e&&Y.replaceState(e.accountState),qd.resetSend(),Es.set({activeChain:B.activeChain,selectedNetworkId:(n=B.activeCaipNetwork)==null?void 0:n.caipNetworkId}),K.setActiveCaipNetworkId(s.caipNetworkId),!this.checkIfSupportedNetwork(s.chainNamespace)&&x.state.enableNetworkSwitch&&!x.state.allowUnsupportedChain&&!Ue.state.wcBasic&&this.showUnsupportedChainUI()},addCaipNetwork(s){var t;if(!s)return;const e=B.chains.get(s.chainNamespace);e&&((t=e==null?void 0:e.caipNetworks)==null||t.push(s))},async switchActiveNamespace(s){var i;if(!s)return;const e=s!==y.state.activeChain,t=(i=y.getNetworkData(s))==null?void 0:i.caipNetwork,r=y.getCaipNetworkByNamespace(s,t==null?void 0:t.id);e&&r&&await y.switchActiveNetwork(r)},async switchActiveNetwork(s){var i;const e=y.state.chains.get(y.state.activeChain);!((i=e==null?void 0:e.caipNetworks)!=null&&i.some(n=>{var o;return n.id===((o=B.activeCaipNetwork)==null?void 0:o.id)}))&&Ae.goBack();const r=this.getNetworkControllerClient(s.chainNamespace);r&&(await r.switchCaipNetwork(s),Le.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:s.caipNetworkId}}))},getNetworkControllerClient(s){const e=s||B.activeChain,t=B.chains.get(e);if(!t)throw new Error("Chain adapter not found");if(!t.networkControllerClient)throw new Error("NetworkController client not set");return t.networkControllerClient},getConnectionControllerClient(s){const e=s||B.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const t=B.chains.get(e);if(!(t!=null&&t.connectionControllerClient))throw new Error("ConnectionController client not set");return t.connectionControllerClient},getAccountProp(s,e){var i;let t=B.activeChain;if(e&&(t=e),!t)return;const r=(i=B.chains.get(t))==null?void 0:i.accountState;if(r)return r[s]},getNetworkProp(s,e){var r;const t=(r=B.chains.get(e))==null?void 0:r.networkState;if(t)return t[s]},getRequestedCaipNetworks(s){const e=B.chains.get(s),{approvedCaipNetworkIds:t=[],requestedCaipNetworks:r=[]}=(e==null?void 0:e.networkState)||{};return ie.sortRequestedNetworks(t,r)},getAllRequestedCaipNetworks(){const s=[];return B.chains.forEach(e=>{const t=this.getRequestedCaipNetworks(e.namespace);s.push(...t)}),s},setRequestedCaipNetworks(s,e){this.setAdapterNetworkState(e,{requestedCaipNetworks:s});const r=this.getAllRequestedCaipNetworks().map(n=>n.chainNamespace),i=Array.from(new Set(r));ne.filterByNamespaces(i)},getAllApprovedCaipNetworkIds(){const s=[];return B.chains.forEach(e=>{const t=this.getApprovedCaipNetworkIds(e.namespace);s.push(...t)}),s},getActiveCaipNetwork(){return B.activeCaipNetwork},getActiveCaipAddress(){return B.activeCaipAddress},getApprovedCaipNetworkIds(s){var r;const e=B.chains.get(s);return((r=e==null?void 0:e.networkState)==null?void 0:r.approvedCaipNetworkIds)||[]},async setApprovedCaipNetworksData(s){const e=this.getNetworkControllerClient(),t=await(e==null?void 0:e.getApprovedCaipNetworksData());this.setAdapterNetworkState(s,{approvedCaipNetworkIds:t==null?void 0:t.approvedCaipNetworkIds,supportsAllNetworks:t==null?void 0:t.supportsAllNetworks})},checkIfSupportedNetwork(s,e){const t=e||B.activeCaipNetwork,r=this.getRequestedCaipNetworks(s);return r.length?r==null?void 0:r.some(i=>i.id===(t==null?void 0:t.id)):!0},checkIfSupportedChainId(s){if(!B.activeChain)return!0;const e=this.getRequestedCaipNetworks(B.activeChain);return e==null?void 0:e.some(t=>t.id===s)},setSmartAccountEnabledNetworks(s,e){this.setAdapterNetworkState(e,{smartAccountEnabledNetworks:s})},checkIfSmartAccountEnabled(){var r;const s=hu.caipNetworkIdToNumber((r=B.activeCaipNetwork)==null?void 0:r.caipNetworkId),e=B.activeChain;if(!e||!s)return!1;const t=this.getNetworkProp("smartAccountEnabledNetworks",e);return!!(t!=null&&t.includes(Number(s)))},getActiveNetworkTokenAddress(){var r,i;const s=((r=B.activeCaipNetwork)==null?void 0:r.chainNamespace)||"eip155",e=((i=B.activeCaipNetwork)==null?void 0:i.id)||1,t=lt.NATIVE_TOKEN_ADDRESS[s];return`${s}:${e}:${t}`},showUnsupportedChainUI(){Fe.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const s=B.activeCaipNetwork;return!!(s!=null&&s.chainNamespace&&lt.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(s.chainNamespace))},resetNetwork(s){this.setAdapterNetworkState(s,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]})},resetAccount(s){const e=s;if(!e)throw new Error("Chain is required to set account prop");B.activeCaipAddress=void 0,this.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountTypes:void 0,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,allAccounts:[],user:void 0,status:"disconnected"}),ne.removeConnectorId(e)},async disconnect(s){const e=tf(s);try{qd.resetSend();const t=await Promise.allSettled(e.map(async([i,n])=>{var o;try{const{caipAddress:a}=this.getAccountData(i)||{};a&&((o=n.connectionControllerClient)!=null&&o.disconnect)&&await n.connectionControllerClient.disconnect(i),this.resetAccount(i),this.resetNetwork(i)}catch(a){throw new Error(`Failed to disconnect chain ${i}: ${a.message}`)}}));Ue.resetWcConnection();const r=t.filter(i=>i.status==="rejected");if(r.length>0)throw new Error(r.map(i=>i.reason.message).join(", "));K.deleteConnectedSocialProvider(),s?ne.removeConnectorId(s):ne.resetConnectorIds(),Le.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:s||"all"}})}catch(t){console.error(t.message||"Failed to disconnect chains"),Le.sendEvent({type:"track",event:"DISCONNECT_ERROR",properties:{message:t.message||"Failed to disconnect chains"}})}},setIsSwitchingNamespace(s){B.isSwitchingNamespace=s},getFirstCaipNetworkSupportsAuthConnector(){var t,r;const s=[];let e;if(B.chains.forEach(i=>{G.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(n=>n===i.namespace)&&i.namespace&&s.push(i.namespace)}),s.length>0){const i=s[0];return e=i?(r=(t=B.chains.get(i))==null?void 0:t.caipNetworks)==null?void 0:r[0]:void 0,e}},getAccountData(s){var e;return s?(e=y.state.chains.get(s))==null?void 0:e.accountState:Y.state},getNetworkData(s){var t;const e=s||B.activeChain;if(e)return(t=y.state.chains.get(e))==null?void 0:t.networkState},getCaipNetworkByNamespace(s,e){var i,n,o;if(!s)return;const t=y.state.chains.get(s),r=(i=t==null?void 0:t.caipNetworks)==null?void 0:i.find(a=>a.id===e);return r||((n=t==null?void 0:t.networkState)==null?void 0:n.caipNetwork)||((o=t==null?void 0:t.caipNetworks)==null?void 0:o[0])},getRequestedCaipNetworkIds(){const s=ne.state.filterByNamespace;return(s?[B.chains.get(s)]:Array.from(B.chains.values())).flatMap(t=>(t==null?void 0:t.caipNetworks)||[]).map(t=>t.caipNetworkId)},getCaipNetworks(s){return s?y.getRequestedCaipNetworks(s):y.getAllRequestedCaipNetworks()}},tA={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},zh=ie.getBlockchainApiUrl(),$t=je({clientId:null,api:new jo({baseUrl:zh,clientId:null}),supportedChains:{http:[],ws:[]}}),re={state:$t,async get(s){const{st:e,sv:t}=re.getSdkProperties(),r=x.state.projectId,i={...s.params||{},st:e,sv:t,projectId:r};return $t.api.get({...s,params:i})},getSdkProperties(){const{sdkType:s,sdkVersion:e}=x.state;return{st:s||"unknown",sv:e||"unknown"}},async isNetworkSupported(s){if(!s)return!1;try{$t.supportedChains.http.length||await re.getSupportedNetworks()}catch{return!1}return $t.supportedChains.http.includes(s)},async getSupportedNetworks(){const s=await re.get({path:"v1/supported-chains"});return $t.supportedChains=s,s},async fetchIdentity({address:s,caipNetworkId:e}){if(!await re.isNetworkSupported(e))return{avatar:"",name:""};const r=K.getIdentityFromCacheForAddress(s);if(r)return r;const i=await re.get({path:`/v1/identity/${s}`,params:{sender:y.state.activeCaipAddress?ie.getPlainAddress(y.state.activeCaipAddress):void 0}});return K.updateIdentityCache({address:s,identity:i,timestamp:Date.now()}),i},async fetchTransactions({account:s,cursor:e,onramp:t,signal:r,cache:i,chainId:n}){var a;return await re.isNetworkSupported((a=y.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)?re.get({path:`/v1/account/${s}/history`,params:{cursor:e,onramp:t,chainId:n},signal:r,cache:i}):{data:[],next:void 0}},async fetchSwapQuote({amount:s,userAddress:e,from:t,to:r,gasPrice:i}){var o;return await re.isNetworkSupported((o=y.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)?re.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:s,userAddress:e,from:t,to:r,gasPrice:i}}):{quotes:[]}},async fetchSwapTokens({chainId:s}){var t;return await re.isNetworkSupported((t=y.state.activeCaipNetwork)==null?void 0:t.caipNetworkId)?re.get({path:"/v1/convert/tokens",params:{chainId:s}}):{tokens:[]}},async fetchTokenPrice({addresses:s}){var t;return await re.isNetworkSupported((t=y.state.activeCaipNetwork)==null?void 0:t.caipNetworkId)?$t.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:s,projectId:x.state.projectId},headers:{"Content-Type":"application/json"}}):{fungibles:[]}},async fetchSwapAllowance({tokenAddress:s,userAddress:e}){var r;return await re.isNetworkSupported((r=y.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?re.get({path:"/v1/convert/allowance",params:{tokenAddress:s,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:s}){var i;const{st:e,sv:t}=re.getSdkProperties();if(!await re.isNetworkSupported((i=y.state.activeCaipNetwork)==null?void 0:i.caipNetworkId))throw new Error("Network not supported for Gas Price");return re.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:s,st:e,sv:t}})},async generateSwapCalldata({amount:s,from:e,to:t,userAddress:r,disableEstimate:i}){var o;if(!await re.isNetworkSupported((o=y.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return $t.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:s,eip155:{slippage:lt.CONVERT_SLIPPAGE_TOLERANCE},projectId:x.state.projectId,from:e,to:t,userAddress:r,disableEstimate:i}})},async generateApproveCalldata({from:s,to:e,userAddress:t}){var o;const{st:r,sv:i}=re.getSdkProperties();if(!await re.isNetworkSupported((o=y.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return re.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:t,from:s,to:e,st:r,sv:i}})},async getBalance(s,e,t){var l;const{st:r,sv:i}=re.getSdkProperties();if(!await re.isNetworkSupported((l=y.state.activeCaipNetwork)==null?void 0:l.caipNetworkId))return rs.showError("Token Balance Unavailable"),{balances:[]};const o=`${e}:${s}`,a=K.getBalanceCacheForCaipAddress(o);if(a)return a;const c=await re.get({path:`/v1/account/${s}/balance`,params:{currency:"usd",chainId:e,forceUpdate:t,st:r,sv:i}});return K.updateBalanceCache({caipAddress:o,balance:c,timestamp:Date.now()}),c},async lookupEnsName(s){var t;return await re.isNetworkSupported((t=y.state.activeCaipNetwork)==null?void 0:t.caipNetworkId)?re.get({path:`/v1/profile/account/${s}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:s}){var t;return await re.isNetworkSupported((t=y.state.activeCaipNetwork)==null?void 0:t.caipNetworkId)?re.get({path:`/v1/profile/reverse/${s}`,params:{sender:Y.state.address,apiVersion:"2"}}):[]},async getEnsNameSuggestions(s){var t;return await re.isNetworkSupported((t=y.state.activeCaipNetwork)==null?void 0:t.caipNetworkId)?re.get({path:`/v1/profile/suggestions/${s}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:s,address:e,message:t,signature:r}){var n;return await re.isNetworkSupported((n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?$t.api.post({path:"/v1/profile/account",body:{coin_type:s,address:e,message:t,signature:r},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:s,partnerUserId:e,defaultNetwork:t,purchaseAmount:r,paymentAmount:i}){var a;return await re.isNetworkSupported((a=y.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)?(await $t.api.post({path:"/v1/generators/onrampurl",params:{projectId:x.state.projectId},body:{destinationWallets:s,defaultNetwork:t,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:r,presetFiatAmount:i}})).url:""},async getOnrampOptions(){var e;if(!await re.isNetworkSupported((e=y.state.activeCaipNetwork)==null?void 0:e.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await re.get({path:"/v1/onramp/options"})}catch{return tA}},async getOnrampQuote({purchaseCurrency:s,paymentCurrency:e,amount:t,network:r}){var i;try{return await re.isNetworkSupported((i=y.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?await $t.api.post({path:"/v1/onramp/quote",params:{projectId:x.state.projectId},body:{purchaseCurrency:s,paymentCurrency:e,amount:t,network:r}}):null}catch{return{coinbaseFee:{amount:t,currency:e.id},networkFee:{amount:t,currency:e.id},paymentSubtotal:{amount:t,currency:e.id},paymentTotal:{amount:t,currency:e.id},purchaseAmount:{amount:t,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(s){var t;return await re.isNetworkSupported((t=y.state.activeCaipNetwork)==null?void 0:t.caipNetworkId)?re.get({path:`/v1/sessions/${s}`}):[]},async revokeSmartSession(s,e,t){var i;return await re.isNetworkSupported((i=y.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?$t.api.post({path:`/v1/sessions/${s}/revoke`,params:{projectId:x.state.projectId},body:{pci:e,signature:t}}):{success:!1}},setClientId(s){$t.clientId=s,$t.api=new jo({baseUrl:zh,clientId:s})}},Ht=je({currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[]}),Y={state:Ht,replaceState(s){s&&Object.assign(Ht,Ar(s))},subscribe(s){return y.subscribeChainProp("accountState",e=>{if(e)return s(e)})},subscribeKey(s,e,t){let r;return y.subscribeChainProp("accountState",i=>{if(i){const n=i[s];r!==n&&(r=n,e(n))}},t)},setStatus(s,e){y.setAccountProp("status",s,e)},getCaipAddress(s){return y.getAccountProp("caipAddress",s)},setCaipAddress(s,e){const t=s?ie.getPlainAddress(s):void 0;e===y.state.activeChain&&(y.state.activeCaipAddress=s),y.setAccountProp("caipAddress",s,e),y.setAccountProp("address",t,e)},setBalance(s,e,t){y.setAccountProp("balance",s,t),y.setAccountProp("balanceSymbol",e,t)},setProfileName(s,e){y.setAccountProp("profileName",s,e)},setProfileImage(s,e){y.setAccountProp("profileImage",s,e)},setUser(s,e){y.setAccountProp("user",s,e)},setAddressExplorerUrl(s,e){y.setAccountProp("addressExplorerUrl",s,e)},setSmartAccountDeployed(s,e){y.setAccountProp("smartAccountDeployed",s,e)},setCurrentTab(s){y.setAccountProp("currentTab",s,y.state.activeChain)},setTokenBalance(s,e){s&&y.setAccountProp("tokenBalance",s,e)},setShouldUpdateToAddress(s,e){y.setAccountProp("shouldUpdateToAddress",s,e)},setAllAccounts(s,e){y.setAccountProp("allAccounts",s,e)},addAddressLabel(s,e,t){const r=y.getAccountProp("addressLabels",t)||new Map;r.set(s,e),y.setAccountProp("addressLabels",r,t)},removeAddressLabel(s,e){const t=y.getAccountProp("addressLabels",e)||new Map;t.delete(s),y.setAccountProp("addressLabels",t,e)},setConnectedWalletInfo(s,e){y.setAccountProp("connectedWalletInfo",s,e,!1)},setPreferredAccountType(s,e){y.setAccountProp("preferredAccountTypes",{...Ht.preferredAccountTypes,[e]:s},e)},setPreferredAccountTypes(s){Ht.preferredAccountTypes=s},setSocialProvider(s,e){s&&y.setAccountProp("socialProvider",s,e)},setSocialWindow(s,e){y.setAccountProp("socialWindow",s?Ar(s):void 0,e)},setFarcasterUrl(s,e){y.setAccountProp("farcasterUrl",s,e)},async fetchTokenBalance(s){var n,o;Ht.balanceLoading=!0;const e=(n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId,t=(o=y.state.activeCaipNetwork)==null?void 0:o.chainNamespace,r=y.state.activeCaipAddress,i=r?ie.getPlainAddress(r):void 0;if(Ht.lastRetry&&!ie.isAllowedRetry(Ht.lastRetry,30*lt.ONE_SEC_MS))return Ht.balanceLoading=!1,[];try{if(i&&e&&t){const c=(await re.getBalance(i,e)).balances.filter(l=>l.quantity.decimals!=="0");return this.setTokenBalance(c,t),Ht.lastRetry=void 0,Ht.balanceLoading=!1,c}}catch(a){Ht.lastRetry=Date.now(),s==null||s(a),rs.showError("Token Balance Unavailable")}finally{Ht.balanceLoading=!1}return[]},resetAccount(s){y.resetAccount(s)}},Ct=je({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),Fe={state:Ct,subscribe(s){return Et(Ct,()=>s(Ct))},subscribeKey(s,e){return Rt(Ct,s,e)},async open(s){var i;const e=Y.state.status==="connected";Ue.state.wcBasic?te.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1}):await te.prefetch({fetchConnectorImages:!e,fetchFeaturedWallets:!e,fetchRecommendedWallets:!e}),s!=null&&s.namespace?(await y.switchActiveNamespace(s.namespace),Fe.setLoading(!0,s.namespace)):Fe.setLoading(!0),ne.setFilterByNamespace(s==null?void 0:s.namespace);const t=(i=y.getAccountData(s==null?void 0:s.namespace))==null?void 0:i.caipAddress,r=y.state.noAdapters;x.state.manualWCControl||r&&!t?ie.isMobile()?Ae.reset("AllWallets"):Ae.reset("ConnectingWalletConnectBasic"):s!=null&&s.view?Ae.reset(s.view,s.data):t?Ae.reset("Account"):Ae.reset("Connect"),Ct.open=!0,Es.set({open:!0}),Le.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!t}})},close(s=!1){if(s||Ae.state.view!=="ApproveTransaction"){const e=x.state.enableEmbedded,t=!!y.state.activeCaipAddress;Ct.open&&Le.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:t}}),Ct.open=!1,Fe.clearLoading(),e?t?Ae.replace("Account"):Ae.push("Connect"):Es.set({open:!1})}Ue.resetUri()},setLoading(s,e){e&&Ct.loadingNamespaceMap.set(e,s),Ct.loading=s,Es.set({loading:s})},clearLoading(){Ct.loadingNamespaceMap.clear(),Ct.loading=!1},shake(){Ct.shake||(Ct.shake=!0,setTimeout(()=>{Ct.shake=!1},500))}},Fd=2147483648,sA={convertEVMChainIdToCoinType(s){if(s>=Fd)throw new Error("Invalid chainId");return(Fd|s)>>>0}},zt=je({suggestions:[],loading:!1}),Vh={state:zt,subscribe(s){return Et(zt,()=>s(zt))},subscribeKey(s,e){return Rt(zt,s,e)},async resolveName(s){var e,t;try{return await re.lookupEnsName(s)}catch(r){const i=r;throw new Error(((t=(e=i==null?void 0:i.reasons)==null?void 0:e[0])==null?void 0:t.description)||"Error resolving name")}},async isNameRegistered(s){try{return await re.lookupEnsName(s),!0}catch{return!1}},async getSuggestions(s){try{zt.loading=!0,zt.suggestions=[];const e=await re.getEnsNameSuggestions(s);return zt.suggestions=e.suggestions.map(t=>({...t,name:t.name}))||[],zt.suggestions}catch(e){const t=this.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(t)}finally{zt.loading=!1}},async getNamesForAddress(s){try{if(!y.state.activeCaipNetwork)return[];const t=K.getEnsFromCacheForAddress(s);if(t)return t;const r=await re.reverseLookupEnsName({address:s});return K.updateEnsCache({address:s,ens:r,timestamp:Date.now()}),r}catch(e){const t=this.parseEnsApiError(e,"Error fetching names for address");throw new Error(t)}},async registerName(s){const e=y.state.activeCaipNetwork;if(!e)throw new Error("Network not found");const t=Y.state.address,r=ne.getAuthConnector();if(!t||!r)throw new Error("Address or auth connector not found");zt.loading=!0;try{const i=JSON.stringify({name:s,attributes:{},timestamp:Math.floor(Date.now()/1e3)});Ae.pushTransactionStack({view:"RegisterAccountNameSuccess",goBack:!1,replace:!0,onCancel(){zt.loading=!1}});const n=await Ue.signMessage(i),o=e.id;if(!o)throw new Error("Network not found");const a=sA.convertEVMChainIdToCoinType(Number(o));await re.registerEnsName({coinType:a,address:t,signature:n,message:i}),Y.setProfileName(s,e.chainNamespace),Ae.replace("RegisterAccountNameSuccess")}catch(i){const n=this.parseEnsApiError(i,`Error registering name ${s}`);throw Ae.replace("RegisterAccountName"),new Error(n)}finally{zt.loading=!1}},validateName(s){return/^[a-zA-Z0-9-]{4,}$/u.test(s)},parseEnsApiError(s,e){var r,i;const t=s;return((i=(r=t==null?void 0:t.reasons)==null?void 0:r[0])==null?void 0:i.description)||e}},Tt={METMASK_CONNECTOR_NAME:"MetaMask",TRUST_CONNECTOR_NAME:"Trust Wallet",SOLFLARE_CONNECTOR_NAME:"Solflare",PHANTOM_CONNECTOR_NAME:"Phantom",COIN98_CONNECTOR_NAME:"Coin98",MAGIC_EDEN_CONNECTOR_NAME:"Magic Eden",BACKPACK_CONNECTOR_NAME:"Backpack",BITGET_CONNECTOR_NAME:"Bitget Wallet",FRONTIER_CONNECTOR_NAME:"Frontier",XVERSE_CONNECTOR_NAME:"Xverse Wallet",LEATHER_CONNECTOR_NAME:"Leather",EIP155:"eip155",ADD_CHAIN_METHOD:"wallet_addEthereumChain",EIP6963_ANNOUNCE_EVENT:"eip6963:announceProvider",EIP6963_REQUEST_EVENT:"eip6963:requestProvider",CONNECTOR_RDNS_MAP:{coinbaseWallet:"com.coinbase.wallet",coinbaseWalletSDK:"com.coinbase.wallet"},CONNECTOR_TYPE_EXTERNAL:"EXTERNAL",CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED",CONNECTOR_TYPE_AUTH:"AUTH",CONNECTOR_TYPE_MULTI_CHAIN:"MULTI_CHAIN",CONNECTOR_TYPE_W3M_AUTH:"ID_AUTH"},Io={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200"},ConnectorImageIds:{[G.CONNECTOR_ID.COINBASE]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[G.CONNECTOR_ID.COINBASE_SDK]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[G.CONNECTOR_ID.SAFE]:"461db637-8616-43ce-035a-d89b8a1d5800",[G.CONNECTOR_ID.LEDGER]:"54a1aa77-d202-4f8d-0fb2-5d2bb6db0300",[G.CONNECTOR_ID.WALLET_CONNECT]:"ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",[G.CONNECTOR_ID.INJECTED]:"07ba87ed-43aa-4adf-4540-9e6a2b9cae00"},ConnectorNamesMap:{[G.CONNECTOR_ID.INJECTED]:"Browser Wallet",[G.CONNECTOR_ID.WALLET_CONNECT]:"WalletConnect",[G.CONNECTOR_ID.COINBASE]:"Coinbase",[G.CONNECTOR_ID.COINBASE_SDK]:"Coinbase",[G.CONNECTOR_ID.LEDGER]:"Ledger",[G.CONNECTOR_ID.SAFE]:"Safe"}},Go={getCaipTokens(s){if(!s)return;const e={};return Object.entries(s).forEach(([t,r])=>{e[`${Tt.EIP155}:${t}`]=r}),e},isLowerCaseMatch(s,e){return(s==null?void 0:s.toLowerCase())===(e==null?void 0:e.toLowerCase())}},rA=new AbortController,ys={EmbeddedWalletAbortController:rA,UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"INVALID_APP_CONFIGURATION"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{shortMessage:"Network Not Found",longMessage:"Network not found - please make sure it is included in 'networks' array in createAppKit function"},INVALID_APP_CONFIGURATION:{shortMessage:"Invalid App Configuration",longMessage:()=>`Origin ${iA()?window.origin:"unknown"} not found on Allowlist - update configuration on cloud.reown.com`},IFRAME_LOAD_FAILED:{shortMessage:"Network Error - Could not load embedded wallet",longMessage:()=>"There was an issue loading the embedded wallet. Please try again later."},IFRAME_REQUEST_TIMEOUT:{shortMessage:"Embedded Wallet Request Timed Out",longMessage:()=>"There was an issue doing the request to the embedded wallet. Please try again later."},UNVERIFIED_DOMAIN:{shortMessage:"Invalid App Configuration",longMessage:()=>"There was an issue loading the embedded wallet. Please verify that your domain is allowed at cloud.reown.com"},JWT_TOKEN_NOT_VALID:{shortMessage:"Session Expired",longMessage:"Invalid session found on UniversalProvider - please check your time settings and connect again"},INVALID_PROJECT_ID:{shortMessage:"Invalid App Configuration",longMessage:"Invalid Project ID - update configuration"},PROJECT_ID_NOT_CONFIGURED:{shortMessage:"Project ID Not Configured",longMessage:"Project ID Not Configured - update configuration on cloud.reown.com"}}};function iA(){return typeof window<"u"}const nA={createLogger(s,e="error"){const t=Ni({level:e}),{logger:r}=Ec({opts:t});return r.error=(...i)=>{for(const n of i)if(n instanceof Error){s(n,...i);return}s(void 0,...i)},r}},oA="rpc.walletconnect.org";function Wd(s,e){const t=new URL("https://rpc.walletconnect.org/v1/");return t.searchParams.set("chainId",s),t.searchParams.set("projectId",e),t.toString()}const Ta=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],ri={extendRpcUrlWithProjectId(s,e){let t=!1;try{t=new URL(s).host===oA}catch{t=!1}if(t){const r=new URL(s);return r.searchParams.has("projectId")||r.searchParams.set("projectId",e),r.toString()}return s},isCaipNetwork(s){return"chainNamespace"in s&&"caipNetworkId"in s},getChainNamespace(s){return this.isCaipNetwork(s)?s.chainNamespace:G.CHAIN.EVM},getCaipNetworkId(s){return this.isCaipNetwork(s)?s.caipNetworkId:`${G.CHAIN.EVM}:${s.id}`},getDefaultRpcUrl(s,e,t){var i,n,o;const r=(o=(n=(i=s.rpcUrls)==null?void 0:i.default)==null?void 0:n.http)==null?void 0:o[0];return Ta.includes(e)?Wd(e,t):r||""},extendCaipNetwork(s,{customNetworkImageUrls:e,projectId:t,customRpcUrls:r}){var h,f,g,m,w;const i=this.getChainNamespace(s),n=this.getCaipNetworkId(s),o=(h=s.rpcUrls.default.http)==null?void 0:h[0],a=this.getDefaultRpcUrl(s,n,t),c=((m=(g=(f=s==null?void 0:s.rpcUrls)==null?void 0:f.chainDefault)==null?void 0:g.http)==null?void 0:m[0])||o,l=((w=r==null?void 0:r[n])==null?void 0:w.map(v=>v.url))||[],d=[...l,a],u=[...l];return c&&!u.includes(c)&&u.push(c),{...s,chainNamespace:i,caipNetworkId:n,assets:{imageId:Io.NetworkImageIds[s.id],imageUrl:e==null?void 0:e[s.id]},rpcUrls:{...s.rpcUrls,default:{http:d},chainDefault:{http:u}}}},extendCaipNetworks(s,{customNetworkImageUrls:e,projectId:t,customRpcUrls:r}){return s.map(i=>ri.extendCaipNetwork(i,{customNetworkImageUrls:e,customRpcUrls:r,projectId:t}))},getViemTransport(s,e,t){var i,n,o;const r=[];return t==null||t.forEach(a=>{r.push(Vn(a.url,a.config))}),Ta.includes(s.caipNetworkId)&&r.push(Vn(Wd(s.caipNetworkId,e),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),(o=(n=(i=s==null?void 0:s.rpcUrls)==null?void 0:i.default)==null?void 0:n.http)==null||o.forEach(a=>{r.push(Vn(a))}),Wc(r)},extendWagmiTransports(s,e,t){if(Ta.includes(s.caipNetworkId)){const r=this.getDefaultRpcUrl(s,s.caipNetworkId,e);return Wc([t,Vn(r)])}return t},getUnsupportedNetwork(s){return{id:s.split(":")[1],caipNetworkId:s,name:G.UNSUPPORTED_NETWORK_NAME,chainNamespace:s.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(s){var c;const e=K.getActiveCaipNetworkId(),t=y.getAllRequestedCaipNetworks(),r=Array.from(((c=y.state.chains)==null?void 0:c.keys())||[]),i=e==null?void 0:e.split(":")[0],n=i?r.includes(i):!1,o=t==null?void 0:t.find(l=>l.caipNetworkId===e);return n&&!o&&e?this.getUnsupportedNetwork(e):o||s||(t==null?void 0:t[0])}},So={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0},At=je({providers:{...So},providerIds:{...So}}),Ne={state:At,subscribeKey(s,e){return Rt(At,s,e)},subscribe(s){return Et(At,()=>{s(At)})},subscribeProviders(s){return Et(At.providers,()=>s(At.providers))},setProvider(s,e){e&&(At.providers[s]=Ar(e))},getProvider(s){return At.providers[s]},setProviderId(s,e){e&&(At.providerIds[s]=e)},getProviderId(s){if(s)return At.providerIds[s]},reset(){At.providers={...So},At.providerIds={...So}},resetChain(s){At.providers[s]=void 0,At.providerIds[s]=void 0}},Hd={transactionHash:/^0x(?:[A-Fa-f0-9]{64})$/u,signedMessage:/^0x(?:[a-fA-F0-9]{62,})$/u},at={set(s,e){Mt.isClient&&localStorage.setItem(`${V.STORAGE_KEY}${s}`,e)},get(s){return Mt.isClient?localStorage.getItem(`${V.STORAGE_KEY}${s}`):null},delete(s,e){Mt.isClient&&(e?localStorage.removeItem(s):localStorage.removeItem(`${V.STORAGE_KEY}${s}`))}},no=30*1e3,Mt={checkIfAllowedToTriggerEmail(){const s=at.get(V.LAST_EMAIL_LOGIN_TIME);if(s){const e=Date.now()-Number(s);if(e<no){const t=Math.ceil((no-e)/1e3);throw new Error(`Please try again after ${t} seconds`)}}},getTimeToNextEmailLogin(){const s=at.get(V.LAST_EMAIL_LOGIN_TIME);if(s){const e=Date.now()-Number(s);if(e<no)return Math.ceil((no-e)/1e3)}return 0},checkIfRequestExists(s){return dt.NOT_SAFE_RPC_METHODS.includes(s.method)||dt.SAFE_RPC_METHODS.includes(s.method)},getResponseType(s){return typeof s=="string"&&((s==null?void 0:s.match(Hd.transactionHash))||(s==null?void 0:s.match(Hd.signedMessage)))?V.RPC_RESPONSE_TYPE_TX:V.RPC_RESPONSE_TYPE_OBJECT},checkIfRequestIsSafe(s){return dt.SAFE_RPC_METHODS.includes(s.method)},isClient:typeof window<"u"};var ve;(function(s){s.assertEqual=i=>i;function e(i){}s.assertIs=e;function t(i){throw new Error}s.assertNever=t,s.arrayToEnum=i=>{const n={};for(const o of i)n[o]=o;return n},s.getValidEnumValues=i=>{const n=s.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(const a of n)o[a]=i[a];return s.objectValues(o)},s.objectValues=i=>s.objectKeys(i).map(function(n){return i[n]}),s.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const n=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&n.push(o);return n},s.find=(i,n)=>{for(const o of i)if(n(o))return o},s.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function r(i,n=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(n)}s.joinValues=r,s.jsonStringifyReplacer=(i,n)=>typeof n=="bigint"?n.toString():n})(ve||(ve={}));var pc;(function(s){s.mergeShapes=(e,t)=>({...e,...t})})(pc||(pc={}));const F=ve.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ys=s=>{switch(typeof s){case"undefined":return F.undefined;case"string":return F.string;case"number":return isNaN(s)?F.nan:F.number;case"boolean":return F.boolean;case"function":return F.function;case"bigint":return F.bigint;case"symbol":return F.symbol;case"object":return Array.isArray(s)?F.array:s===null?F.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?F.promise:typeof Map<"u"&&s instanceof Map?F.map:typeof Set<"u"&&s instanceof Set?F.set:typeof Date<"u"&&s instanceof Date?F.date:F.object;default:return F.unknown}},$=ve.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),aA=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:");class as extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(n){return n.message},r={_errors:[]},i=n=>{for(const o of n.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)r._errors.push(t(o));else{let a=r,c=0;for(;c<o.path.length;){const l=o.path[c];c===o.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(t(o))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return i(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,ve.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}as.create=s=>new as(s);const mn=(s,e)=>{let t;switch(s.code){case $.invalid_type:s.received===F.undefined?t="Required":t=`Expected ${s.expected}, received ${s.received}`;break;case $.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(s.expected,ve.jsonStringifyReplacer)}`;break;case $.unrecognized_keys:t=`Unrecognized key(s) in object: ${ve.joinValues(s.keys,", ")}`;break;case $.invalid_union:t="Invalid input";break;case $.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ve.joinValues(s.options)}`;break;case $.invalid_enum_value:t=`Invalid enum value. Expected ${ve.joinValues(s.options)}, received '${s.received}'`;break;case $.invalid_arguments:t="Invalid function arguments";break;case $.invalid_return_type:t="Invalid function return type";break;case $.invalid_date:t="Invalid date";break;case $.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(t=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?t=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?t=`Invalid input: must end with "${s.validation.endsWith}"`:ve.assertNever(s.validation):s.validation!=="regex"?t=`Invalid ${s.validation}`:t="Invalid";break;case $.too_small:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:t="Invalid input";break;case $.too_big:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?t=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:t="Invalid input";break;case $.custom:t="Invalid input";break;case $.invalid_intersection_types:t="Intersection results could not be merged";break;case $.not_multiple_of:t=`Number must be a multiple of ${s.multipleOf}`;break;case $.not_finite:t="Number must be finite";break;default:t=e.defaultError,ve.assertNever(s)}return{message:t}};let Kh=mn;function cA(s){Kh=s}function No(){return Kh}const To=s=>{const{data:e,path:t,errorMaps:r,issueData:i}=s,n=[...t,...i.path||[]],o={...i,path:n};let a="";const c=r.filter(l=>!!l).slice().reverse();for(const l of c)a=l(o,{data:e,defaultError:a}).message;return{...i,path:n,message:i.message||a}},lA=[];function z(s,e){const t=To({issueData:e,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,No(),mn].filter(r=>!!r)});s.common.issues.push(t)}class mt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const i of t){if(i.status==="aborted")return oe;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const i of t)r.push({key:await i.key,value:await i.value});return mt.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const i of t){const{key:n,value:o}=i;if(n.status==="aborted"||o.status==="aborted")return oe;n.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(r[n.value]=o.value)}return{status:e.value,value:r}}}const oe=Object.freeze({status:"aborted"}),Gh=s=>({status:"dirty",value:s}),bt=s=>({status:"valid",value:s}),fc=s=>s.status==="aborted",gc=s=>s.status==="dirty",wn=s=>s.status==="valid",Po=s=>typeof Promise<"u"&&s instanceof Promise;var X;(function(s){s.errToObj=e=>typeof e=="string"?{message:e}:e||{},s.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(X||(X={}));class _s{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const zd=(s,e)=>{if(wn(e))return{success:!0,data:e.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new as(s.common.issues);return this._error=t,this._error}}};function de(s){if(!s)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:i}=s;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,a)=>o.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:r??a.defaultError}:{message:t??a.defaultError},description:i}}class pe{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Ys(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ys(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new mt,ctx:{common:e.parent.common,data:e.data,parsedType:Ys(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Po(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const i={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ys(e)},n=this._parseSync({data:e,path:i.path,parent:i});return zd(i,n)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ys(e)},i=this._parse({data:e,path:r.path,parent:r}),n=await(Po(i)?i:Promise.resolve(i));return zd(r,n)}refine(e,t){const r=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,n)=>{const o=e(i),a=()=>n.addIssue({code:$.custom,...r(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new ls({schema:this,typeName:se.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return js.create(this,this._def)}nullable(){return Or.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return cs.create(this,this._def)}promise(){return Ci.create(this,this._def)}or(e){return bn.create([this,e],this._def)}and(e){return _n.create(this,e,this._def)}transform(e){return new ls({...de(this._def),schema:this,typeName:se.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Nn({...de(this._def),innerType:this,defaultValue:t,typeName:se.ZodDefault})}brand(){return new Zh({typeName:se.ZodBranded,type:this,...de(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new ko({...de(this._def),innerType:this,catchValue:t,typeName:se.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return qn.create(this,e)}readonly(){return Uo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const dA=/^c[^\s-]{8,}$/i,uA=/^[a-z][a-z0-9]*$/,hA=/^[0-9A-HJKMNP-TV-Z]{26}$/,pA=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,fA=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,gA="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Pa;const mA=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,wA=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,yA=s=>s.precision?s.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${s.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${s.precision}}Z$`):s.precision===0?s.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):s.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function vA(s,e){return!!((e==="v4"||!e)&&mA.test(s)||(e==="v6"||!e)&&wA.test(s))}class ns extends pe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==F.string){const n=this._getOrReturnCtx(e);return z(n,{code:$.invalid_type,expected:F.string,received:n.parsedType}),oe}const r=new mt;let i;for(const n of this._def.checks)if(n.kind==="min")e.data.length<n.value&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),r.dirty());else if(n.kind==="max")e.data.length>n.value&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),r.dirty());else if(n.kind==="length"){const o=e.data.length>n.value,a=e.data.length<n.value;(o||a)&&(i=this._getOrReturnCtx(e,i),o?z(i,{code:$.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):a&&z(i,{code:$.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),r.dirty())}else if(n.kind==="email")fA.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"email",code:$.invalid_string,message:n.message}),r.dirty());else if(n.kind==="emoji")Pa||(Pa=new RegExp(gA,"u")),Pa.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"emoji",code:$.invalid_string,message:n.message}),r.dirty());else if(n.kind==="uuid")pA.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"uuid",code:$.invalid_string,message:n.message}),r.dirty());else if(n.kind==="cuid")dA.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"cuid",code:$.invalid_string,message:n.message}),r.dirty());else if(n.kind==="cuid2")uA.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"cuid2",code:$.invalid_string,message:n.message}),r.dirty());else if(n.kind==="ulid")hA.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"ulid",code:$.invalid_string,message:n.message}),r.dirty());else if(n.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),z(i,{validation:"url",code:$.invalid_string,message:n.message}),r.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"regex",code:$.invalid_string,message:n.message}),r.dirty())):n.kind==="trim"?e.data=e.data.trim():n.kind==="includes"?e.data.includes(n.value,n.position)||(i=this._getOrReturnCtx(e,i),z(i,{code:$.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),r.dirty()):n.kind==="toLowerCase"?e.data=e.data.toLowerCase():n.kind==="toUpperCase"?e.data=e.data.toUpperCase():n.kind==="startsWith"?e.data.startsWith(n.value)||(i=this._getOrReturnCtx(e,i),z(i,{code:$.invalid_string,validation:{startsWith:n.value},message:n.message}),r.dirty()):n.kind==="endsWith"?e.data.endsWith(n.value)||(i=this._getOrReturnCtx(e,i),z(i,{code:$.invalid_string,validation:{endsWith:n.value},message:n.message}),r.dirty()):n.kind==="datetime"?yA(n).test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{code:$.invalid_string,validation:"datetime",message:n.message}),r.dirty()):n.kind==="ip"?vA(e.data,n.version)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"ip",code:$.invalid_string,message:n.message}),r.dirty()):ve.assertNever(n);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(i=>e.test(i),{validation:t,code:$.invalid_string,...X.errToObj(r)})}_addCheck(e){return new ns({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...X.errToObj(e)})}url(e){return this._addCheck({kind:"url",...X.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...X.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...X.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...X.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...X.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...X.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...X.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...X.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...X.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...X.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...X.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...X.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...X.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...X.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...X.errToObj(t)})}nonempty(e){return this.min(1,X.errToObj(e))}trim(){return new ns({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ns({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ns({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ns.create=s=>{var e;return new ns({checks:[],typeName:se.ZodString,coerce:(e=s==null?void 0:s.coerce)!==null&&e!==void 0?e:!1,...de(s)})};function EA(s,e){const t=(s.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,n=parseInt(s.toFixed(i).replace(".","")),o=parseInt(e.toFixed(i).replace(".",""));return n%o/Math.pow(10,i)}class rr extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==F.number){const n=this._getOrReturnCtx(e);return z(n,{code:$.invalid_type,expected:F.number,received:n.parsedType}),oe}let r;const i=new mt;for(const n of this._def.checks)n.kind==="int"?ve.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{code:$.invalid_type,expected:"integer",received:"float",message:n.message}),i.dirty()):n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="multipleOf"?EA(e.data,n.value)!==0&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):n.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{code:$.not_finite,message:n.message}),i.dirty()):ve.assertNever(n);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,X.toString(t))}gt(e,t){return this.setLimit("min",e,!1,X.toString(t))}lte(e,t){return this.setLimit("max",e,!0,X.toString(t))}lt(e,t){return this.setLimit("max",e,!1,X.toString(t))}setLimit(e,t,r,i){return new rr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:X.toString(i)}]})}_addCheck(e){return new rr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:X.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:X.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:X.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:X.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:X.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:X.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:X.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:X.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:X.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ve.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}rr.create=s=>new rr({checks:[],typeName:se.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...de(s)});class ir extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==F.bigint){const n=this._getOrReturnCtx(e);return z(n,{code:$.invalid_type,expected:F.bigint,received:n.parsedType}),oe}let r;const i=new mt;for(const n of this._def.checks)n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="multipleOf"?e.data%n.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):ve.assertNever(n);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,X.toString(t))}gt(e,t){return this.setLimit("min",e,!1,X.toString(t))}lte(e,t){return this.setLimit("max",e,!0,X.toString(t))}lt(e,t){return this.setLimit("max",e,!1,X.toString(t))}setLimit(e,t,r,i){return new ir({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:X.toString(i)}]})}_addCheck(e){return new ir({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:X.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:X.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:X.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:X.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:X.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ir.create=s=>{var e;return new ir({checks:[],typeName:se.ZodBigInt,coerce:(e=s==null?void 0:s.coerce)!==null&&e!==void 0?e:!1,...de(s)})};class yn extends pe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==F.boolean){const r=this._getOrReturnCtx(e);return z(r,{code:$.invalid_type,expected:F.boolean,received:r.parsedType}),oe}return bt(e.data)}}yn.create=s=>new yn({typeName:se.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...de(s)});class Pr extends pe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==F.date){const n=this._getOrReturnCtx(e);return z(n,{code:$.invalid_type,expected:F.date,received:n.parsedType}),oe}if(isNaN(e.data.getTime())){const n=this._getOrReturnCtx(e);return z(n,{code:$.invalid_date}),oe}const r=new mt;let i;for(const n of this._def.checks)n.kind==="min"?e.data.getTime()<n.value&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):n.kind==="max"?e.data.getTime()>n.value&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):ve.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Pr({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:X.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:X.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Pr.create=s=>new Pr({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:se.ZodDate,...de(s)});class Ro extends pe{_parse(e){if(this._getType(e)!==F.symbol){const r=this._getOrReturnCtx(e);return z(r,{code:$.invalid_type,expected:F.symbol,received:r.parsedType}),oe}return bt(e.data)}}Ro.create=s=>new Ro({typeName:se.ZodSymbol,...de(s)});class vn extends pe{_parse(e){if(this._getType(e)!==F.undefined){const r=this._getOrReturnCtx(e);return z(r,{code:$.invalid_type,expected:F.undefined,received:r.parsedType}),oe}return bt(e.data)}}vn.create=s=>new vn({typeName:se.ZodUndefined,...de(s)});class En extends pe{_parse(e){if(this._getType(e)!==F.null){const r=this._getOrReturnCtx(e);return z(r,{code:$.invalid_type,expected:F.null,received:r.parsedType}),oe}return bt(e.data)}}En.create=s=>new En({typeName:se.ZodNull,...de(s)});class _i extends pe{constructor(){super(...arguments),this._any=!0}_parse(e){return bt(e.data)}}_i.create=s=>new _i({typeName:se.ZodAny,...de(s)});class br extends pe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return bt(e.data)}}br.create=s=>new br({typeName:se.ZodUnknown,...de(s)});class Bs extends pe{_parse(e){const t=this._getOrReturnCtx(e);return z(t,{code:$.invalid_type,expected:F.never,received:t.parsedType}),oe}}Bs.create=s=>new Bs({typeName:se.ZodNever,...de(s)});class Oo extends pe{_parse(e){if(this._getType(e)!==F.undefined){const r=this._getOrReturnCtx(e);return z(r,{code:$.invalid_type,expected:F.void,received:r.parsedType}),oe}return bt(e.data)}}Oo.create=s=>new Oo({typeName:se.ZodVoid,...de(s)});class cs extends pe{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==F.array)return z(t,{code:$.invalid_type,expected:F.array,received:t.parsedType}),oe;if(i.exactLength!==null){const o=t.data.length>i.exactLength.value,a=t.data.length<i.exactLength.value;(o||a)&&(z(t,{code:o?$.too_big:$.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(z(t,{code:$.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(z(t,{code:$.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>i.type._parseAsync(new _s(t,o,t.path,a)))).then(o=>mt.mergeArray(r,o));const n=[...t.data].map((o,a)=>i.type._parseSync(new _s(t,o,t.path,a)));return mt.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new cs({...this._def,minLength:{value:e,message:X.toString(t)}})}max(e,t){return new cs({...this._def,maxLength:{value:e,message:X.toString(t)}})}length(e,t){return new cs({...this._def,exactLength:{value:e,message:X.toString(t)}})}nonempty(e){return this.min(1,e)}}cs.create=(s,e)=>new cs({type:s,minLength:null,maxLength:null,exactLength:null,typeName:se.ZodArray,...de(e)});function ii(s){if(s instanceof Me){const e={};for(const t in s.shape){const r=s.shape[t];e[t]=js.create(ii(r))}return new Me({...s._def,shape:()=>e})}else return s instanceof cs?new cs({...s._def,type:ii(s.element)}):s instanceof js?js.create(ii(s.unwrap())):s instanceof Or?Or.create(ii(s.unwrap())):s instanceof Cs?Cs.create(s.items.map(e=>ii(e))):s}class Me extends pe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=ve.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==F.object){const l=this._getOrReturnCtx(e);return z(l,{code:$.invalid_type,expected:F.object,received:l.parsedType}),oe}const{status:r,ctx:i}=this._processInputParams(e),{shape:n,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Bs&&this._def.unknownKeys==="strip"))for(const l in i.data)o.includes(l)||a.push(l);const c=[];for(const l of o){const d=n[l],u=i.data[l];c.push({key:{status:"valid",value:l},value:d._parse(new _s(i,u,i.path,l)),alwaysSet:l in i.data})}if(this._def.catchall instanceof Bs){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of a)c.push({key:{status:"valid",value:d},value:{status:"valid",value:i.data[d]}});else if(l==="strict")a.length>0&&(z(i,{code:$.unrecognized_keys,keys:a}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of a){const u=i.data[d];c.push({key:{status:"valid",value:d},value:l._parse(new _s(i,u,i.path,d)),alwaysSet:d in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of c){const u=await d.key;l.push({key:u,value:await d.value,alwaysSet:d.alwaysSet})}return l}).then(l=>mt.mergeObjectSync(r,l)):mt.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return X.errToObj,new Me({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,n,o,a;const c=(o=(n=(i=this._def).errorMap)===null||n===void 0?void 0:n.call(i,t,r).message)!==null&&o!==void 0?o:r.defaultError;return t.code==="unrecognized_keys"?{message:(a=X.errToObj(e).message)!==null&&a!==void 0?a:c}:{message:c}}}:{}})}strip(){return new Me({...this._def,unknownKeys:"strip"})}passthrough(){return new Me({...this._def,unknownKeys:"passthrough"})}extend(e){return new Me({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Me({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:se.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Me({...this._def,catchall:e})}pick(e){const t={};return ve.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new Me({...this._def,shape:()=>t})}omit(e){const t={};return ve.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new Me({...this._def,shape:()=>t})}deepPartial(){return ii(this)}partial(e){const t={};return ve.objectKeys(this.shape).forEach(r=>{const i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}),new Me({...this._def,shape:()=>t})}required(e){const t={};return ve.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let n=this.shape[r];for(;n instanceof js;)n=n._def.innerType;t[r]=n}}),new Me({...this._def,shape:()=>t})}keyof(){return Yh(ve.objectKeys(this.shape))}}Me.create=(s,e)=>new Me({shape:()=>s,unknownKeys:"strip",catchall:Bs.create(),typeName:se.ZodObject,...de(e)});Me.strictCreate=(s,e)=>new Me({shape:()=>s,unknownKeys:"strict",catchall:Bs.create(),typeName:se.ZodObject,...de(e)});Me.lazycreate=(s,e)=>new Me({shape:s,unknownKeys:"strip",catchall:Bs.create(),typeName:se.ZodObject,...de(e)});class bn extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function i(n){for(const a of n)if(a.result.status==="valid")return a.result;for(const a of n)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;const o=n.map(a=>new as(a.ctx.common.issues));return z(t,{code:$.invalid_union,unionErrors:o}),oe}if(t.common.async)return Promise.all(r.map(async n=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await n._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(i);{let n;const o=[];for(const c of r){const l={...t,common:{...t.common,issues:[]},parent:null},d=c._parseSync({data:t.data,path:t.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!n&&(n={result:d,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(n)return t.common.issues.push(...n.ctx.common.issues),n.result;const a=o.map(c=>new as(c));return z(t,{code:$.invalid_union,unionErrors:a}),oe}}get options(){return this._def.options}}bn.create=(s,e)=>new bn({options:s,typeName:se.ZodUnion,...de(e)});const fo=s=>s instanceof An?fo(s.schema):s instanceof ls?fo(s.innerType()):s instanceof In?[s.value]:s instanceof nr?s.options:s instanceof Sn?Object.keys(s.enum):s instanceof Nn?fo(s._def.innerType):s instanceof vn?[void 0]:s instanceof En?[null]:null;class Yo extends pe{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==F.object)return z(t,{code:$.invalid_type,expected:F.object,received:t.parsedType}),oe;const r=this.discriminator,i=t.data[r],n=this.optionsMap.get(i);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(z(t,{code:$.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),oe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const i=new Map;for(const n of t){const o=fo(n.shape[e]);if(!o)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,n)}}return new Yo({typeName:se.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...de(r)})}}function mc(s,e){const t=Ys(s),r=Ys(e);if(s===e)return{valid:!0,data:s};if(t===F.object&&r===F.object){const i=ve.objectKeys(e),n=ve.objectKeys(s).filter(a=>i.indexOf(a)!==-1),o={...s,...e};for(const a of n){const c=mc(s[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===F.array&&r===F.array){if(s.length!==e.length)return{valid:!1};const i=[];for(let n=0;n<s.length;n++){const o=s[n],a=e[n],c=mc(o,a);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return t===F.date&&r===F.date&&+s==+e?{valid:!0,data:s}:{valid:!1}}class _n extends pe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=(n,o)=>{if(fc(n)||fc(o))return oe;const a=mc(n.value,o.value);return a.valid?((gc(n)||gc(o))&&t.dirty(),{status:t.value,value:a.data}):(z(r,{code:$.invalid_intersection_types}),oe)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([n,o])=>i(n,o)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}_n.create=(s,e,t)=>new _n({left:s,right:e,typeName:se.ZodIntersection,...de(t)});class Cs extends pe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==F.array)return z(r,{code:$.invalid_type,expected:F.array,received:r.parsedType}),oe;if(r.data.length<this._def.items.length)return z(r,{code:$.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),oe;!this._def.rest&&r.data.length>this._def.items.length&&(z(r,{code:$.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...r.data].map((o,a)=>{const c=this._def.items[a]||this._def.rest;return c?c._parse(new _s(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(n).then(o=>mt.mergeArray(t,o)):mt.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new Cs({...this._def,rest:e})}}Cs.create=(s,e)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Cs({items:s,typeName:se.ZodTuple,rest:null,...de(e)})};class Cn extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==F.object)return z(r,{code:$.invalid_type,expected:F.object,received:r.parsedType}),oe;const i=[],n=this._def.keyType,o=this._def.valueType;for(const a in r.data)i.push({key:n._parse(new _s(r,a,r.path,a)),value:o._parse(new _s(r,r.data[a],r.path,a))});return r.common.async?mt.mergeObjectAsync(t,i):mt.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof pe?new Cn({keyType:e,valueType:t,typeName:se.ZodRecord,...de(r)}):new Cn({keyType:ns.create(),valueType:e,typeName:se.ZodRecord,...de(t)})}}class xo extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==F.map)return z(r,{code:$.invalid_type,expected:F.map,received:r.parsedType}),oe;const i=this._def.keyType,n=this._def.valueType,o=[...r.data.entries()].map(([a,c],l)=>({key:i._parse(new _s(r,a,r.path,[l,"key"])),value:n._parse(new _s(r,c,r.path,[l,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const c of o){const l=await c.key,d=await c.value;if(l.status==="aborted"||d.status==="aborted")return oe;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),a.set(l.value,d.value)}return{status:t.value,value:a}})}else{const a=new Map;for(const c of o){const l=c.key,d=c.value;if(l.status==="aborted"||d.status==="aborted")return oe;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),a.set(l.value,d.value)}return{status:t.value,value:a}}}}xo.create=(s,e,t)=>new xo({valueType:e,keyType:s,typeName:se.ZodMap,...de(t)});class Rr extends pe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==F.set)return z(r,{code:$.invalid_type,expected:F.set,received:r.parsedType}),oe;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(z(r,{code:$.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(z(r,{code:$.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const n=this._def.valueType;function o(c){const l=new Set;for(const d of c){if(d.status==="aborted")return oe;d.status==="dirty"&&t.dirty(),l.add(d.value)}return{status:t.value,value:l}}const a=[...r.data.values()].map((c,l)=>n._parse(new _s(r,c,r.path,l)));return r.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new Rr({...this._def,minSize:{value:e,message:X.toString(t)}})}max(e,t){return new Rr({...this._def,maxSize:{value:e,message:X.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Rr.create=(s,e)=>new Rr({valueType:s,minSize:null,maxSize:null,typeName:se.ZodSet,...de(e)});class ui extends pe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==F.function)return z(t,{code:$.invalid_type,expected:F.function,received:t.parsedType}),oe;function r(a,c){return To({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,No(),mn].filter(l=>!!l),issueData:{code:$.invalid_arguments,argumentsError:c}})}function i(a,c){return To({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,No(),mn].filter(l=>!!l),issueData:{code:$.invalid_return_type,returnTypeError:c}})}const n={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof Ci){const a=this;return bt(async function(...c){const l=new as([]),d=await a._def.args.parseAsync(c,n).catch(f=>{throw l.addIssue(r(c,f)),l}),u=await Reflect.apply(o,this,d);return await a._def.returns._def.type.parseAsync(u,n).catch(f=>{throw l.addIssue(i(u,f)),l})})}else{const a=this;return bt(function(...c){const l=a._def.args.safeParse(c,n);if(!l.success)throw new as([r(c,l.error)]);const d=Reflect.apply(o,this,l.data),u=a._def.returns.safeParse(d,n);if(!u.success)throw new as([i(d,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ui({...this._def,args:Cs.create(e).rest(br.create())})}returns(e){return new ui({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new ui({args:e||Cs.create([]).rest(br.create()),returns:t||br.create(),typeName:se.ZodFunction,...de(r)})}}class An extends pe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}An.create=(s,e)=>new An({getter:s,typeName:se.ZodLazy,...de(e)});class In extends pe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return z(t,{received:t.data,code:$.invalid_literal,expected:this._def.value}),oe}return{status:"valid",value:e.data}}get value(){return this._def.value}}In.create=(s,e)=>new In({value:s,typeName:se.ZodLiteral,...de(e)});function Yh(s,e){return new nr({values:s,typeName:se.ZodEnum,...de(e)})}class nr extends pe{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return z(t,{expected:ve.joinValues(r),received:t.parsedType,code:$.invalid_type}),oe}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),r=this._def.values;return z(t,{received:t.data,code:$.invalid_enum_value,options:r}),oe}return bt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return nr.create(e)}exclude(e){return nr.create(this.options.filter(t=>!e.includes(t)))}}nr.create=Yh;class Sn extends pe{_parse(e){const t=ve.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==F.string&&r.parsedType!==F.number){const i=ve.objectValues(t);return z(r,{expected:ve.joinValues(i),received:r.parsedType,code:$.invalid_type}),oe}if(t.indexOf(e.data)===-1){const i=ve.objectValues(t);return z(r,{received:r.data,code:$.invalid_enum_value,options:i}),oe}return bt(e.data)}get enum(){return this._def.values}}Sn.create=(s,e)=>new Sn({values:s,typeName:se.ZodNativeEnum,...de(e)});class Ci extends pe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==F.promise&&t.common.async===!1)return z(t,{code:$.invalid_type,expected:F.promise,received:t.parsedType}),oe;const r=t.parsedType===F.promise?t.data:Promise.resolve(t.data);return bt(r.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ci.create=(s,e)=>new Ci({type:s,typeName:se.ZodPromise,...de(e)});class ls extends pe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===se.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:o=>{z(r,o),o.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),i.type==="preprocess"){const o=i.transform(r.data,n);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(o).then(a=>this._def.schema._parseAsync({data:a,path:r.path,parent:r})):this._def.schema._parseSync({data:o,path:r.path,parent:r})}if(i.type==="refinement"){const o=a=>{const c=i.refinement(a,n);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?oe:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?oe:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(i.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!wn(o))return o;const a=i.transform(o.value,n);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>wn(o)?Promise.resolve(i.transform(o.value,n)).then(a=>({status:t.value,value:a})):o);ve.assertNever(i)}}ls.create=(s,e,t)=>new ls({schema:s,typeName:se.ZodEffects,effect:e,...de(t)});ls.createWithPreprocess=(s,e,t)=>new ls({schema:e,effect:{type:"preprocess",transform:s},typeName:se.ZodEffects,...de(t)});class js extends pe{_parse(e){return this._getType(e)===F.undefined?bt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}js.create=(s,e)=>new js({innerType:s,typeName:se.ZodOptional,...de(e)});class Or extends pe{_parse(e){return this._getType(e)===F.null?bt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Or.create=(s,e)=>new Or({innerType:s,typeName:se.ZodNullable,...de(e)});class Nn extends pe{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===F.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Nn.create=(s,e)=>new Nn({innerType:s,typeName:se.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...de(e)});class ko extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Po(i)?i.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new as(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new as(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ko.create=(s,e)=>new ko({innerType:s,typeName:se.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...de(e)});class $o extends pe{_parse(e){if(this._getType(e)!==F.nan){const r=this._getOrReturnCtx(e);return z(r,{code:$.invalid_type,expected:F.nan,received:r.parsedType}),oe}return{status:"valid",value:e.data}}}$o.create=s=>new $o({typeName:se.ZodNaN,...de(s)});const bA=Symbol("zod_brand");class Zh extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class qn extends pe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const n=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return n.status==="aborted"?oe:n.status==="dirty"?(t.dirty(),Gh(n.value)):this._def.out._parseAsync({data:n.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?oe:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,t){return new qn({in:e,out:t,typeName:se.ZodPipeline})}}class Uo extends pe{_parse(e){const t=this._def.innerType._parse(e);return wn(t)&&(t.value=Object.freeze(t.value)),t}}Uo.create=(s,e)=>new Uo({innerType:s,typeName:se.ZodReadonly,...de(e)});const Jh=(s,e={},t)=>s?_i.create().superRefine((r,i)=>{var n,o;if(!s(r)){const a=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,c=(o=(n=a.fatal)!==null&&n!==void 0?n:t)!==null&&o!==void 0?o:!0,l=typeof a=="string"?{message:a}:a;i.addIssue({code:"custom",...l,fatal:c})}}):_i.create(),_A={object:Me.lazycreate};var se;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(se||(se={}));const CA=(s,e={message:`Input not instance of ${s.name}`})=>Jh(t=>t instanceof s,e),Xh=ns.create,Qh=rr.create,AA=$o.create,IA=ir.create,ep=yn.create,SA=Pr.create,NA=Ro.create,TA=vn.create,PA=En.create,RA=_i.create,OA=br.create,xA=Bs.create,kA=Oo.create,$A=cs.create,UA=Me.create,DA=Me.strictCreate,LA=bn.create,MA=Yo.create,jA=_n.create,BA=Cs.create,qA=Cn.create,FA=xo.create,WA=Rr.create,HA=ui.create,zA=An.create,VA=In.create,KA=nr.create,GA=Sn.create,YA=Ci.create,Vd=ls.create,ZA=js.create,JA=Or.create,XA=ls.createWithPreprocess,QA=qn.create,eI=()=>Xh().optional(),tI=()=>Qh().optional(),sI=()=>ep().optional(),rI={string:s=>ns.create({...s,coerce:!0}),number:s=>rr.create({...s,coerce:!0}),boolean:s=>yn.create({...s,coerce:!0}),bigint:s=>ir.create({...s,coerce:!0}),date:s=>Pr.create({...s,coerce:!0})},iI=oe;var p=Object.freeze({__proto__:null,defaultErrorMap:mn,setErrorMap:cA,getErrorMap:No,makeIssue:To,EMPTY_PATH:lA,addIssueToContext:z,ParseStatus:mt,INVALID:oe,DIRTY:Gh,OK:bt,isAborted:fc,isDirty:gc,isValid:wn,isAsync:Po,get util(){return ve},get objectUtil(){return pc},ZodParsedType:F,getParsedType:Ys,ZodType:pe,ZodString:ns,ZodNumber:rr,ZodBigInt:ir,ZodBoolean:yn,ZodDate:Pr,ZodSymbol:Ro,ZodUndefined:vn,ZodNull:En,ZodAny:_i,ZodUnknown:br,ZodNever:Bs,ZodVoid:Oo,ZodArray:cs,ZodObject:Me,ZodUnion:bn,ZodDiscriminatedUnion:Yo,ZodIntersection:_n,ZodTuple:Cs,ZodRecord:Cn,ZodMap:xo,ZodSet:Rr,ZodFunction:ui,ZodLazy:An,ZodLiteral:In,ZodEnum:nr,ZodNativeEnum:Sn,ZodPromise:Ci,ZodEffects:ls,ZodTransformer:ls,ZodOptional:js,ZodNullable:Or,ZodDefault:Nn,ZodCatch:ko,ZodNaN:$o,BRAND:bA,ZodBranded:Zh,ZodPipeline:qn,ZodReadonly:Uo,custom:Jh,Schema:pe,ZodSchema:pe,late:_A,get ZodFirstPartyTypeKind(){return se},coerce:rI,any:RA,array:$A,bigint:IA,boolean:ep,date:SA,discriminatedUnion:MA,effect:Vd,enum:KA,function:HA,instanceof:CA,intersection:jA,lazy:zA,literal:VA,map:FA,nan:AA,nativeEnum:GA,never:xA,null:PA,nullable:JA,number:Qh,object:UA,oboolean:sI,onumber:tI,optional:ZA,ostring:eI,pipeline:QA,preprocess:XA,promise:YA,record:qA,set:WA,strictObject:DA,string:Xh,symbol:NA,transformer:Vd,tuple:BA,undefined:TA,union:LA,unknown:OA,void:kA,NEVER:iI,ZodIssueCode:$,quotelessJson:aA,ZodError:as});const Be=p.object({message:p.string()});function W(s){return p.literal(V[s])}p.object({accessList:p.array(p.string()),blockHash:p.string().nullable(),blockNumber:p.string().nullable(),chainId:p.string().or(p.number()),from:p.string(),gas:p.string(),hash:p.string(),input:p.string().nullable(),maxFeePerGas:p.string(),maxPriorityFeePerGas:p.string(),nonce:p.string(),r:p.string(),s:p.string(),to:p.string(),transactionIndex:p.string().nullable(),type:p.string(),v:p.string(),value:p.string()});const nI=p.object({chainId:p.string().or(p.number())}),oI=p.object({email:p.string().email()}),aI=p.object({otp:p.string()}),cI=p.object({uri:p.string()}),lI=p.object({chainId:p.optional(p.string().or(p.number())),preferredAccountType:p.optional(p.string())}),dI=p.object({provider:p.enum(["google","github","apple","facebook","x","discord"])}),uI=p.object({email:p.string().email()}),hI=p.object({otp:p.string()}),pI=p.object({otp:p.string()}),fI=p.object({themeMode:p.optional(p.enum(["light","dark"])),themeVariables:p.optional(p.record(p.string(),p.string().or(p.number()))),w3mThemeVariables:p.optional(p.record(p.string(),p.string()))}),gI=p.object({metadata:p.object({name:p.string(),description:p.string(),url:p.string(),icons:p.array(p.string())}).optional(),sdkVersion:p.string().optional(),sdkType:p.string().optional(),projectId:p.string()}),mI=p.object({type:p.string()}),wI=p.object({action:p.enum(["VERIFY_DEVICE","VERIFY_OTP","CONNECT"])}),yI=p.object({url:p.string()}),vI=p.object({userName:p.string()}),EI=p.object({email:p.string().optional().nullable(),address:p.string(),chainId:p.string().or(p.number()),accounts:p.array(p.object({address:p.string(),type:p.enum([dt.ACCOUNT_TYPES.EOA,dt.ACCOUNT_TYPES.SMART_ACCOUNT])})).optional(),userName:p.string().optional().nullable()}),bI=p.object({action:p.enum(["VERIFY_PRIMARY_OTP","VERIFY_SECONDARY_OTP"])}),_I=p.object({email:p.string().email().optional().nullable(),address:p.string(),chainId:p.string().or(p.number()),smartAccountDeployed:p.optional(p.boolean()),accounts:p.array(p.object({address:p.string(),type:p.enum([dt.ACCOUNT_TYPES.EOA,dt.ACCOUNT_TYPES.SMART_ACCOUNT])})).optional(),preferredAccountType:p.optional(p.string())}),CI=p.object({uri:p.string()}),AI=p.object({isConnected:p.boolean()}),II=p.object({chainId:p.string().or(p.number())}),SI=p.object({chainId:p.string().or(p.number())}),NI=p.object({newEmail:p.string().email()}),TI=p.object({smartAccountEnabledNetworks:p.array(p.number())});p.object({address:p.string(),isDeployed:p.boolean()});const PI=p.object({version:p.string().optional()}),RI=p.object({type:p.string(),address:p.string()}),OI=p.any(),xI=p.object({method:p.literal("eth_accounts")}),kI=p.object({method:p.literal("eth_blockNumber")}),$I=p.object({method:p.literal("eth_call"),params:p.array(p.any())}),UI=p.object({method:p.literal("eth_chainId")}),DI=p.object({method:p.literal("eth_estimateGas"),params:p.array(p.any())}),LI=p.object({method:p.literal("eth_feeHistory"),params:p.array(p.any())}),MI=p.object({method:p.literal("eth_gasPrice")}),jI=p.object({method:p.literal("eth_getAccount"),params:p.array(p.any())}),BI=p.object({method:p.literal("eth_getBalance"),params:p.array(p.any())}),qI=p.object({method:p.literal("eth_getBlockByHash"),params:p.array(p.any())}),FI=p.object({method:p.literal("eth_getBlockByNumber"),params:p.array(p.any())}),WI=p.object({method:p.literal("eth_getBlockReceipts"),params:p.array(p.any())}),HI=p.object({method:p.literal("eth_getBlockTransactionCountByHash"),params:p.array(p.any())}),zI=p.object({method:p.literal("eth_getBlockTransactionCountByNumber"),params:p.array(p.any())}),VI=p.object({method:p.literal("eth_getCode"),params:p.array(p.any())}),KI=p.object({method:p.literal("eth_getFilterChanges"),params:p.array(p.any())}),GI=p.object({method:p.literal("eth_getFilterLogs"),params:p.array(p.any())}),YI=p.object({method:p.literal("eth_getLogs"),params:p.array(p.any())}),ZI=p.object({method:p.literal("eth_getProof"),params:p.array(p.any())}),JI=p.object({method:p.literal("eth_getStorageAt"),params:p.array(p.any())}),XI=p.object({method:p.literal("eth_getTransactionByBlockHashAndIndex"),params:p.array(p.any())}),QI=p.object({method:p.literal("eth_getTransactionByBlockNumberAndIndex"),params:p.array(p.any())}),eS=p.object({method:p.literal("eth_getTransactionByHash"),params:p.array(p.any())}),tS=p.object({method:p.literal("eth_getTransactionCount"),params:p.array(p.any())}),sS=p.object({method:p.literal("eth_getTransactionReceipt"),params:p.array(p.any())}),rS=p.object({method:p.literal("eth_getUncleCountByBlockHash"),params:p.array(p.any())}),iS=p.object({method:p.literal("eth_getUncleCountByBlockNumber"),params:p.array(p.any())}),nS=p.object({method:p.literal("eth_maxPriorityFeePerGas")}),oS=p.object({method:p.literal("eth_newBlockFilter")}),aS=p.object({method:p.literal("eth_newFilter"),params:p.array(p.any())}),cS=p.object({method:p.literal("eth_newPendingTransactionFilter")}),lS=p.object({method:p.literal("eth_sendRawTransaction"),params:p.array(p.any())}),dS=p.object({method:p.literal("eth_syncing"),params:p.array(p.any())}),uS=p.object({method:p.literal("eth_uninstallFilter"),params:p.array(p.any())}),Kd=p.object({method:p.literal("personal_sign"),params:p.array(p.any())}),hS=p.object({method:p.literal("eth_signTypedData_v4"),params:p.array(p.any())}),pS=p.object({method:p.literal("eth_sendTransaction"),params:p.array(p.any())}),fS=p.object({method:p.literal("solana_signMessage"),params:p.object({message:p.string(),pubkey:p.string()})}),gS=p.object({method:p.literal("solana_signTransaction"),params:p.object({transaction:p.string()})}),mS=p.object({method:p.literal("solana_signAllTransactions"),params:p.object({transactions:p.array(p.string())})}),wS=p.object({method:p.literal("solana_signAndSendTransaction"),params:p.object({transaction:p.string(),options:p.object({skipPreflight:p.boolean().optional(),preflightCommitment:p.enum(["processed","confirmed","finalized","recent","single","singleGossip","root","max"]).optional(),maxRetries:p.number().optional(),minContextSlot:p.number().optional()}).optional()})}),yS=p.object({method:p.literal("wallet_sendCalls"),params:p.array(p.object({chainId:p.string().or(p.number()).optional(),from:p.string().optional(),version:p.string().optional(),capabilities:p.any().optional(),calls:p.array(p.object({to:p.string().startsWith("0x"),data:p.string().startsWith("0x").optional(),value:p.string().optional()}))}))}),vS=p.object({method:p.literal("wallet_getCallsStatus"),params:p.array(p.string())}),ES=p.object({method:p.literal("wallet_getCapabilities")}),bS=p.object({method:p.literal("wallet_grantPermissions"),params:p.array(p.any())}),_S=p.object({method:p.literal("wallet_revokePermissions"),params:p.any()}),CS=p.object({method:p.literal("wallet_getAssets"),params:p.any()}),Gd=p.object({token:p.string()}),H=p.object({id:p.string().optional()}),Hi={appEvent:H.extend({type:W("APP_SWITCH_NETWORK"),payload:nI}).or(H.extend({type:W("APP_CONNECT_EMAIL"),payload:oI})).or(H.extend({type:W("APP_CONNECT_DEVICE")})).or(H.extend({type:W("APP_CONNECT_OTP"),payload:aI})).or(H.extend({type:W("APP_CONNECT_SOCIAL"),payload:cI})).or(H.extend({type:W("APP_GET_FARCASTER_URI")})).or(H.extend({type:W("APP_CONNECT_FARCASTER")})).or(H.extend({type:W("APP_GET_USER"),payload:p.optional(lI)})).or(H.extend({type:W("APP_GET_SOCIAL_REDIRECT_URI"),payload:dI})).or(H.extend({type:W("APP_SIGN_OUT")})).or(H.extend({type:W("APP_IS_CONNECTED"),payload:p.optional(Gd)})).or(H.extend({type:W("APP_GET_CHAIN_ID")})).or(H.extend({type:W("APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS")})).or(H.extend({type:W("APP_INIT_SMART_ACCOUNT")})).or(H.extend({type:W("APP_SET_PREFERRED_ACCOUNT"),payload:mI})).or(H.extend({type:W("APP_RPC_REQUEST"),payload:Kd.or(CS).or(xI).or(kI).or($I).or(UI).or(DI).or(LI).or(MI).or(jI).or(BI).or(qI).or(FI).or(WI).or(HI).or(zI).or(VI).or(KI).or(GI).or(YI).or(ZI).or(JI).or(XI).or(QI).or(eS).or(tS).or(sS).or(rS).or(iS).or(nS).or(oS).or(aS).or(cS).or(lS).or(dS).or(uS).or(Kd).or(hS).or(pS).or(fS).or(gS).or(mS).or(wS).or(vS).or(yS).or(ES).or(bS).or(_S)})).or(H.extend({type:W("APP_UPDATE_EMAIL"),payload:uI})).or(H.extend({type:W("APP_UPDATE_EMAIL_PRIMARY_OTP"),payload:hI})).or(H.extend({type:W("APP_UPDATE_EMAIL_SECONDARY_OTP"),payload:pI})).or(H.extend({type:W("APP_SYNC_THEME"),payload:fI})).or(H.extend({type:W("APP_SYNC_DAPP_DATA"),payload:gI})).or(H.extend({type:W("APP_RELOAD")})),frameEvent:H.extend({type:W("FRAME_SWITCH_NETWORK_ERROR"),payload:Be}).or(H.extend({type:W("FRAME_SWITCH_NETWORK_SUCCESS"),payload:SI})).or(H.extend({type:W("FRAME_CONNECT_EMAIL_SUCCESS"),payload:wI})).or(H.extend({type:W("FRAME_CONNECT_EMAIL_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_GET_FARCASTER_URI_SUCCESS"),payload:yI})).or(H.extend({type:W("FRAME_GET_FARCASTER_URI_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_CONNECT_FARCASTER_SUCCESS"),payload:vI})).or(H.extend({type:W("FRAME_CONNECT_FARCASTER_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_CONNECT_OTP_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_CONNECT_OTP_SUCCESS")})).or(H.extend({type:W("FRAME_CONNECT_DEVICE_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_CONNECT_DEVICE_SUCCESS")})).or(H.extend({type:W("FRAME_CONNECT_SOCIAL_SUCCESS"),payload:EI})).or(H.extend({type:W("FRAME_CONNECT_SOCIAL_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_GET_USER_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_GET_USER_SUCCESS"),payload:_I})).or(H.extend({type:W("FRAME_GET_SOCIAL_REDIRECT_URI_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_GET_SOCIAL_REDIRECT_URI_SUCCESS"),payload:CI})).or(H.extend({type:W("FRAME_SIGN_OUT_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_SIGN_OUT_SUCCESS")})).or(H.extend({type:W("FRAME_IS_CONNECTED_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_IS_CONNECTED_SUCCESS"),payload:AI})).or(H.extend({type:W("FRAME_GET_CHAIN_ID_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_GET_CHAIN_ID_SUCCESS"),payload:II})).or(H.extend({type:W("FRAME_RPC_REQUEST_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_RPC_REQUEST_SUCCESS"),payload:OI})).or(H.extend({type:W("FRAME_SESSION_UPDATE"),payload:Gd})).or(H.extend({type:W("FRAME_UPDATE_EMAIL_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_UPDATE_EMAIL_SUCCESS"),payload:bI})).or(H.extend({type:W("FRAME_UPDATE_EMAIL_PRIMARY_OTP_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_UPDATE_EMAIL_PRIMARY_OTP_SUCCESS")})).or(H.extend({type:W("FRAME_UPDATE_EMAIL_SECONDARY_OTP_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_UPDATE_EMAIL_SECONDARY_OTP_SUCCESS"),payload:NI})).or(H.extend({type:W("FRAME_SYNC_THEME_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_SYNC_THEME_SUCCESS")})).or(H.extend({type:W("FRAME_SYNC_DAPP_DATA_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_SYNC_DAPP_DATA_SUCCESS")})).or(H.extend({type:W("FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS"),payload:TI})).or(H.extend({type:W("FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_INIT_SMART_ACCOUNT_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_SET_PREFERRED_ACCOUNT_SUCCESS"),payload:RI})).or(H.extend({type:W("FRAME_SET_PREFERRED_ACCOUNT_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_READY"),payload:PI})).or(H.extend({type:W("FRAME_RELOAD_ERROR"),payload:Be})).or(H.extend({type:W("FRAME_RELOAD_SUCCESS")}))};function Ra(s,e={}){var t;return typeof(e==null?void 0:e.type)=="string"&&((t=e==null?void 0:e.type)==null?void 0:t.includes(s))}class AS{constructor({projectId:e,isAppClient:t=!1,chainId:r="eip155:1",enableLogger:i=!0}){if(this.iframe=null,this.iframeIsReady=!1,this.rpcUrl=G.BLOCKCHAIN_API_RPC_URL,this.initFrame=()=>{const n=document.getElementById("w3m-iframe");this.iframe&&!n&&document.body.appendChild(this.iframe)},this.events={registerFrameEventHandler:(n,o,a)=>{function c({data:l}){if(!Ra(V.FRAME_EVENT_KEY,l))return;const d=Hi.frameEvent.parse(l);d.id===n&&(o(d),window.removeEventListener("message",c))}Mt.isClient&&(window.addEventListener("message",c),a.addEventListener("abort",()=>{window.removeEventListener("message",c)}))},onFrameEvent:n=>{Mt.isClient&&window.addEventListener("message",({data:o})=>{if(!Ra(V.FRAME_EVENT_KEY,o))return;const a=Hi.frameEvent.parse(o);n(a)})},onAppEvent:n=>{Mt.isClient&&window.addEventListener("message",({data:o})=>{if(!Ra(V.APP_EVENT_KEY,o))return;const a=Hi.appEvent.parse(o);n(a)})},postAppEvent:n=>{var o;if(Mt.isClient){if(!((o=this.iframe)!=null&&o.contentWindow))throw new Error("W3mFrame: iframe is not set");Hi.appEvent.parse(n),this.iframe.contentWindow.postMessage(n,"*")}},postFrameEvent:n=>{if(Mt.isClient){if(!parent)throw new Error("W3mFrame: parent is not set");Hi.frameEvent.parse(n),parent.postMessage(n,"*")}}},this.projectId=e,this.frameLoadPromise=new Promise((n,o)=>{this.frameLoadPromiseResolver={resolve:n,reject:o}}),t&&(this.frameLoadPromise=new Promise((n,o)=>{this.frameLoadPromiseResolver={resolve:n,reject:o}}),Mt.isClient)){const n=document.createElement("iframe");n.id="w3m-iframe",n.src=`${J0}?projectId=${e}&chainId=${r}&version=${Q0}&enableLogger=${i}`,n.name="w3m-secure-iframe",n.style.position="fixed",n.style.zIndex="999999",n.style.display="none",n.style.border="none",n.style.animationDelay="0s, 50ms",n.style.borderBottomLeftRadius="clamp(0px, var(--wui-border-radius-l), 44px)",n.style.borderBottomRightRadius="clamp(0px, var(--wui-border-radius-l), 44px)",this.iframe=n,this.iframe.onerror=()=>{var o;(o=this.frameLoadPromiseResolver)==null||o.reject("Unable to load email login dependency")},this.events.onFrameEvent(o=>{var a;o.type==="@w3m-frame/READY"&&(this.iframeIsReady=!0,(a=this.frameLoadPromiseResolver)==null||a.resolve(void 0))})}}get networks(){const e=["eip155:1","eip155:5","eip155:11155111","eip155:10","eip155:420","eip155:42161","eip155:421613","eip155:137","eip155:80001","eip155:42220","eip155:1313161554","eip155:1313161555","eip155:56","eip155:97","eip155:43114","eip155:43113","eip155:324","eip155:280","eip155:100","eip155:8453","eip155:84531","eip155:84532","eip155:7777777","eip155:999","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1"].map(t=>({[t]:{rpcUrl:`${this.rpcUrl}/v1/?chainId=${t}&projectId=${this.projectId}`,chainId:t}}));return Object.assign({},...e)}}class IS{constructor(e){var n;const t=Ni({level:X0}),{logger:r,chunkLoggerController:i}=Ec({opts:t});this.logger=wt(r,this.constructor.name),this.chunkLoggerController=i,typeof window<"u"&&((n=this.chunkLoggerController)!=null&&n.downloadLogsBlobInBrowser)&&(window.downloadAppKitLogsBlob||(window.downloadAppKitLogsBlob={}),window.downloadAppKitLogsBlob.sdk=()=>{var o;(o=this.chunkLoggerController)!=null&&o.downloadLogsBlobInBrowser&&this.chunkLoggerController.downloadLogsBlobInBrowser({projectId:e})})}}class SS{constructor({projectId:e,chainId:t,enableLogger:r=!0,onTimeout:i,abortController:n}){this.openRpcRequests=[],r&&(this.w3mLogger=new IS(e)),this.abortController=n,this.w3mFrame=new AS({projectId:e,isAppClient:!0,chainId:t,enableLogger:r}),this.onTimeout=i,this.getLoginEmailUsed()&&this.w3mFrame.initFrame(),this.initPromise=new Promise(o=>{this.w3mFrame.events.onFrameEvent(async a=>{a.type===V.FRAME_READY&&(this.initPromise=void 0,await new Promise(c=>{setTimeout(c,500)}),o())})})}async init(){this.w3mFrame.initFrame(),this.initPromise&&await this.initPromise}getLoginEmailUsed(){return!!at.get(V.EMAIL_LOGIN_USED_KEY)}getEmail(){return at.get(V.EMAIL)}getUsername(){return at.get(V.SOCIAL_USERNAME)}async reload(){var e;try{this.w3mFrame.initFrame(),await this.appEvent({type:V.APP_RELOAD})}catch(t){throw(e=this.w3mLogger)==null||e.logger.error({error:t},"Error reloading iframe"),t}}async connectEmail(e){var t;try{Mt.checkIfAllowedToTriggerEmail(),this.w3mFrame.initFrame();const r=await this.appEvent({type:V.APP_CONNECT_EMAIL,payload:e});return this.setNewLastEmailLoginTime(),r}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error connecting email"),r}}async connectDevice(){var e;try{return this.appEvent({type:V.APP_CONNECT_DEVICE})}catch(t){throw(e=this.w3mLogger)==null||e.logger.error({error:t},"Error connecting device"),t}}async connectOtp(e){var t;try{return this.appEvent({type:V.APP_CONNECT_OTP,payload:e})}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error connecting otp"),r}}async isConnected(){var e;try{if(!this.getLoginEmailUsed())return{isConnected:!1};const t=await this.appEvent({type:V.APP_IS_CONNECTED});return t!=null&&t.isConnected||this.deleteAuthLoginCache(),t}catch(t){throw this.deleteAuthLoginCache(),(e=this.w3mLogger)==null||e.logger.error({error:t},"Error checking connection"),t}}async getChainId(){var e;try{const t=await this.appEvent({type:V.APP_GET_CHAIN_ID});return this.setLastUsedChainId(t.chainId),t}catch(t){throw(e=this.w3mLogger)==null||e.logger.error({error:t},"Error getting chain id"),t}}async getSocialRedirectUri(e){var t;try{return this.w3mFrame.initFrame(),this.appEvent({type:V.APP_GET_SOCIAL_REDIRECT_URI,payload:e})}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error getting social redirect uri"),r}}async updateEmail(e){var t;try{const r=await this.appEvent({type:V.APP_UPDATE_EMAIL,payload:e});return this.setNewLastEmailLoginTime(),r}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error updating email"),r}}async updateEmailPrimaryOtp(e){var t;try{return this.appEvent({type:V.APP_UPDATE_EMAIL_PRIMARY_OTP,payload:e})}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error updating email primary otp"),r}}async updateEmailSecondaryOtp(e){var t;try{const r=await this.appEvent({type:V.APP_UPDATE_EMAIL_SECONDARY_OTP,payload:e});return this.setLoginSuccess(r.newEmail),r}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error updating email secondary otp"),r}}async syncTheme(e){var t;try{return this.appEvent({type:V.APP_SYNC_THEME,payload:e})}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error syncing theme"),r}}async syncDappData(e){var t;try{return this.appEvent({type:V.APP_SYNC_DAPP_DATA,payload:e})}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error syncing dapp data"),r}}async getSmartAccountEnabledNetworks(){var e;try{const t=await this.appEvent({type:V.APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS});return this.persistSmartAccountEnabledNetworks(t.smartAccountEnabledNetworks),t}catch(t){throw this.persistSmartAccountEnabledNetworks([]),(e=this.w3mLogger)==null||e.logger.error({error:t},"Error getting smart account enabled networks"),t}}async setPreferredAccount(e){var t;try{return this.appEvent({type:V.APP_SET_PREFERRED_ACCOUNT,payload:{type:e}})}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error setting preferred account"),r}}async connect(e){var t;try{const r=(e==null?void 0:e.chainId)||this.getLastUsedChainId()||1,i=await this.getUser({chainId:r,preferredAccountType:e==null?void 0:e.preferredAccountType});return this.setLoginSuccess(i.email),this.setLastUsedChainId(i.chainId),this.user=i,i}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error connecting"),r}}async getUser(e){var t;try{const r=(e==null?void 0:e.chainId)||this.getLastUsedChainId()||1,i=await this.appEvent({type:V.APP_GET_USER,payload:{...e,chainId:r}});return this.user=i,i}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error connecting"),r}}async connectSocial(e){var t;try{this.w3mFrame.initFrame();const r=await this.appEvent({type:V.APP_CONNECT_SOCIAL,payload:{uri:e}});return r.userName&&this.setSocialLoginSuccess(r.userName),r}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error connecting social"),r}}async getFarcasterUri(){var e;try{return this.w3mFrame.initFrame(),await this.appEvent({type:V.APP_GET_FARCASTER_URI})}catch(t){throw(e=this.w3mLogger)==null||e.logger.error({error:t},"Error getting farcaster uri"),t}}async connectFarcaster(){var e;try{const t=await this.appEvent({type:V.APP_CONNECT_FARCASTER});return t.userName&&this.setSocialLoginSuccess(t.userName),t}catch(t){throw(e=this.w3mLogger)==null||e.logger.error({error:t},"Error connecting farcaster"),t}}async switchNetwork(e){var t;try{const r=await this.appEvent({type:V.APP_SWITCH_NETWORK,payload:{chainId:e}});return this.setLastUsedChainId(r.chainId),r}catch(r){throw(t=this.w3mLogger)==null||t.logger.error({error:r},"Error switching network"),r}}async disconnect(){var e;try{const t=await this.appEvent({type:V.APP_SIGN_OUT});return this.deleteAuthLoginCache(),t}catch(t){throw(e=this.w3mLogger)==null||e.logger.error({error:t},"Error disconnecting"),t}}async request(e){var t,r,i,n;try{if(dt.GET_CHAIN_ID===e.method)return this.getLastUsedChainId();(t=this.rpcRequestHandler)==null||t.call(this,e);const o=await this.appEvent({type:V.APP_RPC_REQUEST,payload:e});return(r=this.rpcSuccessHandler)==null||r.call(this,o,e),o}catch(o){throw(i=this.rpcErrorHandler)==null||i.call(this,o,e),(n=this.w3mLogger)==null||n.logger.error({error:o},"Error requesting"),o}}onRpcRequest(e){this.rpcRequestHandler=e}onRpcSuccess(e){this.rpcSuccessHandler=e}onRpcError(e){this.rpcErrorHandler=e}onIsConnected(e){this.w3mFrame.events.onFrameEvent(t=>{t.type===V.FRAME_IS_CONNECTED_SUCCESS&&t.payload.isConnected&&e()})}onNotConnected(e){this.w3mFrame.events.onFrameEvent(t=>{t.type===V.FRAME_IS_CONNECTED_ERROR&&e(),t.type===V.FRAME_IS_CONNECTED_SUCCESS&&!t.payload.isConnected&&e()})}onConnect(e){this.w3mFrame.events.onFrameEvent(t=>{t.type===V.FRAME_GET_USER_SUCCESS&&e(t.payload)})}onSocialConnected(e){this.w3mFrame.events.onFrameEvent(t=>{t.type===V.FRAME_CONNECT_SOCIAL_SUCCESS&&e(t.payload)})}async getCapabilities(){try{return await this.request({method:"wallet_getCapabilities"})||{}}catch{return{}}}onSetPreferredAccount(e){this.w3mFrame.events.onFrameEvent(t=>{t.type===V.FRAME_SET_PREFERRED_ACCOUNT_SUCCESS?e(t.payload):t.type===V.FRAME_SET_PREFERRED_ACCOUNT_ERROR&&e({type:dt.ACCOUNT_TYPES.EOA})})}onGetSmartAccountEnabledNetworks(e){this.w3mFrame.events.onFrameEvent(t=>{t.type===V.FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS?e(t.payload.smartAccountEnabledNetworks):t.type===V.FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_ERROR&&e([])})}getAvailableChainIds(){return Object.keys(this.w3mFrame.networks)}rejectRpcRequests(){var e;try{this.openRpcRequests.forEach(({abortController:t,method:r})=>{dt.SAFE_RPC_METHODS.includes(r)||t.abort()}),this.openRpcRequests=[]}catch(t){(e=this.w3mLogger)==null||e.logger.error({error:t},"Error aborting RPC request")}}async appEvent(e){let t,r;function i(c){return c.replace("@w3m-app/","")}const n=[V.APP_SYNC_DAPP_DATA,V.APP_SYNC_THEME,V.APP_SET_PREFERRED_ACCOUNT],o=i(e.type);return!this.w3mFrame.iframeIsReady&&!n.includes(e.type)&&(r=setTimeout(()=>{var c;(c=this.onTimeout)==null||c.call(this,"iframe_load_failed"),this.abortController.abort()},2e4)),await this.w3mFrame.frameLoadPromise,clearTimeout(r),[V.APP_CONNECT_EMAIL,V.APP_CONNECT_DEVICE,V.APP_CONNECT_OTP,V.APP_CONNECT_SOCIAL,V.APP_GET_SOCIAL_REDIRECT_URI].map(i).includes(o)&&(t=setTimeout(()=>{var c;(c=this.onTimeout)==null||c.call(this,"iframe_request_timeout"),this.abortController.abort()},3e4)),new Promise((c,l)=>{var f,g,m;const d=Math.random().toString(36).substring(7);(m=(f=this.w3mLogger)==null?void 0:(g=f.logger).info)==null||m.call(g,{event:e,id:d},"Sending app event"),this.w3mFrame.events.postAppEvent({...e,id:d});const u=new AbortController;if(o==="RPC_REQUEST"){const w=e;this.openRpcRequests=[...this.openRpcRequests,{...w.payload,abortController:u}]}u.signal.addEventListener("abort",()=>{o==="RPC_REQUEST"?l(new Error("Request was aborted")):o!=="GET_FARCASTER_URI"&&l(new Error("Something went wrong"))});function h(w,v){var E,_,C;w.id===d&&((_=v==null?void 0:(E=v.logger).info)==null||_.call(E,{framEvent:w,id:d},"Received frame response"),w.type===`@w3m-frame/${o}_SUCCESS`?(t&&clearTimeout(t),r&&clearTimeout(r),"payload"in w&&c(w.payload),c(void 0)):w.type===`@w3m-frame/${o}_ERROR`&&(t&&clearTimeout(t),r&&clearTimeout(r),"payload"in w&&l(new Error(((C=w.payload)==null?void 0:C.message)||"An error occurred")),l(new Error("An error occurred"))))}this.w3mFrame.events.registerFrameEventHandler(d,w=>h(w,this.w3mLogger),this.abortController.signal)})}setNewLastEmailLoginTime(){at.set(V.LAST_EMAIL_LOGIN_TIME,Date.now().toString())}setSocialLoginSuccess(e){at.set(V.SOCIAL_USERNAME,e)}setLoginSuccess(e){e&&at.set(V.EMAIL,e),at.set(V.EMAIL_LOGIN_USED_KEY,"true"),at.delete(V.LAST_EMAIL_LOGIN_TIME)}deleteAuthLoginCache(){at.delete(V.EMAIL_LOGIN_USED_KEY),at.delete(V.EMAIL),at.delete(V.LAST_USED_CHAIN_KEY),at.delete(V.SOCIAL_USERNAME)}setLastUsedChainId(e){e&&at.set(V.LAST_USED_CHAIN_KEY,String(e))}getLastUsedChainId(){const e=at.get(V.LAST_USED_CHAIN_KEY)??void 0,t=Number(e);return isNaN(t)?e:t}persistSmartAccountEnabledNetworks(e){at.set(V.SMART_ACCOUNT_ENABLED_NETWORKS,e.join(","))}}class sn{constructor(){}static getInstance({projectId:e,chainId:t,enableLogger:r,onTimeout:i,abortController:n}){return sn.instance||(sn.instance=new SS({projectId:e,chainId:t,enableLogger:r,onTimeout:i,abortController:n})),sn.instance}}var Yd={};const NS={ACCOUNT_TABS:[{label:"Tokens"},{label:"NFTs"},{label:"Activity"}],SECURE_SITE_ORIGIN:(typeof os<"u"&&typeof Yd<"u"?Yd.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",VIEW_DIRECTION:{Next:"next",Prev:"prev"},DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"],ANIMATION_DURATIONS:{HeaderText:120,ModalHeight:150,ViewTransition:150}},wc={filterOutDuplicatesByRDNS(s){const e=x.state.enableEIP6963?ne.state.connectors:[],t=K.getRecentWallets(),r=e.map(a=>{var c;return(c=a.info)==null?void 0:c.rdns}).filter(Boolean),i=t.map(a=>a.rdns).filter(Boolean),n=r.concat(i);if(n.includes("io.metamask.mobile")&&ie.isMobile()){const a=n.indexOf("io.metamask.mobile");n[a]="io.metamask"}return s.filter(a=>!n.includes(String(a==null?void 0:a.rdns)))},filterOutDuplicatesByIds(s){const e=ne.state.connectors.filter(a=>a.type==="ANNOUNCED"||a.type==="INJECTED"),t=K.getRecentWallets(),r=e.map(a=>a.explorerId),i=t.map(a=>a.id),n=r.concat(i);return s.filter(a=>!n.includes(a==null?void 0:a.id))},filterOutDuplicateWallets(s){const e=this.filterOutDuplicatesByRDNS(s);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(s){const{connectors:e}=ne.state,t=e.filter(n=>n.type==="ANNOUNCED").reduce((n,o)=>{var a;return(a=o.info)!=null&&a.rdns&&(n[o.info.rdns]=!0),n},{});return s.map(n=>({...n,installed:!!n.rdns&&!!t[n.rdns??""]})).sort((n,o)=>Number(o.installed)-Number(n.installed))},getConnectOrderMethod(s,e){var c;const t=(s==null?void 0:s.connectMethodsOrder)||((c=x.state.features)==null?void 0:c.connectMethodsOrder),r=e||ne.state.connectors;if(t)return t;const{injected:i,announced:n}=go.getConnectorsByType(r,te.state.recommended,te.state.featured),o=i.filter(go.showConnector),a=n.filter(go.showConnector);return o.length||a.length?["wallet","email","social"]:NS.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(s){const e=!!s.rdns&&te.state.excludedWallets.some(r=>r.rdns===s.rdns),t=!!s.name&&te.state.excludedWallets.some(r=>Go.isLowerCaseMatch(r.name,s.name));return e||t}},go={getConnectorsByType(s,e,t){const{customWallets:r}=x.state,i=K.getRecentWallets(),n=wc.filterOutDuplicateWallets(e),o=wc.filterOutDuplicateWallets(t),a=s.filter(u=>u.type==="MULTI_CHAIN"),c=s.filter(u=>u.type==="ANNOUNCED"),l=s.filter(u=>u.type==="INJECTED"),d=s.filter(u=>u.type==="EXTERNAL");return{custom:r,recent:i,external:d,multiChain:a,announced:c,injected:l,recommended:n,featured:o}},showConnector(s){var i;const e=(i=s.info)==null?void 0:i.rdns,t=!!e&&te.state.excludedWallets.some(n=>!!n.rdns&&n.rdns===e),r=!!s.name&&te.state.excludedWallets.some(n=>Go.isLowerCaseMatch(n.name,s.name));return!(s.type==="INJECTED"&&(s.name==="Browser Wallet"&&(!ie.isMobile()||ie.isMobile()&&!e&&!Ue.checkInstalled())||t||r)||(s.type==="ANNOUNCED"||s.type==="EXTERNAL")&&(t||r))},getIsConnectedWithWC(){return Array.from(y.state.chains.values()).some(t=>ne.getConnectorId(t.namespace)===G.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:s,featured:e,custom:t,recent:r,announced:i,injected:n,multiChain:o,external:a,overriddenConnectors:c=(l=>(l=x.state.features)==null?void 0:l.connectorTypeOrder)()??[]}){const d=go.getIsConnectedWithWC(),f=[{type:"walletConnect",isEnabled:x.state.enableWalletConnect&&!d},{type:"recent",isEnabled:r.length>0},{type:"injected",isEnabled:[...n,...i,...o].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:t&&t.length>0},{type:"external",isEnabled:a.length>0},{type:"recommended",isEnabled:s.length>0}].filter(v=>v.isEnabled),g=new Set(f.map(v=>v.type)),m=c.filter(v=>g.has(v)).map(v=>({type:v,isEnabled:!0})),w=f.filter(({type:v})=>!m.some(({type:_})=>_===v));return Array.from(new Set([...m,...w].map(({type:v})=>v)))}};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const mo=globalThis,Mc=mo.ShadowRoot&&(mo.ShadyCSS===void 0||mo.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,jc=Symbol(),Zd=new WeakMap;let tp=class{constructor(e,t,r){if(this._$cssResult$=!0,r!==jc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Mc&&e===void 0){const r=t!==void 0&&t.length===1;r&&(e=Zd.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&Zd.set(t,e))}return e}toString(){return this.cssText}};const Kt=s=>new tp(typeof s=="string"?s:s+"",void 0,jc),hi=(s,...e)=>{const t=s.length===1?s[0]:e.reduce((r,i,n)=>r+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+s[n+1],s[0]);return new tp(t,s,jc)},TS=(s,e)=>{if(Mc)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const r=document.createElement("style"),i=mo.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=t.cssText,s.appendChild(r)}},Jd=Mc?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(const r of e.cssRules)t+=r.cssText;return Kt(t)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:PS,defineProperty:RS,getOwnPropertyDescriptor:OS,getOwnPropertyNames:xS,getOwnPropertySymbols:kS,getPrototypeOf:$S}=Object,er=globalThis,Xd=er.trustedTypes,US=Xd?Xd.emptyScript:"",Oa=er.reactiveElementPolyfillSupport,rn=(s,e)=>s,yc={toAttribute(s,e){switch(e){case Boolean:s=s?US:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},sp=(s,e)=>!PS(s,e),Qd={attribute:!0,type:String,converter:yc,reflect:!1,useDefault:!1,hasChanged:sp};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),er.litPropertyMetadata??(er.litPropertyMetadata=new WeakMap);let ni=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=Qd){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const r=Symbol(),i=this.getPropertyDescriptor(e,r,t);i!==void 0&&RS(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){const{get:i,set:n}=OS(this.prototype,e)??{get(){return this[t]},set(o){this[t]=o}};return{get:i,set(o){const a=i==null?void 0:i.call(this);n==null||n.call(this,o),this.requestUpdate(e,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??Qd}static _$Ei(){if(this.hasOwnProperty(rn("elementProperties")))return;const e=$S(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(rn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(rn("properties"))){const t=this.properties,r=[...xS(t),...kS(t)];for(const i of r)this.createProperty(i,t[i])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[r,i]of t)this.elementProperties.set(r,i)}this._$Eh=new Map;for(const[t,r]of this.elementProperties){const i=this._$Eu(t,r);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const i of r)t.unshift(Jd(i))}else e!==void 0&&t.push(Jd(e));return t}static _$Eu(e,t){const r=t.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return TS(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(t=>{var r;return(r=t.hostConnected)==null?void 0:r.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(t=>{var r;return(r=t.hostDisconnected)==null?void 0:r.call(t)})}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$ET(e,t){var n;const r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(i!==void 0&&r.reflect===!0){const o=(((n=r.converter)==null?void 0:n.toAttribute)!==void 0?r.converter:yc).toAttribute(t,r.type);this._$Em=e,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._$Em=null}}_$AK(e,t){var n,o;const r=this.constructor,i=r._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const a=r.getPropertyOptions(i),c=typeof a.converter=="function"?{fromAttribute:a.converter}:((n=a.converter)==null?void 0:n.fromAttribute)!==void 0?a.converter:yc;this._$Em=i,this[i]=c.fromAttribute(t,a.type)??((o=this._$Ej)==null?void 0:o.get(i))??null,this._$Em=null}}requestUpdate(e,t,r){var i;if(e!==void 0){const n=this.constructor,o=this[e];if(r??(r=n.getPropertyOptions(e)),!((r.hasChanged??sp)(o,t)||r.useDefault&&r.reflect&&o===((i=this._$Ej)==null?void 0:i.get(e))&&!this.hasAttribute(n._$Eu(e,r))))return;this.C(e,t,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,t,{useDefault:r,reflect:i,wrapped:n},o){r&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,o??t??this[e]),n!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||r||(t=void 0),this._$AL.set(e,t)),i===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,o]of this._$Ep)this[n]=o;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[n,o]of i){const{wrapped:a}=o,c=this[n];a!==!0||this._$AL.has(n)||c===void 0||this.C(n,void 0,o,c)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(r=this._$EO)==null||r.forEach(i=>{var n;return(n=i.hostUpdate)==null?void 0:n.call(i)}),this.update(t)):this._$EM()}catch(i){throw e=!1,this._$EM(),i}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(e){}firstUpdated(e){}};ni.elementStyles=[],ni.shadowRootOptions={mode:"open"},ni[rn("elementProperties")]=new Map,ni[rn("finalized")]=new Map,Oa==null||Oa({ReactiveElement:ni}),(er.reactiveElementVersions??(er.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const nn=globalThis,Do=nn.trustedTypes,eu=Do?Do.createPolicy("lit-html",{createHTML:s=>s}):void 0,rp="$lit$",Zs=`lit$${Math.random().toFixed(9).slice(2)}$`,ip="?"+Zs,DS=`<${ip}>`,xr=document,Tn=()=>xr.createComment(""),Pn=s=>s===null||typeof s!="object"&&typeof s!="function",Bc=Array.isArray,LS=s=>Bc(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",xa=`[ 	
\f\r]`,zi=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,tu=/-->/g,su=/>/g,ur=RegExp(`>|${xa}(?:([^\\s"'>=/]+)(${xa}*=${xa}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),ru=/'/g,iu=/"/g,np=/^(?:script|style|textarea|title)$/i,op=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),TN=op(1),PN=op(2),Ai=Symbol.for("lit-noChange"),st=Symbol.for("lit-nothing"),nu=new WeakMap,vr=xr.createTreeWalker(xr,129);function ap(s,e){if(!Bc(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return eu!==void 0?eu.createHTML(e):e}const MS=(s,e)=>{const t=s.length-1,r=[];let i,n=e===2?"<svg>":e===3?"<math>":"",o=zi;for(let a=0;a<t;a++){const c=s[a];let l,d,u=-1,h=0;for(;h<c.length&&(o.lastIndex=h,d=o.exec(c),d!==null);)h=o.lastIndex,o===zi?d[1]==="!--"?o=tu:d[1]!==void 0?o=su:d[2]!==void 0?(np.test(d[2])&&(i=RegExp("</"+d[2],"g")),o=ur):d[3]!==void 0&&(o=ur):o===ur?d[0]===">"?(o=i??zi,u=-1):d[1]===void 0?u=-2:(u=o.lastIndex-d[2].length,l=d[1],o=d[3]===void 0?ur:d[3]==='"'?iu:ru):o===iu||o===ru?o=ur:o===tu||o===su?o=zi:(o=ur,i=void 0);const f=o===ur&&s[a+1].startsWith("/>")?" ":"";n+=o===zi?c+DS:u>=0?(r.push(l),c.slice(0,u)+rp+c.slice(u)+Zs+f):c+Zs+(u===-2?a:f)}return[ap(s,n+(s[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]};class Rn{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let n=0,o=0;const a=e.length-1,c=this.parts,[l,d]=MS(e,t);if(this.el=Rn.createElement(l,r),vr.currentNode=this.el.content,t===2||t===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(i=vr.nextNode())!==null&&c.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const u of i.getAttributeNames())if(u.endsWith(rp)){const h=d[o++],f=i.getAttribute(u).split(Zs),g=/([.?@])?(.*)/.exec(h);c.push({type:1,index:n,name:g[2],strings:f,ctor:g[1]==="."?BS:g[1]==="?"?qS:g[1]==="@"?FS:Zo}),i.removeAttribute(u)}else u.startsWith(Zs)&&(c.push({type:6,index:n}),i.removeAttribute(u));if(np.test(i.tagName)){const u=i.textContent.split(Zs),h=u.length-1;if(h>0){i.textContent=Do?Do.emptyScript:"";for(let f=0;f<h;f++)i.append(u[f],Tn()),vr.nextNode(),c.push({type:2,index:++n});i.append(u[h],Tn())}}}else if(i.nodeType===8)if(i.data===ip)c.push({type:2,index:n});else{let u=-1;for(;(u=i.data.indexOf(Zs,u+1))!==-1;)c.push({type:7,index:n}),u+=Zs.length-1}n++}}static createElement(e,t){const r=xr.createElement("template");return r.innerHTML=e,r}}function Ii(s,e,t=s,r){var o,a;if(e===Ai)return e;let i=r!==void 0?(o=t._$Co)==null?void 0:o[r]:t._$Cl;const n=Pn(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==n&&((a=i==null?void 0:i._$AO)==null||a.call(i,!1),n===void 0?i=void 0:(i=new n(s),i._$AT(s,t,r)),r!==void 0?(t._$Co??(t._$Co=[]))[r]=i:t._$Cl=i),i!==void 0&&(e=Ii(s,i._$AS(s,e.values),i,r)),e}class jS{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:r}=this._$AD,i=((e==null?void 0:e.creationScope)??xr).importNode(t,!0);vr.currentNode=i;let n=vr.nextNode(),o=0,a=0,c=r[0];for(;c!==void 0;){if(o===c.index){let l;c.type===2?l=new Fn(n,n.nextSibling,this,e):c.type===1?l=new c.ctor(n,c.name,c.strings,this,e):c.type===6&&(l=new WS(n,this,e)),this._$AV.push(l),c=r[++a]}o!==(c==null?void 0:c.index)&&(n=vr.nextNode(),o++)}return vr.currentNode=xr,i}p(e){let t=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}}class Fn{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,r,i){this.type=2,this._$AH=st,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=(i==null?void 0:i.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ii(this,e,t),Pn(e)?e===st||e==null||e===""?(this._$AH!==st&&this._$AR(),this._$AH=st):e!==this._$AH&&e!==Ai&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):LS(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==st&&Pn(this._$AH)?this._$AA.nextSibling.data=e:this.T(xr.createTextNode(e)),this._$AH=e}$(e){var n;const{values:t,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=Rn.createElement(ap(r.h,r.h[0]),this.options)),r);if(((n=this._$AH)==null?void 0:n._$AD)===i)this._$AH.p(t);else{const o=new jS(i,this),a=o.u(this.options);o.p(t),this.T(a),this._$AH=o}}_$AC(e){let t=nu.get(e.strings);return t===void 0&&nu.set(e.strings,t=new Rn(e)),t}k(e){Bc(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let r,i=0;for(const n of e)i===t.length?t.push(r=new Fn(this.O(Tn()),this.O(Tn()),this,this.options)):r=t[i],r._$AI(n),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,t);e&&e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}}class Zo{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,n){this.type=1,this._$AH=st,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=n,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=st}_$AI(e,t=this,r,i){const n=this.strings;let o=!1;if(n===void 0)e=Ii(this,e,t,0),o=!Pn(e)||e!==this._$AH&&e!==Ai,o&&(this._$AH=e);else{const a=e;let c,l;for(e=n[0],c=0;c<n.length-1;c++)l=Ii(this,a[r+c],t,c),l===Ai&&(l=this._$AH[c]),o||(o=!Pn(l)||l!==this._$AH[c]),l===st?e=st:e!==st&&(e+=(l??"")+n[c+1]),this._$AH[c]=l}o&&!i&&this.j(e)}j(e){e===st?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class BS extends Zo{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===st?void 0:e}}class qS extends Zo{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==st)}}class FS extends Zo{constructor(e,t,r,i,n){super(e,t,r,i,n),this.type=5}_$AI(e,t=this){if((e=Ii(this,e,t,0)??st)===Ai)return;const r=this._$AH,i=e===st&&r!==st||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,n=e!==st&&(r===st||i);i&&this.element.removeEventListener(this.name,this,r),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}}class WS{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){Ii(this,e)}}const ka=nn.litHtmlPolyfillSupport;ka==null||ka(Rn,Fn),(nn.litHtmlVersions??(nn.litHtmlVersions=[])).push("3.3.0");const HS=(s,e,t)=>{const r=(t==null?void 0:t.renderBefore)??e;let i=r._$litPart$;if(i===void 0){const n=(t==null?void 0:t.renderBefore)??null;r._$litPart$=i=new Fn(e.insertBefore(Tn(),n),n,void 0,t??{})}return i._$AI(s),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const _r=globalThis;class wo extends ni{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=HS(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Ai}}var lu;wo._$litElement$=!0,wo.finalized=!0,(lu=_r.litElementHydrateSupport)==null||lu.call(_r,{LitElement:wo});const $a=_r.litElementPolyfillSupport;$a==null||$a({LitElement:wo});(_r.litElementVersions??(_r.litElementVersions=[])).push("4.2.0");let on,tr,sr;function RN(s,e){on=document.createElement("style"),tr=document.createElement("style"),sr=document.createElement("style"),on.textContent=pi(s).core.cssText,tr.textContent=pi(s).dark.cssText,sr.textContent=pi(s).light.cssText,document.head.appendChild(on),document.head.appendChild(tr),document.head.appendChild(sr),cp(e)}function cp(s){tr&&sr&&(s==="light"?(tr.removeAttribute("media"),sr.media="enabled"):(sr.removeAttribute("media"),tr.media="enabled"))}function zS(s){on&&tr&&sr&&(on.textContent=pi(s).core.cssText,tr.textContent=pi(s).dark.cssText,sr.textContent=pi(s).light.cssText)}function pi(s){return{core:hi`
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --w3m-modal-width: 360px;
        --w3m-color-mix-strength: ${Kt(s!=null&&s["--w3m-color-mix-strength"]?`${s["--w3m-color-mix-strength"]}%`:"0%")};
        --w3m-font-family: ${Kt((s==null?void 0:s["--w3m-font-family"])||"Inter, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;")};
        --w3m-font-size-master: ${Kt((s==null?void 0:s["--w3m-font-size-master"])||"10px")};
        --w3m-border-radius-master: ${Kt((s==null?void 0:s["--w3m-border-radius-master"])||"4px")};
        --w3m-z-index: ${Kt((s==null?void 0:s["--w3m-z-index"])||999)};

        --wui-font-family: var(--w3m-font-family);

        --wui-font-size-mini: calc(var(--w3m-font-size-master) * 0.8);
        --wui-font-size-micro: var(--w3m-font-size-master);
        --wui-font-size-tiny: calc(var(--w3m-font-size-master) * 1.2);
        --wui-font-size-small: calc(var(--w3m-font-size-master) * 1.4);
        --wui-font-size-paragraph: calc(var(--w3m-font-size-master) * 1.6);
        --wui-font-size-medium: calc(var(--w3m-font-size-master) * 1.8);
        --wui-font-size-large: calc(var(--w3m-font-size-master) * 2);
        --wui-font-size-title-6: calc(var(--w3m-font-size-master) * 2.2);
        --wui-font-size-medium-title: calc(var(--w3m-font-size-master) * 2.4);
        --wui-font-size-2xl: calc(var(--w3m-font-size-master) * 4);

        --wui-border-radius-5xs: var(--w3m-border-radius-master);
        --wui-border-radius-4xs: calc(var(--w3m-border-radius-master) * 1.5);
        --wui-border-radius-3xs: calc(var(--w3m-border-radius-master) * 2);
        --wui-border-radius-xxs: calc(var(--w3m-border-radius-master) * 3);
        --wui-border-radius-xs: calc(var(--w3m-border-radius-master) * 4);
        --wui-border-radius-s: calc(var(--w3m-border-radius-master) * 5);
        --wui-border-radius-m: calc(var(--w3m-border-radius-master) * 7);
        --wui-border-radius-l: calc(var(--w3m-border-radius-master) * 9);
        --wui-border-radius-3xl: calc(var(--w3m-border-radius-master) * 20);

        --wui-font-weight-light: 400;
        --wui-font-weight-regular: 500;
        --wui-font-weight-medium: 600;
        --wui-font-weight-bold: 700;

        --wui-letter-spacing-2xl: -1.6px;
        --wui-letter-spacing-medium-title: -0.96px;
        --wui-letter-spacing-title-6: -0.88px;
        --wui-letter-spacing-large: -0.8px;
        --wui-letter-spacing-medium: -0.72px;
        --wui-letter-spacing-paragraph: -0.64px;
        --wui-letter-spacing-small: -0.56px;
        --wui-letter-spacing-tiny: -0.48px;
        --wui-letter-spacing-micro: -0.2px;
        --wui-letter-spacing-mini: -0.16px;

        --wui-spacing-0: 0px;
        --wui-spacing-4xs: 2px;
        --wui-spacing-3xs: 4px;
        --wui-spacing-xxs: 6px;
        --wui-spacing-2xs: 7px;
        --wui-spacing-xs: 8px;
        --wui-spacing-1xs: 10px;
        --wui-spacing-s: 12px;
        --wui-spacing-m: 14px;
        --wui-spacing-l: 16px;
        --wui-spacing-2l: 18px;
        --wui-spacing-xl: 20px;
        --wui-spacing-xxl: 24px;
        --wui-spacing-2xl: 32px;
        --wui-spacing-3xl: 40px;
        --wui-spacing-4xl: 90px;
        --wui-spacing-5xl: 95px;

        --wui-icon-box-size-xxs: 14px;
        --wui-icon-box-size-xs: 20px;
        --wui-icon-box-size-sm: 24px;
        --wui-icon-box-size-md: 32px;
        --wui-icon-box-size-mdl: 36px;
        --wui-icon-box-size-lg: 40px;
        --wui-icon-box-size-2lg: 48px;
        --wui-icon-box-size-xl: 64px;

        --wui-icon-size-inherit: inherit;
        --wui-icon-size-xxs: 10px;
        --wui-icon-size-xs: 12px;
        --wui-icon-size-sm: 14px;
        --wui-icon-size-md: 16px;
        --wui-icon-size-mdl: 18px;
        --wui-icon-size-lg: 20px;
        --wui-icon-size-xl: 24px;
        --wui-icon-size-xxl: 28px;

        --wui-wallet-image-size-inherit: inherit;
        --wui-wallet-image-size-sm: 40px;
        --wui-wallet-image-size-md: 56px;
        --wui-wallet-image-size-lg: 80px;

        --wui-visual-size-size-inherit: inherit;
        --wui-visual-size-sm: 40px;
        --wui-visual-size-md: 55px;
        --wui-visual-size-lg: 80px;

        --wui-box-size-md: 100px;
        --wui-box-size-lg: 120px;

        --wui-ease-out-power-2: cubic-bezier(0, 0, 0.22, 1);
        --wui-ease-out-power-1: cubic-bezier(0, 0, 0.55, 1);

        --wui-ease-in-power-3: cubic-bezier(0.66, 0, 1, 1);
        --wui-ease-in-power-2: cubic-bezier(0.45, 0, 1, 1);
        --wui-ease-in-power-1: cubic-bezier(0.3, 0, 1, 1);

        --wui-ease-inout-power-1: cubic-bezier(0.45, 0, 0.55, 1);

        --wui-duration-lg: 200ms;
        --wui-duration-md: 125ms;
        --wui-duration-sm: 75ms;

        --wui-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --wui-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --wui-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --wui-width-network-sm: 36px;
        --wui-width-network-md: 48px;
        --wui-width-network-lg: 86px;

        --wui-height-network-sm: 40px;
        --wui-height-network-md: 54px;
        --wui-height-network-lg: 96px;

        --wui-icon-size-network-xs: 12px;
        --wui-icon-size-network-sm: 16px;
        --wui-icon-size-network-md: 24px;
        --wui-icon-size-network-lg: 42px;

        --wui-color-inherit: inherit;

        --wui-color-inverse-100: #fff;
        --wui-color-inverse-000: #000;

        --wui-cover: rgba(20, 20, 20, 0.8);

        --wui-color-modal-bg: var(--wui-color-modal-bg-base);

        --wui-color-accent-100: var(--wui-color-accent-base-100);
        --wui-color-accent-090: var(--wui-color-accent-base-090);
        --wui-color-accent-080: var(--wui-color-accent-base-080);

        --wui-color-success-100: var(--wui-color-success-base-100);
        --wui-color-success-125: var(--wui-color-success-base-125);

        --wui-color-warning-100: var(--wui-color-warning-base-100);

        --wui-color-error-100: var(--wui-color-error-base-100);
        --wui-color-error-125: var(--wui-color-error-base-125);

        --wui-color-blue-100: var(--wui-color-blue-base-100);
        --wui-color-blue-90: var(--wui-color-blue-base-90);

        --wui-icon-box-bg-error-100: var(--wui-icon-box-bg-error-base-100);
        --wui-icon-box-bg-blue-100: var(--wui-icon-box-bg-blue-base-100);
        --wui-icon-box-bg-success-100: var(--wui-icon-box-bg-success-base-100);
        --wui-icon-box-bg-inverse-100: var(--wui-icon-box-bg-inverse-base-100);

        --wui-all-wallets-bg-100: var(--wui-all-wallets-bg-100);

        --wui-avatar-border: var(--wui-avatar-border-base);

        --wui-thumbnail-border: var(--wui-thumbnail-border-base);

        --wui-wallet-button-bg: var(--wui-wallet-button-bg-base);

        --wui-box-shadow-blue: var(--wui-color-accent-glass-020);
      }

      @supports (background: color-mix(in srgb, white 50%, black)) {
        :root {
          --wui-color-modal-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-modal-bg-base)
          );

          --wui-box-shadow-blue: color-mix(in srgb, var(--wui-color-accent-100) 20%, transparent);

          --wui-color-accent-100: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 100%,
            transparent
          );
          --wui-color-accent-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-glass-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-020: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 20%,
            transparent
          );
          --wui-color-accent-glass-015: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 15%,
            transparent
          );
          --wui-color-accent-glass-010: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 10%,
            transparent
          );
          --wui-color-accent-glass-005: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 5%,
            transparent
          );
          --wui-color-accent-002: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 2%,
            transparent
          );

          --wui-color-fg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-100)
          );
          --wui-color-fg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-125)
          );
          --wui-color-fg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-150)
          );
          --wui-color-fg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-175)
          );
          --wui-color-fg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-200)
          );
          --wui-color-fg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-225)
          );
          --wui-color-fg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-250)
          );
          --wui-color-fg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-275)
          );
          --wui-color-fg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-300)
          );
          --wui-color-fg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-325)
          );
          --wui-color-fg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-350)
          );

          --wui-color-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-100)
          );
          --wui-color-bg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-125)
          );
          --wui-color-bg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-150)
          );
          --wui-color-bg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-175)
          );
          --wui-color-bg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-200)
          );
          --wui-color-bg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-225)
          );
          --wui-color-bg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-250)
          );
          --wui-color-bg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-275)
          );
          --wui-color-bg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-300)
          );
          --wui-color-bg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-325)
          );
          --wui-color-bg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-350)
          );

          --wui-color-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-100)
          );
          --wui-color-success-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-125)
          );

          --wui-color-warning-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-warning-base-100)
          );

          --wui-color-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-100)
          );
          --wui-color-blue-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-100)
          );
          --wui-color-blue-90: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-90)
          );
          --wui-color-error-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-125)
          );

          --wui-icon-box-bg-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-error-base-100)
          );
          --wui-icon-box-bg-accent-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-blue-base-100)
          );
          --wui-icon-box-bg-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-success-base-100)
          );
          --wui-icon-box-bg-inverse-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-inverse-base-100)
          );

          --wui-all-wallets-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-all-wallets-bg-100)
          );

          --wui-avatar-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-avatar-border-base)
          );

          --wui-thumbnail-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-thumbnail-border-base)
          );

          --wui-wallet-button-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-wallet-button-bg-base)
          );
        }
      }
    `,light:hi`
      :root {
        --w3m-color-mix: ${Kt((s==null?void 0:s["--w3m-color-mix"])||"#fff")};
        --w3m-accent: ${Kt(Ds(s,"dark")["--w3m-accent"])};
        --w3m-default: #fff;

        --wui-color-modal-bg-base: ${Kt(Ds(s,"dark")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(230, 100%, 67%, 1);
        --wui-color-blueberry-090: hsla(231, 76%, 61%, 1);
        --wui-color-blueberry-080: hsla(230, 59%, 55%, 1);
        --wui-color-blueberry-050: hsla(231, 100%, 70%, 0.1);

        --wui-color-fg-100: #e4e7e7;
        --wui-color-fg-125: #d0d5d5;
        --wui-color-fg-150: #a8b1b1;
        --wui-color-fg-175: #a8b0b0;
        --wui-color-fg-200: #949e9e;
        --wui-color-fg-225: #868f8f;
        --wui-color-fg-250: #788080;
        --wui-color-fg-275: #788181;
        --wui-color-fg-300: #6e7777;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #363636;

        --wui-color-bg-100: #141414;
        --wui-color-bg-125: #191a1a;
        --wui-color-bg-150: #1e1f1f;
        --wui-color-bg-175: #222525;
        --wui-color-bg-200: #272a2a;
        --wui-color-bg-225: #2c3030;
        --wui-color-bg-250: #313535;
        --wui-color-bg-275: #363b3b;
        --wui-color-bg-300: #3b4040;
        --wui-color-bg-325: #252525;
        --wui-color-bg-350: #ffffff;

        --wui-color-success-base-100: #26d962;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f25a67;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 217, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 217, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 217, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 217, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 217, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 217, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 217, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 217, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 217, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 217, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(242, 90, 103, 0.01);
        --wui-color-error-glass-002: rgba(242, 90, 103, 0.02);
        --wui-color-error-glass-005: rgba(242, 90, 103, 0.05);
        --wui-color-error-glass-010: rgba(242, 90, 103, 0.1);
        --wui-color-error-glass-015: rgba(242, 90, 103, 0.15);
        --wui-color-error-glass-020: rgba(242, 90, 103, 0.2);
        --wui-color-error-glass-025: rgba(242, 90, 103, 0.25);
        --wui-color-error-glass-030: rgba(242, 90, 103, 0.3);
        --wui-color-error-glass-060: rgba(242, 90, 103, 0.6);
        --wui-color-error-glass-080: rgba(242, 90, 103, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-color-gray-glass-001: rgba(255, 255, 255, 0.01);
        --wui-color-gray-glass-002: rgba(255, 255, 255, 0.02);
        --wui-color-gray-glass-005: rgba(255, 255, 255, 0.05);
        --wui-color-gray-glass-010: rgba(255, 255, 255, 0.1);
        --wui-color-gray-glass-015: rgba(255, 255, 255, 0.15);
        --wui-color-gray-glass-020: rgba(255, 255, 255, 0.2);
        --wui-color-gray-glass-025: rgba(255, 255, 255, 0.25);
        --wui-color-gray-glass-030: rgba(255, 255, 255, 0.3);
        --wui-color-gray-glass-060: rgba(255, 255, 255, 0.6);
        --wui-color-gray-glass-080: rgba(255, 255, 255, 0.8);
        --wui-color-gray-glass-090: rgba(255, 255, 255, 0.9);

        --wui-color-dark-glass-100: rgba(42, 42, 42, 1);

        --wui-icon-box-bg-error-base-100: #3c2426;
        --wui-icon-box-bg-blue-base-100: #20303f;
        --wui-icon-box-bg-success-base-100: #1f3a28;
        --wui-icon-box-bg-inverse-base-100: #243240;

        --wui-all-wallets-bg-100: #222b35;

        --wui-avatar-border-base: #252525;

        --wui-thumbnail-border-base: #252525;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --w3m-card-embedded-shadow-color: rgb(17 17 18 / 25%);
      }
    `,dark:hi`
      :root {
        --w3m-color-mix: ${Kt((s==null?void 0:s["--w3m-color-mix"])||"#000")};
        --w3m-accent: ${Kt(Ds(s,"light")["--w3m-accent"])};
        --w3m-default: #000;

        --wui-color-modal-bg-base: ${Kt(Ds(s,"light")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(231, 100%, 70%, 1);
        --wui-color-blueberry-090: hsla(231, 97%, 72%, 1);
        --wui-color-blueberry-080: hsla(231, 92%, 74%, 1);

        --wui-color-fg-100: #141414;
        --wui-color-fg-125: #2d3131;
        --wui-color-fg-150: #474d4d;
        --wui-color-fg-175: #636d6d;
        --wui-color-fg-200: #798686;
        --wui-color-fg-225: #828f8f;
        --wui-color-fg-250: #8b9797;
        --wui-color-fg-275: #95a0a0;
        --wui-color-fg-300: #9ea9a9;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #d0d0d0;

        --wui-color-bg-100: #ffffff;
        --wui-color-bg-125: #f5fafa;
        --wui-color-bg-150: #f3f8f8;
        --wui-color-bg-175: #eef4f4;
        --wui-color-bg-200: #eaf1f1;
        --wui-color-bg-225: #e5eded;
        --wui-color-bg-250: #e1e9e9;
        --wui-color-bg-275: #dce7e7;
        --wui-color-bg-300: #d8e3e3;
        --wui-color-bg-325: #f3f3f3;
        --wui-color-bg-350: #202020;

        --wui-color-success-base-100: #26b562;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f05142;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 181, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 181, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 181, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 181, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 181, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 181, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 181, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 181, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 181, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 181, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(240, 81, 66, 0.01);
        --wui-color-error-glass-002: rgba(240, 81, 66, 0.02);
        --wui-color-error-glass-005: rgba(240, 81, 66, 0.05);
        --wui-color-error-glass-010: rgba(240, 81, 66, 0.1);
        --wui-color-error-glass-015: rgba(240, 81, 66, 0.15);
        --wui-color-error-glass-020: rgba(240, 81, 66, 0.2);
        --wui-color-error-glass-025: rgba(240, 81, 66, 0.25);
        --wui-color-error-glass-030: rgba(240, 81, 66, 0.3);
        --wui-color-error-glass-060: rgba(240, 81, 66, 0.6);
        --wui-color-error-glass-080: rgba(240, 81, 66, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-icon-box-bg-error-base-100: #f4dfdd;
        --wui-icon-box-bg-blue-base-100: #d9ecfb;
        --wui-icon-box-bg-success-base-100: #daf0e4;
        --wui-icon-box-bg-inverse-base-100: #dcecfc;

        --wui-all-wallets-bg-100: #e8f1fa;

        --wui-avatar-border-base: #f3f4f4;

        --wui-thumbnail-border-base: #eaefef;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --wui-color-gray-glass-001: rgba(0, 0, 0, 0.01);
        --wui-color-gray-glass-002: rgba(0, 0, 0, 0.02);
        --wui-color-gray-glass-005: rgba(0, 0, 0, 0.05);
        --wui-color-gray-glass-010: rgba(0, 0, 0, 0.1);
        --wui-color-gray-glass-015: rgba(0, 0, 0, 0.15);
        --wui-color-gray-glass-020: rgba(0, 0, 0, 0.2);
        --wui-color-gray-glass-025: rgba(0, 0, 0, 0.25);
        --wui-color-gray-glass-030: rgba(0, 0, 0, 0.3);
        --wui-color-gray-glass-060: rgba(0, 0, 0, 0.6);
        --wui-color-gray-glass-080: rgba(0, 0, 0, 0.8);
        --wui-color-gray-glass-090: rgba(0, 0, 0, 0.9);

        --wui-color-dark-glass-100: rgba(233, 233, 233, 1);

        --w3m-card-embedded-shadow-color: rgb(224 225 233 / 25%);
      }
    `}}const ON=hi`
  *,
  *::after,
  *::before,
  :host {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    font-family: var(--wui-font-family);
    backface-visibility: hidden;
  }
`,xN=hi`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    transition:
      color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      background-color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1),
      box-shadow var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: background-color, color, border, box-shadow, border-radius;
    outline: none;
    border: none;
    column-gap: var(--wui-spacing-3xs);
    background-color: transparent;
    text-decoration: none;
  }

  wui-flex {
    transition: border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: border-radius;
  }

  button:disabled > wui-wallet-image,
  button:disabled > wui-all-wallets-image,
  button:disabled > wui-network-image,
  button:disabled > wui-image,
  button:disabled > wui-transaction-visual,
  button:disabled > wui-logo {
    filter: grayscale(1);
  }

  @media (hover: hover) and (pointer: fine) {
    button:hover:enabled {
      background-color: var(--wui-color-gray-glass-005);
    }

    button:active:enabled {
      background-color: var(--wui-color-gray-glass-010);
    }
  }

  button:disabled > wui-icon-box {
    opacity: 0.5;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`,kN=hi`
  .wui-color-inherit {
    color: var(--wui-color-inherit);
  }

  .wui-color-accent-100 {
    color: var(--wui-color-accent-100);
  }

  .wui-color-error-100 {
    color: var(--wui-color-error-100);
  }

  .wui-color-blue-100 {
    color: var(--wui-color-blue-100);
  }

  .wui-color-blue-90 {
    color: var(--wui-color-blue-90);
  }

  .wui-color-error-125 {
    color: var(--wui-color-error-125);
  }

  .wui-color-success-100 {
    color: var(--wui-color-success-100);
  }

  .wui-color-success-125 {
    color: var(--wui-color-success-125);
  }

  .wui-color-inverse-100 {
    color: var(--wui-color-inverse-100);
  }

  .wui-color-inverse-000 {
    color: var(--wui-color-inverse-000);
  }

  .wui-color-fg-100 {
    color: var(--wui-color-fg-100);
  }

  .wui-color-fg-200 {
    color: var(--wui-color-fg-200);
  }

  .wui-color-fg-300 {
    color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    color: var(--wui-color-fg-350);
  }

  .wui-bg-color-inherit {
    background-color: var(--wui-color-inherit);
  }

  .wui-bg-color-blue-100 {
    background-color: var(--wui-color-accent-100);
  }

  .wui-bg-color-error-100 {
    background-color: var(--wui-color-error-100);
  }

  .wui-bg-color-error-125 {
    background-color: var(--wui-color-error-125);
  }

  .wui-bg-color-success-100 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-success-125 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-inverse-100 {
    background-color: var(--wui-color-inverse-100);
  }

  .wui-bg-color-inverse-000 {
    background-color: var(--wui-color-inverse-000);
  }

  .wui-bg-color-fg-100 {
    background-color: var(--wui-color-fg-100);
  }

  .wui-bg-color-fg-200 {
    background-color: var(--wui-color-fg-200);
  }

  .wui-bg-color-fg-300 {
    background-color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    background-color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    background-color: var(--wui-color-fg-350);
  }
`,li={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"]};function Wn(s){return{formatters:void 0,fees:void 0,serializers:void 0,...s}}const ou=Wn({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"}),au=Wn({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"});Wn({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});Wn({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}});Wn({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});const lp={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},an={getMethodsByChainNamespace(s){return lp[s]||[]},createDefaultNamespace(s){return{methods:this.getMethodsByChainNamespace(s),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(s,e){if(!e)return{...s};const t={...s},r=new Set;if(e.methods&&Object.keys(e.methods).forEach(i=>r.add(i)),e.chains&&Object.keys(e.chains).forEach(i=>r.add(i)),e.events&&Object.keys(e.events).forEach(i=>r.add(i)),e.rpcMap&&Object.keys(e.rpcMap).forEach(i=>{const[n]=i.split(":");n&&r.add(n)}),r.forEach(i=>{t[i]||(t[i]=this.createDefaultNamespace(i))}),e.methods&&Object.entries(e.methods).forEach(([i,n])=>{t[i]&&(t[i].methods=n)}),e.chains&&Object.entries(e.chains).forEach(([i,n])=>{t[i]&&(t[i].chains=n)}),e.events&&Object.entries(e.events).forEach(([i,n])=>{t[i]&&(t[i].events=n)}),e.rpcMap){const i=new Set;Object.entries(e.rpcMap).forEach(([n,o])=>{const[a,c]=n.split(":");!a||!c||!t[a]||(t[a].rpcMap||(t[a].rpcMap={}),i.has(a)||(t[a].rpcMap={},i.add(a)),t[a].rpcMap[c]=o)})}return t},createNamespaces(s,e){const t=s.reduce((r,i)=>{const{id:n,chainNamespace:o,rpcUrls:a}=i,c=a.default.http[0];r[o]||(r[o]=this.createDefaultNamespace(o));const l=`${o}:${n}`,d=r[o];switch(d.chains.push(l),l){case ou.caipNetworkId:d.chains.push(ou.deprecatedCaipNetworkId);break;case au.caipNetworkId:d.chains.push(au.deprecatedCaipNetworkId);break}return d!=null&&d.rpcMap&&c&&(d.rpcMap[n]=c),r},{});return this.applyNamespaceOverrides(t,e)},resolveReownName:async s=>{var r;const e=await Vh.resolveName(s);return((r=(Object.values(e==null?void 0:e.addresses)||[])[0])==null?void 0:r.address)||!1},getChainsFromNamespaces(s={}){return Object.values(s).flatMap(e=>{const t=e.chains||[],r=e.accounts.map(i=>{const[n,o]=i.split(":");return`${n}:${o}`});return Array.from(new Set([...t,...r]))})},isSessionEventData(s){return typeof s=="object"&&s!==null&&"id"in s&&"topic"in s&&"params"in s&&typeof s.params=="object"&&s.params!==null&&"chainId"in s.params&&"event"in s.params&&typeof s.params.event=="object"&&s.params.event!==null},isOriginAllowed(s,e,t){for(const r of[...e,...t])if(r.includes("*")){const n=`^${r.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&").replace(/\\\*/gu,".*")}$`;if(new RegExp(n,"u").test(s))return!0}else if(r===s)return!0;return!1}};class dp{constructor({provider:e,namespace:t}){this.id=G.CONNECTOR_ID.WALLET_CONNECT,this.name=Io.ConnectorNamesMap[G.CONNECTOR_ID.WALLET_CONNECT],this.type="WALLET_CONNECT",this.imageId=Io.ConnectorImageIds[G.CONNECTOR_ID.WALLET_CONNECT],this.getCaipNetworks=y.getCaipNetworks.bind(y),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=t}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){const t=this.getCaipNetworks(),r=x.state.universalProviderConfigOverride,i=an.createNamespaces(t,r);await this.provider.connect({optionalNamespaces:i})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(t=>t.caipNetworkId);return tn.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:VS})}}const VS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];class KS{constructor(e){this.availableConnectors=[],this.eventListeners=new Map,this.getCaipNetworks=t=>y.getCaipNetworks(t),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get networks(){return this.getCaipNetworks(this.namespace)}setAuthProvider(e){this.addConnector({id:G.CONNECTOR_ID.AUTH,type:"AUTH",name:G.CONNECTOR_NAMES.AUTH,provider:e,imageId:Io.ConnectorImageIds[G.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(...e){const t=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(r=>t.has(r.id)?!1:(t.add(r.id),!0)),this.emit("connectors",this.availableConnectors)}setStatus(e,t){Y.setStatus(e,t)}on(e,t){var r;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),(r=this.eventListeners.get(e))==null||r.add(t)}off(e,t){const r=this.eventListeners.get(e);r&&r.delete(t)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,t){const r=this.eventListeners.get(e);r&&r.forEach(i=>i(t))}async connectWalletConnect(e){return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}async switchNetwork(e){var n;const{caipNetwork:t,providerType:r}=e;if(!e.provider)return;const i="provider"in e.provider?e.provider.provider:e.provider;if(r==="WALLET_CONNECT"){i.setDefaultChain(t.caipNetworkId);return}if(i&&r==="AUTH"){const o=i,a=(n=Y.state.preferredAccountTypes)==null?void 0:n[t.chainNamespace];await o.switchNetwork(t.caipNetworkId);const c=await o.getUser({chainId:t.caipNetworkId,preferredAccountType:a});this.emit("switchNetwork",c)}}getWalletConnectConnector(){const e=this.connectors.find(t=>t instanceof dp);if(!e)throw new Error("WalletConnectConnector not found");return e}}class GS extends KS{setUniversalProvider(e){this.addConnector(new dp({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace}))}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect()}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}}async getAccounts({namespace:e}){var i,n,o,a;const t=this.provider,r=((a=(o=(n=(i=t==null?void 0:t.session)==null?void 0:i.namespaces)==null?void 0:n[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>{const[,,l]=c.split(":");return l}).filter((c,l,d)=>d.indexOf(c)===l))||[];return Promise.resolve({accounts:r.map(c=>ie.createAccount(e,c,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){var n,o,a,c,l;if(!(e.caipNetwork&&lt.BALANCE_SUPPORTED_CHAINS.includes((n=e.caipNetwork)==null?void 0:n.chainNamespace))||(o=e.caipNetwork)!=null&&o.testnet)return{balance:"0.00",symbol:((a=e.caipNetwork)==null?void 0:a.nativeCurrency.symbol)||""};if(Y.state.balanceLoading&&e.chainId===((c=y.state.activeCaipNetwork)==null?void 0:c.id))return{balance:Y.state.balance||"0.00",symbol:Y.state.balanceSymbol||""};const i=(await Y.fetchTokenBalance()).find(d=>{var u,h;return d.chainId===`${(u=e.caipNetwork)==null?void 0:u.chainNamespace}:${e.chainId}`&&d.symbol===((h=e.caipNetwork)==null?void 0:h.nativeCurrency.symbol)});return{balance:(i==null?void 0:i.quantity.numeric)||"0.00",symbol:(i==null?void 0:i.symbol)||((l=e.caipNetwork)==null?void 0:l.nativeCurrency.symbol)||""}}async signMessage(e){var o,a,c;const{provider:t,message:r,address:i}=e;if(!t)throw new Error("UniversalAdapter:signMessage - provider is undefined");let n="";return((o=y.state.activeCaipNetwork)==null?void 0:o.chainNamespace)===G.CHAIN.SOLANA?n=(await t.request({method:"solana_signMessage",params:{message:du.encode(new TextEncoder().encode(r)),pubkey:i}},(a=y.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)).signature:n=await t.request({method:"personal_sign",params:[r,i]},(c=y.state.activeCaipNetwork)==null?void 0:c.caipNetworkId),{signature:n}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){var i,n,o,a,c,l;const{caipNetwork:t}=e,r=this.getWalletConnectConnector();if(t.chainNamespace===G.CHAIN.EVM)try{await((i=r.provider)==null?void 0:i.request({method:"wallet_switchEthereumChain",params:[{chainId:Hc(t.id)}]}))}catch(d){if(d.code===li.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||d.code===li.ERROR_INVALID_CHAIN_ID||d.code===li.ERROR_CODE_DEFAULT||((o=(n=d==null?void 0:d.data)==null?void 0:n.originalError)==null?void 0:o.code)===li.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await((l=r.provider)==null?void 0:l.request({method:"wallet_addEthereumChain",params:[{chainId:Hc(t.id),rpcUrls:[(a=t==null?void 0:t.rpcUrls.chainDefault)==null?void 0:a.http],chainName:t.name,nativeCurrency:t.nativeCurrency,blockExplorerUrls:[(c=t.blockExplorers)==null?void 0:c.default.url]}]}))}catch{throw new Error("Chain is not supported")}}r.provider.setDefaultChain(t.caipNetworkId)}getWalletConnectProvider(){const e=this.connectors.find(r=>r.type==="WALLET_CONNECT");return e==null?void 0:e.provider}}class YS{constructor(e){this.chainNamespaces=[],this.reportedAlertErrors={},this.getCaipNetwork=(t,r)=>{var i,n,o,a;if(t){const c=(n=(i=y.getNetworkData(t))==null?void 0:i.requestedCaipNetworks)==null?void 0:n.find(d=>d.id===r);if(c)return c;const l=(o=y.getNetworkData(t))==null?void 0:o.caipNetwork;return l||((a=y.getRequestedCaipNetworks(t).filter(d=>d.chainNamespace===t))==null?void 0:a[0])}return y.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const t=this.getCaipNetwork();if(t)return t.id},this.getCaipNetworks=t=>y.getCaipNetworks(t),this.getActiveChainNamespace=()=>y.state.activeChain,this.setRequestedCaipNetworks=(t,r)=>{y.setRequestedCaipNetworks(t,r)},this.getApprovedCaipNetworkIds=()=>y.getAllApprovedCaipNetworkIds(),this.getCaipAddress=t=>y.state.activeChain===t||!t?y.state.activeCaipAddress:y.getAccountProp("caipAddress",t),this.setClientId=t=>{re.setClientId(t)},this.getProvider=t=>Ne.getProvider(t),this.getProviderType=t=>Ne.getProviderId(t),this.getPreferredAccountType=t=>{var r;return(r=Y.state.preferredAccountTypes)==null?void 0:r[t]},this.setCaipAddress=(t,r)=>{Y.setCaipAddress(t,r)},this.setBalance=(t,r,i)=>{Y.setBalance(t,r,i)},this.setProfileName=(t,r)=>{Y.setProfileName(t,r)},this.setProfileImage=(t,r)=>{Y.setProfileImage(t,r)},this.setUser=(t,r)=>{Y.setUser(t,r),x.state.enableEmbedded&&Fe.close()},this.resetAccount=t=>{Y.resetAccount(t)},this.setCaipNetwork=t=>{y.setActiveCaipNetwork(t)},this.setCaipNetworkOfNamespace=(t,r)=>{y.setChainNetworkData(r,{caipNetwork:t})},this.setAllAccounts=(t,r)=>{Y.setAllAccounts(t,r),x.setHasMultipleAddresses((t==null?void 0:t.length)>1)},this.setStatus=(t,r)=>{Y.setStatus(t,r),ne.isConnected()?K.setConnectionStatus("connected"):K.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=t=>y.getAccountProp("address",t),this.setConnectors=t=>{const r=[...ne.state.allConnectors,...t];ne.setConnectors(r)},this.fetchIdentity=t=>re.fetchIdentity(t),this.getReownName=t=>Vh.getNamesForAddress(t),this.getConnectors=()=>ne.getConnectors(),this.getConnectorImage=t=>gu.getConnectorImage(t),this.setConnectedWalletInfo=(t,r)=>{const i=Ne.getProviderId(r),n=t?{...t,type:i}:void 0;Y.setConnectedWalletInfo(n,r)},this.getIsConnectedState=()=>!!y.state.activeCaipAddress,this.addAddressLabel=(t,r,i)=>{Y.addAddressLabel(t,r,i)},this.removeAddressLabel=(t,r)=>{Y.removeAddressLabel(t,r)},this.getAddress=t=>y.state.activeChain===t||!t?Y.state.address:y.getAccountProp("address",t),this.setApprovedCaipNetworksData=t=>y.setApprovedCaipNetworksData(t),this.resetNetwork=t=>{y.resetNetwork(t)},this.addConnector=t=>{ne.addConnector(t)},this.resetWcConnection=()=>{Ue.resetWcConnection()},this.setAddressExplorerUrl=(t,r)=>{Y.setAddressExplorerUrl(t,r)},this.setSmartAccountDeployed=(t,r)=>{Y.setSmartAccountDeployed(t,r)},this.setSmartAccountEnabledNetworks=(t,r)=>{y.setSmartAccountEnabledNetworks(t,r)},this.setPreferredAccountType=(t,r)=>{Y.setPreferredAccountType(t,r)},this.setEIP6963Enabled=t=>{x.setEIP6963Enabled(t)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.initialize(e)}getChainNamespacesSet(e,t){const r=e==null?void 0:e.map(n=>n.namespace).filter(n=>!!n);if(r!=null&&r.length)return[...new Set(r)];const i=t==null?void 0:t.map(n=>n.chainNamespace);return[...new Set(i)]}async initialize(e){var t,r,i;this.initControllers(e),await this.initChainAdapters(),await this.injectModalUi(),this.sendInitializeEvent(e),Es.set({initialized:!0}),await this.syncExistingConnection(),((t=x.state.features)!=null&&t.email||Array.isArray((r=x.state.features)==null?void 0:r.socials)&&((i=x.state.features)==null?void 0:i.socials.length)>0)&&await this.checkAllowedOrigins()}async checkAllowedOrigins(){const e=await te.fetchAllowedOrigins();if(e&&ie.isClient()){const t=window.location.origin;an.isOriginAllowed(t,e,li.DEFAULT_ALLOWED_ANCESTORS)||$s.open(ys.ALERT_ERRORS.INVALID_APP_CONFIGURATION,"error")}else $s.open(ys.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error")}sendInitializeEvent(e){var r;const{...t}=e;delete t.adapters,delete t.universalProvider,Le.sendEvent({type:"track",event:"INITIALIZE",properties:{...t,networks:e.networks.map(i=>i.id),siweConfig:{options:((r=e.siweConfig)==null?void 0:r.options)||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initializeThemeController(e){e.themeMode&&ft.setThemeMode(e.themeMode),e.themeVariables&&ft.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient||!this.networkControllerClient)throw new Error("ConnectionControllerClient and NetworkControllerClient must be set");y.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});const t=this.getDefaultNetwork();t&&y.setActiveCaipNetwork(t)}initializeConnectionController(e){Ue.setWcBasic(e.basic??!1)}initializeConnectorController(){ne.initialize(this.chainNamespaces)}initializeOptionsController(e){var o;x.setDebug(e.debug!==!1),x.setEnableWalletConnect(e.enableWalletConnect!==!1),x.setEnableWalletGuide(e.enableWalletGuide!==!1),x.setEnableWallets(e.enableWallets!==!1),x.setEIP6963Enabled(e.enableEIP6963!==!1),x.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),x.setEnableAuthLogger(e.enableAuthLogger!==!1),x.setCustomRpcUrls(e.customRpcUrls),x.setSdkVersion(e.sdkVersion),x.setProjectId(e.projectId),x.setEnableEmbedded(e.enableEmbedded),x.setAllWallets(e.allWallets),x.setIncludeWalletIds(e.includeWalletIds),x.setExcludeWalletIds(e.excludeWalletIds),x.setFeaturedWalletIds(e.featuredWalletIds),x.setTokens(e.tokens),x.setTermsConditionsUrl(e.termsConditionsUrl),x.setPrivacyPolicyUrl(e.privacyPolicyUrl),x.setCustomWallets(e.customWallets),x.setFeatures(e.features),x.setAllowUnsupportedChain(e.allowUnsupportedChain),x.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),x.setDefaultAccountTypes(e.defaultAccountTypes);const t=K.getPreferredAccountTypes(),r={...x.state.defaultAccountTypes,...t};Y.setPreferredAccountTypes(r);const i=this.getDefaultMetaData();if(!e.metadata&&i&&(e.metadata=i),x.setMetadata(e.metadata),x.setDisableAppend(e.disableAppend),x.setEnableEmbedded(e.enableEmbedded),x.setSIWX(e.siwx),!e.projectId){$s.open(ys.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(((o=e.adapters)==null?void 0:o.find(a=>a.namespace===G.CHAIN.EVM))&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");x.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){var e,t,r,i;return typeof window<"u"&&typeof document<"u"?{name:((t=(e=document.getElementsByTagName("title"))==null?void 0:e[0])==null?void 0:t.textContent)||"",description:((r=document.querySelector('meta[property="og:description"]'))==null?void 0:r.content)||"",url:window.location.origin,icons:[((i=document.querySelector('link[rel~="icon"]'))==null?void 0:i.href)||""]}:null}setUnsupportedNetwork(e){const t=this.getActiveChainNamespace();if(t){const r=ri.getUnsupportedNetwork(`${t}:${e}`);y.setActiveCaipNetwork(r)}}getDefaultNetwork(){return ri.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,t){return ri.extendCaipNetwork(e,{customNetworkImageUrls:t.chainImages,projectId:t.projectId})}extendCaipNetworks(e){return ri.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const t=e.networks.find(i=>{var n;return i.id===((n=e.defaultNetwork)==null?void 0:n.id)});return t?ri.extendCaipNetwork(t,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{var n;const e=y.state.activeChain,t=this.getAdapter(e),r=(n=this.getCaipNetwork(e))==null?void 0:n.id;if(!t)throw new Error("Adapter not found");const i=await t.connectWalletConnect(r);this.close(),this.setClientId((i==null?void 0:i.clientId)||null),K.setConnectedNamespaces([...y.state.chains.keys()]),this.chainNamespaces.forEach(o=>{ne.setConnectorId(Tt.CONNECTOR_TYPE_WALLET_CONNECT,o)}),await this.syncWalletConnectAccount()},connectExternal:async({id:e,info:t,type:r,provider:i,chain:n,caipNetwork:o})=>{var f,g,m,w,v,E;const a=y.state.activeChain,c=n||a,l=this.getAdapter(c);if(n&&n!==a&&!o){const _=this.getCaipNetworks().find(C=>C.chainNamespace===n);_&&this.setCaipNetwork(_)}if(!l)throw new Error("Adapter not found");const d=this.getCaipNetwork(c),u=await l.connect({id:e,info:t,type:r,provider:i,chainId:(o==null?void 0:o.id)||(d==null?void 0:d.id),rpcUrl:((m=(g=(f=o==null?void 0:o.rpcUrls)==null?void 0:f.default)==null?void 0:g.http)==null?void 0:m[0])||((E=(v=(w=d==null?void 0:d.rpcUrls)==null?void 0:w.default)==null?void 0:v.http)==null?void 0:E[0])});if(!u)return;K.addConnectedNamespace(c),this.syncProvider({...u,chainNamespace:c});const{accounts:h}=await l.getAccounts({namespace:c,id:e});this.setAllAccounts(h,c),this.setStatus("connected",c),this.syncConnectedWalletInfo(c)},reconnectExternal:async({id:e,info:t,type:r,provider:i})=>{var a;const n=y.state.activeChain,o=this.getAdapter(n);o!=null&&o.reconnect&&(await(o==null?void 0:o.reconnect({id:e,info:t,type:r,provider:i,chainId:(a=this.getCaipNetwork())==null?void 0:a.id})),K.addConnectedNamespace(n),this.syncConnectedWalletInfo(n))},disconnect:async e=>{const t=e||y.state.activeChain,r=this.getAdapter(t),i=Ne.getProvider(t),n=Ne.getProviderId(t);await(r==null?void 0:r.disconnect({provider:i,providerType:n})),K.removeConnectedNamespace(t),Ne.resetChain(t),this.setUser(void 0,t),this.setStatus("disconnected",t),this.setConnectedWalletInfo(void 0,t)},checkInstalled:e=>e?e.some(t=>{var r;return!!((r=window.ethereum)!=null&&r[String(t)])}):!!window.ethereum,signMessage:async e=>{const t=this.getAdapter(y.state.activeChain),r=await(t==null?void 0:t.signMessage({message:e,address:Y.state.address,provider:Ne.getProvider(y.state.activeChain)}));return(r==null?void 0:r.signature)||""},sendTransaction:async e=>{const t=e.chainNamespace;if(lt.SEND_SUPPORTED_NAMESPACES.includes(t)){const r=this.getAdapter(y.state.activeChain),i=Ne.getProvider(t),n=await(r==null?void 0:r.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:i}));return(n==null?void 0:n.hash)||""}return""},estimateGas:async e=>{if(e.chainNamespace===G.CHAIN.EVM){const t=this.getAdapter(y.state.activeChain),r=Ne.getProvider(y.state.activeChain),i=this.getCaipNetwork();if(!i)throw new Error("CaipNetwork is undefined");const n=await(t==null?void 0:t.estimateGas({...e,provider:r,caipNetwork:i}));return(n==null?void 0:n.gas)||0n}return 0n},getEnsAvatar:async()=>{var e;return await this.syncIdentity({address:Y.state.address,chainId:Number((e=this.getCaipNetwork())==null?void 0:e.id),chainNamespace:y.state.activeChain}),Y.state.profileImage||!1},getEnsAddress:async e=>await an.resolveReownName(e),writeContract:async e=>{const t=this.getAdapter(y.state.activeChain),r=this.getCaipNetwork(),i=this.getCaipAddress(),n=Ne.getProvider(y.state.activeChain);if(!r||!i)throw new Error("CaipNetwork or CaipAddress is undefined");const o=await(t==null?void 0:t.writeContract({...e,caipNetwork:r,provider:n,caipAddress:i}));return o==null?void 0:o.hash},parseUnits:(e,t)=>{const r=this.getAdapter(y.state.activeChain);return(r==null?void 0:r.parseUnits({value:e,decimals:t}))??0n},formatUnits:(e,t)=>{const r=this.getAdapter(y.state.activeChain);return(r==null?void 0:r.formatUnits({value:e,decimals:t}))??"0"},getCapabilities:async e=>{const t=this.getAdapter(y.state.activeChain);return await(t==null?void 0:t.getCapabilities(e))},grantPermissions:async e=>{const t=this.getAdapter(y.state.activeChain);return await(t==null?void 0:t.grantPermissions(e))},revokePermissions:async e=>{const t=this.getAdapter(y.state.activeChain);return t!=null&&t.revokePermissions?await t.revokePermissions(e):"0x"},walletGetAssets:async e=>{const t=this.getAdapter(y.state.activeChain);return await(t==null?void 0:t.walletGetAssets(e))??{}}},this.networkControllerClient={switchCaipNetwork:async e=>await this.switchCaipNetwork(e),getApprovedCaipNetworksData:async()=>this.getApprovedCaipNetworksData()},Ue.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){var t,r,i,n,o;if(Ne.getProviderId(y.state.activeChain)===Tt.CONNECTOR_TYPE_WALLET_CONNECT){const a=(r=(t=this.universalProvider)==null?void 0:t.session)==null?void 0:r.namespaces;return{supportsAllNetworks:((o=(n=(i=this.universalProvider)==null?void 0:i.session)==null?void 0:n.peer)==null?void 0:o.metadata.name)==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(a)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){if(!e)return;const t=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const i=Ne.getProvider(t),n=Ne.getProviderId(t);if(e.chainNamespace===y.state.activeChain){const o=this.getAdapter(t);await(o==null?void 0:o.switchNetwork({caipNetwork:e,provider:i,providerType:n}))}else if(this.setCaipNetwork(e),n===Tt.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const o=this.getAddressByChainNamespace(t);o&&this.syncAccount({address:o,chainId:e.id,chainNamespace:t})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(t=>{const r=t.chains||[],i=t.accounts.map(n=>{const{chainId:o,chainNamespace:a}=Fs.parseCaipAddress(n);return`${a}:${o}`});return Array.from(new Set([...r,...i]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((t,r)=>{var n;const i=e==null?void 0:e.find(o=>o.namespace===r);return i?(i.construct({namespace:r,projectId:(n=this.options)==null?void 0:n.projectId,networks:this.getCaipNetworks()}),t[r]=i):t[r]=new GS({namespace:r,networks:this.getCaipNetworks()}),t},{})}async initChainAdapter(e){var t;this.onConnectors(e),this.listenAdapter(e),(t=this.chainAdapters)==null||t[e].syncConnectors(this.options,this),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)}))}onConnectors(e){const t=this.getAdapter(e);t==null||t.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const t=this.getAdapter(e);if(!t)return;const r=K.getConnectionStatus();r==="connected"?this.setStatus("connecting",e):r==="disconnected"?(K.clearAddressCache(),this.setStatus(r,e)):this.setStatus(r,e),t.on("switchNetwork",({address:i,chainId:n})=>{const o=this.getCaipNetworks().find(l=>l.id===n||l.caipNetworkId===n),a=y.state.activeChain===e,c=y.getAccountProp("address",e);if(o){const l=a&&i?i:c;l&&this.syncAccount({address:l,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(n)}),t.on("disconnect",this.disconnect.bind(this,e)),t.on("pendingTransactions",()=>{const i=Y.state.address,n=y.state.activeCaipNetwork;!i||!(n!=null&&n.id)||this.updateNativeBalance(i,n.id,n.chainNamespace)}),t.on("accountChanged",({address:i,chainId:n})=>{var a,c;const o=y.state.activeChain===e;o&&n?this.syncAccount({address:i,chainId:n,chainNamespace:e}):o&&((a=y.state.activeCaipNetwork)!=null&&a.id)?this.syncAccount({address:i,chainId:(c=y.state.activeCaipNetwork)==null?void 0:c.id,chainNamespace:e}):this.syncAccountInfo(i,n,e),this.syncAllAccounts(e)})}async createUniversalProviderForAdapter(e){var t,r,i;await this.getUniversalProvider(),this.universalProvider&&((i=(r=(t=this.chainAdapters)==null?void 0:t[e])==null?void 0:r.setUniversalProvider)==null||i.call(r,this.universalProvider))}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async syncNamespaceConnection(e){try{const t=ne.getConnectorId(e);switch(this.setStatus("connecting",e),t){case G.CONNECTOR_ID.WALLET_CONNECT:await this.syncWalletConnectAccount();break;case G.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(t){console.warn("AppKit couldn't sync existing connection",t),this.setStatus("disconnected",e)}}async syncAdapterConnection(e){var o,a,c;const t=this.getAdapter(e),r=ne.getConnectorId(e),i=this.getCaipNetwork(e),n=ne.getConnectors(e).find(l=>l.id===r);try{if(!t||!n)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!(i!=null&&i.id))throw new Error("CaipNetwork not found");const l=await(t==null?void 0:t.syncConnection({namespace:e,id:n.id,chainId:i.id,rpcUrl:(c=(a=(o=i==null?void 0:i.rpcUrls)==null?void 0:o.default)==null?void 0:a.http)==null?void 0:c[0]}));if(l){const d=await(t==null?void 0:t.getAccounts({namespace:e,id:n.id}));d&&d.accounts.length>0?this.setAllAccounts(d.accounts,e):this.setAllAccounts([ie.createAccount(e,l.address,"eoa")],e),this.syncProvider({...l,chainNamespace:e}),await this.syncAccount({...l,chainNamespace:e}),this.setStatus("connected",e)}else this.setStatus("disconnected",e)}catch{this.setStatus("disconnected",e)}}async syncWalletConnectAccount(){const e=this.chainNamespaces.map(async t=>{var a,c,l,d,u;const r=this.getAdapter(t),i=((d=(l=(c=(a=this.universalProvider)==null?void 0:a.session)==null?void 0:c.namespaces)==null?void 0:l[t])==null?void 0:d.accounts)||[],n=(u=y.state.activeCaipNetwork)==null?void 0:u.id,o=i.find(h=>{const{chainId:f}=Fs.parseCaipAddress(h);return f===(n==null?void 0:n.toString())})||i[0];if(o){const h=Fs.validateCaipAddress(o),{chainId:f,address:g}=Fs.parseCaipAddress(h);if(Ne.setProviderId(t,Tt.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&y.state.activeCaipNetwork&&(r==null?void 0:r.namespace)!==G.CHAIN.EVM){const m=r==null?void 0:r.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:y.state.activeCaipNetwork});Ne.setProvider(t,m)}else Ne.setProvider(t,this.universalProvider);ne.setConnectorId(G.CONNECTOR_ID.WALLET_CONNECT,t),K.addConnectedNamespace(t),this.syncWalletConnectAccounts(t),await this.syncAccount({address:g,chainId:f,chainNamespace:t})}else this.setStatus("disconnected",t);this.syncConnectedWalletInfo(t),await y.setApprovedCaipNetworksData(t)});await Promise.all(e)}syncWalletConnectAccounts(e){var r,i,n,o,a;const t=(a=(o=(n=(i=(r=this.universalProvider)==null?void 0:r.session)==null?void 0:i.namespaces)==null?void 0:n[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>{const{address:l}=Fs.parseCaipAddress(c);return l}).filter((c,l,d)=>d.indexOf(c)===l);t&&this.setAllAccounts(t.map(c=>ie.createAccount(e,c,e==="bip122"?"payment":"eoa")),e)}syncProvider({type:e,provider:t,id:r,chainNamespace:i}){Ne.setProviderId(i,e),Ne.setProvider(i,t),ne.setConnectorId(r,i)}async syncAllAccounts(e){const t=ne.getConnectorId(e);if(!t)return;const r=this.getAdapter(e),i=await(r==null?void 0:r.getAccounts({namespace:e,id:t}));i&&i.accounts.length>0&&this.setAllAccounts(i.accounts,e)}async syncAccount(e){var u,h;const t=e.chainNamespace===y.state.activeChain,r=y.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:i,chainId:n,chainNamespace:o}=e,{chainId:a}=K.getActiveNetworkProps(),c=n||a,l=((u=y.state.activeCaipNetwork)==null?void 0:u.name)===G.UNSUPPORTED_NETWORK_NAME,d=y.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(l&&!d)&&c){let f=this.getCaipNetworks().find(w=>w.id.toString()===c.toString()),g=this.getCaipNetworks().find(w=>w.chainNamespace===o);if(!d&&!f&&!g){const w=this.getApprovedCaipNetworkIds()||[],v=w.find(_=>{var C;return((C=Fs.parseCaipNetworkId(_))==null?void 0:C.chainId)===c.toString()}),E=w.find(_=>{var C;return((C=Fs.parseCaipNetworkId(_))==null?void 0:C.chainNamespace)===o});f=this.getCaipNetworks().find(_=>_.caipNetworkId===v),g=this.getCaipNetworks().find(_=>_.caipNetworkId===E||"deprecatedCaipNetworkId"in _&&_.deprecatedCaipNetworkId===E)}const m=f||g;(m==null?void 0:m.chainNamespace)===y.state.activeChain?x.state.enableNetworkSwitch&&!x.state.allowUnsupportedChain&&((h=y.state.activeCaipNetwork)==null?void 0:h.name)===G.UNSUPPORTED_NETWORK_NAME?y.showUnsupportedChainUI():this.setCaipNetwork(m):t||r&&this.setCaipNetworkOfNamespace(r,o),this.syncConnectedWalletInfo(o),Go.isLowerCaseMatch(i,Y.state.address)||this.syncAccountInfo(i,m==null?void 0:m.id,o),t?await this.syncBalance({address:i,chainId:m==null?void 0:m.id,chainNamespace:o}):await this.syncBalance({address:i,chainId:r==null?void 0:r.id,chainNamespace:o})}}async syncAccountInfo(e,t,r){const i=this.getCaipAddress(r),n=t||(i==null?void 0:i.split(":")[1]);if(!n)return;const o=`${r}:${n}:${e}`;this.setCaipAddress(o,r),await this.syncIdentity({address:e,chainId:n,chainNamespace:r})}async syncReownName(e,t){try{const r=await this.getReownName(e);if(r[0]){const i=r[0];this.setProfileName(i.name,t)}else this.setProfileName(null,t)}catch{this.setProfileName(null,t)}}syncConnectedWalletInfo(e){var i;const t=ne.getConnectorId(e),r=Ne.getProviderId(e);if(r===Tt.CONNECTOR_TYPE_ANNOUNCED||r===Tt.CONNECTOR_TYPE_INJECTED){if(t){const n=this.getConnectors().find(o=>o.id===t);if(n){const{info:o,name:a,imageUrl:c}=n,l=c||this.getConnectorImage(n);this.setConnectedWalletInfo({name:a,icon:l,...o},e)}}}else if(r===Tt.CONNECTOR_TYPE_WALLET_CONNECT){const n=Ne.getProvider(e);n!=null&&n.session&&this.setConnectedWalletInfo({...n.session.peer.metadata,name:n.session.peer.metadata.name,icon:(i=n.session.peer.metadata.icons)==null?void 0:i[0]},e)}else if(t)if(t===G.CONNECTOR_ID.COINBASE){const n=this.getConnectors().find(o=>o.id===G.CONNECTOR_ID.COINBASE);this.setConnectedWalletInfo({name:"Coinbase Wallet",icon:this.getConnectorImage(n)},e)}else this.setConnectedWalletInfo({name:t},e)}async syncBalance(e){!hu.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(r=>{var i;return r.id.toString()===((i=e.chainId)==null?void 0:i.toString())})||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async updateNativeBalance(e,t,r){const i=this.getAdapter(r),n=y.getCaipNetworkByNamespace(r,t);if(i){const o=await i.getBalance({address:e,chainId:t,caipNetwork:n,tokens:this.options.tokens});this.setBalance(o.balance,o.symbol,r)}}async initializeUniversalAdapter(){var r,i,n,o,a,c,l,d,u,h;const e=nA.createLogger((f,...g)=>{f&&this.handleAlertError(f),console.error(...g)}),t={projectId:(r=this.options)==null?void 0:r.projectId,metadata:{name:(i=this.options)!=null&&i.metadata?(n=this.options)==null?void 0:n.metadata.name:"",description:(o=this.options)!=null&&o.metadata?(a=this.options)==null?void 0:a.metadata.description:"",url:(c=this.options)!=null&&c.metadata?(l=this.options)==null?void 0:l.metadata.url:"",icons:(d=this.options)!=null&&d.metadata?(u=this.options)==null?void 0:u.metadata.icons:[""]},logger:e};x.setManualWCControl(!!((h=this.options)!=null&&h.manualWCControl)),this.universalProvider=this.options.universalProvider??await Y0.init(t),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&(this.universalProvider.on("display_uri",e=>{Ue.setUri(e)}),this.universalProvider.on("connect",Ue.finalizeWcConnection),this.universalProvider.on("disconnect",()=>{this.chainNamespaces.forEach(e=>{this.resetAccount(e)}),Ue.resetWcConnection()}),this.universalProvider.on("chainChanged",e=>{const t=this.getCaipNetworks().find(i=>i.id==e),r=this.getCaipNetwork();if(!t){this.setUnsupportedNetwork(e);return}(r==null?void 0:r.id)!==(t==null?void 0:t.id)&&this.setCaipNetwork(t)}),this.universalProvider.on("session_event",e=>{if(an.isSessionEventData(e)){const{name:t,data:r}=e.params.event;t==="accountsChanged"&&Array.isArray(r)&&ie.isCaipAddress(r[0])&&this.syncAccount(Fs.parseCaipAddress(r[0]))}}))}createUniversalProvider(){var e;return!this.universalProviderInitPromise&&ie.isClient()&&((e=this.options)!=null&&e.projectId)&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){Le.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}handleAlertError(e){const t=Object.entries(ys.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[r,i]=t??[],{message:n,alertErrorKey:o}=i??{};if(r&&n&&!this.reportedAlertErrors[r]){const a=ys.ALERT_ERRORS[o];a&&($s.open(a,"error"),this.reportedAlertErrors[r]=!0)}}getAdapter(e){var t;if(e)return(t=this.chainAdapters)==null?void 0:t[e]}createAdapter(e){var i;if(!e)return;const t=e.namespace;if(!t)return;this.createClients();const r=e;r.namespace=t,r.construct({namespace:t,projectId:(i=this.options)==null?void 0:i.projectId,networks:this.getCaipNetworks()}),this.chainNamespaces.includes(t)||this.chainNamespaces.push(t),this.chainAdapters&&(this.chainAdapters[t]=r)}async open(e){if(await this.injectModalUi(),e!=null&&e.uri&&Ue.setUri(e.uri),e!=null&&e.arguments)switch(e==null?void 0:e.view){case"Swap":return Fe.open({...e,data:{swap:e.arguments}})}return Fe.open(e)}async close(e=!1){await this.injectModalUi(),Fe.close(e)}setLoading(e,t){Fe.setLoading(e,t)}async disconnect(e){await Ue.disconnect(e)}getSIWX(){return x.state.siwx}getError(){return""}getChainId(){var e;return(e=y.state.activeCaipNetwork)==null?void 0:e.id}async switchNetwork(e){const t=this.getCaipNetworks().find(r=>r.id===e.id);if(!t){$s.open(ys.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await y.switchActiveNetwork(t)}getWalletProvider(){return y.state.activeChain?Ne.state.providers[y.state.activeChain]:null}getWalletProviderType(){return Ne.getProviderId(y.state.activeChain)}subscribeProviders(e){return Ne.subscribeProviders(e)}getThemeMode(){return ft.state.themeMode}getThemeVariables(){return ft.state.themeVariables}setThemeMode(e){ft.setThemeMode(e),cp(ft.state.themeMode)}setTermsConditionsUrl(e){x.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){x.setPrivacyPolicyUrl(e)}setThemeVariables(e){ft.setThemeVariables(e),zS(ft.state.themeVariables)}subscribeTheme(e){return ft.subscribe(e)}getWalletInfo(){return Y.state.connectedWalletInfo}getAccount(e){var o;const t=ne.getAuthConnector(e),r=y.getAccountData(e),i=y.state.activeChain,n=K.getConnectedConnectorId(e);if(r)return{allAccounts:r.allAccounts,caipAddress:r.caipAddress,address:ie.getPlainAddress(r.caipAddress),isConnected:!!r.caipAddress,status:r.status,embeddedWalletInfo:t&&n===G.CONNECTOR_ID.AUTH?{user:r.user?{...r.user,username:K.getConnectedSocialUsername()}:void 0,authProvider:r.socialProvider||"email",accountType:(o=r.preferredAccountTypes)==null?void 0:o[e||i],isSmartAccountDeployed:!!r.smartAccountDeployed}:void 0}}subscribeAccount(e,t){const r=()=>{const i=this.getAccount(t);i&&e(i)};t?y.subscribeChainProp("accountState",r,t):y.subscribe(r),ne.subscribe(r)}subscribeNetwork(e){return y.subscribe(({activeCaipNetwork:t})=>{e({caipNetwork:t,chainId:t==null?void 0:t.id,caipNetworkId:t==null?void 0:t.caipNetworkId})})}subscribeWalletInfo(e){return Y.subscribeKey("connectedWalletInfo",e)}subscribeShouldUpdateToAddress(e){Y.subscribeKey("shouldUpdateToAddress",e)}subscribeCaipNetworkChange(e){y.subscribeKey("activeCaipNetwork",e)}getState(){return Es.state}subscribeState(e){return Es.subscribe(e)}showErrorMessage(e){rs.showError(e)}showSuccessMessage(e){rs.showSuccess(e)}getEvent(){return{...Le.state}}subscribeEvents(e){return Le.subscribe(e)}replace(e){Ae.replace(e)}redirect(e){Ae.push(e)}popTransactionStack(e){Ae.popTransactionStack(e)}isOpen(){return Fe.state.open}isTransactionStackEmpty(){return Ae.state.transactionStack.length===0}isTransactionShouldReplaceView(){var e;return(e=Ae.state.transactionStack[Ae.state.transactionStack.length-1])==null?void 0:e.replace}static getInstance(){return this.instance}updateFeatures(e){x.setFeatures(e)}updateOptions(e){const r={...x.state||{},...e};x.setOptions(r)}setConnectMethodsOrder(e){x.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){x.setWalletFeaturesOrder(e)}setCollapseWallets(e){x.setCollapseWallets(e)}setSocialsOrder(e){x.setSocialsOrder(e)}getConnectMethodsOrder(){return wc.getConnectOrderMethod(x.state.features,ne.getConnectors())}addNetwork(e,t){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const r=this.extendCaipNetwork(t,this.options);this.getCaipNetworks().find(i=>i.id===r.id)||y.addNetwork(r)}removeNetwork(e,t){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(i=>i.id===t)&&y.removeNetwork(e,t)}}let cu=!1;class up extends YS{setupAuthConnectorListeners(e){e.onRpcRequest(t=>{Mt.checkIfRequestExists(t)?Mt.checkIfRequestIsSafe(t)||this.handleUnsafeRPCRequest():(this.open(),console.error(dt.RPC_METHOD_NOT_ALLOWED_MESSAGE,{method:t.method}),setTimeout(()=>{this.showErrorMessage(dt.RPC_METHOD_NOT_ALLOWED_UI_MESSAGE)},300),e.rejectRpcRequests())}),e.onRpcError(()=>{this.isOpen()&&(this.isTransactionStackEmpty()?this.close(!0):this.popTransactionStack(!0))}),e.onRpcSuccess((t,r)=>{const i=Mt.checkIfRequestIsSafe(r),n=Y.state.address,o=y.state.activeCaipNetwork;i||(this.isTransactionStackEmpty()?(this.close(!0),n&&(o!=null&&o.id)&&this.updateNativeBalance(n,o.id,o.chainNamespace)):(this.popTransactionStack(),n&&(o!=null&&o.id)&&this.updateNativeBalance(n,o.id,o.chainNamespace)))}),e.onNotConnected(()=>{const t=y.state.activeChain;ne.getConnectorId(t)===G.CONNECTOR_ID.AUTH&&(this.setCaipAddress(void 0,t),this.setLoading(!1,t))}),e.onConnect(async t=>{var a,c;const r=y.state.activeChain,i=r===G.CHAIN.EVM?`eip155:${t.chainId}:${t.address}`:`${t.chainId}:${t.address}`,n=t.preferredAccountType||((a=Y.state.preferredAccountTypes)==null?void 0:a[r])||x.state.defaultAccountTypes[r];Go.isLowerCaseMatch(t.address,Y.state.address)||this.syncIdentity({address:t.address,chainId:t.chainId,chainNamespace:r}),this.setCaipAddress(i,r),this.setUser({...Y.state.user||{},...t},r),this.setSmartAccountDeployed(!!t.smartAccountDeployed,r),this.setPreferredAccountType(n,r);const o=(c=t.accounts)==null?void 0:c.map(l=>{var d;return ie.createAccount(r,l.address,l.type||((d=Y.state.preferredAccountTypes)==null?void 0:d[r])||x.state.defaultAccountTypes[r])});this.setAllAccounts(o||[ie.createAccount(r,t.address,t.preferredAccountType||n)],r),await e.getSmartAccountEnabledNetworks(),this.setLoading(!1,r)}),e.onSocialConnected(({userName:t})=>{this.setUser({...Y.state.user||{},username:t},y.state.activeChain)}),e.onGetSmartAccountEnabledNetworks(t=>{this.setSmartAccountEnabledNetworks(t,y.state.activeChain)}),e.onSetPreferredAccount(({address:t,type:r})=>{t&&this.setPreferredAccountType(r,y.state.activeChain)})}async syncAuthConnector(e,t){var d,u,h,f;const r=G.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(t);if(!r)return;this.setLoading(!0,t);const i=e.getLoginEmailUsed();this.setLoading(i,t),i&&this.setStatus("connecting",t);const n=e.getEmail(),o=e.getUsername();this.setUser({...((d=Y.state)==null?void 0:d.user)||{},username:o,email:n},y.state.activeChain),this.setupAuthConnectorListeners(e);const{isConnected:a}=await e.isConnected(),c=ft.getSnapshot(),l=x.getSnapshot();e.syncDappData({metadata:l.metadata,sdkVersion:l.sdkVersion,projectId:l.projectId,sdkType:l.sdkType}),e.syncTheme({themeMode:c.themeMode,themeVariables:c.themeVariables,w3mThemeVariables:Ds(c.themeVariables,c.themeMode)}),t&&r&&(a&&((u=this.connectionControllerClient)!=null&&u.connectExternal)?(await((f=this.connectionControllerClient)==null?void 0:f.connectExternal({id:G.CONNECTOR_ID.AUTH,info:{name:G.CONNECTOR_ID.AUTH},type:Tt.CONNECTOR_TYPE_AUTH,provider:e,chainId:(h=y.state.activeCaipNetwork)==null?void 0:h.id,chain:t})),this.setStatus("connected",t)):ne.getConnectorId(t)===G.CONNECTOR_ID.AUTH&&(this.setStatus("disconnected",t),K.removeConnectedNamespace(t))),this.setLoading(!1,t)}async checkExistingTelegramSocialConnection(e){var t;try{if(!ie.isTelegram())return;const r=K.getTelegramSocialProvider();if(!r||typeof window>"u"||typeof document>"u")return;const n=new URL(window.location.href).searchParams.get("result_uri");if(!n)return;Y.setSocialProvider(r,e),await((t=this.authProvider)==null?void 0:t.init());const o=ne.getAuthConnector();r&&o&&(this.setLoading(!0,e),await o.provider.connectSocial(n),await Ue.connectExternal(o,o.chain),K.setConnectedSocialProvider(r),K.removeTelegramSocialProvider(),Le.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",properties:{provider:r}}))}catch(r){this.setLoading(!1,e),console.error("checkExistingSTelegramocialConnection error",r)}try{const r=new URL(window.location.href);r.searchParams.delete("result_uri"),window.history.replaceState({},document.title,r.toString())}catch(r){console.error("tma social login failed",r)}}createAuthProvider(e){var o,a,c,l,d,u,h,f,g,m,w,v,E,_,C;if(!G.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(e))return;const r=((a=(o=this.options)==null?void 0:o.features)==null?void 0:a.email)===void 0?lt.DEFAULT_FEATURES.email:(l=(c=this.options)==null?void 0:c.features)==null?void 0:l.email,i=(u=(d=this.options)==null?void 0:d.features)!=null&&u.socials?((g=(f=(h=this.options)==null?void 0:h.features)==null?void 0:f.socials)==null?void 0:g.length)>0:((w=(m=this.options)==null?void 0:m.features)==null?void 0:w.socials)??lt.DEFAULT_FEATURES.socials,n=r||i;!this.authProvider&&((v=this.options)!=null&&v.projectId)&&n&&(this.authProvider=sn.getInstance({projectId:this.options.projectId,enableLogger:this.options.enableAuthLogger,chainId:(E=this.getCaipNetwork(e))==null?void 0:E.caipNetworkId,abortController:ys.EmbeddedWalletAbortController,onTimeout:k=>{k==="iframe_load_failed"?$s.open(ys.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):k==="iframe_request_timeout"?$s.open(ys.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):k==="unverified_domain"&&$s.open(ys.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")}}),Es.subscribeOpen(k=>{var T;!k&&this.isTransactionStackEmpty()&&((T=this.authProvider)==null||T.rejectRpcRequests())}),e===G.CHAIN.EVM&&((_=Y.state.preferredAccountTypes)!=null&&_.eip155)&&this.authProvider.setPreferredAccount((C=Y.state.preferredAccountTypes)==null?void 0:C.eip155),this.syncAuthConnector(this.authProvider,e),this.checkExistingTelegramSocialConnection(e))}createAuthProviderForAdapter(e){var t,r,i;this.createAuthProvider(e),this.authProvider&&((i=(r=(t=this.chainAdapters)==null?void 0:t[e])==null?void 0:r.setAuthProvider)==null||i.call(r,this.authProvider))}initControllers(e){super.initControllers(e),this.options.excludeWalletIds&&te.initializeExcludedWallets({ids:this.options.excludeWalletIds})}async switchCaipNetwork(e){var n,o;if(!e)return;const t=y.state.activeChain,r=e.chainNamespace,i=this.getAddressByChainNamespace(e.chainNamespace);if(e.chainNamespace===y.state.activeChain&&i){const a=this.getAdapter(r),c=Ne.getProvider(r),l=Ne.getProviderId(r);await(a==null?void 0:a.switchNetwork({caipNetwork:e,provider:c,providerType:l})),this.setCaipNetwork(e)}else{const c=Ne.getProviderId(t)===Tt.CONNECTOR_TYPE_AUTH,l=Ne.getProviderId(r),d=l===Tt.CONNECTOR_TYPE_AUTH,u=G.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(r);if((c||d)&&u)try{y.state.activeChain=e.chainNamespace,await((o=(n=this.connectionControllerClient)==null?void 0:n.connectExternal)==null?void 0:o.call(n,{id:G.CONNECTOR_ID.AUTH,provider:this.authProvider,chain:r,chainId:e.id,type:Tt.CONNECTOR_TYPE_AUTH,caipNetwork:e})),this.setCaipNetwork(e)}catch{const f=this.getAdapter(r);await(f==null?void 0:f.switchNetwork({caipNetwork:e,provider:this.authProvider,providerType:l}))}else l===Tt.CONNECTOR_TYPE_WALLET_CONNECT?(this.setCaipNetwork(e),this.syncWalletConnectAccount()):(this.setCaipNetwork(e),i&&this.syncAccount({address:i,chainId:e.id,chainNamespace:r}))}}async initChainAdapter(e){await super.initChainAdapter(e),this.createAuthProviderForAdapter(e)}async syncIdentity({address:e,chainId:t,chainNamespace:r}){var o;const i=`${r}:${t}`,n=(o=this.caipNetworks)==null?void 0:o.find(a=>a.caipNetworkId===i);if(r!==G.CHAIN.EVM||n!=null&&n.testnet){this.setProfileName(null,r),this.setProfileImage(null,r);return}try{const{name:a,avatar:c}=await this.fetchIdentity({address:e,caipNetworkId:i});this.setProfileName(a,r),this.setProfileImage(c,r)}catch{await this.syncReownName(e,r),t!==1&&this.setProfileImage(null,r)}}syncConnectedWalletInfo(e){const t=Ne.getProviderId(e);if(t===Tt.CONNECTOR_TYPE_AUTH){const r=this.authProvider;if(r){const i=K.getConnectedSocialProvider()??"email",n=r.getEmail()??r.getUsername();this.setConnectedWalletInfo({name:t,identifier:n,social:i},e)}}else super.syncConnectedWalletInfo(e)}async injectModalUi(){if(!cu&&ie.isClient()){const e={...lt.DEFAULT_FEATURES,...this.options.features},t=[];if(e&&((e.email||e.socials&&e.socials.length)&&t.push(Vt(()=>import("./embedded-wallet-Be7BeICu.js"),__vite__mapDeps([3,4,1,2,5,6,7,8,9,10,11,12,13,14]))),e.email&&t.push(Vt(()=>import("./email-f2-TTO6i.js"),__vite__mapDeps([15,4,1,2,14,8,13,7,12,16,9]))),e.socials&&t.push(Vt(()=>import("./socials-Bkyt1kXA.js"),__vite__mapDeps([17,4,1,2,18,7,19,20,13,21,12,8,14,22,6,23,24]))),e.swaps&&t.push(Vt(()=>import("./swaps-CtItMOLF.js"),__vite__mapDeps([25,4,1,2,12,8,26,27,28,6,13,24,9,7]))),e.send&&t.push(Vt(()=>import("./send-BJHVUFVq.js"),__vite__mapDeps([29,4,1,2,12,8,13,7,19,14,28,6,9,30,31]))),e.receive&&t.push(Vt(()=>import("./receive-DYPKYs-1.js"),__vite__mapDeps([32,4,1,2,33,6,22,23]))),e.onramp&&t.push(Vt(()=>import("./onramp-C5khZrCG.js"),__vite__mapDeps([34,4,1,2,35,24,13,6,8,36,18,7,19,37,14,12,21,9]))),e.history&&t.push(Vt(()=>import("./transactions-CQd-wA0I.js"),__vite__mapDeps([38,4,1,2,39,35,24,13,14,6]))),e.pay&&t.push(Vt(()=>import("./index-BR8_a7pJ.js"),__vite__mapDeps([40,4,1,2,12,8,41,6,13,10,36,31,21])))),await Promise.all([...t,Vt(()=>import("./index-V8I_cuBF.js"),__vite__mapDeps([42,4,1,2,6,8,30,13,43,27,10,36,12,11,41,39,35,24,14,26,7,9,31,16,18,19,20,5,21,33,22,23,37])),Vt(()=>import("./w3m-modal-DTlqIVnD.js"),__vite__mapDeps([44,4,1,2,10,6,13,11,8,27,43]))]),!document.querySelector("w3m-modal")){const i=document.createElement("w3m-modal");!x.state.disableAppend&&!x.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",i)}cu=!0}}}const ZS="1.7.4";function JS(s){return new up({...s,sdkVersion:ie.generateSdkVersion(s.adapters??[],"html",ZS)})}const $N=Object.freeze(Object.defineProperty({__proto__:null,AccountController:Y,AppKit:up,CoreHelperUtil:ie,DEFAULT_METHODS:lp,WcConstantsUtil:li,WcHelpersUtil:an,createAppKit:JS},Symbol.toStringTag,{value:"Module"}));export{Ai as $,Y as A,re as B,ne as C,te as D,Vh as E,eN as F,eA as G,ss as H,Hp as I,Ne as J,kN as K,wc as L,Fe as M,Bp as N,x as O,Fs as P,go as Q,Ae as R,rs as S,ft as T,tn as U,PN as V,dt as W,st as X,RN as Y,sp as Z,yc as _,wo as a,wg as a0,yN as a1,rl as a2,Au as a3,ag as a4,yg as a5,vN as a6,wN as a7,Bo as a8,bN as a9,EN as aa,$N as ab,lt as b,G as c,ie as d,y as e,Le as f,Ds as g,xN as h,hi as i,Mt as j,Ue as k,Tt as l,SS as m,$s as n,NS as o,K as p,ys as q,ON as r,qd as s,gu as t,je as u,Bd as v,Rt as w,TN as x,Et as y,QS as z};
